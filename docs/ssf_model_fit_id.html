<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.40">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Scott Forrest">
<meta name="dcterms.date" content="2025-02-18">

<title>SSF Model Fitting – deepSSF</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./ssf_validation.html" rel="next">
<link href="./Python/deepSSF_next_step_validation_S2.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-549806ee2085284f45b00abea8c6df48.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-4a1c1709ed6c34e18d4d8b73dec7994d.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<link href="site_libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet">

<script src="site_libs/pagedtable-1.1/js/pagedtable.js"></script>


  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">deepSSF</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./getting_started.html"> 
<span class="menu-text">Getting Started</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./study_system.html"> 
<span class="menu-text">Study System</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./data_preparation.html"> 
<span class="menu-text">Data Preparation</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./model_training.html"> 
<span class="menu-text">Model Training</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./predictions.html"> 
<span class="menu-text">Predictions</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./inference.html"> 
<span class="menu-text">Inference</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="./validation.html" aria-current="page"> 
<span class="menu-text">Validation</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="https://swforrest.github.io"> 
<span class="menu-text">Website</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/swforrest/deepSSF"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="mailto:scottwforrest@gmail.com"> <i class="bi bi-envelope-at-fill" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/in/swforrest/"> <i class="bi bi-linkedin" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://bsky.app/profile/scottwilliamf.bsky.social"> 
<span class="menu-text">Bluesky</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./ssf_model_fit_id.html">SSF Model Fitting</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./validation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Validation</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Python/deepSSF_next_step_validation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">deepSSF Validation</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Python/deepSSF_next_step_validation_S2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">deepSSF Validation - S2</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ssf_model_fit_id.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">SSF Model Fitting</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ssf_validation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">SSF Validation</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./validation_comparison.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Comparing SSF and deepSSF Predictions</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#load-packages" id="toc-load-packages" class="nav-link active" data-scroll-target="#load-packages">Load packages</a></li>
  <li><a href="#importing-buffalo-data" id="toc-importing-buffalo-data" class="nav-link" data-scroll-target="#importing-buffalo-data">Importing buffalo data</a></li>
  <li><a href="#fitting-the-models" id="toc-fitting-the-models" class="nav-link" data-scroll-target="#fitting-the-models">Fitting the models</a>
  <ul class="collapse">
  <li><a href="#creating-a-data-matrix" id="toc-creating-a-data-matrix" class="nav-link" data-scroll-target="#creating-a-data-matrix">Creating a data matrix</a></li>
  <li><a href="#selecting-data" id="toc-selecting-data" class="nav-link" data-scroll-target="#selecting-data">Selecting data</a></li>
  <li><a href="#model-formula" id="toc-model-formula" class="nav-link" data-scroll-target="#model-formula">Model formula</a></li>
  <li><a href="#fit-the-model" id="toc-fit-the-model" class="nav-link" data-scroll-target="#fit-the-model">Fit the model</a></li>
  <li><a href="#check-the-fitted-model-outputs" id="toc-check-the-fitted-model-outputs" class="nav-link" data-scroll-target="#check-the-fitted-model-outputs">Check the fitted model outputs</a></li>
  <li><a href="#reconstruct-the-temporally-dynamic-coefficients" id="toc-reconstruct-the-temporally-dynamic-coefficients" class="nav-link" data-scroll-target="#reconstruct-the-temporally-dynamic-coefficients">Reconstruct the temporally dynamic coefficients</a></li>
  <li><a href="#plot-the-results---scaled-temporally-dynamic-coefficients" id="toc-plot-the-results---scaled-temporally-dynamic-coefficients" class="nav-link" data-scroll-target="#plot-the-results---scaled-temporally-dynamic-coefficients">Plot the results - scaled temporally dynamic coefficients</a></li>
  <li><a href="#reconstructing-the-natural-scale-temporally-dynamic-coefficients" id="toc-reconstructing-the-natural-scale-temporally-dynamic-coefficients" class="nav-link" data-scroll-target="#reconstructing-the-natural-scale-temporally-dynamic-coefficients">Reconstructing the natural-scale temporally dynamic coefficients</a></li>
  <li><a href="#update-the-gamma-and-von-mises-distributions" id="toc-update-the-gamma-and-von-mises-distributions" class="nav-link" data-scroll-target="#update-the-gamma-and-von-mises-distributions">Update the Gamma and von Mises distributions</a></li>
  <li><a href="#plot-the-natural-scale-temporally-dynamic-coefficients" id="toc-plot-the-natural-scale-temporally-dynamic-coefficients" class="nav-link" data-scroll-target="#plot-the-natural-scale-temporally-dynamic-coefficients">Plot the natural-scale temporally dynamic coefficients</a></li>
  <li><a href="#plot-only-the-temporally-dynamic-movement-parameters" id="toc-plot-only-the-temporally-dynamic-movement-parameters" class="nav-link" data-scroll-target="#plot-only-the-temporally-dynamic-movement-parameters">Plot only the temporally dynamic movement parameters</a></li>
  <li><a href="#sample-from-temporally-dynamic-movement-parameters" id="toc-sample-from-temporally-dynamic-movement-parameters" class="nav-link" data-scroll-target="#sample-from-temporally-dynamic-movement-parameters">Sample from temporally dynamic movement parameters</a></li>
  <li><a href="#creating-selection-surfaces" id="toc-creating-selection-surfaces" class="nav-link" data-scroll-target="#creating-selection-surfaces">Creating selection surfaces</a></li>
  <li><a href="#ndvi-selection-surface" id="toc-ndvi-selection-surface" class="nav-link" data-scroll-target="#ndvi-selection-surface">NDVI selection surface</a></li>
  <li><a href="#canopy-cover-selection-surface" id="toc-canopy-cover-selection-surface" class="nav-link" data-scroll-target="#canopy-cover-selection-surface">Canopy cover selection surface</a></li>
  </ul></li>
  <li><a href="#combining-the-plots" id="toc-combining-the-plots" class="nav-link" data-scroll-target="#combining-the-plots">Combining the plots</a>
  <ul class="collapse">
  <li><a href="#movement-parameters" id="toc-movement-parameters" class="nav-link" data-scroll-target="#movement-parameters">Movement parameters</a></li>
  <li><a href="#habitat-selection" id="toc-habitat-selection" class="nav-link" data-scroll-target="#habitat-selection">Habitat selection</a></li>
  </ul></li>
  <li><a href="#combining-selection-surfaces" id="toc-combining-selection-surfaces" class="nav-link" data-scroll-target="#combining-selection-surfaces">Combining selection surfaces</a>
  <ul class="collapse">
  <li><a href="#ndvi" id="toc-ndvi" class="nav-link" data-scroll-target="#ndvi">NDVI</a></li>
  <li><a href="#canopy-cover" id="toc-canopy-cover" class="nav-link" data-scroll-target="#canopy-cover">Canopy cover</a></li>
  </ul></li>
  <li><a href="#adding-all-selection-surfaces-to-the-same-plot" id="toc-adding-all-selection-surfaces-to-the-same-plot" class="nav-link" data-scroll-target="#adding-all-selection-surfaces-to-the-same-plot">Adding all selection surfaces to the same plot</a>
  <ul class="collapse">
  <li><a href="#all-selection-surfaces" id="toc-all-selection-surfaces" class="nav-link" data-scroll-target="#all-selection-surfaces">All selection surfaces</a></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references">References</a></li>
  <li><a href="#session-info" id="toc-session-info" class="nav-link" data-scroll-target="#session-info">Session info</a></li>
  </ul></li>
  </ul>
<div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="ssf_model_fit_id.pdf"><i class="bi bi-file-pdf"></i>PDF</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">SSF Model Fitting</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
</div>


<div class="quarto-title-meta-author">
  <div class="quarto-title-meta-heading">Author</div>
  <div class="quarto-title-meta-heading">Affiliation</div>
  
    <div class="quarto-title-meta-contents">
    <p class="author"><a href="https://swforrest.github.io/">Scott Forrest</a> <a href="mailto:scottwforrest@gmail.com" class="quarto-title-author-email"><i class="bi bi-envelope"></i></a> <a href="https://orcid.org/0000-0001-9529-0108" class="quarto-title-author-orcid"> <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg=="></a></p>
  </div>
  <div class="quarto-title-meta-contents">
        <p class="affiliation">
            Queensland University of Technology, CSIRO
          </p>
      </div>
  </div>

<div class="quarto-title-meta">

      
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">February 18, 2025</p>
    </div>
  </div>
  
    
  </div>
  
<div>
  <div class="abstract">
    <div class="block-title">Abstract</div>
    <p>To compare the next-step predictions of the deepSSF models to SSF models, we need to fit some SSF models to the same data and covariates. Here we fit SSF models with and without temporal harmonics to buffalo data, which is similar to the approach in <span class="citation" data-cites="Forrest2024-gc">Forrest et al. (<a href="#ref-Forrest2024-gc" role="doc-biblioref">2024</a>)</span> except that here we are just fitting the models to the focal individual, rather than to multiple individuals.</p>
    <p>We use the estimated parameters of the SSF models to generate next-step predictions of the SSF models in the <a href="./ssf_validation.html">SSF Validation</a> script, and compare these to the next-step predictions of the deepSSF models.</p>
    <p>Whilst we have included temporal dynamics on an daily time-scale using the harmonics, also including seasonal temporal dynamics (such that daily behaviours also change across seasons - requiring an interaction between the daily and seasonal harmonics) is difficult. We have therefore only fitted the SSF models with daily temporal dynamics.</p>
    <p>We have also not fitted the SSF models to the Sentinel-2 data, as we have done with the deepSSF models.</p>
  </div>
</div>


</header>


<section id="load-packages" class="level2">
<h2 class="anchored" data-anchor-id="load-packages">Load packages</h2>
<div class="cell">
<details class="code-fold">
<summary>Loading packages</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="fu">options</span>(<span class="at">scipen=</span><span class="dv">999</span>)</span>
<span id="cb1-2"><a href="#cb1-2"></a></span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-4"><a href="#cb1-4"></a>packages <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"amt"</span>, <span class="st">"lubridate"</span>, <span class="st">"terra"</span>, <span class="st">"tictoc"</span>, </span>
<span id="cb1-5"><a href="#cb1-5"></a>              <span class="st">"beepr"</span>, <span class="st">"ggpubr"</span>)</span>
<span id="cb1-6"><a href="#cb1-6"></a><span class="fu">walk</span>(packages, require, <span class="at">character.only =</span> T)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="importing-buffalo-data" class="level2">
<h2 class="anchored" data-anchor-id="importing-buffalo-data">Importing buffalo data</h2>
<p>Import the buffalo data with random steps and extracted covariates that we created for the paper <span class="citation" data-cites="Forrest2024-gc">Forrest et al. (<a href="#ref-Forrest2024-gc" role="doc-biblioref">2024</a>)</span>, in the script <code>Ecography_DynamicSSF_1_Step_generation</code>. This repo can be found at: <a href="https://github.com/swforrest/dynamic_SSF_sims">swforrest/dynamic_SSF_sims</a>.</p>
<p>Here we create the sine and cosine terms that were interact with each of the covariates to fit temporally varying parameters.</p>
<div class="cell">
<details class="code-fold">
<summary>Importing data</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a>buffalo_data_all <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"data/buffalo_parametric_popn_covs_GvM_10rs_2024-09-04.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 1165406 Columns: 22
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
dbl  (18): id, burst_, x1_, x2_, y1_, y2_, sl_, ta_, dt_, hour_t2, step_id_,...
lgl   (1): case_
dttm  (3): t1_, t2_, t2_rounded

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<details class="code-fold">
<summary>Importing data</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a>buffalo_data_all <span class="ot">&lt;-</span> buffalo_data_all <span class="sc">%&gt;%</span></span>
<span id="cb4-2"><a href="#cb4-2"></a>  <span class="fu">mutate</span>(<span class="at">t1_ =</span> lubridate<span class="sc">::</span><span class="fu">with_tz</span>(buffalo_data_all<span class="sc">$</span>t1_, <span class="at">tzone =</span> <span class="st">"Australia/Darwin"</span>),</span>
<span id="cb4-3"><a href="#cb4-3"></a>         <span class="at">t2_ =</span> lubridate<span class="sc">::</span><span class="fu">with_tz</span>(buffalo_data_all<span class="sc">$</span>t2_, <span class="at">tzone =</span> <span class="st">"Australia/Darwin"</span>))</span>
<span id="cb4-4"><a href="#cb4-4"></a></span>
<span id="cb4-5"><a href="#cb4-5"></a>buffalo_data_all <span class="ot">&lt;-</span> buffalo_data_all <span class="sc">%&gt;%</span></span>
<span id="cb4-6"><a href="#cb4-6"></a>  <span class="fu">mutate</span>(<span class="at">id_num =</span> <span class="fu">as.numeric</span>(<span class="fu">factor</span>(id)),</span>
<span id="cb4-7"><a href="#cb4-7"></a>         <span class="at">step_id =</span> step_id_,</span>
<span id="cb4-8"><a href="#cb4-8"></a>         <span class="at">x1 =</span> x1_, <span class="at">x2 =</span> x2_,</span>
<span id="cb4-9"><a href="#cb4-9"></a>         <span class="at">y1 =</span> y1_, <span class="at">y2 =</span> y2_,</span>
<span id="cb4-10"><a href="#cb4-10"></a>         <span class="at">t1 =</span> t1_,</span>
<span id="cb4-11"><a href="#cb4-11"></a>         <span class="at">t1_rounded =</span> <span class="fu">round_date</span>(buffalo_data_all<span class="sc">$</span>t1_, <span class="st">"hour"</span>),</span>
<span id="cb4-12"><a href="#cb4-12"></a>         <span class="at">hour_t1 =</span> <span class="fu">hour</span>(t1_rounded),</span>
<span id="cb4-13"><a href="#cb4-13"></a>         <span class="at">t2 =</span> t2_,</span>
<span id="cb4-14"><a href="#cb4-14"></a>         <span class="at">t2_rounded =</span> <span class="fu">round_date</span>(buffalo_data_all<span class="sc">$</span>t2_, <span class="st">"hour"</span>),</span>
<span id="cb4-15"><a href="#cb4-15"></a>         <span class="at">hour_t2 =</span> <span class="fu">hour</span>(t2_rounded),</span>
<span id="cb4-16"><a href="#cb4-16"></a>         <span class="at">hour =</span> hour_t2,</span>
<span id="cb4-17"><a href="#cb4-17"></a>         <span class="at">yday =</span> <span class="fu">yday</span>(t1_),</span>
<span id="cb4-18"><a href="#cb4-18"></a>         <span class="at">year =</span> <span class="fu">year</span>(t1_),</span>
<span id="cb4-19"><a href="#cb4-19"></a>         <span class="at">month =</span> <span class="fu">month</span>(t1_),</span>
<span id="cb4-20"><a href="#cb4-20"></a>         <span class="at">sl =</span> sl_,</span>
<span id="cb4-21"><a href="#cb4-21"></a>         <span class="at">log_sl =</span> <span class="fu">log</span>(sl_),</span>
<span id="cb4-22"><a href="#cb4-22"></a>         <span class="at">ta =</span> ta_,</span>
<span id="cb4-23"><a href="#cb4-23"></a>         <span class="at">cos_ta =</span> <span class="fu">cos</span>(ta_),</span>
<span id="cb4-24"><a href="#cb4-24"></a>         <span class="co"># scale canopy cover from 0 to 1</span></span>
<span id="cb4-25"><a href="#cb4-25"></a>         <span class="at">canopy_01 =</span> canopy_cover<span class="sc">/</span><span class="dv">100</span>,</span>
<span id="cb4-26"><a href="#cb4-26"></a>         <span class="co"># here we create the harmonic terms for the hour of the day</span></span>
<span id="cb4-27"><a href="#cb4-27"></a>         <span class="co"># for seasonal effects, change hour to yday (which is tau in the manuscript), </span></span>
<span id="cb4-28"><a href="#cb4-28"></a>         <span class="co"># and 24 to 365 (which is T)</span></span>
<span id="cb4-29"><a href="#cb4-29"></a>         <span class="at">hour_s1 =</span> <span class="fu">sin</span>(<span class="dv">2</span><span class="sc">*</span>pi<span class="sc">*</span>hour<span class="sc">/</span><span class="dv">24</span>),</span>
<span id="cb4-30"><a href="#cb4-30"></a>         <span class="at">hour_s2 =</span> <span class="fu">sin</span>(<span class="dv">4</span><span class="sc">*</span>pi<span class="sc">*</span>hour<span class="sc">/</span><span class="dv">24</span>),</span>
<span id="cb4-31"><a href="#cb4-31"></a>         <span class="at">hour_s3 =</span> <span class="fu">sin</span>(<span class="dv">6</span><span class="sc">*</span>pi<span class="sc">*</span>hour<span class="sc">/</span><span class="dv">24</span>),</span>
<span id="cb4-32"><a href="#cb4-32"></a>         <span class="at">hour_c1 =</span> <span class="fu">cos</span>(<span class="dv">2</span><span class="sc">*</span>pi<span class="sc">*</span>hour<span class="sc">/</span><span class="dv">24</span>),</span>
<span id="cb4-33"><a href="#cb4-33"></a>         <span class="at">hour_c2 =</span> <span class="fu">cos</span>(<span class="dv">4</span><span class="sc">*</span>pi<span class="sc">*</span>hour<span class="sc">/</span><span class="dv">24</span>),</span>
<span id="cb4-34"><a href="#cb4-34"></a>         <span class="at">hour_c3 =</span> <span class="fu">cos</span>(<span class="dv">6</span><span class="sc">*</span>pi<span class="sc">*</span>hour<span class="sc">/</span><span class="dv">24</span>))</span>
<span id="cb4-35"><a href="#cb4-35"></a></span>
<span id="cb4-36"><a href="#cb4-36"></a><span class="co"># to select a single year of data</span></span>
<span id="cb4-37"><a href="#cb4-37"></a><span class="co"># buffalo_data_all &lt;- buffalo_data_all %&gt;% filter(t1 &lt; "2019-07-25 09:32:42 ACST")</span></span>
<span id="cb4-38"><a href="#cb4-38"></a></span>
<span id="cb4-39"><a href="#cb4-39"></a>buffalo_ids <span class="ot">&lt;-</span> <span class="fu">unique</span>(buffalo_data_all<span class="sc">$</span>id)</span>
<span id="cb4-40"><a href="#cb4-40"></a></span>
<span id="cb4-41"><a href="#cb4-41"></a><span class="co"># Timeline of buffalo data</span></span>
<span id="cb4-42"><a href="#cb4-42"></a>buffalo_data_all <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> t1, <span class="at">y =</span> <span class="fu">factor</span>(id), <span class="at">colour =</span> <span class="fu">factor</span>(id))) <span class="sc">+</span></span>
<span id="cb4-43"><a href="#cb4-43"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb4-44"><a href="#cb4-44"></a>  <span class="fu">scale_y_discrete</span>(<span class="st">"Buffalo ID"</span>) <span class="sc">+</span></span>
<span id="cb4-45"><a href="#cb4-45"></a>  <span class="fu">scale_x_datetime</span>(<span class="st">"Date"</span>) <span class="sc">+</span></span>
<span id="cb4-46"><a href="#cb4-46"></a>  <span class="fu">scale_colour_viridis_d</span>() <span class="sc">+</span></span>
<span id="cb4-47"><a href="#cb4-47"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb4-48"><a href="#cb4-48"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ssf_model_fit_id_files/figure-html/import_data-1.png" class="img-fluid figure-img" width="2100"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="fitting-the-models" class="level1">
<h1>Fitting the models</h1>
<section id="creating-a-data-matrix" class="level2">
<h2 class="anchored" data-anchor-id="creating-a-data-matrix">Creating a data matrix</h2>
<p>First we create a data matrix to be provided to the model, and then we scale and centre the full data matrix, with respect to each of the columns. That means that all variables are scaled and centred <em>after</em> the data has been split into wet and dry season data, and also after creating the quadratic and harmonic terms (when using them).</p>
<p>We should only include covariates in the data matrix that will be used in the model formula.</p>
<p><strong>Models</strong></p>
<ul>
<li>0p = 0 pairs of harmonics</li>
<li>1p = 1 pair of harmonics</li>
<li>2p = 2 pairs of harmonics</li>
<li>3p = 3 pairs of harmonics</li>
</ul>
<p>For the dynamic models, we start to add the harmonic terms. As we have already created the harmonic terms for the hour of the day (s1, c1, s2, etc), we just interact (multiply) these with each of the covariates, including the quadratic terms, prior to model fitting. We store the scaling and centering variables to reconstruct the natural scale coefficients.</p>
<p>To provide some intuition about harmonic regression we have created a walkthrough script for <span class="citation" data-cites="Forrest2024-gc">Forrest et al. (<a href="#ref-Forrest2024-gc" role="doc-biblioref">2024</a>)</span>, in the script <code>Ecography_DynamicSSF_Walkthrough_Harmonics_and_selection_surfaces</code>, which can be found at: <a href="https://github.com/swforrest/dynamic_SSF_sims">swforrest/dynamic_SSF_sims</a>, that introduces harmonics and how they can be used to model temporal variation in the data. It will help provide some understand the model outputs and how we construct the temporally varying coefficients in this script.</p>
</section>
<section id="selecting-data" class="level2">
<h2 class="anchored" data-anchor-id="selecting-data">Selecting data</h2>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a>months_wet <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, <span class="dv">11</span><span class="sc">:</span><span class="dv">12</span>)</span>
<span id="cb5-2"><a href="#cb5-2"></a>buffalo_ids <span class="ot">&lt;-</span> <span class="fu">unique</span>(buffalo_data_all<span class="sc">$</span>id)</span>
<span id="cb5-3"><a href="#cb5-3"></a>focal_id <span class="ot">&lt;-</span> <span class="dv">2005</span></span>
<span id="cb5-4"><a href="#cb5-4"></a></span>
<span id="cb5-5"><a href="#cb5-5"></a><span class="co"># comment and uncomment the relevant lines to get either wet or dry season data</span></span>
<span id="cb5-6"><a href="#cb5-6"></a><span class="co"># buffalo_data &lt;- buffalo_data_all %&gt;% filter(id == focal_id &amp; month %in% months_wet) # wet season</span></span>
<span id="cb5-7"><a href="#cb5-7"></a><span class="co"># buffalo_data &lt;- buffalo_data_all %&gt;% filter(id == focal_id &amp; !month %in% months_wet) # dry season</span></span>
<span id="cb5-8"><a href="#cb5-8"></a></span>
<span id="cb5-9"><a href="#cb5-9"></a><span class="co"># all data</span></span>
<span id="cb5-10"><a href="#cb5-10"></a>buffalo_data <span class="ot">&lt;-</span> buffalo_data_all <span class="sc">%&gt;%</span> <span class="fu">filter</span>(id <span class="sc">==</span> focal_id)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="tabset-margin-container"></div><div class="panel-tabset" data-group="model">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true">0p</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false">1p</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-3" role="tab" aria-controls="tabset-1-3" aria-selected="false">2p</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-4" role="tab" aria-controls="tabset-1-4" aria-selected="false">3p</a></li></ul>
<div class="tab-content" data-group="model">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a>buffalo_data_matrix_unscaled <span class="ot">&lt;-</span> buffalo_data <span class="sc">%&gt;%</span> <span class="fu">transmute</span>(</span>
<span id="cb6-2"><a href="#cb6-2"></a>  </span>
<span id="cb6-3"><a href="#cb6-3"></a>  <span class="at">ndvi =</span> ndvi_temporal,</span>
<span id="cb6-4"><a href="#cb6-4"></a>  <span class="at">ndvi_sq =</span> ndvi_temporal <span class="sc">^</span> <span class="dv">2</span>,</span>
<span id="cb6-5"><a href="#cb6-5"></a>  <span class="at">canopy =</span> canopy_01,</span>
<span id="cb6-6"><a href="#cb6-6"></a>  <span class="at">canopy_sq =</span> canopy_01 <span class="sc">^</span> <span class="dv">2</span>,</span>
<span id="cb6-7"><a href="#cb6-7"></a>  <span class="at">slope =</span> slope,</span>
<span id="cb6-8"><a href="#cb6-8"></a>  <span class="at">herby =</span> veg_herby,</span>
<span id="cb6-9"><a href="#cb6-9"></a>  <span class="at">step_l =</span> sl,</span>
<span id="cb6-10"><a href="#cb6-10"></a>  <span class="at">log_step_l =</span> log_sl,</span>
<span id="cb6-11"><a href="#cb6-11"></a>  <span class="at">cos_turn_a =</span> cos_ta)</span>
<span id="cb6-12"><a href="#cb6-12"></a></span>
<span id="cb6-13"><a href="#cb6-13"></a>buffalo_data_matrix_scaled <span class="ot">&lt;-</span> <span class="fu">scale</span>(buffalo_data_matrix_unscaled)</span>
<span id="cb6-14"><a href="#cb6-14"></a></span>
<span id="cb6-15"><a href="#cb6-15"></a><span class="co"># save the scaling values to recover the natural scale of the coefficients</span></span>
<span id="cb6-16"><a href="#cb6-16"></a><span class="co"># which is required for the simulations </span></span>
<span id="cb6-17"><a href="#cb6-17"></a><span class="co"># (so then environmental variables don't need to be scaled)</span></span>
<span id="cb6-18"><a href="#cb6-18"></a>mean_vals <span class="ot">&lt;-</span> <span class="fu">attr</span>(buffalo_data_matrix_scaled, <span class="st">"scaled:center"</span>)</span>
<span id="cb6-19"><a href="#cb6-19"></a>sd_vals <span class="ot">&lt;-</span> <span class="fu">attr</span>(buffalo_data_matrix_scaled, <span class="st">"scaled:scale"</span>)</span>
<span id="cb6-20"><a href="#cb6-20"></a>scaling_attributes_0p <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">variable =</span> <span class="fu">names</span>(buffalo_data_matrix_unscaled), </span>
<span id="cb6-21"><a href="#cb6-21"></a>                                    <span class="at">mean =</span> mean_vals, <span class="at">sd =</span> sd_vals)</span>
<span id="cb6-22"><a href="#cb6-22"></a></span>
<span id="cb6-23"><a href="#cb6-23"></a><span class="co"># add the id, step_id columns and presence/absence columns to </span></span>
<span id="cb6-24"><a href="#cb6-24"></a><span class="co"># the scaled data matrix for model fitting</span></span>
<span id="cb6-25"><a href="#cb6-25"></a>buffalo_data_scaled_0p <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">id =</span> buffalo_data<span class="sc">$</span>id,  </span>
<span id="cb6-26"><a href="#cb6-26"></a>                                     <span class="at">step_id =</span> buffalo_data<span class="sc">$</span>step_id, </span>
<span id="cb6-27"><a href="#cb6-27"></a>                                     <span class="at">y =</span> buffalo_data<span class="sc">$</span>y, </span>
<span id="cb6-28"><a href="#cb6-28"></a>                                     buffalo_data_matrix_scaled)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a>buffalo_data_matrix_unscaled <span class="ot">&lt;-</span> buffalo_data <span class="sc">%&gt;%</span> <span class="fu">transmute</span>(</span>
<span id="cb7-2"><a href="#cb7-2"></a>  </span>
<span id="cb7-3"><a href="#cb7-3"></a>  <span class="co"># the 'linear' term</span></span>
<span id="cb7-4"><a href="#cb7-4"></a>  <span class="at">ndvi =</span> ndvi_temporal,</span>
<span id="cb7-5"><a href="#cb7-5"></a>  <span class="co"># interact with the harmonic terms</span></span>
<span id="cb7-6"><a href="#cb7-6"></a>  <span class="at">ndvi_s1 =</span> ndvi_temporal <span class="sc">*</span> hour_s1,</span>
<span id="cb7-7"><a href="#cb7-7"></a>  <span class="at">ndvi_c1 =</span> ndvi_temporal <span class="sc">*</span> hour_c1,</span>
<span id="cb7-8"><a href="#cb7-8"></a>  </span>
<span id="cb7-9"><a href="#cb7-9"></a>  <span class="at">ndvi_sq =</span> ndvi_temporal <span class="sc">^</span> <span class="dv">2</span>,</span>
<span id="cb7-10"><a href="#cb7-10"></a>  <span class="at">ndvi_sq_s1 =</span> (ndvi_temporal <span class="sc">^</span> <span class="dv">2</span>) <span class="sc">*</span> hour_s1,</span>
<span id="cb7-11"><a href="#cb7-11"></a>  <span class="at">ndvi_sq_c1 =</span> (ndvi_temporal <span class="sc">^</span> <span class="dv">2</span>) <span class="sc">*</span> hour_c1,</span>
<span id="cb7-12"><a href="#cb7-12"></a>  </span>
<span id="cb7-13"><a href="#cb7-13"></a>  <span class="at">canopy =</span> canopy_01,</span>
<span id="cb7-14"><a href="#cb7-14"></a>  <span class="at">canopy_s1 =</span> canopy_01 <span class="sc">*</span> hour_s1,</span>
<span id="cb7-15"><a href="#cb7-15"></a>  <span class="at">canopy_c1 =</span> canopy_01 <span class="sc">*</span> hour_c1,</span>
<span id="cb7-16"><a href="#cb7-16"></a>  </span>
<span id="cb7-17"><a href="#cb7-17"></a>  <span class="at">canopy_sq =</span> canopy_01 <span class="sc">^</span> <span class="dv">2</span>,</span>
<span id="cb7-18"><a href="#cb7-18"></a>  <span class="at">canopy_sq_s1 =</span> (canopy_01 <span class="sc">^</span> <span class="dv">2</span>) <span class="sc">*</span> hour_s1,</span>
<span id="cb7-19"><a href="#cb7-19"></a>  <span class="at">canopy_sq_c1 =</span> (canopy_01 <span class="sc">^</span> <span class="dv">2</span>) <span class="sc">*</span> hour_c1,</span>
<span id="cb7-20"><a href="#cb7-20"></a>  </span>
<span id="cb7-21"><a href="#cb7-21"></a>  <span class="at">slope =</span> slope,</span>
<span id="cb7-22"><a href="#cb7-22"></a>  <span class="at">slope_s1 =</span> slope <span class="sc">*</span> hour_s1,</span>
<span id="cb7-23"><a href="#cb7-23"></a>  <span class="at">slope_c1 =</span> slope <span class="sc">*</span> hour_c1,</span>
<span id="cb7-24"><a href="#cb7-24"></a>  </span>
<span id="cb7-25"><a href="#cb7-25"></a>  <span class="at">herby =</span> veg_herby,</span>
<span id="cb7-26"><a href="#cb7-26"></a>  <span class="at">herby_s1 =</span> veg_herby <span class="sc">*</span> hour_s1,</span>
<span id="cb7-27"><a href="#cb7-27"></a>  <span class="at">herby_c1 =</span> veg_herby <span class="sc">*</span> hour_c1,</span>
<span id="cb7-28"><a href="#cb7-28"></a>  </span>
<span id="cb7-29"><a href="#cb7-29"></a>  <span class="at">step_l =</span> sl,</span>
<span id="cb7-30"><a href="#cb7-30"></a>  <span class="at">step_l_s1 =</span> sl <span class="sc">*</span> hour_s1,</span>
<span id="cb7-31"><a href="#cb7-31"></a>  <span class="at">step_l_c1 =</span> sl <span class="sc">*</span> hour_c1,</span>
<span id="cb7-32"><a href="#cb7-32"></a></span>
<span id="cb7-33"><a href="#cb7-33"></a>  <span class="at">log_step_l =</span> log_sl,</span>
<span id="cb7-34"><a href="#cb7-34"></a>  <span class="at">log_step_l_s1 =</span> log_sl <span class="sc">*</span> hour_s1,</span>
<span id="cb7-35"><a href="#cb7-35"></a>  <span class="at">log_step_l_c1 =</span> log_sl <span class="sc">*</span> hour_c1,</span>
<span id="cb7-36"><a href="#cb7-36"></a></span>
<span id="cb7-37"><a href="#cb7-37"></a>  <span class="at">cos_turn_a =</span> cos_ta,</span>
<span id="cb7-38"><a href="#cb7-38"></a>  <span class="at">cos_turn_a_s1 =</span> cos_ta <span class="sc">*</span> hour_s1,</span>
<span id="cb7-39"><a href="#cb7-39"></a>  <span class="at">cos_turn_a_c1 =</span> cos_ta <span class="sc">*</span> hour_c1)</span>
<span id="cb7-40"><a href="#cb7-40"></a></span>
<span id="cb7-41"><a href="#cb7-41"></a>buffalo_data_matrix_scaled <span class="ot">&lt;-</span> <span class="fu">scale</span>(buffalo_data_matrix_unscaled)</span>
<span id="cb7-42"><a href="#cb7-42"></a></span>
<span id="cb7-43"><a href="#cb7-43"></a>mean_vals <span class="ot">&lt;-</span> <span class="fu">attr</span>(buffalo_data_matrix_scaled, <span class="st">"scaled:center"</span>)</span>
<span id="cb7-44"><a href="#cb7-44"></a>sd_vals <span class="ot">&lt;-</span> <span class="fu">attr</span>(buffalo_data_matrix_scaled, <span class="st">"scaled:scale"</span>)</span>
<span id="cb7-45"><a href="#cb7-45"></a>scaling_attributes_1p <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">variable =</span> <span class="fu">names</span>(buffalo_data_matrix_unscaled), </span>
<span id="cb7-46"><a href="#cb7-46"></a>                                    <span class="at">mean =</span> mean_vals, <span class="at">sd =</span> sd_vals)</span>
<span id="cb7-47"><a href="#cb7-47"></a></span>
<span id="cb7-48"><a href="#cb7-48"></a>buffalo_data_scaled_1p <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">id =</span> buffalo_data<span class="sc">$</span>id,  </span>
<span id="cb7-49"><a href="#cb7-49"></a>                                     <span class="at">step_id =</span> buffalo_data<span class="sc">$</span>step_id, </span>
<span id="cb7-50"><a href="#cb7-50"></a>                                     <span class="at">y =</span> buffalo_data<span class="sc">$</span>y, </span>
<span id="cb7-51"><a href="#cb7-51"></a>                                     buffalo_data_matrix_scaled)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
<div id="tabset-1-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-3-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a>buffalo_data_matrix_unscaled <span class="ot">&lt;-</span> buffalo_data <span class="sc">%&gt;%</span> <span class="fu">transmute</span>(</span>
<span id="cb8-2"><a href="#cb8-2"></a>  </span>
<span id="cb8-3"><a href="#cb8-3"></a>  <span class="at">ndvi =</span> ndvi_temporal,</span>
<span id="cb8-4"><a href="#cb8-4"></a>  <span class="at">ndvi_s1 =</span> ndvi_temporal <span class="sc">*</span> hour_s1,</span>
<span id="cb8-5"><a href="#cb8-5"></a>  <span class="at">ndvi_s2 =</span> ndvi_temporal <span class="sc">*</span> hour_s2,</span>
<span id="cb8-6"><a href="#cb8-6"></a>  <span class="at">ndvi_c1 =</span> ndvi_temporal <span class="sc">*</span> hour_c1,</span>
<span id="cb8-7"><a href="#cb8-7"></a>  <span class="at">ndvi_c2 =</span> ndvi_temporal <span class="sc">*</span> hour_c2,</span>
<span id="cb8-8"><a href="#cb8-8"></a>  </span>
<span id="cb8-9"><a href="#cb8-9"></a>  <span class="at">ndvi_sq =</span> ndvi_temporal <span class="sc">^</span> <span class="dv">2</span>,</span>
<span id="cb8-10"><a href="#cb8-10"></a>  <span class="at">ndvi_sq_s1 =</span> (ndvi_temporal <span class="sc">^</span> <span class="dv">2</span>) <span class="sc">*</span> hour_s1,</span>
<span id="cb8-11"><a href="#cb8-11"></a>  <span class="at">ndvi_sq_s2 =</span> (ndvi_temporal <span class="sc">^</span> <span class="dv">2</span>) <span class="sc">*</span> hour_s2,</span>
<span id="cb8-12"><a href="#cb8-12"></a>  <span class="at">ndvi_sq_c1 =</span> (ndvi_temporal <span class="sc">^</span> <span class="dv">2</span>) <span class="sc">*</span> hour_c1,</span>
<span id="cb8-13"><a href="#cb8-13"></a>  <span class="at">ndvi_sq_c2 =</span> (ndvi_temporal <span class="sc">^</span> <span class="dv">2</span>) <span class="sc">*</span> hour_c2,</span>
<span id="cb8-14"><a href="#cb8-14"></a>  </span>
<span id="cb8-15"><a href="#cb8-15"></a>  <span class="at">canopy =</span> canopy_01,</span>
<span id="cb8-16"><a href="#cb8-16"></a>  <span class="at">canopy_s1 =</span> canopy_01 <span class="sc">*</span> hour_s1,</span>
<span id="cb8-17"><a href="#cb8-17"></a>  <span class="at">canopy_s2 =</span> canopy_01 <span class="sc">*</span> hour_s2,</span>
<span id="cb8-18"><a href="#cb8-18"></a>  <span class="at">canopy_c1 =</span> canopy_01 <span class="sc">*</span> hour_c1,</span>
<span id="cb8-19"><a href="#cb8-19"></a>  <span class="at">canopy_c2 =</span> canopy_01 <span class="sc">*</span> hour_c2,</span>
<span id="cb8-20"><a href="#cb8-20"></a>  </span>
<span id="cb8-21"><a href="#cb8-21"></a>  <span class="at">canopy_sq =</span> canopy_01 <span class="sc">^</span> <span class="dv">2</span>,</span>
<span id="cb8-22"><a href="#cb8-22"></a>  <span class="at">canopy_sq_s1 =</span> (canopy_01 <span class="sc">^</span> <span class="dv">2</span>) <span class="sc">*</span> hour_s1,</span>
<span id="cb8-23"><a href="#cb8-23"></a>  <span class="at">canopy_sq_s2 =</span> (canopy_01 <span class="sc">^</span> <span class="dv">2</span>) <span class="sc">*</span> hour_s2,</span>
<span id="cb8-24"><a href="#cb8-24"></a>  <span class="at">canopy_sq_c1 =</span> (canopy_01 <span class="sc">^</span> <span class="dv">2</span>) <span class="sc">*</span> hour_c1,</span>
<span id="cb8-25"><a href="#cb8-25"></a>  <span class="at">canopy_sq_c2 =</span> (canopy_01 <span class="sc">^</span> <span class="dv">2</span>) <span class="sc">*</span> hour_c2,</span>
<span id="cb8-26"><a href="#cb8-26"></a>  </span>
<span id="cb8-27"><a href="#cb8-27"></a>  <span class="at">slope =</span> slope,</span>
<span id="cb8-28"><a href="#cb8-28"></a>  <span class="at">slope_s1 =</span> slope <span class="sc">*</span> hour_s1,</span>
<span id="cb8-29"><a href="#cb8-29"></a>  <span class="at">slope_s2 =</span> slope <span class="sc">*</span> hour_s2,</span>
<span id="cb8-30"><a href="#cb8-30"></a>  <span class="at">slope_c1 =</span> slope <span class="sc">*</span> hour_c1,</span>
<span id="cb8-31"><a href="#cb8-31"></a>  <span class="at">slope_c2 =</span> slope <span class="sc">*</span> hour_c2,</span>
<span id="cb8-32"><a href="#cb8-32"></a>  </span>
<span id="cb8-33"><a href="#cb8-33"></a>  <span class="at">herby =</span> veg_herby,</span>
<span id="cb8-34"><a href="#cb8-34"></a>  <span class="at">herby_s1 =</span> veg_herby <span class="sc">*</span> hour_s1,</span>
<span id="cb8-35"><a href="#cb8-35"></a>  <span class="at">herby_s2 =</span> veg_herby <span class="sc">*</span> hour_s2,</span>
<span id="cb8-36"><a href="#cb8-36"></a>  <span class="at">herby_c1 =</span> veg_herby <span class="sc">*</span> hour_c1,</span>
<span id="cb8-37"><a href="#cb8-37"></a>  <span class="at">herby_c2 =</span> veg_herby <span class="sc">*</span> hour_c2,</span>
<span id="cb8-38"><a href="#cb8-38"></a>  </span>
<span id="cb8-39"><a href="#cb8-39"></a>  <span class="at">step_l =</span> sl,</span>
<span id="cb8-40"><a href="#cb8-40"></a>  <span class="at">step_l_s1 =</span> sl <span class="sc">*</span> hour_s1,</span>
<span id="cb8-41"><a href="#cb8-41"></a>  <span class="at">step_l_s2 =</span> sl <span class="sc">*</span> hour_s2,</span>
<span id="cb8-42"><a href="#cb8-42"></a>  <span class="at">step_l_c1 =</span> sl <span class="sc">*</span> hour_c1,</span>
<span id="cb8-43"><a href="#cb8-43"></a>  <span class="at">step_l_c2 =</span> sl <span class="sc">*</span> hour_c2,</span>
<span id="cb8-44"><a href="#cb8-44"></a></span>
<span id="cb8-45"><a href="#cb8-45"></a>  <span class="at">log_step_l =</span> log_sl,</span>
<span id="cb8-46"><a href="#cb8-46"></a>  <span class="at">log_step_l_s1 =</span> log_sl <span class="sc">*</span> hour_s1,</span>
<span id="cb8-47"><a href="#cb8-47"></a>  <span class="at">log_step_l_s2 =</span> log_sl <span class="sc">*</span> hour_s2,</span>
<span id="cb8-48"><a href="#cb8-48"></a>  <span class="at">log_step_l_c1 =</span> log_sl <span class="sc">*</span> hour_c1,</span>
<span id="cb8-49"><a href="#cb8-49"></a>  <span class="at">log_step_l_c2 =</span> log_sl <span class="sc">*</span> hour_c2,</span>
<span id="cb8-50"><a href="#cb8-50"></a></span>
<span id="cb8-51"><a href="#cb8-51"></a>  <span class="at">cos_turn_a =</span> cos_ta,</span>
<span id="cb8-52"><a href="#cb8-52"></a>  <span class="at">cos_turn_a_s1 =</span> cos_ta <span class="sc">*</span> hour_s1,</span>
<span id="cb8-53"><a href="#cb8-53"></a>  <span class="at">cos_turn_a_s2 =</span> cos_ta <span class="sc">*</span> hour_s2,</span>
<span id="cb8-54"><a href="#cb8-54"></a>  <span class="at">cos_turn_a_c1 =</span> cos_ta <span class="sc">*</span> hour_c1,</span>
<span id="cb8-55"><a href="#cb8-55"></a>  <span class="at">cos_turn_a_c2 =</span> cos_ta <span class="sc">*</span> hour_c2)</span>
<span id="cb8-56"><a href="#cb8-56"></a></span>
<span id="cb8-57"><a href="#cb8-57"></a>buffalo_data_matrix_scaled <span class="ot">&lt;-</span> <span class="fu">scale</span>(buffalo_data_matrix_unscaled)</span>
<span id="cb8-58"><a href="#cb8-58"></a></span>
<span id="cb8-59"><a href="#cb8-59"></a>mean_vals <span class="ot">&lt;-</span> <span class="fu">attr</span>(buffalo_data_matrix_scaled, <span class="st">"scaled:center"</span>)</span>
<span id="cb8-60"><a href="#cb8-60"></a>sd_vals <span class="ot">&lt;-</span> <span class="fu">attr</span>(buffalo_data_matrix_scaled, <span class="st">"scaled:scale"</span>)</span>
<span id="cb8-61"><a href="#cb8-61"></a>scaling_attributes_2p <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">variable =</span> <span class="fu">names</span>(buffalo_data_matrix_unscaled), </span>
<span id="cb8-62"><a href="#cb8-62"></a>                                    <span class="at">mean =</span> mean_vals, <span class="at">sd =</span> sd_vals)</span>
<span id="cb8-63"><a href="#cb8-63"></a></span>
<span id="cb8-64"><a href="#cb8-64"></a>buffalo_data_scaled_2p <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">id =</span> buffalo_data<span class="sc">$</span>id,  </span>
<span id="cb8-65"><a href="#cb8-65"></a>                                     <span class="at">step_id =</span> buffalo_data<span class="sc">$</span>step_id, </span>
<span id="cb8-66"><a href="#cb8-66"></a>                                     <span class="at">y =</span> buffalo_data<span class="sc">$</span>y, </span>
<span id="cb8-67"><a href="#cb8-67"></a>                                     buffalo_data_matrix_scaled)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
<div id="tabset-1-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-4-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a>buffalo_data_matrix_unscaled <span class="ot">&lt;-</span> buffalo_data <span class="sc">%&gt;%</span> <span class="fu">transmute</span>(</span>
<span id="cb9-2"><a href="#cb9-2"></a>  </span>
<span id="cb9-3"><a href="#cb9-3"></a>  <span class="at">ndvi =</span> ndvi_temporal,</span>
<span id="cb9-4"><a href="#cb9-4"></a>  <span class="at">ndvi_s1 =</span> ndvi_temporal <span class="sc">*</span> hour_s1,</span>
<span id="cb9-5"><a href="#cb9-5"></a>  <span class="at">ndvi_s2 =</span> ndvi_temporal <span class="sc">*</span> hour_s2,</span>
<span id="cb9-6"><a href="#cb9-6"></a>  <span class="at">ndvi_s3 =</span> ndvi_temporal <span class="sc">*</span> hour_s3,</span>
<span id="cb9-7"><a href="#cb9-7"></a>  <span class="at">ndvi_c1 =</span> ndvi_temporal <span class="sc">*</span> hour_c1,</span>
<span id="cb9-8"><a href="#cb9-8"></a>  <span class="at">ndvi_c2 =</span> ndvi_temporal <span class="sc">*</span> hour_c2,</span>
<span id="cb9-9"><a href="#cb9-9"></a>  <span class="at">ndvi_c3 =</span> ndvi_temporal <span class="sc">*</span> hour_c3,   </span>
<span id="cb9-10"><a href="#cb9-10"></a>  </span>
<span id="cb9-11"><a href="#cb9-11"></a>  <span class="at">ndvi_sq =</span> ndvi_temporal <span class="sc">^</span> <span class="dv">2</span>,</span>
<span id="cb9-12"><a href="#cb9-12"></a>  <span class="at">ndvi_sq_s1 =</span> (ndvi_temporal <span class="sc">^</span> <span class="dv">2</span>) <span class="sc">*</span> hour_s1,</span>
<span id="cb9-13"><a href="#cb9-13"></a>  <span class="at">ndvi_sq_s2 =</span> (ndvi_temporal <span class="sc">^</span> <span class="dv">2</span>) <span class="sc">*</span> hour_s2,</span>
<span id="cb9-14"><a href="#cb9-14"></a>  <span class="at">ndvi_sq_s3 =</span> (ndvi_temporal <span class="sc">^</span> <span class="dv">2</span>) <span class="sc">*</span> hour_s3,</span>
<span id="cb9-15"><a href="#cb9-15"></a>  <span class="at">ndvi_sq_c1 =</span> (ndvi_temporal <span class="sc">^</span> <span class="dv">2</span>) <span class="sc">*</span> hour_c1,</span>
<span id="cb9-16"><a href="#cb9-16"></a>  <span class="at">ndvi_sq_c2 =</span> (ndvi_temporal <span class="sc">^</span> <span class="dv">2</span>) <span class="sc">*</span> hour_c2,</span>
<span id="cb9-17"><a href="#cb9-17"></a>  <span class="at">ndvi_sq_c3 =</span> (ndvi_temporal <span class="sc">^</span> <span class="dv">2</span>) <span class="sc">*</span> hour_c3,   </span>
<span id="cb9-18"><a href="#cb9-18"></a>  </span>
<span id="cb9-19"><a href="#cb9-19"></a>  <span class="at">canopy =</span> canopy_01,</span>
<span id="cb9-20"><a href="#cb9-20"></a>  <span class="at">canopy_s1 =</span> canopy_01 <span class="sc">*</span> hour_s1,</span>
<span id="cb9-21"><a href="#cb9-21"></a>  <span class="at">canopy_s2 =</span> canopy_01 <span class="sc">*</span> hour_s2,</span>
<span id="cb9-22"><a href="#cb9-22"></a>  <span class="at">canopy_s3 =</span> canopy_01 <span class="sc">*</span> hour_s3,</span>
<span id="cb9-23"><a href="#cb9-23"></a>  <span class="at">canopy_c1 =</span> canopy_01 <span class="sc">*</span> hour_c1,</span>
<span id="cb9-24"><a href="#cb9-24"></a>  <span class="at">canopy_c2 =</span> canopy_01 <span class="sc">*</span> hour_c2,</span>
<span id="cb9-25"><a href="#cb9-25"></a>  <span class="at">canopy_c3 =</span> canopy_01 <span class="sc">*</span> hour_c3,   </span>
<span id="cb9-26"><a href="#cb9-26"></a>  </span>
<span id="cb9-27"><a href="#cb9-27"></a>  <span class="at">canopy_sq =</span> canopy_01 <span class="sc">^</span> <span class="dv">2</span>,</span>
<span id="cb9-28"><a href="#cb9-28"></a>  <span class="at">canopy_sq_s1 =</span> (canopy_01 <span class="sc">^</span> <span class="dv">2</span>) <span class="sc">*</span> hour_s1,</span>
<span id="cb9-29"><a href="#cb9-29"></a>  <span class="at">canopy_sq_s2 =</span> (canopy_01 <span class="sc">^</span> <span class="dv">2</span>) <span class="sc">*</span> hour_s2,</span>
<span id="cb9-30"><a href="#cb9-30"></a>  <span class="at">canopy_sq_s3 =</span> (canopy_01 <span class="sc">^</span> <span class="dv">2</span>) <span class="sc">*</span> hour_s3,</span>
<span id="cb9-31"><a href="#cb9-31"></a>  <span class="at">canopy_sq_c1 =</span> (canopy_01 <span class="sc">^</span> <span class="dv">2</span>) <span class="sc">*</span> hour_c1,</span>
<span id="cb9-32"><a href="#cb9-32"></a>  <span class="at">canopy_sq_c2 =</span> (canopy_01 <span class="sc">^</span> <span class="dv">2</span>) <span class="sc">*</span> hour_c2,</span>
<span id="cb9-33"><a href="#cb9-33"></a>  <span class="at">canopy_sq_c3 =</span> (canopy_01 <span class="sc">^</span> <span class="dv">2</span>) <span class="sc">*</span> hour_c3,   </span>
<span id="cb9-34"><a href="#cb9-34"></a>  </span>
<span id="cb9-35"><a href="#cb9-35"></a>  <span class="at">slope =</span> slope,</span>
<span id="cb9-36"><a href="#cb9-36"></a>  <span class="at">slope_s1 =</span> slope <span class="sc">*</span> hour_s1,</span>
<span id="cb9-37"><a href="#cb9-37"></a>  <span class="at">slope_s2 =</span> slope <span class="sc">*</span> hour_s2,</span>
<span id="cb9-38"><a href="#cb9-38"></a>  <span class="at">slope_s3 =</span> slope <span class="sc">*</span> hour_s3,</span>
<span id="cb9-39"><a href="#cb9-39"></a>  <span class="at">slope_c1 =</span> slope <span class="sc">*</span> hour_c1,</span>
<span id="cb9-40"><a href="#cb9-40"></a>  <span class="at">slope_c2 =</span> slope <span class="sc">*</span> hour_c2,</span>
<span id="cb9-41"><a href="#cb9-41"></a>  <span class="at">slope_c3 =</span> slope <span class="sc">*</span> hour_c3,   </span>
<span id="cb9-42"><a href="#cb9-42"></a>  </span>
<span id="cb9-43"><a href="#cb9-43"></a>  <span class="at">herby =</span> veg_herby,</span>
<span id="cb9-44"><a href="#cb9-44"></a>  <span class="at">herby_s1 =</span> veg_herby <span class="sc">*</span> hour_s1,</span>
<span id="cb9-45"><a href="#cb9-45"></a>  <span class="at">herby_s2 =</span> veg_herby <span class="sc">*</span> hour_s2,</span>
<span id="cb9-46"><a href="#cb9-46"></a>  <span class="at">herby_s3 =</span> veg_herby <span class="sc">*</span> hour_s3,</span>
<span id="cb9-47"><a href="#cb9-47"></a>  <span class="at">herby_c1 =</span> veg_herby <span class="sc">*</span> hour_c1,</span>
<span id="cb9-48"><a href="#cb9-48"></a>  <span class="at">herby_c2 =</span> veg_herby <span class="sc">*</span> hour_c2,</span>
<span id="cb9-49"><a href="#cb9-49"></a>  <span class="at">herby_c3 =</span> veg_herby <span class="sc">*</span> hour_c3,     </span>
<span id="cb9-50"><a href="#cb9-50"></a>  </span>
<span id="cb9-51"><a href="#cb9-51"></a>  <span class="at">step_l =</span> sl,</span>
<span id="cb9-52"><a href="#cb9-52"></a>  <span class="at">step_l_s1 =</span> sl <span class="sc">*</span> hour_s1,</span>
<span id="cb9-53"><a href="#cb9-53"></a>  <span class="at">step_l_s2 =</span> sl <span class="sc">*</span> hour_s2,</span>
<span id="cb9-54"><a href="#cb9-54"></a>  <span class="at">step_l_s3 =</span> sl <span class="sc">*</span> hour_s3,</span>
<span id="cb9-55"><a href="#cb9-55"></a>  <span class="at">step_l_c1 =</span> sl <span class="sc">*</span> hour_c1,</span>
<span id="cb9-56"><a href="#cb9-56"></a>  <span class="at">step_l_c2 =</span> sl <span class="sc">*</span> hour_c2,</span>
<span id="cb9-57"><a href="#cb9-57"></a>  <span class="at">step_l_c3 =</span> sl <span class="sc">*</span> hour_c3,</span>
<span id="cb9-58"><a href="#cb9-58"></a></span>
<span id="cb9-59"><a href="#cb9-59"></a>  <span class="at">log_step_l =</span> log_sl,</span>
<span id="cb9-60"><a href="#cb9-60"></a>  <span class="at">log_step_l_s1 =</span> log_sl <span class="sc">*</span> hour_s1,</span>
<span id="cb9-61"><a href="#cb9-61"></a>  <span class="at">log_step_l_s2 =</span> log_sl <span class="sc">*</span> hour_s2,</span>
<span id="cb9-62"><a href="#cb9-62"></a>  <span class="at">log_step_l_s3 =</span> log_sl <span class="sc">*</span> hour_s3,</span>
<span id="cb9-63"><a href="#cb9-63"></a>  <span class="at">log_step_l_c1 =</span> log_sl <span class="sc">*</span> hour_c1,</span>
<span id="cb9-64"><a href="#cb9-64"></a>  <span class="at">log_step_l_c2 =</span> log_sl <span class="sc">*</span> hour_c2,</span>
<span id="cb9-65"><a href="#cb9-65"></a>  <span class="at">log_step_l_c3 =</span> log_sl <span class="sc">*</span> hour_c3,</span>
<span id="cb9-66"><a href="#cb9-66"></a></span>
<span id="cb9-67"><a href="#cb9-67"></a>  <span class="at">cos_turn_a =</span> cos_ta,</span>
<span id="cb9-68"><a href="#cb9-68"></a>  <span class="at">cos_turn_a_s1 =</span> cos_ta <span class="sc">*</span> hour_s1,</span>
<span id="cb9-69"><a href="#cb9-69"></a>  <span class="at">cos_turn_a_s2 =</span> cos_ta <span class="sc">*</span> hour_s2,</span>
<span id="cb9-70"><a href="#cb9-70"></a>  <span class="at">cos_turn_a_s3 =</span> cos_ta <span class="sc">*</span> hour_s3,</span>
<span id="cb9-71"><a href="#cb9-71"></a>  <span class="at">cos_turn_a_c1 =</span> cos_ta <span class="sc">*</span> hour_c1,</span>
<span id="cb9-72"><a href="#cb9-72"></a>  <span class="at">cos_turn_a_c2 =</span> cos_ta <span class="sc">*</span> hour_c2,</span>
<span id="cb9-73"><a href="#cb9-73"></a>  <span class="at">cos_turn_a_c3 =</span> cos_ta <span class="sc">*</span> hour_c3)</span>
<span id="cb9-74"><a href="#cb9-74"></a></span>
<span id="cb9-75"><a href="#cb9-75"></a>buffalo_data_matrix_scaled <span class="ot">&lt;-</span> <span class="fu">scale</span>(buffalo_data_matrix_unscaled)</span>
<span id="cb9-76"><a href="#cb9-76"></a></span>
<span id="cb9-77"><a href="#cb9-77"></a>mean_vals <span class="ot">&lt;-</span> <span class="fu">attr</span>(buffalo_data_matrix_scaled, <span class="st">"scaled:center"</span>)</span>
<span id="cb9-78"><a href="#cb9-78"></a>sd_vals <span class="ot">&lt;-</span> <span class="fu">attr</span>(buffalo_data_matrix_scaled, <span class="st">"scaled:scale"</span>)</span>
<span id="cb9-79"><a href="#cb9-79"></a>scaling_attributes_3p <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">variable =</span> <span class="fu">names</span>(buffalo_data_matrix_unscaled), </span>
<span id="cb9-80"><a href="#cb9-80"></a>                                    <span class="at">mean =</span> mean_vals, <span class="at">sd =</span> sd_vals)</span>
<span id="cb9-81"><a href="#cb9-81"></a></span>
<span id="cb9-82"><a href="#cb9-82"></a>buffalo_data_scaled_3p <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">id =</span> buffalo_data<span class="sc">$</span>id,  </span>
<span id="cb9-83"><a href="#cb9-83"></a>                                     <span class="at">step_id =</span> buffalo_data<span class="sc">$</span>step_id, </span>
<span id="cb9-84"><a href="#cb9-84"></a>                                     <span class="at">y =</span> buffalo_data<span class="sc">$</span>y, </span>
<span id="cb9-85"><a href="#cb9-85"></a>                                     buffalo_data_matrix_scaled)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
</section>
<section id="model-formula" class="level2">
<h2 class="anchored" data-anchor-id="model-formula">Model formula</h2>
<p>As we have already precomputed and scaled the covariates, quadratic terms and interactions with the harmonics, we just include each parameter as a linear predictor.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset" data-group="model">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-2-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-1" role="tab" aria-controls="tabset-2-1" aria-selected="true">0p</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-2" role="tab" aria-controls="tabset-2-2" aria-selected="false">1p</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-3" role="tab" aria-controls="tabset-2-3" aria-selected="false">2p</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-4" role="tab" aria-controls="tabset-2-4" aria-selected="false">3p</a></li></ul>
<div class="tab-content" data-group="model">
<div id="tabset-2-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-2-1-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a>formula_0p <span class="ot">&lt;-</span> y <span class="sc">~</span> </span>
<span id="cb10-2"><a href="#cb10-2"></a>  </span>
<span id="cb10-3"><a href="#cb10-3"></a>  ndvi <span class="sc">+</span></span>
<span id="cb10-4"><a href="#cb10-4"></a>  ndvi_sq <span class="sc">+</span></span>
<span id="cb10-5"><a href="#cb10-5"></a>  canopy <span class="sc">+</span></span>
<span id="cb10-6"><a href="#cb10-6"></a>  canopy_sq <span class="sc">+</span></span>
<span id="cb10-7"><a href="#cb10-7"></a>  slope <span class="sc">+</span></span>
<span id="cb10-8"><a href="#cb10-8"></a>  herby <span class="sc">+</span></span>
<span id="cb10-9"><a href="#cb10-9"></a>  step_l <span class="sc">+</span></span>
<span id="cb10-10"><a href="#cb10-10"></a>  log_step_l <span class="sc">+</span></span>
<span id="cb10-11"><a href="#cb10-11"></a>  cos_turn_a <span class="sc">+</span></span>
<span id="cb10-12"><a href="#cb10-12"></a>  </span>
<span id="cb10-13"><a href="#cb10-13"></a>  <span class="fu">strata</span>(step_id)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
<div id="tabset-2-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-2-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a>formula_1p <span class="ot">&lt;-</span> y <span class="sc">~</span> </span>
<span id="cb11-2"><a href="#cb11-2"></a>  </span>
<span id="cb11-3"><a href="#cb11-3"></a>  ndvi <span class="sc">+</span></span>
<span id="cb11-4"><a href="#cb11-4"></a>  ndvi_s1 <span class="sc">+</span></span>
<span id="cb11-5"><a href="#cb11-5"></a>  ndvi_c1 <span class="sc">+</span></span>
<span id="cb11-6"><a href="#cb11-6"></a>  </span>
<span id="cb11-7"><a href="#cb11-7"></a>  ndvi_sq <span class="sc">+</span></span>
<span id="cb11-8"><a href="#cb11-8"></a>  ndvi_sq_s1 <span class="sc">+</span></span>
<span id="cb11-9"><a href="#cb11-9"></a>  ndvi_sq_c1 <span class="sc">+</span></span>
<span id="cb11-10"><a href="#cb11-10"></a>  </span>
<span id="cb11-11"><a href="#cb11-11"></a>  canopy <span class="sc">+</span></span>
<span id="cb11-12"><a href="#cb11-12"></a>  canopy_s1 <span class="sc">+</span></span>
<span id="cb11-13"><a href="#cb11-13"></a>  canopy_c1 <span class="sc">+</span></span>
<span id="cb11-14"><a href="#cb11-14"></a>  </span>
<span id="cb11-15"><a href="#cb11-15"></a>  canopy_sq <span class="sc">+</span></span>
<span id="cb11-16"><a href="#cb11-16"></a>  canopy_sq_s1 <span class="sc">+</span></span>
<span id="cb11-17"><a href="#cb11-17"></a>  canopy_sq_c1 <span class="sc">+</span></span>
<span id="cb11-18"><a href="#cb11-18"></a>  </span>
<span id="cb11-19"><a href="#cb11-19"></a>  slope <span class="sc">+</span></span>
<span id="cb11-20"><a href="#cb11-20"></a>  slope_s1 <span class="sc">+</span></span>
<span id="cb11-21"><a href="#cb11-21"></a>  slope_c1 <span class="sc">+</span></span>
<span id="cb11-22"><a href="#cb11-22"></a>  </span>
<span id="cb11-23"><a href="#cb11-23"></a>  herby <span class="sc">+</span></span>
<span id="cb11-24"><a href="#cb11-24"></a>  herby_s1 <span class="sc">+</span></span>
<span id="cb11-25"><a href="#cb11-25"></a>  herby_c1 <span class="sc">+</span></span>
<span id="cb11-26"><a href="#cb11-26"></a>  </span>
<span id="cb11-27"><a href="#cb11-27"></a>  step_l <span class="sc">+</span></span>
<span id="cb11-28"><a href="#cb11-28"></a>  step_l_s1 <span class="sc">+</span></span>
<span id="cb11-29"><a href="#cb11-29"></a>  step_l_c1 <span class="sc">+</span></span>
<span id="cb11-30"><a href="#cb11-30"></a>  </span>
<span id="cb11-31"><a href="#cb11-31"></a>  log_step_l <span class="sc">+</span></span>
<span id="cb11-32"><a href="#cb11-32"></a>  log_step_l_s1 <span class="sc">+</span></span>
<span id="cb11-33"><a href="#cb11-33"></a>  log_step_l_c1 <span class="sc">+</span></span>
<span id="cb11-34"><a href="#cb11-34"></a></span>
<span id="cb11-35"><a href="#cb11-35"></a>  cos_turn_a <span class="sc">+</span></span>
<span id="cb11-36"><a href="#cb11-36"></a>  cos_turn_a_s1 <span class="sc">+</span></span>
<span id="cb11-37"><a href="#cb11-37"></a>  cos_turn_a_c1 <span class="sc">+</span></span>
<span id="cb11-38"><a href="#cb11-38"></a>  </span>
<span id="cb11-39"><a href="#cb11-39"></a>  <span class="fu">strata</span>(step_id) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
<div id="tabset-2-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-3-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a>formula_2p <span class="ot">&lt;-</span> y <span class="sc">~</span> </span>
<span id="cb12-2"><a href="#cb12-2"></a>  </span>
<span id="cb12-3"><a href="#cb12-3"></a>  ndvi <span class="sc">+</span></span>
<span id="cb12-4"><a href="#cb12-4"></a>  ndvi_s1 <span class="sc">+</span></span>
<span id="cb12-5"><a href="#cb12-5"></a>  ndvi_s2 <span class="sc">+</span></span>
<span id="cb12-6"><a href="#cb12-6"></a>  ndvi_c1 <span class="sc">+</span></span>
<span id="cb12-7"><a href="#cb12-7"></a>  ndvi_c2 <span class="sc">+</span></span>
<span id="cb12-8"><a href="#cb12-8"></a>  </span>
<span id="cb12-9"><a href="#cb12-9"></a>  ndvi_sq <span class="sc">+</span></span>
<span id="cb12-10"><a href="#cb12-10"></a>  ndvi_sq_s1 <span class="sc">+</span></span>
<span id="cb12-11"><a href="#cb12-11"></a>  ndvi_sq_s2 <span class="sc">+</span></span>
<span id="cb12-12"><a href="#cb12-12"></a>  ndvi_sq_c1 <span class="sc">+</span></span>
<span id="cb12-13"><a href="#cb12-13"></a>  ndvi_sq_c2 <span class="sc">+</span></span>
<span id="cb12-14"><a href="#cb12-14"></a>  </span>
<span id="cb12-15"><a href="#cb12-15"></a>  canopy <span class="sc">+</span></span>
<span id="cb12-16"><a href="#cb12-16"></a>  canopy_s1 <span class="sc">+</span></span>
<span id="cb12-17"><a href="#cb12-17"></a>  canopy_s2 <span class="sc">+</span></span>
<span id="cb12-18"><a href="#cb12-18"></a>  canopy_c1 <span class="sc">+</span></span>
<span id="cb12-19"><a href="#cb12-19"></a>  canopy_c2 <span class="sc">+</span></span>
<span id="cb12-20"><a href="#cb12-20"></a>  </span>
<span id="cb12-21"><a href="#cb12-21"></a>  canopy_sq <span class="sc">+</span></span>
<span id="cb12-22"><a href="#cb12-22"></a>  canopy_sq_s1 <span class="sc">+</span></span>
<span id="cb12-23"><a href="#cb12-23"></a>  canopy_sq_s2 <span class="sc">+</span></span>
<span id="cb12-24"><a href="#cb12-24"></a>  canopy_sq_c1 <span class="sc">+</span></span>
<span id="cb12-25"><a href="#cb12-25"></a>  canopy_sq_c2 <span class="sc">+</span></span>
<span id="cb12-26"><a href="#cb12-26"></a>  </span>
<span id="cb12-27"><a href="#cb12-27"></a>  slope <span class="sc">+</span></span>
<span id="cb12-28"><a href="#cb12-28"></a>  slope_s1 <span class="sc">+</span></span>
<span id="cb12-29"><a href="#cb12-29"></a>  slope_s2 <span class="sc">+</span></span>
<span id="cb12-30"><a href="#cb12-30"></a>  slope_c1 <span class="sc">+</span></span>
<span id="cb12-31"><a href="#cb12-31"></a>  slope_c2 <span class="sc">+</span></span>
<span id="cb12-32"><a href="#cb12-32"></a>  </span>
<span id="cb12-33"><a href="#cb12-33"></a>  herby <span class="sc">+</span></span>
<span id="cb12-34"><a href="#cb12-34"></a>  herby_s1 <span class="sc">+</span></span>
<span id="cb12-35"><a href="#cb12-35"></a>  herby_s2 <span class="sc">+</span></span>
<span id="cb12-36"><a href="#cb12-36"></a>  herby_c1 <span class="sc">+</span></span>
<span id="cb12-37"><a href="#cb12-37"></a>  herby_c2 <span class="sc">+</span></span>
<span id="cb12-38"><a href="#cb12-38"></a>  </span>
<span id="cb12-39"><a href="#cb12-39"></a>  step_l <span class="sc">+</span></span>
<span id="cb12-40"><a href="#cb12-40"></a>  step_l_s1 <span class="sc">+</span></span>
<span id="cb12-41"><a href="#cb12-41"></a>  step_l_s2 <span class="sc">+</span></span>
<span id="cb12-42"><a href="#cb12-42"></a>  step_l_c1 <span class="sc">+</span></span>
<span id="cb12-43"><a href="#cb12-43"></a>  step_l_c2 <span class="sc">+</span></span>
<span id="cb12-44"><a href="#cb12-44"></a>  </span>
<span id="cb12-45"><a href="#cb12-45"></a>  log_step_l <span class="sc">+</span></span>
<span id="cb12-46"><a href="#cb12-46"></a>  log_step_l_s1 <span class="sc">+</span></span>
<span id="cb12-47"><a href="#cb12-47"></a>  log_step_l_s2 <span class="sc">+</span></span>
<span id="cb12-48"><a href="#cb12-48"></a>  log_step_l_c1 <span class="sc">+</span></span>
<span id="cb12-49"><a href="#cb12-49"></a>  log_step_l_c2 <span class="sc">+</span></span>
<span id="cb12-50"><a href="#cb12-50"></a></span>
<span id="cb12-51"><a href="#cb12-51"></a>  cos_turn_a <span class="sc">+</span></span>
<span id="cb12-52"><a href="#cb12-52"></a>  cos_turn_a_s1 <span class="sc">+</span></span>
<span id="cb12-53"><a href="#cb12-53"></a>  cos_turn_a_s2 <span class="sc">+</span></span>
<span id="cb12-54"><a href="#cb12-54"></a>  cos_turn_a_c1 <span class="sc">+</span></span>
<span id="cb12-55"><a href="#cb12-55"></a>  cos_turn_a_c2 <span class="sc">+</span></span>
<span id="cb12-56"><a href="#cb12-56"></a>  </span>
<span id="cb12-57"><a href="#cb12-57"></a>  <span class="fu">strata</span>(step_id) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
<div id="tabset-2-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-4-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a>formula_3p <span class="ot">&lt;-</span> y <span class="sc">~</span> </span>
<span id="cb13-2"><a href="#cb13-2"></a>  </span>
<span id="cb13-3"><a href="#cb13-3"></a>  ndvi <span class="sc">+</span></span>
<span id="cb13-4"><a href="#cb13-4"></a>  ndvi_s1 <span class="sc">+</span></span>
<span id="cb13-5"><a href="#cb13-5"></a>  ndvi_s2 <span class="sc">+</span></span>
<span id="cb13-6"><a href="#cb13-6"></a>  ndvi_s3 <span class="sc">+</span>  </span>
<span id="cb13-7"><a href="#cb13-7"></a>  ndvi_c1 <span class="sc">+</span></span>
<span id="cb13-8"><a href="#cb13-8"></a>  ndvi_c2 <span class="sc">+</span></span>
<span id="cb13-9"><a href="#cb13-9"></a>  ndvi_c3 <span class="sc">+</span>  </span>
<span id="cb13-10"><a href="#cb13-10"></a>  </span>
<span id="cb13-11"><a href="#cb13-11"></a>  ndvi_sq <span class="sc">+</span></span>
<span id="cb13-12"><a href="#cb13-12"></a>  ndvi_sq_s1 <span class="sc">+</span></span>
<span id="cb13-13"><a href="#cb13-13"></a>  ndvi_sq_s2 <span class="sc">+</span></span>
<span id="cb13-14"><a href="#cb13-14"></a>  ndvi_sq_s3 <span class="sc">+</span>  </span>
<span id="cb13-15"><a href="#cb13-15"></a>  ndvi_sq_c1 <span class="sc">+</span></span>
<span id="cb13-16"><a href="#cb13-16"></a>  ndvi_sq_c2 <span class="sc">+</span></span>
<span id="cb13-17"><a href="#cb13-17"></a>  ndvi_sq_c3 <span class="sc">+</span>  </span>
<span id="cb13-18"><a href="#cb13-18"></a>  </span>
<span id="cb13-19"><a href="#cb13-19"></a>  canopy <span class="sc">+</span></span>
<span id="cb13-20"><a href="#cb13-20"></a>  canopy_s1 <span class="sc">+</span></span>
<span id="cb13-21"><a href="#cb13-21"></a>  canopy_s2 <span class="sc">+</span></span>
<span id="cb13-22"><a href="#cb13-22"></a>  canopy_s3 <span class="sc">+</span>  </span>
<span id="cb13-23"><a href="#cb13-23"></a>  canopy_c1 <span class="sc">+</span></span>
<span id="cb13-24"><a href="#cb13-24"></a>  canopy_c2 <span class="sc">+</span></span>
<span id="cb13-25"><a href="#cb13-25"></a>  canopy_c3 <span class="sc">+</span>  </span>
<span id="cb13-26"><a href="#cb13-26"></a>  </span>
<span id="cb13-27"><a href="#cb13-27"></a>  canopy_sq <span class="sc">+</span></span>
<span id="cb13-28"><a href="#cb13-28"></a>  canopy_sq_s1 <span class="sc">+</span></span>
<span id="cb13-29"><a href="#cb13-29"></a>  canopy_sq_s2 <span class="sc">+</span></span>
<span id="cb13-30"><a href="#cb13-30"></a>  canopy_sq_s3 <span class="sc">+</span>  </span>
<span id="cb13-31"><a href="#cb13-31"></a>  canopy_sq_c1 <span class="sc">+</span></span>
<span id="cb13-32"><a href="#cb13-32"></a>  canopy_sq_c2 <span class="sc">+</span></span>
<span id="cb13-33"><a href="#cb13-33"></a>  canopy_sq_c3 <span class="sc">+</span>  </span>
<span id="cb13-34"><a href="#cb13-34"></a>  </span>
<span id="cb13-35"><a href="#cb13-35"></a>  slope <span class="sc">+</span></span>
<span id="cb13-36"><a href="#cb13-36"></a>  slope_s1 <span class="sc">+</span></span>
<span id="cb13-37"><a href="#cb13-37"></a>  slope_s2 <span class="sc">+</span></span>
<span id="cb13-38"><a href="#cb13-38"></a>  slope_s3 <span class="sc">+</span>  </span>
<span id="cb13-39"><a href="#cb13-39"></a>  slope_c1 <span class="sc">+</span></span>
<span id="cb13-40"><a href="#cb13-40"></a>  slope_c2 <span class="sc">+</span></span>
<span id="cb13-41"><a href="#cb13-41"></a>  slope_c3 <span class="sc">+</span>  </span>
<span id="cb13-42"><a href="#cb13-42"></a>  </span>
<span id="cb13-43"><a href="#cb13-43"></a>  herby <span class="sc">+</span></span>
<span id="cb13-44"><a href="#cb13-44"></a>  herby_s1 <span class="sc">+</span></span>
<span id="cb13-45"><a href="#cb13-45"></a>  herby_s2 <span class="sc">+</span></span>
<span id="cb13-46"><a href="#cb13-46"></a>  herby_s3 <span class="sc">+</span>  </span>
<span id="cb13-47"><a href="#cb13-47"></a>  herby_c1 <span class="sc">+</span></span>
<span id="cb13-48"><a href="#cb13-48"></a>  herby_c2 <span class="sc">+</span></span>
<span id="cb13-49"><a href="#cb13-49"></a>  herby_c3 <span class="sc">+</span>   </span>
<span id="cb13-50"><a href="#cb13-50"></a>  </span>
<span id="cb13-51"><a href="#cb13-51"></a>  step_l <span class="sc">+</span></span>
<span id="cb13-52"><a href="#cb13-52"></a>  step_l_s1 <span class="sc">+</span></span>
<span id="cb13-53"><a href="#cb13-53"></a>  step_l_s2 <span class="sc">+</span></span>
<span id="cb13-54"><a href="#cb13-54"></a>  step_l_s3 <span class="sc">+</span>  </span>
<span id="cb13-55"><a href="#cb13-55"></a>  step_l_c1 <span class="sc">+</span></span>
<span id="cb13-56"><a href="#cb13-56"></a>  step_l_c2 <span class="sc">+</span></span>
<span id="cb13-57"><a href="#cb13-57"></a>  step_l_c3 <span class="sc">+</span>  </span>
<span id="cb13-58"><a href="#cb13-58"></a>  </span>
<span id="cb13-59"><a href="#cb13-59"></a>  log_step_l <span class="sc">+</span></span>
<span id="cb13-60"><a href="#cb13-60"></a>  log_step_l_s1 <span class="sc">+</span></span>
<span id="cb13-61"><a href="#cb13-61"></a>  log_step_l_s2 <span class="sc">+</span></span>
<span id="cb13-62"><a href="#cb13-62"></a>  log_step_l_s3 <span class="sc">+</span>  </span>
<span id="cb13-63"><a href="#cb13-63"></a>  log_step_l_c1 <span class="sc">+</span></span>
<span id="cb13-64"><a href="#cb13-64"></a>  log_step_l_c2 <span class="sc">+</span></span>
<span id="cb13-65"><a href="#cb13-65"></a>  log_step_l_c3 <span class="sc">+</span>  </span>
<span id="cb13-66"><a href="#cb13-66"></a>  </span>
<span id="cb13-67"><a href="#cb13-67"></a>  cos_turn_a <span class="sc">+</span></span>
<span id="cb13-68"><a href="#cb13-68"></a>  cos_turn_a_s1 <span class="sc">+</span></span>
<span id="cb13-69"><a href="#cb13-69"></a>  cos_turn_a_s2 <span class="sc">+</span></span>
<span id="cb13-70"><a href="#cb13-70"></a>  cos_turn_a_s3 <span class="sc">+</span>  </span>
<span id="cb13-71"><a href="#cb13-71"></a>  cos_turn_a_c1 <span class="sc">+</span></span>
<span id="cb13-72"><a href="#cb13-72"></a>  cos_turn_a_c2 <span class="sc">+</span></span>
<span id="cb13-73"><a href="#cb13-73"></a>  cos_turn_a_c3 <span class="sc">+</span></span>
<span id="cb13-74"><a href="#cb13-74"></a>  </span>
<span id="cb13-75"><a href="#cb13-75"></a>  <span class="fu">strata</span>(step_id)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
</section>
<section id="fit-the-model" class="level2">
<h2 class="anchored" data-anchor-id="fit-the-model">Fit the model</h2>
<p>As we have already fitted the model, we will load it here, but if the model_fit file doesn’t exist, it will run the model fitting code. Be careful here that if you change the model formula, you will need to delete or rename the model_fit file to re-run the model fitting code, otherwise it will just load the previous model.</p>
<p>We are fitting a single model to the focal individual.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset" data-group="model">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-3-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-1" role="tab" aria-controls="tabset-3-1" aria-selected="true">0p</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-2" role="tab" aria-controls="tabset-3-2" aria-selected="false">1p</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-3" role="tab" aria-controls="tabset-3-3" aria-selected="false">2p</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-4" role="tab" aria-controls="tabset-3-4" aria-selected="false">3p</a></li></ul>
<div class="tab-content" data-group="model">
<div id="tabset-3-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-3-1-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a><span class="cf">if</span>(<span class="fu">file.exists</span>(<span class="fu">paste0</span>(<span class="st">"ssf_coefficients/model_id"</span>, focal_id, <span class="st">"_0p_harms.rds"</span>))) {</span>
<span id="cb14-2"><a href="#cb14-2"></a>  </span>
<span id="cb14-3"><a href="#cb14-3"></a>  model_0p_harms <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="fu">paste0</span>(<span class="st">"ssf_coefficients/model_id"</span>, focal_id, <span class="st">"_0p_harms.rds"</span>))</span>
<span id="cb14-4"><a href="#cb14-4"></a>  <span class="fu">print</span>(<span class="st">"Read existing model"</span>)</span>
<span id="cb14-5"><a href="#cb14-5"></a>  </span>
<span id="cb14-6"><a href="#cb14-6"></a>} <span class="cf">else</span> {</span>
<span id="cb14-7"><a href="#cb14-7"></a>  </span>
<span id="cb14-8"><a href="#cb14-8"></a>  <span class="fu">tic</span>()</span>
<span id="cb14-9"><a href="#cb14-9"></a>    model_0p_harms <span class="ot">&lt;-</span> <span class="fu">fit_clogit</span>(<span class="at">formula =</span> formula_0p,</span>
<span id="cb14-10"><a href="#cb14-10"></a>                                 <span class="at">data =</span> buffalo_data_scaled_0p)</span>
<span id="cb14-11"><a href="#cb14-11"></a>  <span class="fu">toc</span>()</span>
<span id="cb14-12"><a href="#cb14-12"></a>  </span>
<span id="cb14-13"><a href="#cb14-13"></a>  <span class="co"># save model object</span></span>
<span id="cb14-14"><a href="#cb14-14"></a>  <span class="fu">saveRDS</span>(model_0p_harms, <span class="at">file =</span> <span class="fu">paste0</span>(<span class="st">"ssf_coefficients/model_id"</span>, focal_id, <span class="st">"_0p_harms.rds"</span>))</span>
<span id="cb14-15"><a href="#cb14-15"></a>  </span>
<span id="cb14-16"><a href="#cb14-16"></a>  <span class="fu">print</span>(<span class="st">"Fitted model"</span>)</span>
<span id="cb14-17"><a href="#cb14-17"></a>  <span class="fu">beep</span>(<span class="at">sound =</span> <span class="dv">2</span>)</span>
<span id="cb14-18"><a href="#cb14-18"></a></span>
<span id="cb14-19"><a href="#cb14-19"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Read existing model"</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1"></a>model_0p_harms</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>$model
Call:
survival::clogit(formula, data = data, ...)

                coef exp(coef)  se(coef)       z                    p
ndvi        0.119793  1.127263  0.054606   2.194             0.028254
ndvi_sq    -0.029336  0.971090  0.057424  -0.511             0.609444
canopy     -0.209316  0.811139  0.055978  -3.739             0.000185
canopy_sq   0.067734  1.070080  0.056884   1.191             0.233758
slope      -0.081189  0.922019  0.018447  -4.401            0.0000108
herby      -0.060009  0.941756  0.016352  -3.670             0.000243
step_l     -0.176031  0.838592  0.016867 -10.436 &lt; 0.0000000000000002
log_step_l  0.127038  1.135461  0.015469   8.212 &lt; 0.0000000000000002
cos_turn_a  0.001974  1.001976  0.011025   0.179             0.857924

Likelihood ratio test=282.9  on 9 df, p=&lt; 0.00000000000000022
n= 104742, number of events= 9082 
   (2574 observations deleted due to missingness)

$sl_
NULL

$ta_
NULL

$more
NULL

attr(,"class")
[1] "fit_clogit" "list"      </code></pre>
</div>
</div>
</div>
<div id="tabset-3-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-2-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1"></a><span class="cf">if</span>(<span class="fu">file.exists</span>(<span class="fu">paste0</span>(<span class="st">"ssf_coefficients/model_id"</span>, focal_id, <span class="st">"_1p_harms.rds"</span>))) {</span>
<span id="cb18-2"><a href="#cb18-2"></a>  </span>
<span id="cb18-3"><a href="#cb18-3"></a>  model_1p_harms <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="fu">paste0</span>(<span class="st">"ssf_coefficients/model_id"</span>, focal_id, <span class="st">"_1p_harms.rds"</span>))</span>
<span id="cb18-4"><a href="#cb18-4"></a>  <span class="fu">print</span>(<span class="st">"Read existing model"</span>)</span>
<span id="cb18-5"><a href="#cb18-5"></a>  </span>
<span id="cb18-6"><a href="#cb18-6"></a>} <span class="cf">else</span> {</span>
<span id="cb18-7"><a href="#cb18-7"></a></span>
<span id="cb18-8"><a href="#cb18-8"></a>  <span class="fu">tic</span>()</span>
<span id="cb18-9"><a href="#cb18-9"></a>  model_1p_harms <span class="ot">&lt;-</span> <span class="fu">fit_clogit</span>(<span class="at">formula =</span> formula_1p,</span>
<span id="cb18-10"><a href="#cb18-10"></a>                               <span class="at">data =</span> buffalo_data_scaled_1p)</span>
<span id="cb18-11"><a href="#cb18-11"></a>  <span class="fu">toc</span>()</span>
<span id="cb18-12"><a href="#cb18-12"></a>  </span>
<span id="cb18-13"><a href="#cb18-13"></a>  <span class="co"># save model object</span></span>
<span id="cb18-14"><a href="#cb18-14"></a>  <span class="fu">saveRDS</span>(model_1p_harms, <span class="at">file =</span> <span class="fu">paste0</span>(<span class="st">"ssf_coefficients/model_id"</span>, focal_id, <span class="st">"_1p_harms.rds"</span>))</span>
<span id="cb18-15"><a href="#cb18-15"></a>  </span>
<span id="cb18-16"><a href="#cb18-16"></a>  <span class="fu">print</span>(<span class="st">"Fitted model"</span>)</span>
<span id="cb18-17"><a href="#cb18-17"></a>  <span class="fu">beep</span>(<span class="at">sound =</span> <span class="dv">2</span>)</span>
<span id="cb18-18"><a href="#cb18-18"></a></span>
<span id="cb18-19"><a href="#cb18-19"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Read existing model"</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1"></a>model_1p_harms</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>$model
Call:
survival::clogit(formula, data = data, ...)

                   coef exp(coef)  se(coef)       z                    p
ndvi           0.003458  1.003464  0.065205   0.053             0.957708
ndvi_s1       -0.905497  0.404341  0.208658  -4.340 0.000014272791479765
ndvi_c1       -1.587639  0.204408  0.196747  -8.069 0.000000000000000706
ndvi_sq        0.042168  1.043069  0.066146   0.637             0.523805
ndvi_sq_s1     0.422763  1.526173  0.121607   3.476             0.000508
ndvi_sq_c1     0.894461  2.446018  0.116964   7.647 0.000000000000020526
canopy        -0.221606  0.801231  0.058306  -3.801             0.000144
canopy_s1     -0.034029  0.966543  0.166888  -0.204             0.838428
canopy_c1      0.223925  1.250977  0.169148   1.324             0.185557
canopy_sq      0.081769  1.085205  0.059131   1.383             0.166716
canopy_sq_s1   0.180573  1.197904  0.110883   1.629             0.103418
canopy_sq_c1  -0.277337  0.757799  0.112403  -2.467             0.013612
slope         -0.079070  0.923975  0.019172  -4.124 0.000037197638599163
slope_s1      -0.111915  0.894120  0.026769  -4.181 0.000029054259144576
slope_c1       0.019384  1.019573  0.027979   0.693             0.488442
herby         -0.052554  0.948803  0.017372  -3.025             0.002484
herby_s1       0.003434  1.003440  0.035854   0.096             0.923689
herby_c1       0.166075  1.180662  0.037677   4.408 0.000010438424205133
step_l        -0.236002  0.789779  0.018147 -13.005 &lt; 0.0000000000000002
step_l_s1      0.046954  1.048074  0.021103   2.225             0.026084
step_l_c1      0.016707  1.016848  0.021392   0.781             0.434806
log_step_l     0.222075  1.248665  0.017412  12.754 &lt; 0.0000000000000002
log_step_l_s1 -0.332569  0.717079  0.031679 -10.498 &lt; 0.0000000000000002
log_step_l_c1 -0.467227  0.626738  0.031657 -14.759 &lt; 0.0000000000000002
cos_turn_a     0.005601  1.005617  0.011209   0.500             0.617310
cos_turn_a_s1 -0.083722  0.919687  0.011221  -7.461 0.000000000000085936
cos_turn_a_c1 -0.097243  0.907335  0.011329  -8.583 &lt; 0.0000000000000002

Likelihood ratio test=1136  on 27 df, p=&lt; 0.00000000000000022
n= 104742, number of events= 9082 
   (2574 observations deleted due to missingness)

$sl_
NULL

$ta_
NULL

$more
NULL

attr(,"class")
[1] "fit_clogit" "list"      </code></pre>
</div>
</div>
</div>
<div id="tabset-3-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-3-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1"></a><span class="cf">if</span>(<span class="fu">file.exists</span>(<span class="fu">paste0</span>(<span class="st">"ssf_coefficients/model_id"</span>, focal_id, <span class="st">"_2p_harms.rds"</span>))) {</span>
<span id="cb22-2"><a href="#cb22-2"></a>  </span>
<span id="cb22-3"><a href="#cb22-3"></a>  model_2p_harms <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="fu">paste0</span>(<span class="st">"ssf_coefficients/model_id"</span>, focal_id, <span class="st">"_2p_harms.rds"</span>))</span>
<span id="cb22-4"><a href="#cb22-4"></a>  <span class="fu">print</span>(<span class="st">"Read existing model"</span>)</span>
<span id="cb22-5"><a href="#cb22-5"></a>  </span>
<span id="cb22-6"><a href="#cb22-6"></a>} <span class="cf">else</span> {</span>
<span id="cb22-7"><a href="#cb22-7"></a></span>
<span id="cb22-8"><a href="#cb22-8"></a>  <span class="fu">tic</span>()</span>
<span id="cb22-9"><a href="#cb22-9"></a>  model_2p_harms <span class="ot">&lt;-</span> <span class="fu">fit_clogit</span>(<span class="at">formula =</span> formula_2p,</span>
<span id="cb22-10"><a href="#cb22-10"></a>                               <span class="at">data =</span> buffalo_data_scaled_2p)</span>
<span id="cb22-11"><a href="#cb22-11"></a>  <span class="fu">toc</span>()</span>
<span id="cb22-12"><a href="#cb22-12"></a>  </span>
<span id="cb22-13"><a href="#cb22-13"></a>  <span class="co"># save model object</span></span>
<span id="cb22-14"><a href="#cb22-14"></a>  <span class="fu">saveRDS</span>(model_2p_harms, <span class="at">file =</span> <span class="fu">paste0</span>(<span class="st">"ssf_coefficients/model_id"</span>, focal_id, <span class="st">"_2p_harms.rds"</span>))</span>
<span id="cb22-15"><a href="#cb22-15"></a>  </span>
<span id="cb22-16"><a href="#cb22-16"></a>  <span class="fu">print</span>(<span class="st">"Fitted model"</span>)</span>
<span id="cb22-17"><a href="#cb22-17"></a>  <span class="fu">beep</span>(<span class="at">sound =</span> <span class="dv">2</span>)</span>
<span id="cb22-18"><a href="#cb22-18"></a></span>
<span id="cb22-19"><a href="#cb22-19"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Read existing model"</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1"></a>model_2p_harms</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>$model
Call:
survival::clogit(formula, data = data, ...)

                   coef exp(coef)  se(coef)       z                    p
ndvi           0.043757  1.044728  0.068423   0.640             0.522494
ndvi_s1       -0.992511  0.370645  0.205335  -4.834  0.00000134070221599
ndvi_s2        0.342154  1.407978  0.203008   1.685             0.091907
ndvi_c1       -1.612940  0.199301  0.220780  -7.306  0.00000000000027593
ndvi_c2        0.088936  1.093010  0.217183   0.409             0.682176
ndvi_sq       -0.008091  0.991942  0.069470  -0.116             0.907284
ndvi_sq_s1     0.514073  1.672089  0.120387   4.270  0.00001953181494962
ndvi_sq_s2    -0.130500  0.877657  0.120427  -1.084             0.278525
ndvi_sq_c1     0.895540  2.448658  0.130059   6.886  0.00000000000575333
ndvi_sq_c2     0.082307  1.085789  0.127867   0.644             0.519776
canopy        -0.192538  0.824863  0.059616  -3.230             0.001240
canopy_s1      0.080558  1.083892  0.172367   0.467             0.640240
canopy_s2     -0.015172  0.984942  0.168208  -0.090             0.928129
canopy_c1      0.266237  1.305045  0.177146   1.503             0.132858
canopy_c2      0.050129  1.051407  0.173408   0.289             0.772518
canopy_sq      0.058202  1.059930  0.060273   0.966             0.334221
canopy_sq_s1   0.122514  1.130335  0.114444   1.071             0.284387
canopy_sq_s2   0.104232  1.109858  0.111811   0.932             0.351223
canopy_sq_c1  -0.276427  0.758489  0.116800  -2.367             0.017948
canopy_sq_c2   0.098530  1.103547  0.114527   0.860             0.389615
slope         -0.091073  0.912951  0.020685  -4.403  0.00001068238707322
slope_s1      -0.093865  0.910406  0.026656  -3.521             0.000429
slope_s2      -0.023585  0.976691  0.028530  -0.827             0.408417
slope_c1       0.001756  1.001758  0.031056   0.057             0.954898
slope_c2      -0.029052  0.971366  0.029142  -0.997             0.318817
herby         -0.059191  0.942527  0.017900  -3.307             0.000944
herby_s1       0.002033  1.002036  0.037217   0.055             0.956428
herby_s2      -0.000974  0.999027  0.037022  -0.026             0.979011
herby_c1       0.115076  1.121959  0.040037   2.874             0.004050
herby_c2      -0.128467  0.879443  0.037886  -3.391             0.000697
step_l        -0.419477  0.657391  0.022905 -18.314 &lt; 0.0000000000000002
step_l_s1     -0.001464  0.998537  0.019972  -0.073             0.941577
step_l_s2     -0.279437  0.756210  0.023197 -12.046 &lt; 0.0000000000000002
step_l_c1     -0.107757  0.897845  0.028057  -3.841             0.000123
step_l_c2     -0.289807  0.748408  0.024142 -12.004 &lt; 0.0000000000000002
log_step_l     0.288252  1.334093  0.018317  15.737 &lt; 0.0000000000000002
log_step_l_s1 -0.374283  0.687782  0.035567 -10.523 &lt; 0.0000000000000002
log_step_l_s2 -0.045758  0.955273  0.033065  -1.384             0.166397
log_step_l_c1 -0.372760  0.688830  0.033255 -11.209 &lt; 0.0000000000000002
log_step_l_c2 -0.153402  0.857785  0.032811  -4.675  0.00000293525964538
cos_turn_a     0.009075  1.009116  0.011381   0.797             0.425219
cos_turn_a_s1 -0.088709  0.915112  0.011422  -7.766  0.00000000000000808
cos_turn_a_s2 -0.105611  0.899774  0.011399  -9.265 &lt; 0.0000000000000002
cos_turn_a_c1 -0.089552  0.914341  0.011476  -7.804  0.00000000000000601
cos_turn_a_c2 -0.077023  0.925869  0.011429  -6.739  0.00000000001591447

Likelihood ratio test=2039  on 45 df, p=&lt; 0.00000000000000022
n= 104742, number of events= 9082 
   (2574 observations deleted due to missingness)

$sl_
NULL

$ta_
NULL

$more
NULL

attr(,"class")
[1] "fit_clogit" "list"      </code></pre>
</div>
</div>
</div>
<div id="tabset-3-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-4-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1"></a><span class="cf">if</span>(<span class="fu">file.exists</span>(<span class="fu">paste0</span>(<span class="st">"ssf_coefficients/model_id"</span>, focal_id, <span class="st">"_3p_harms.rds"</span>))) {</span>
<span id="cb26-2"><a href="#cb26-2"></a>  </span>
<span id="cb26-3"><a href="#cb26-3"></a>  model_3p_harms <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="fu">paste0</span>(<span class="st">"ssf_coefficients/model_id"</span>, focal_id, <span class="st">"_3p_harms.rds"</span>))</span>
<span id="cb26-4"><a href="#cb26-4"></a>  <span class="fu">print</span>(<span class="st">"Read existing model"</span>)</span>
<span id="cb26-5"><a href="#cb26-5"></a>  </span>
<span id="cb26-6"><a href="#cb26-6"></a>} <span class="cf">else</span> {</span>
<span id="cb26-7"><a href="#cb26-7"></a></span>
<span id="cb26-8"><a href="#cb26-8"></a>  <span class="fu">tic</span>()</span>
<span id="cb26-9"><a href="#cb26-9"></a>  model_3p_harms <span class="ot">&lt;-</span> <span class="fu">fit_clogit</span>(<span class="at">formula =</span> formula_3p,</span>
<span id="cb26-10"><a href="#cb26-10"></a>                               <span class="at">data =</span> buffalo_data_scaled_3p)</span>
<span id="cb26-11"><a href="#cb26-11"></a>  <span class="fu">toc</span>()</span>
<span id="cb26-12"><a href="#cb26-12"></a>  </span>
<span id="cb26-13"><a href="#cb26-13"></a>  <span class="co"># save model object</span></span>
<span id="cb26-14"><a href="#cb26-14"></a>  <span class="fu">saveRDS</span>(model_3p_harms, <span class="at">file =</span> <span class="fu">paste0</span>(<span class="st">"ssf_coefficients/model_id"</span>, focal_id, <span class="st">"_3p_harms.rds"</span>))</span>
<span id="cb26-15"><a href="#cb26-15"></a>  </span>
<span id="cb26-16"><a href="#cb26-16"></a>  <span class="fu">print</span>(<span class="st">"Fitted model"</span>)</span>
<span id="cb26-17"><a href="#cb26-17"></a>  <span class="fu">beep</span>(<span class="at">sound =</span> <span class="dv">2</span>)</span>
<span id="cb26-18"><a href="#cb26-18"></a></span>
<span id="cb26-19"><a href="#cb26-19"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Read existing model"</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1"></a>model_3p_harms</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>$model
Call:
survival::clogit(formula, data = data, ...)

                   coef exp(coef)  se(coef)       z                    p
ndvi           0.053434  1.054887  0.069905   0.764             0.444642
ndvi_s1       -0.889595  0.410822  0.220413  -4.036  0.00005436147153177
ndvi_s2        0.376174  1.456700  0.210826   1.784             0.074378
ndvi_s3        0.020205  1.020410  0.221771   0.091             0.927409
ndvi_c1       -1.673562  0.187578  0.218941  -7.644  0.00000000000002108
ndvi_c2       -0.135140  0.873594  0.227080  -0.595             0.551764
ndvi_c3       -0.208753  0.811596  0.207927  -1.004             0.315391
ndvi_sq       -0.013759  0.986335  0.070977  -0.194             0.846290
ndvi_sq_s1     0.452224  1.571804  0.128359   3.523             0.000426
ndvi_sq_s2    -0.166224  0.846856  0.123974  -1.341             0.179986
ndvi_sq_s3    -0.056616  0.944957  0.130381  -0.434             0.664116
ndvi_sq_c1     0.943417  2.568745  0.129567   7.281  0.00000000000033058
ndvi_sq_c2     0.226610  1.254340  0.133381   1.699             0.089326
ndvi_sq_c3     0.014961  1.015073  0.123553   0.121             0.903620
canopy        -0.210127  0.810481  0.060329  -3.483             0.000496
canopy_s1      0.139434  1.149623  0.175581   0.794             0.427118
canopy_s2      0.041171  1.042030  0.173616   0.237             0.812552
canopy_s3      0.167108  1.181882  0.172810   0.967             0.333542
canopy_c1      0.186546  1.205080  0.177467   1.051             0.293186
canopy_c2     -0.020638  0.979573  0.178995  -0.115             0.908206
canopy_c3     -0.432610  0.648814  0.172568  -2.507             0.012180
canopy_sq      0.070688  1.073247  0.061074   1.157             0.247099
canopy_sq_s1   0.079781  1.083050  0.116564   0.684             0.493698
canopy_sq_s2   0.068549  1.070953  0.115436   0.594             0.552631
canopy_sq_s3  -0.128069  0.879793  0.114703  -1.117             0.264199
canopy_sq_c1  -0.233344  0.791881  0.117332  -1.989             0.046728
canopy_sq_c2   0.128881  1.137555  0.118059   1.092             0.274978
canopy_sq_c3   0.262403  1.300051  0.114177   2.298             0.021550
slope         -0.101180  0.903771  0.020815  -4.861  0.00000116797774923
slope_s1      -0.079426  0.923646  0.027910  -2.846             0.004430
slope_s2      -0.018933  0.981245  0.028913  -0.655             0.512585
slope_s3       0.027495  1.027877  0.028756   0.956             0.338986
slope_c1       0.004549  1.004559  0.031200   0.146             0.884082
slope_c2      -0.021925  0.978314  0.029634  -0.740             0.459388
slope_c3      -0.063772  0.938219  0.029628  -2.152             0.031365
herby         -0.055395  0.946111  0.018036  -3.071             0.002131
herby_s1      -0.002842  0.997162  0.037958  -0.075             0.940322
herby_s2      -0.011763  0.988306  0.038665  -0.304             0.760951
herby_s3      -0.057742  0.943893  0.038132  -1.514             0.129954
herby_c1       0.138502  1.148552  0.040208   3.445             0.000572
herby_c2      -0.096224  0.908260  0.039346  -2.446             0.014463
herby_c3       0.046576  1.047677  0.037659   1.237             0.216170
step_l        -0.475893  0.621330  0.023495 -20.255 &lt; 0.0000000000000002
step_l_s1      0.082577  1.086082  0.024644   3.351             0.000806
step_l_s2     -0.235319  0.790319  0.024867  -9.463 &lt; 0.0000000000000002
step_l_s3      0.037193  1.037893  0.024911   1.493             0.135428
step_l_c1      0.037076  1.037772  0.029939   1.238             0.215564
step_l_c2     -0.207766  0.812397  0.025781  -8.059  0.00000000000000077
step_l_c3     -0.016837  0.983304  0.024683  -0.682             0.495166
log_step_l     0.424316  1.528544  0.021121  20.090 &lt; 0.0000000000000002
log_step_l_s1 -0.485817  0.615194  0.042313 -11.482 &lt; 0.0000000000000002
log_step_l_s2 -0.097189  0.907385  0.036489  -2.664             0.007732
log_step_l_s3  0.577112  1.780888  0.035215  16.388 &lt; 0.0000000000000002
log_step_l_c1 -0.559955  0.571235  0.033581 -16.675 &lt; 0.0000000000000002
log_step_l_c2 -0.431154  0.649759  0.037566 -11.477 &lt; 0.0000000000000002
log_step_l_c3  0.386800  1.472262  0.034641  11.166 &lt; 0.0000000000000002
cos_turn_a     0.005726  1.005743  0.011526   0.497             0.619330
cos_turn_a_s1 -0.083038  0.920316  0.011673  -7.114  0.00000000000112854
cos_turn_a_s2 -0.099854  0.904970  0.011521  -8.667 &lt; 0.0000000000000002
cos_turn_a_s3  0.145950  1.157139  0.011610  12.571 &lt; 0.0000000000000002
cos_turn_a_c1 -0.101155  0.903793  0.011567  -8.745 &lt; 0.0000000000000002
cos_turn_a_c2 -0.089038  0.914811  0.011680  -7.623  0.00000000000002471
cos_turn_a_c3  0.027900  1.028292  0.011512   2.423             0.015374

Likelihood ratio test=2898  on 63 df, p=&lt; 0.00000000000000022
n= 104742, number of events= 9082 
   (2574 observations deleted due to missingness)

$sl_
NULL

$ta_
NULL

$more
NULL

attr(,"class")
[1] "fit_clogit" "list"      </code></pre>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="check-the-fitted-model-outputs" class="level2">
<h2 class="anchored" data-anchor-id="check-the-fitted-model-outputs">Check the fitted model outputs</h2>
<p>Create a dataframe of the coefficients with the scaling attributes that we saved when creating the data matrix. We can then return the coefficients to their natural scale by dividing by the scaling factor (standard deviation).</p>
<p>As we can see, we have a coefficient for each covariate by itself, and then one for each of the harmonic interactions. These are the ‘weights’ that we played around with in the <code>Ecography_DynamicSSF_Walkthrough_Harmonics_and_selection_surfaces</code> walkthrough script in: <a href="https://github.com/swforrest/dynamic_SSF_sims">swforrest/dynamic_SSF_sims</a>, and we reconstruct them in exactly the same way. We also have the coefficients for the quadratic terms and the interactions with the harmonics, which we have denoted as <code>ndvi_sq</code> for instance. We will come back to these when we look at the selection surfaces.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset" data-group="model">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-4-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-1" role="tab" aria-controls="tabset-4-1" aria-selected="true">0p</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-4-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-2" role="tab" aria-controls="tabset-4-2" aria-selected="false">1p</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-4-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-3" role="tab" aria-controls="tabset-4-3" aria-selected="false">2p</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-4-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-4" role="tab" aria-controls="tabset-4-4" aria-selected="false">3p</a></li></ul>
<div class="tab-content" data-group="model">
<div id="tabset-4-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-4-1-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1"></a>model_0p_harms</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>$model
Call:
survival::clogit(formula, data = data, ...)

                coef exp(coef)  se(coef)       z                    p
ndvi        0.119793  1.127263  0.054606   2.194             0.028254
ndvi_sq    -0.029336  0.971090  0.057424  -0.511             0.609444
canopy     -0.209316  0.811139  0.055978  -3.739             0.000185
canopy_sq   0.067734  1.070080  0.056884   1.191             0.233758
slope      -0.081189  0.922019  0.018447  -4.401            0.0000108
herby      -0.060009  0.941756  0.016352  -3.670             0.000243
step_l     -0.176031  0.838592  0.016867 -10.436 &lt; 0.0000000000000002
log_step_l  0.127038  1.135461  0.015469   8.212 &lt; 0.0000000000000002
cos_turn_a  0.001974  1.001976  0.011025   0.179             0.857924

Likelihood ratio test=282.9  on 9 df, p=&lt; 0.00000000000000022
n= 104742, number of events= 9082 
   (2574 observations deleted due to missingness)

$sl_
NULL

$ta_
NULL

$more
NULL

attr(,"class")
[1] "fit_clogit" "list"      </code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1"></a><span class="co"># these create massive outputs for the dynamic models so we've commented them out</span></span>
<span id="cb32-2"><a href="#cb32-2"></a><span class="co"># model_0p_harms$model$coefficients</span></span>
<span id="cb32-3"><a href="#cb32-3"></a><span class="co"># model_0p_harms$se</span></span>
<span id="cb32-4"><a href="#cb32-4"></a><span class="co"># model_0p_harms$vcov</span></span>
<span id="cb32-5"><a href="#cb32-5"></a><span class="co"># diag(model_0p_harms$D) # between cluster variance</span></span>
<span id="cb32-6"><a href="#cb32-6"></a><span class="co"># model_0p_harms$r.effect # individual estimates</span></span>
<span id="cb32-7"><a href="#cb32-7"></a></span>
<span id="cb32-8"><a href="#cb32-8"></a><span class="co"># create a dataframe of the coefficients and their scaling attributes</span></span>
<span id="cb32-9"><a href="#cb32-9"></a>coefs_clr_0p <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">coefs =</span> <span class="fu">names</span>(model_0p_harms<span class="sc">$</span>model<span class="sc">$</span>coefficients), </span>
<span id="cb32-10"><a href="#cb32-10"></a>                           <span class="at">value =</span> model_0p_harms<span class="sc">$</span>model<span class="sc">$</span>coefficients)</span>
<span id="cb32-11"><a href="#cb32-11"></a></span>
<span id="cb32-12"><a href="#cb32-12"></a><span class="co"># return coefficients to natural scale</span></span>
<span id="cb32-13"><a href="#cb32-13"></a>coefs_clr_0p<span class="sc">$</span>scale_sd <span class="ot">&lt;-</span> scaling_attributes_0p<span class="sc">$</span>sd</span>
<span id="cb32-14"><a href="#cb32-14"></a>coefs_clr_0p <span class="ot">&lt;-</span> coefs_clr_0p <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">value_nat =</span> value <span class="sc">/</span> scale_sd)</span>
<span id="cb32-15"><a href="#cb32-15"></a></span>
<span id="cb32-16"><a href="#cb32-16"></a><span class="co"># show the first few rows</span></span>
<span id="cb32-17"><a href="#cb32-17"></a><span class="fu">head</span>(coefs_clr_0p)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["coefs"],"name":[1],"type":["chr"],"align":["left"]},{"label":["value"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["scale_sd"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["value_nat"],"name":[4],"type":["dbl"],"align":["right"]}],"data":[{"1":"ndvi","2":"0.11979262","3":"0.09970648","4":"1.2014527","_rn_":"ndvi"},{"1":"ndvi_sq","2":"-0.02933619","3":"0.06498555","4":"-0.4514263","_rn_":"ndvi_sq"},{"1":"canopy","2":"-0.20931554","3":"0.15313840","4":"-1.3668390","_rn_":"canopy"},{"1":"canopy_sq","2":"0.06773356","3":"0.12331270","4":"0.5492829","_rn_":"canopy_sq"},{"1":"slope","2":"-0.08118911","3":"0.68009298","4":"-0.1193794","_rn_":"slope"},{"1":"herby","2":"-0.06000902","3":"0.40882526","4":"-0.1467840","_rn_":"herby"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
</div>
<div id="tabset-4-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-4-2-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1"></a><span class="co"># creates a huge output due to the correlation matrix</span></span>
<span id="cb33-2"><a href="#cb33-2"></a><span class="co"># model_1p_harms</span></span>
<span id="cb33-3"><a href="#cb33-3"></a></span>
<span id="cb33-4"><a href="#cb33-4"></a><span class="co"># model_1p_harms</span></span>
<span id="cb33-5"><a href="#cb33-5"></a><span class="co"># model_1p_harms$model$coefficients</span></span>
<span id="cb33-6"><a href="#cb33-6"></a><span class="co"># model_1p_harms$se</span></span>
<span id="cb33-7"><a href="#cb33-7"></a><span class="co"># model_1p_harms$vcov</span></span>
<span id="cb33-8"><a href="#cb33-8"></a><span class="co"># diag(model_1p_harms$D) # between cluster variance</span></span>
<span id="cb33-9"><a href="#cb33-9"></a><span class="co"># model_1p_harms$r.effect # individual estimates</span></span>
<span id="cb33-10"><a href="#cb33-10"></a></span>
<span id="cb33-11"><a href="#cb33-11"></a>coefs_clr_1p <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">coefs =</span> <span class="fu">names</span>(model_1p_harms<span class="sc">$</span>model<span class="sc">$</span>coefficients), </span>
<span id="cb33-12"><a href="#cb33-12"></a>                           <span class="at">value =</span> model_1p_harms<span class="sc">$</span>model<span class="sc">$</span>coefficients)</span>
<span id="cb33-13"><a href="#cb33-13"></a></span>
<span id="cb33-14"><a href="#cb33-14"></a><span class="co"># return coefficients to natural scale</span></span>
<span id="cb33-15"><a href="#cb33-15"></a>coefs_clr_1p<span class="sc">$</span>scale_sd <span class="ot">&lt;-</span> scaling_attributes_1p<span class="sc">$</span>sd</span>
<span id="cb33-16"><a href="#cb33-16"></a>coefs_clr_1p <span class="ot">&lt;-</span> coefs_clr_1p <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">value_nat =</span> value <span class="sc">/</span> scale_sd)</span>
<span id="cb33-17"><a href="#cb33-17"></a></span>
<span id="cb33-18"><a href="#cb33-18"></a><span class="co"># show the first few rows</span></span>
<span id="cb33-19"><a href="#cb33-19"></a><span class="fu">head</span>(coefs_clr_1p)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["coefs"],"name":[1],"type":["chr"],"align":["left"]},{"label":["value"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["scale_sd"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["value_nat"],"name":[4],"type":["dbl"],"align":["right"]}],"data":[{"1":"ndvi","2":"0.00345779","3":"0.09970648","4":"0.03467969","_rn_":"ndvi"},{"1":"ndvi_s1","2":"-0.90549705","3":"0.22207031","4":"-4.07752410","_rn_":"ndvi_s1"},{"1":"ndvi_c1","2":"-1.58763903","3":"0.22261685","4":"-7.13171101","_rn_":"ndvi_c1"},{"1":"ndvi_sq","2":"0.04216766","3":"0.06498555","4":"0.64887747","_rn_":"ndvi_sq"},{"1":"ndvi_sq_s1","2":"0.42276326","3":"0.08269541","4":"5.11229399","_rn_":"ndvi_sq_s1"},{"1":"ndvi_sq_c1","2":"0.89446133","3":"0.08466353","4":"10.56489576","_rn_":"ndvi_sq_c1"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
</div>
<div id="tabset-4-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-4-3-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1"></a><span class="co"># creates a huge output due to the correlation matrix</span></span>
<span id="cb34-2"><a href="#cb34-2"></a><span class="co"># model_2p_harms</span></span>
<span id="cb34-3"><a href="#cb34-3"></a></span>
<span id="cb34-4"><a href="#cb34-4"></a><span class="co"># model_2p_harms</span></span>
<span id="cb34-5"><a href="#cb34-5"></a><span class="co"># model_2p_harms$model$coefficients</span></span>
<span id="cb34-6"><a href="#cb34-6"></a><span class="co"># model_2p_harms$se</span></span>
<span id="cb34-7"><a href="#cb34-7"></a><span class="co"># model_2p_harms$vcov</span></span>
<span id="cb34-8"><a href="#cb34-8"></a><span class="co"># diag(model_2p_harms$D) # between cluster variance</span></span>
<span id="cb34-9"><a href="#cb34-9"></a><span class="co"># model_2p_harms$r.effect # individual estimates</span></span>
<span id="cb34-10"><a href="#cb34-10"></a></span>
<span id="cb34-11"><a href="#cb34-11"></a><span class="co"># creating data frame of model coefficients</span></span>
<span id="cb34-12"><a href="#cb34-12"></a>coefs_clr_2p <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">coefs =</span> <span class="fu">names</span>(model_2p_harms<span class="sc">$</span>model<span class="sc">$</span>coefficients), </span>
<span id="cb34-13"><a href="#cb34-13"></a>                           <span class="at">value =</span> model_2p_harms<span class="sc">$</span>model<span class="sc">$</span>coefficients)</span>
<span id="cb34-14"><a href="#cb34-14"></a></span>
<span id="cb34-15"><a href="#cb34-15"></a><span class="co"># return coefficients to natural scale</span></span>
<span id="cb34-16"><a href="#cb34-16"></a>coefs_clr_2p<span class="sc">$</span>scale_sd <span class="ot">&lt;-</span> scaling_attributes_2p<span class="sc">$</span>sd</span>
<span id="cb34-17"><a href="#cb34-17"></a>coefs_clr_2p <span class="ot">&lt;-</span> coefs_clr_2p <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">value_nat =</span> value <span class="sc">/</span> scale_sd)</span>
<span id="cb34-18"><a href="#cb34-18"></a></span>
<span id="cb34-19"><a href="#cb34-19"></a><span class="co"># show the first few rows</span></span>
<span id="cb34-20"><a href="#cb34-20"></a><span class="fu">head</span>(coefs_clr_2p)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["coefs"],"name":[1],"type":["chr"],"align":["left"]},{"label":["value"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["scale_sd"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["value_nat"],"name":[4],"type":["dbl"],"align":["right"]}],"data":[{"1":"ndvi","2":"0.04375683","3":"0.09970648","4":"0.4388565","_rn_":"ndvi"},{"1":"ndvi_s1","2":"-0.99251073","3":"0.22207031","4":"-4.4693535","_rn_":"ndvi_s1"},{"1":"ndvi_s2","2":"0.34215431","3":"0.21936365","4":"1.5597585","_rn_":"ndvi_s2"},{"1":"ndvi_c1","2":"-1.61294037","3":"0.22261685","4":"-7.2453652","_rn_":"ndvi_c1"},{"1":"ndvi_c2","2":"0.08893551","3":"0.22532434","4":"0.3947000","_rn_":"ndvi_c2"},{"1":"ndvi_sq","2":"-0.00809084","3":"0.06498555","4":"-0.1245021","_rn_":"ndvi_sq"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
</div>
<div id="tabset-4-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-4-4-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1"></a><span class="co"># creates a huge output due to the correlation matrix</span></span>
<span id="cb35-2"><a href="#cb35-2"></a><span class="co"># model_3p_harms</span></span>
<span id="cb35-3"><a href="#cb35-3"></a></span>
<span id="cb35-4"><a href="#cb35-4"></a><span class="co"># model_3p_harms$model$coefficients</span></span>
<span id="cb35-5"><a href="#cb35-5"></a><span class="co"># model_3p_harms$se</span></span>
<span id="cb35-6"><a href="#cb35-6"></a><span class="co"># model_3p_harms$vcov</span></span>
<span id="cb35-7"><a href="#cb35-7"></a><span class="co"># diag(model_3p_harms$D) # between cluster variance</span></span>
<span id="cb35-8"><a href="#cb35-8"></a><span class="co"># model_3p_harms$r.effect # individual estimates</span></span>
<span id="cb35-9"><a href="#cb35-9"></a></span>
<span id="cb35-10"><a href="#cb35-10"></a><span class="co"># creating dataframe of coefficients</span></span>
<span id="cb35-11"><a href="#cb35-11"></a>coefs_clr_3p <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">coefs =</span> <span class="fu">names</span>(model_3p_harms<span class="sc">$</span>model<span class="sc">$</span>coefficients), </span>
<span id="cb35-12"><a href="#cb35-12"></a>                           <span class="at">value =</span> model_3p_harms<span class="sc">$</span>model<span class="sc">$</span>coefficients)</span>
<span id="cb35-13"><a href="#cb35-13"></a></span>
<span id="cb35-14"><a href="#cb35-14"></a><span class="co"># return coefficients to natural scale</span></span>
<span id="cb35-15"><a href="#cb35-15"></a>coefs_clr_3p<span class="sc">$</span>scale_sd <span class="ot">&lt;-</span> scaling_attributes_3p<span class="sc">$</span>sd</span>
<span id="cb35-16"><a href="#cb35-16"></a>coefs_clr_3p <span class="ot">&lt;-</span> coefs_clr_3p <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">value_nat =</span> value <span class="sc">/</span> scale_sd)</span>
<span id="cb35-17"><a href="#cb35-17"></a></span>
<span id="cb35-18"><a href="#cb35-18"></a><span class="co"># show the first few rows</span></span>
<span id="cb35-19"><a href="#cb35-19"></a><span class="fu">head</span>(coefs_clr_3p)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["coefs"],"name":[1],"type":["chr"],"align":["left"]},{"label":["value"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["scale_sd"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["value_nat"],"name":[4],"type":["dbl"],"align":["right"]}],"data":[{"1":"ndvi","2":"0.05343376","3":"0.09970648","4":"0.53591063","_rn_":"ndvi"},{"1":"ndvi_s1","2":"-0.88959485","3":"0.22207031","4":"-4.00591521","_rn_":"ndvi_s1"},{"1":"ndvi_s2","2":"0.37617357","3":"0.21936365","4":"1.71484006","_rn_":"ndvi_s2"},{"1":"ndvi_s3","2":"0.02020461","3":"0.22087403","4":"0.09147573","_rn_":"ndvi_s3"},{"1":"ndvi_c1","2":"-1.67356151","3":"0.22261685","4":"-7.51767674","_rn_":"ndvi_c1"},{"1":"ndvi_c2","2":"-0.13513951","3":"0.22532434","4":"-0.59975548","_rn_":"ndvi_c2"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="reconstruct-the-temporally-dynamic-coefficients" class="level2">
<h2 class="anchored" data-anchor-id="reconstruct-the-temporally-dynamic-coefficients">Reconstruct the temporally dynamic coefficients</h2>
<p>First we reconstruct the hourly coefficients for the model with no harmonics. This step isn’t necessary as we already have the coefficients, and we have already rescaled them in the dataframe we created above. But as we are also fitting harmonic models and recover their coefficients across time, we have used the same approach here so then we can plot them together and illustrate the static/dynamic outputs of the models. It also means that we can use the same simulation code (which indexes across the hour of the day), and just change the data frame of coefficients (as it will index across the coefficients of the static model but they won’t change).</p>
<p>We need a sequence of values that covers a full period (or the period that we want to construct the function over, which can be more or less than 1 period). The sequence can be arbitrarily finely spaced. The smaller the increment the smoother the function will be for plotting. When simulating data from the temporally dynamic coefficients, we will subset to the increment that relates to the data collection and model fitting (i.e.&nbsp;one hour in this case).</p>
<p>Essentially, the coefficients can be considered as weights of the harmonics, which combine into a single function.</p>
<p>Now we can reconstruct the harmonic function using the formula that we put into our model by interacting the harmonic terms with each of the covariates, for two pairs of harmonics (2p) a single covariate, let’s say herbaceous vegetation (herby), this would be written down as:</p>
<p><span class="math display">\[
f = \beta_{herby} +
\beta_{herby\_s1} \sin\left(\frac{2\pi t}{24}\right) +
\beta_{herby\_c1} \cos\left(\frac{2\pi t}{24}\right) +
\beta_{herby\_s2} \sin\left(\frac{4\pi t}{24}\right) +
\beta_{herby\_c2} \cos\left(\frac{4\pi t}{24}\right),
\]</span></p>
<p>where we have 5 <span class="math inline">\(\beta_{herby}\)</span> coefficients, one for the linear term, and one for each of the harmonic terms.</p>
<p>Here we use matrix multiplication to reconstruct the temporally dynamic coefficients. We provide some background in the <code>Ecography_DynamicSSF_Walkthrough_Harmonics_and_selection_surfaces</code> script.</p>
<p>First we create a matrix of the values of the harmonics, which is just the sin and cos terms for each harmonic, and then we can multiply this by the coefficients to get the function. When we use two pairs of harmonics we will have 5 coefficients for each covariate (linear + 2 sine and 2 cosine), so there will be 5 columns in the matrix.</p>
<p>For matrix multiplication, the number of columns in the first matrix must be equal to the number of rows in the second matrix. The result will then have the same number of rows as the first matrix and the same number of columns as the second matrix.</p>
<p>Or in other words, if we have a 24 x 5 matrix of harmonics and a 5 x 1 matrix of coefficients, we will get a 24 x 1 matrix of the function, which corresponds to our 24 hours of the day.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset" data-group="model">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-5-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-1" role="tab" aria-controls="tabset-5-1" aria-selected="true">0p</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-5-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-2" role="tab" aria-controls="tabset-5-2" aria-selected="false">1p</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-5-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-3" role="tab" aria-controls="tabset-5-3" aria-selected="false">2p</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-5-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-4" role="tab" aria-controls="tabset-5-4" aria-selected="false">3p</a></li></ul>
<div class="tab-content" data-group="model">
<div id="tabset-5-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-5-1-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1"></a><span class="co"># increments are arbitrary - finer results in smoother curves</span></span>
<span id="cb36-2"><a href="#cb36-2"></a><span class="co"># for the simulations we will subset to the step interval</span></span>
<span id="cb36-3"><a href="#cb36-3"></a>hour <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="fl">23.9</span>,<span class="fl">0.1</span>) </span>
<span id="cb36-4"><a href="#cb36-4"></a></span>
<span id="cb36-5"><a href="#cb36-5"></a><span class="co"># create the dataframe of values of the harmonic terms over the period (here just the linear term)</span></span>
<span id="cb36-6"><a href="#cb36-6"></a>hour_harmonics_df_0p <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="st">"linear_term"</span> <span class="ot">=</span> <span class="fu">rep</span>(<span class="dv">1</span>, <span class="fu">length</span>(hour)))</span>
<span id="cb36-7"><a href="#cb36-7"></a></span>
<span id="cb36-8"><a href="#cb36-8"></a>harmonics_scaled_df_0p <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb36-9"><a href="#cb36-9"></a>  <span class="st">"hour"</span> <span class="ot">=</span> hour,</span>
<span id="cb36-10"><a href="#cb36-10"></a>  <span class="st">"ndvi"</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(</span>
<span id="cb36-11"><a href="#cb36-11"></a>    coefs_clr_0p <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"ndvi"</span>, coefs) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">grepl</span>(<span class="st">"sq"</span>, coefs)) <span class="sc">%&gt;%</span> </span>
<span id="cb36-12"><a href="#cb36-12"></a>      <span class="fu">pull</span>(value) <span class="sc">%&gt;%</span> <span class="fu">t</span>() <span class="sc">%*%</span> <span class="fu">t</span>(<span class="fu">as.matrix</span>(hour_harmonics_df_0p))),</span>
<span id="cb36-13"><a href="#cb36-13"></a>  <span class="st">"ndvi_2"</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(</span>
<span id="cb36-14"><a href="#cb36-14"></a>    coefs_clr_0p <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"ndvi_sq"</span>, coefs)) <span class="sc">%&gt;%</span> </span>
<span id="cb36-15"><a href="#cb36-15"></a>      <span class="fu">pull</span>(value) <span class="sc">%&gt;%</span> <span class="fu">t</span>() <span class="sc">%*%</span> <span class="fu">t</span>(<span class="fu">as.matrix</span>(hour_harmonics_df_0p))),</span>
<span id="cb36-16"><a href="#cb36-16"></a>  <span class="st">"canopy"</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(</span>
<span id="cb36-17"><a href="#cb36-17"></a>    coefs_clr_0p <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"canopy"</span>, coefs) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">grepl</span>(<span class="st">"sq"</span>, coefs)) <span class="sc">%&gt;%</span> </span>
<span id="cb36-18"><a href="#cb36-18"></a>      <span class="fu">pull</span>(value) <span class="sc">%&gt;%</span> <span class="fu">t</span>() <span class="sc">%*%</span> <span class="fu">t</span>(<span class="fu">as.matrix</span>(hour_harmonics_df_0p))),</span>
<span id="cb36-19"><a href="#cb36-19"></a>  <span class="st">"canopy_2"</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(</span>
<span id="cb36-20"><a href="#cb36-20"></a>    coefs_clr_0p <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"canopy_sq"</span>, coefs)) <span class="sc">%&gt;%</span> </span>
<span id="cb36-21"><a href="#cb36-21"></a>      <span class="fu">pull</span>(value) <span class="sc">%&gt;%</span> <span class="fu">t</span>() <span class="sc">%*%</span> <span class="fu">t</span>(<span class="fu">as.matrix</span>(hour_harmonics_df_0p))),</span>
<span id="cb36-22"><a href="#cb36-22"></a>  <span class="st">"slope"</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(</span>
<span id="cb36-23"><a href="#cb36-23"></a>    coefs_clr_0p <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"slope"</span>, coefs)) <span class="sc">%&gt;%</span> </span>
<span id="cb36-24"><a href="#cb36-24"></a>      <span class="fu">pull</span>(value) <span class="sc">%&gt;%</span> <span class="fu">t</span>() <span class="sc">%*%</span> <span class="fu">t</span>(<span class="fu">as.matrix</span>(hour_harmonics_df_0p))),</span>
<span id="cb36-25"><a href="#cb36-25"></a>  <span class="st">"herby"</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(</span>
<span id="cb36-26"><a href="#cb36-26"></a>    coefs_clr_0p <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"herby"</span>, coefs)) <span class="sc">%&gt;%</span> </span>
<span id="cb36-27"><a href="#cb36-27"></a>      <span class="fu">pull</span>(value) <span class="sc">%&gt;%</span> <span class="fu">t</span>() <span class="sc">%*%</span> <span class="fu">t</span>(<span class="fu">as.matrix</span>(hour_harmonics_df_0p))),</span>
<span id="cb36-28"><a href="#cb36-28"></a>  <span class="st">"sl"</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(</span>
<span id="cb36-29"><a href="#cb36-29"></a>    coefs_clr_0p <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"step_l"</span>, coefs) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">grepl</span>(<span class="st">"log"</span>, coefs)) <span class="sc">%&gt;%</span> </span>
<span id="cb36-30"><a href="#cb36-30"></a>      <span class="fu">pull</span>(value) <span class="sc">%&gt;%</span> <span class="fu">t</span>() <span class="sc">%*%</span> <span class="fu">t</span>(<span class="fu">as.matrix</span>(hour_harmonics_df_0p))),</span>
<span id="cb36-31"><a href="#cb36-31"></a>  <span class="st">"log_sl"</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(</span>
<span id="cb36-32"><a href="#cb36-32"></a>    coefs_clr_0p <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"log_step_l"</span>, coefs)) <span class="sc">%&gt;%</span> </span>
<span id="cb36-33"><a href="#cb36-33"></a>      <span class="fu">pull</span>(value) <span class="sc">%&gt;%</span> <span class="fu">t</span>() <span class="sc">%*%</span> <span class="fu">t</span>(<span class="fu">as.matrix</span>(hour_harmonics_df_0p))),</span>
<span id="cb36-34"><a href="#cb36-34"></a>  <span class="st">"cos_ta"</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(</span>
<span id="cb36-35"><a href="#cb36-35"></a>    coefs_clr_0p <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"cos"</span>, coefs)) <span class="sc">%&gt;%</span> </span>
<span id="cb36-36"><a href="#cb36-36"></a>      <span class="fu">pull</span>(value) <span class="sc">%&gt;%</span> <span class="fu">t</span>() <span class="sc">%*%</span> <span class="fu">t</span>(<span class="fu">as.matrix</span>(hour_harmonics_df_0p))))</span>
<span id="cb36-37"><a href="#cb36-37"></a></span>
<span id="cb36-38"><a href="#cb36-38"></a>harmonics_scaled_long_0p <span class="ot">&lt;-</span> <span class="fu">pivot_longer</span>(harmonics_scaled_df_0p, </span>
<span id="cb36-39"><a href="#cb36-39"></a>                                         <span class="at">cols =</span> <span class="sc">!</span><span class="dv">1</span>, </span>
<span id="cb36-40"><a href="#cb36-40"></a>                                         <span class="at">names_to =</span> <span class="st">"coef"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
<div id="tabset-5-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-5-2-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1"></a><span class="co"># create the dataframe of values of the harmonic terms over the period</span></span>
<span id="cb37-2"><a href="#cb37-2"></a>hour_harmonics_df_1p <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="st">"linear_term"</span> <span class="ot">=</span> <span class="fu">rep</span>(<span class="dv">1</span>, <span class="fu">length</span>(hour)),</span>
<span id="cb37-3"><a href="#cb37-3"></a>                                <span class="st">"hour_s1"</span> <span class="ot">=</span> <span class="fu">sin</span>(<span class="dv">2</span><span class="sc">*</span>pi<span class="sc">*</span>hour<span class="sc">/</span><span class="dv">24</span>),</span>
<span id="cb37-4"><a href="#cb37-4"></a>                                <span class="st">"hour_c1"</span> <span class="ot">=</span> <span class="fu">cos</span>(<span class="dv">2</span><span class="sc">*</span>pi<span class="sc">*</span>hour<span class="sc">/</span><span class="dv">24</span>))</span>
<span id="cb37-5"><a href="#cb37-5"></a></span>
<span id="cb37-6"><a href="#cb37-6"></a>harmonics_scaled_df_1p <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb37-7"><a href="#cb37-7"></a>  <span class="st">"hour"</span> <span class="ot">=</span> hour,</span>
<span id="cb37-8"><a href="#cb37-8"></a>  <span class="st">"ndvi"</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(</span>
<span id="cb37-9"><a href="#cb37-9"></a>    coefs_clr_1p <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"ndvi"</span>, coefs) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">grepl</span>(<span class="st">"sq"</span>, coefs)) <span class="sc">%&gt;%</span> </span>
<span id="cb37-10"><a href="#cb37-10"></a>      <span class="fu">pull</span>(value) <span class="sc">%&gt;%</span> <span class="fu">t</span>() <span class="sc">%*%</span> <span class="fu">t</span>(<span class="fu">as.matrix</span>(hour_harmonics_df_1p))),</span>
<span id="cb37-11"><a href="#cb37-11"></a>  <span class="st">"ndvi_2"</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(</span>
<span id="cb37-12"><a href="#cb37-12"></a>    coefs_clr_1p <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"ndvi_sq"</span>, coefs)) <span class="sc">%&gt;%</span> </span>
<span id="cb37-13"><a href="#cb37-13"></a>      <span class="fu">pull</span>(value) <span class="sc">%&gt;%</span> <span class="fu">t</span>() <span class="sc">%*%</span> <span class="fu">t</span>(<span class="fu">as.matrix</span>(hour_harmonics_df_1p))),</span>
<span id="cb37-14"><a href="#cb37-14"></a>  <span class="st">"canopy"</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(</span>
<span id="cb37-15"><a href="#cb37-15"></a>    coefs_clr_1p <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"canopy"</span>, coefs) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">grepl</span>(<span class="st">"sq"</span>, coefs)) <span class="sc">%&gt;%</span> </span>
<span id="cb37-16"><a href="#cb37-16"></a>      <span class="fu">pull</span>(value) <span class="sc">%&gt;%</span> <span class="fu">t</span>() <span class="sc">%*%</span> <span class="fu">t</span>(<span class="fu">as.matrix</span>(hour_harmonics_df_1p))),</span>
<span id="cb37-17"><a href="#cb37-17"></a>  <span class="st">"canopy_2"</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(</span>
<span id="cb37-18"><a href="#cb37-18"></a>    coefs_clr_1p <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"canopy_sq"</span>, coefs)) <span class="sc">%&gt;%</span> </span>
<span id="cb37-19"><a href="#cb37-19"></a>      <span class="fu">pull</span>(value) <span class="sc">%&gt;%</span> <span class="fu">t</span>() <span class="sc">%*%</span> <span class="fu">t</span>(<span class="fu">as.matrix</span>(hour_harmonics_df_1p))),</span>
<span id="cb37-20"><a href="#cb37-20"></a>  <span class="st">"slope"</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(</span>
<span id="cb37-21"><a href="#cb37-21"></a>    coefs_clr_1p <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"slope"</span>, coefs)) <span class="sc">%&gt;%</span> </span>
<span id="cb37-22"><a href="#cb37-22"></a>      <span class="fu">pull</span>(value) <span class="sc">%&gt;%</span> <span class="fu">t</span>() <span class="sc">%*%</span> <span class="fu">t</span>(<span class="fu">as.matrix</span>(hour_harmonics_df_1p))),</span>
<span id="cb37-23"><a href="#cb37-23"></a>  <span class="st">"herby"</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(</span>
<span id="cb37-24"><a href="#cb37-24"></a>    coefs_clr_1p <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"herby"</span>, coefs)) <span class="sc">%&gt;%</span> </span>
<span id="cb37-25"><a href="#cb37-25"></a>      <span class="fu">pull</span>(value) <span class="sc">%&gt;%</span> <span class="fu">t</span>() <span class="sc">%*%</span> <span class="fu">t</span>(<span class="fu">as.matrix</span>(hour_harmonics_df_1p))),</span>
<span id="cb37-26"><a href="#cb37-26"></a>  <span class="st">"sl"</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(</span>
<span id="cb37-27"><a href="#cb37-27"></a>    coefs_clr_1p <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"step_l"</span>, coefs) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">grepl</span>(<span class="st">"log"</span>, coefs)) <span class="sc">%&gt;%</span> </span>
<span id="cb37-28"><a href="#cb37-28"></a>      <span class="fu">pull</span>(value) <span class="sc">%&gt;%</span> <span class="fu">t</span>() <span class="sc">%*%</span> <span class="fu">t</span>(<span class="fu">as.matrix</span>(hour_harmonics_df_1p))),</span>
<span id="cb37-29"><a href="#cb37-29"></a>  <span class="st">"log_sl"</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(</span>
<span id="cb37-30"><a href="#cb37-30"></a>    coefs_clr_1p <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"log_step_l"</span>, coefs)) <span class="sc">%&gt;%</span> </span>
<span id="cb37-31"><a href="#cb37-31"></a>      <span class="fu">pull</span>(value) <span class="sc">%&gt;%</span> <span class="fu">t</span>() <span class="sc">%*%</span> <span class="fu">t</span>(<span class="fu">as.matrix</span>(hour_harmonics_df_1p))),</span>
<span id="cb37-32"><a href="#cb37-32"></a>  <span class="st">"cos_ta"</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(</span>
<span id="cb37-33"><a href="#cb37-33"></a>    coefs_clr_1p <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"cos"</span>, coefs)) <span class="sc">%&gt;%</span> </span>
<span id="cb37-34"><a href="#cb37-34"></a>      <span class="fu">pull</span>(value) <span class="sc">%&gt;%</span> <span class="fu">t</span>() <span class="sc">%*%</span> <span class="fu">t</span>(<span class="fu">as.matrix</span>(hour_harmonics_df_1p))))</span>
<span id="cb37-35"><a href="#cb37-35"></a></span>
<span id="cb37-36"><a href="#cb37-36"></a>harmonics_scaled_long_1p <span class="ot">&lt;-</span> <span class="fu">pivot_longer</span>(harmonics_scaled_df_1p, </span>
<span id="cb37-37"><a href="#cb37-37"></a>                                         <span class="at">cols =</span> <span class="sc">!</span><span class="dv">1</span>, </span>
<span id="cb37-38"><a href="#cb37-38"></a>                                         <span class="at">names_to =</span> <span class="st">"coef"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
<div id="tabset-5-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-5-3-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1"></a><span class="co"># create the dataframe of values of the harmonic terms over the period</span></span>
<span id="cb38-2"><a href="#cb38-2"></a>hour_harmonics_df_2p <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="st">"linear_term"</span> <span class="ot">=</span> <span class="fu">rep</span>(<span class="dv">1</span>, <span class="fu">length</span>(hour)),</span>
<span id="cb38-3"><a href="#cb38-3"></a>                                <span class="st">"hour_s1"</span> <span class="ot">=</span> <span class="fu">sin</span>(<span class="dv">2</span><span class="sc">*</span>pi<span class="sc">*</span>hour<span class="sc">/</span><span class="dv">24</span>),</span>
<span id="cb38-4"><a href="#cb38-4"></a>                                <span class="st">"hour_s2"</span> <span class="ot">=</span> <span class="fu">sin</span>(<span class="dv">4</span><span class="sc">*</span>pi<span class="sc">*</span>hour<span class="sc">/</span><span class="dv">24</span>),</span>
<span id="cb38-5"><a href="#cb38-5"></a>                                <span class="st">"hour_c1"</span> <span class="ot">=</span> <span class="fu">cos</span>(<span class="dv">2</span><span class="sc">*</span>pi<span class="sc">*</span>hour<span class="sc">/</span><span class="dv">24</span>),</span>
<span id="cb38-6"><a href="#cb38-6"></a>                                <span class="st">"hour_c2"</span> <span class="ot">=</span> <span class="fu">cos</span>(<span class="dv">4</span><span class="sc">*</span>pi<span class="sc">*</span>hour<span class="sc">/</span><span class="dv">24</span>))</span>
<span id="cb38-7"><a href="#cb38-7"></a></span>
<span id="cb38-8"><a href="#cb38-8"></a>harmonics_scaled_df_2p <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb38-9"><a href="#cb38-9"></a>  <span class="st">"hour"</span> <span class="ot">=</span> hour,</span>
<span id="cb38-10"><a href="#cb38-10"></a>  <span class="st">"ndvi"</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(</span>
<span id="cb38-11"><a href="#cb38-11"></a>    coefs_clr_2p <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"ndvi"</span>, coefs) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">grepl</span>(<span class="st">"sq"</span>, coefs)) <span class="sc">%&gt;%</span> </span>
<span id="cb38-12"><a href="#cb38-12"></a>      <span class="fu">pull</span>(value) <span class="sc">%&gt;%</span> <span class="fu">t</span>() <span class="sc">%*%</span> <span class="fu">t</span>(<span class="fu">as.matrix</span>(hour_harmonics_df_2p))),</span>
<span id="cb38-13"><a href="#cb38-13"></a>  <span class="st">"ndvi_2"</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(</span>
<span id="cb38-14"><a href="#cb38-14"></a>    coefs_clr_2p <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"ndvi_sq"</span>, coefs)) <span class="sc">%&gt;%</span> </span>
<span id="cb38-15"><a href="#cb38-15"></a>      <span class="fu">pull</span>(value) <span class="sc">%&gt;%</span> <span class="fu">t</span>() <span class="sc">%*%</span> <span class="fu">t</span>(<span class="fu">as.matrix</span>(hour_harmonics_df_2p))),</span>
<span id="cb38-16"><a href="#cb38-16"></a>  <span class="st">"canopy"</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(</span>
<span id="cb38-17"><a href="#cb38-17"></a>    coefs_clr_2p <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"canopy"</span>, coefs) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">grepl</span>(<span class="st">"sq"</span>, coefs)) <span class="sc">%&gt;%</span> </span>
<span id="cb38-18"><a href="#cb38-18"></a>      <span class="fu">pull</span>(value) <span class="sc">%&gt;%</span> <span class="fu">t</span>() <span class="sc">%*%</span> <span class="fu">t</span>(<span class="fu">as.matrix</span>(hour_harmonics_df_2p))),</span>
<span id="cb38-19"><a href="#cb38-19"></a>  <span class="st">"canopy_2"</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(</span>
<span id="cb38-20"><a href="#cb38-20"></a>    coefs_clr_2p <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"canopy_sq"</span>, coefs)) <span class="sc">%&gt;%</span> </span>
<span id="cb38-21"><a href="#cb38-21"></a>      <span class="fu">pull</span>(value) <span class="sc">%&gt;%</span> <span class="fu">t</span>() <span class="sc">%*%</span> <span class="fu">t</span>(<span class="fu">as.matrix</span>(hour_harmonics_df_2p))),</span>
<span id="cb38-22"><a href="#cb38-22"></a>  <span class="st">"slope"</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(</span>
<span id="cb38-23"><a href="#cb38-23"></a>    coefs_clr_2p <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"slope"</span>, coefs)) <span class="sc">%&gt;%</span> </span>
<span id="cb38-24"><a href="#cb38-24"></a>      <span class="fu">pull</span>(value) <span class="sc">%&gt;%</span> <span class="fu">t</span>() <span class="sc">%*%</span> <span class="fu">t</span>(<span class="fu">as.matrix</span>(hour_harmonics_df_2p))),</span>
<span id="cb38-25"><a href="#cb38-25"></a>  <span class="st">"herby"</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(</span>
<span id="cb38-26"><a href="#cb38-26"></a>    coefs_clr_2p <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"herby"</span>, coefs)) <span class="sc">%&gt;%</span> </span>
<span id="cb38-27"><a href="#cb38-27"></a>      <span class="fu">pull</span>(value) <span class="sc">%&gt;%</span> <span class="fu">t</span>() <span class="sc">%*%</span> <span class="fu">t</span>(<span class="fu">as.matrix</span>(hour_harmonics_df_2p))),</span>
<span id="cb38-28"><a href="#cb38-28"></a>  <span class="st">"sl"</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(</span>
<span id="cb38-29"><a href="#cb38-29"></a>    coefs_clr_2p <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"step_l"</span>, coefs) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">grepl</span>(<span class="st">"log"</span>, coefs)) <span class="sc">%&gt;%</span> </span>
<span id="cb38-30"><a href="#cb38-30"></a>      <span class="fu">pull</span>(value) <span class="sc">%&gt;%</span> <span class="fu">t</span>() <span class="sc">%*%</span> <span class="fu">t</span>(<span class="fu">as.matrix</span>(hour_harmonics_df_2p))),</span>
<span id="cb38-31"><a href="#cb38-31"></a>  <span class="st">"log_sl"</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(</span>
<span id="cb38-32"><a href="#cb38-32"></a>    coefs_clr_2p <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"log_step_l"</span>, coefs)) <span class="sc">%&gt;%</span> </span>
<span id="cb38-33"><a href="#cb38-33"></a>      <span class="fu">pull</span>(value) <span class="sc">%&gt;%</span> <span class="fu">t</span>() <span class="sc">%*%</span> <span class="fu">t</span>(<span class="fu">as.matrix</span>(hour_harmonics_df_2p))),</span>
<span id="cb38-34"><a href="#cb38-34"></a>  <span class="st">"cos_ta"</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(</span>
<span id="cb38-35"><a href="#cb38-35"></a>    coefs_clr_2p <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"cos"</span>, coefs)) <span class="sc">%&gt;%</span> </span>
<span id="cb38-36"><a href="#cb38-36"></a>      <span class="fu">pull</span>(value) <span class="sc">%&gt;%</span> <span class="fu">t</span>() <span class="sc">%*%</span> <span class="fu">t</span>(<span class="fu">as.matrix</span>(hour_harmonics_df_2p))))</span>
<span id="cb38-37"><a href="#cb38-37"></a></span>
<span id="cb38-38"><a href="#cb38-38"></a>harmonics_scaled_long_2p <span class="ot">&lt;-</span> <span class="fu">pivot_longer</span>(harmonics_scaled_df_2p, <span class="at">cols =</span> <span class="sc">!</span><span class="dv">1</span>, </span>
<span id="cb38-39"><a href="#cb38-39"></a>                                         <span class="at">names_to =</span> <span class="st">"coef"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
<div id="tabset-5-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-5-4-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1"></a><span class="co"># create the dataframe of values of the harmonic terms over the period</span></span>
<span id="cb39-2"><a href="#cb39-2"></a>hour_harmonics_df_3p <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="st">"linear_term"</span> <span class="ot">=</span> <span class="fu">rep</span>(<span class="dv">1</span>, <span class="fu">length</span>(hour)),</span>
<span id="cb39-3"><a href="#cb39-3"></a>                                <span class="st">"hour_s1"</span> <span class="ot">=</span> <span class="fu">sin</span>(<span class="dv">2</span><span class="sc">*</span>pi<span class="sc">*</span>hour<span class="sc">/</span><span class="dv">24</span>),</span>
<span id="cb39-4"><a href="#cb39-4"></a>                                <span class="st">"hour_s2"</span> <span class="ot">=</span> <span class="fu">sin</span>(<span class="dv">4</span><span class="sc">*</span>pi<span class="sc">*</span>hour<span class="sc">/</span><span class="dv">24</span>),</span>
<span id="cb39-5"><a href="#cb39-5"></a>                                <span class="st">"hour_s3"</span> <span class="ot">=</span> <span class="fu">sin</span>(<span class="dv">6</span><span class="sc">*</span>pi<span class="sc">*</span>hour<span class="sc">/</span><span class="dv">24</span>),</span>
<span id="cb39-6"><a href="#cb39-6"></a>                                <span class="st">"hour_c1"</span> <span class="ot">=</span> <span class="fu">cos</span>(<span class="dv">2</span><span class="sc">*</span>pi<span class="sc">*</span>hour<span class="sc">/</span><span class="dv">24</span>),</span>
<span id="cb39-7"><a href="#cb39-7"></a>                                <span class="st">"hour_c2"</span> <span class="ot">=</span> <span class="fu">cos</span>(<span class="dv">4</span><span class="sc">*</span>pi<span class="sc">*</span>hour<span class="sc">/</span><span class="dv">24</span>),</span>
<span id="cb39-8"><a href="#cb39-8"></a>                                <span class="st">"hour_c3"</span> <span class="ot">=</span> <span class="fu">cos</span>(<span class="dv">6</span><span class="sc">*</span>pi<span class="sc">*</span>hour<span class="sc">/</span><span class="dv">24</span>))</span>
<span id="cb39-9"><a href="#cb39-9"></a></span>
<span id="cb39-10"><a href="#cb39-10"></a>harmonics_scaled_df_3p <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb39-11"><a href="#cb39-11"></a>  <span class="st">"hour"</span> <span class="ot">=</span> hour,</span>
<span id="cb39-12"><a href="#cb39-12"></a>  <span class="st">"ndvi"</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(</span>
<span id="cb39-13"><a href="#cb39-13"></a>    coefs_clr_3p <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"ndvi"</span>, coefs) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">grepl</span>(<span class="st">"sq"</span>, coefs)) <span class="sc">%&gt;%</span> </span>
<span id="cb39-14"><a href="#cb39-14"></a>      <span class="fu">pull</span>(value) <span class="sc">%&gt;%</span> <span class="fu">t</span>() <span class="sc">%*%</span> <span class="fu">t</span>(<span class="fu">as.matrix</span>(hour_harmonics_df_3p))),</span>
<span id="cb39-15"><a href="#cb39-15"></a>  <span class="st">"ndvi_2"</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(</span>
<span id="cb39-16"><a href="#cb39-16"></a>    coefs_clr_3p <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"ndvi_sq"</span>, coefs)) <span class="sc">%&gt;%</span> </span>
<span id="cb39-17"><a href="#cb39-17"></a>      <span class="fu">pull</span>(value) <span class="sc">%&gt;%</span> <span class="fu">t</span>() <span class="sc">%*%</span> <span class="fu">t</span>(<span class="fu">as.matrix</span>(hour_harmonics_df_3p))),</span>
<span id="cb39-18"><a href="#cb39-18"></a>  <span class="st">"canopy"</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(</span>
<span id="cb39-19"><a href="#cb39-19"></a>    coefs_clr_3p <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"canopy"</span>, coefs) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">grepl</span>(<span class="st">"sq"</span>, coefs)) <span class="sc">%&gt;%</span> </span>
<span id="cb39-20"><a href="#cb39-20"></a>      <span class="fu">pull</span>(value) <span class="sc">%&gt;%</span> <span class="fu">t</span>() <span class="sc">%*%</span> <span class="fu">t</span>(<span class="fu">as.matrix</span>(hour_harmonics_df_3p))),</span>
<span id="cb39-21"><a href="#cb39-21"></a>  <span class="st">"canopy_2"</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(</span>
<span id="cb39-22"><a href="#cb39-22"></a>    coefs_clr_3p <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"canopy_sq"</span>, coefs)) <span class="sc">%&gt;%</span> </span>
<span id="cb39-23"><a href="#cb39-23"></a>      <span class="fu">pull</span>(value) <span class="sc">%&gt;%</span> <span class="fu">t</span>() <span class="sc">%*%</span> <span class="fu">t</span>(<span class="fu">as.matrix</span>(hour_harmonics_df_3p))),</span>
<span id="cb39-24"><a href="#cb39-24"></a>  <span class="st">"slope"</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(</span>
<span id="cb39-25"><a href="#cb39-25"></a>    coefs_clr_3p <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"slope"</span>, coefs)) <span class="sc">%&gt;%</span> </span>
<span id="cb39-26"><a href="#cb39-26"></a>      <span class="fu">pull</span>(value) <span class="sc">%&gt;%</span> <span class="fu">t</span>() <span class="sc">%*%</span> <span class="fu">t</span>(<span class="fu">as.matrix</span>(hour_harmonics_df_3p))),</span>
<span id="cb39-27"><a href="#cb39-27"></a>  <span class="st">"herby"</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(</span>
<span id="cb39-28"><a href="#cb39-28"></a>    coefs_clr_3p <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"herby"</span>, coefs)) <span class="sc">%&gt;%</span> </span>
<span id="cb39-29"><a href="#cb39-29"></a>      <span class="fu">pull</span>(value) <span class="sc">%&gt;%</span> <span class="fu">t</span>() <span class="sc">%*%</span> <span class="fu">t</span>(<span class="fu">as.matrix</span>(hour_harmonics_df_3p))),</span>
<span id="cb39-30"><a href="#cb39-30"></a>  <span class="st">"sl"</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(</span>
<span id="cb39-31"><a href="#cb39-31"></a>    coefs_clr_3p <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"step_l"</span>, coefs) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">grepl</span>(<span class="st">"log"</span>, coefs)) <span class="sc">%&gt;%</span> </span>
<span id="cb39-32"><a href="#cb39-32"></a>      <span class="fu">pull</span>(value) <span class="sc">%&gt;%</span> <span class="fu">t</span>() <span class="sc">%*%</span> <span class="fu">t</span>(<span class="fu">as.matrix</span>(hour_harmonics_df_3p))),</span>
<span id="cb39-33"><a href="#cb39-33"></a>  <span class="st">"log_sl"</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(</span>
<span id="cb39-34"><a href="#cb39-34"></a>    coefs_clr_3p <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"log_step_l"</span>, coefs)) <span class="sc">%&gt;%</span> </span>
<span id="cb39-35"><a href="#cb39-35"></a>      <span class="fu">pull</span>(value) <span class="sc">%&gt;%</span> <span class="fu">t</span>() <span class="sc">%*%</span> <span class="fu">t</span>(<span class="fu">as.matrix</span>(hour_harmonics_df_3p))),</span>
<span id="cb39-36"><a href="#cb39-36"></a>  <span class="st">"cos_ta"</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(</span>
<span id="cb39-37"><a href="#cb39-37"></a>    coefs_clr_3p <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"cos"</span>, coefs)) <span class="sc">%&gt;%</span> </span>
<span id="cb39-38"><a href="#cb39-38"></a>      <span class="fu">pull</span>(value) <span class="sc">%&gt;%</span> <span class="fu">t</span>() <span class="sc">%*%</span> <span class="fu">t</span>(<span class="fu">as.matrix</span>(hour_harmonics_df_3p))))</span>
<span id="cb39-39"><a href="#cb39-39"></a></span>
<span id="cb39-40"><a href="#cb39-40"></a>harmonics_scaled_long_3p <span class="ot">&lt;-</span> <span class="fu">pivot_longer</span>(harmonics_scaled_df_3p, <span class="at">cols =</span> <span class="sc">!</span><span class="dv">1</span>, </span>
<span id="cb39-41"><a href="#cb39-41"></a>                                         <span class="at">names_to =</span> <span class="st">"coef"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
</section>
<section id="plot-the-results---scaled-temporally-dynamic-coefficients" class="level2">
<h2 class="anchored" data-anchor-id="plot-the-results---scaled-temporally-dynamic-coefficients">Plot the results - scaled temporally dynamic coefficients</h2>
<p>Here we show the temporally-varying coefficients across time (which are currently still scaled).</p>
<div class="tabset-margin-container"></div><div class="panel-tabset" data-group="model">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-6-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-6-1" role="tab" aria-controls="tabset-6-1" aria-selected="true">0p</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-6-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-6-2" role="tab" aria-controls="tabset-6-2" aria-selected="false">1p</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-6-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-6-3" role="tab" aria-controls="tabset-6-3" aria-selected="false">2p</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-6-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-6-4" role="tab" aria-controls="tabset-6-4" aria-selected="false">3p</a></li></ul>
<div class="tab-content" data-group="model">
<div id="tabset-6-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-6-1-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb40-2"><a href="#cb40-2"></a>    <span class="fu">geom_path</span>(<span class="at">data =</span> harmonics_scaled_long_0p,</span>
<span id="cb40-3"><a href="#cb40-3"></a>              <span class="fu">aes</span>(<span class="at">x =</span> hour, <span class="at">y =</span> value, <span class="at">colour =</span> coef)) <span class="sc">+</span></span>
<span id="cb40-4"><a href="#cb40-4"></a>    <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb40-5"><a href="#cb40-5"></a>    <span class="fu">scale_y_continuous</span>(<span class="fu">expression</span>(Time<span class="sc">-</span>varying<span class="sc">~</span>parameter<span class="sc">~</span>values<span class="sc">~</span>beta)) <span class="sc">+</span></span>
<span id="cb40-6"><a href="#cb40-6"></a>    <span class="fu">scale_x_continuous</span>(<span class="st">"Hour"</span>) <span class="sc">+</span></span>
<span id="cb40-7"><a href="#cb40-7"></a>    <span class="fu">scale_color_discrete</span>(<span class="st">"Estimate"</span>) <span class="sc">+</span></span>
<span id="cb40-8"><a href="#cb40-8"></a>    <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb40-9"><a href="#cb40-9"></a>    <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ssf_model_fit_id_files/figure-html/0p_plot_coefs-1.png" class="img-fluid figure-img" width="2100"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-6-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-6-2-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb41-2"><a href="#cb41-2"></a>    <span class="fu">geom_path</span>(<span class="at">data =</span> harmonics_scaled_long_1p,</span>
<span id="cb41-3"><a href="#cb41-3"></a>              <span class="fu">aes</span>(<span class="at">x =</span> hour, <span class="at">y =</span> value, <span class="at">colour =</span> coef)) <span class="sc">+</span></span>
<span id="cb41-4"><a href="#cb41-4"></a>    <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb41-5"><a href="#cb41-5"></a>    <span class="fu">scale_y_continuous</span>(<span class="fu">expression</span>(Time<span class="sc">-</span>varying<span class="sc">~</span>parameter<span class="sc">~</span>values<span class="sc">~</span>beta)) <span class="sc">+</span></span>
<span id="cb41-6"><a href="#cb41-6"></a>    <span class="fu">scale_x_continuous</span>(<span class="st">"Hour"</span>) <span class="sc">+</span></span>
<span id="cb41-7"><a href="#cb41-7"></a>    <span class="fu">scale_color_discrete</span>(<span class="st">"Estimate"</span>) <span class="sc">+</span></span>
<span id="cb41-8"><a href="#cb41-8"></a>    <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb41-9"><a href="#cb41-9"></a>    <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ssf_model_fit_id_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid figure-img" width="2100"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-6-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-6-3-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb42-2"><a href="#cb42-2"></a>    <span class="fu">geom_path</span>(<span class="at">data =</span> harmonics_scaled_long_2p,</span>
<span id="cb42-3"><a href="#cb42-3"></a>              <span class="fu">aes</span>(<span class="at">x =</span> hour, <span class="at">y =</span> value, <span class="at">colour =</span> coef)) <span class="sc">+</span></span>
<span id="cb42-4"><a href="#cb42-4"></a>    <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb42-5"><a href="#cb42-5"></a>    <span class="fu">scale_y_continuous</span>(<span class="fu">expression</span>(Time<span class="sc">-</span>varying<span class="sc">~</span>parameter<span class="sc">~</span>values<span class="sc">~</span>beta)) <span class="sc">+</span></span>
<span id="cb42-6"><a href="#cb42-6"></a>    <span class="fu">scale_x_continuous</span>(<span class="st">"Hour"</span>) <span class="sc">+</span></span>
<span id="cb42-7"><a href="#cb42-7"></a>    <span class="fu">scale_color_discrete</span>(<span class="st">"Estimate"</span>) <span class="sc">+</span></span>
<span id="cb42-8"><a href="#cb42-8"></a>    <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb42-9"><a href="#cb42-9"></a>    <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ssf_model_fit_id_files/figure-html/unnamed-chunk-24-1.png" class="img-fluid figure-img" width="2100"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-6-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-6-4-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb43-2"><a href="#cb43-2"></a>    <span class="fu">geom_path</span>(<span class="at">data =</span> harmonics_scaled_long_3p,</span>
<span id="cb43-3"><a href="#cb43-3"></a>              <span class="fu">aes</span>(<span class="at">x =</span> hour, <span class="at">y =</span> value, <span class="at">colour =</span> coef)) <span class="sc">+</span></span>
<span id="cb43-4"><a href="#cb43-4"></a>    <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb43-5"><a href="#cb43-5"></a>    <span class="fu">scale_y_continuous</span>(<span class="fu">expression</span>(Time<span class="sc">-</span>varying<span class="sc">~</span>parameter<span class="sc">~</span>values<span class="sc">~</span>beta)) <span class="sc">+</span></span>
<span id="cb43-6"><a href="#cb43-6"></a>    <span class="fu">scale_x_continuous</span>(<span class="st">"Hour"</span>) <span class="sc">+</span></span>
<span id="cb43-7"><a href="#cb43-7"></a>    <span class="fu">scale_color_discrete</span>(<span class="st">"Estimate"</span>) <span class="sc">+</span></span>
<span id="cb43-8"><a href="#cb43-8"></a>    <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb43-9"><a href="#cb43-9"></a>    <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ssf_model_fit_id_files/figure-html/unnamed-chunk-25-1.png" class="img-fluid figure-img" width="2100"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="reconstructing-the-natural-scale-temporally-dynamic-coefficients" class="level2">
<h2 class="anchored" data-anchor-id="reconstructing-the-natural-scale-temporally-dynamic-coefficients">Reconstructing the natural-scale temporally dynamic coefficients</h2>
<p>As we scaled the covariate values prior to fitting the models, we want to rescale the coefficients to their natural scale. This is important for the simulations, as the environmental variables will not be scaled when we simulate steps.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset" data-group="model">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-7-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-7-1" role="tab" aria-controls="tabset-7-1" aria-selected="true">0p</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-7-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-7-2" role="tab" aria-controls="tabset-7-2" aria-selected="false">1p</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-7-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-7-3" role="tab" aria-controls="tabset-7-3" aria-selected="false">2p</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-7-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-7-4" role="tab" aria-controls="tabset-7-4" aria-selected="false">3p</a></li></ul>
<div class="tab-content" data-group="model">
<div id="tabset-7-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-7-1-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1"></a>harmonics_nat_df_0p <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb44-2"><a href="#cb44-2"></a>  <span class="st">"hour"</span> <span class="ot">=</span> hour,</span>
<span id="cb44-3"><a href="#cb44-3"></a>  <span class="st">"ndvi"</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(</span>
<span id="cb44-4"><a href="#cb44-4"></a>    coefs_clr_0p <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"ndvi"</span>, coefs) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">grepl</span>(<span class="st">"sq"</span>, coefs)) <span class="sc">%&gt;%</span> </span>
<span id="cb44-5"><a href="#cb44-5"></a>      <span class="fu">pull</span>(value_nat) <span class="sc">%&gt;%</span> <span class="fu">t</span>() <span class="sc">%*%</span> <span class="fu">t</span>(<span class="fu">as.matrix</span>(hour_harmonics_df_0p))),</span>
<span id="cb44-6"><a href="#cb44-6"></a>  <span class="st">"ndvi_2"</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(</span>
<span id="cb44-7"><a href="#cb44-7"></a>    coefs_clr_0p <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"ndvi_sq"</span>, coefs)) <span class="sc">%&gt;%</span> </span>
<span id="cb44-8"><a href="#cb44-8"></a>      <span class="fu">pull</span>(value_nat) <span class="sc">%&gt;%</span> <span class="fu">t</span>() <span class="sc">%*%</span> <span class="fu">t</span>(<span class="fu">as.matrix</span>(hour_harmonics_df_0p))),</span>
<span id="cb44-9"><a href="#cb44-9"></a>  <span class="st">"canopy"</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(</span>
<span id="cb44-10"><a href="#cb44-10"></a>    coefs_clr_0p <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"canopy"</span>, coefs) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">grepl</span>(<span class="st">"sq"</span>, coefs)) <span class="sc">%&gt;%</span> </span>
<span id="cb44-11"><a href="#cb44-11"></a>      <span class="fu">pull</span>(value_nat) <span class="sc">%&gt;%</span> <span class="fu">t</span>() <span class="sc">%*%</span> <span class="fu">t</span>(<span class="fu">as.matrix</span>(hour_harmonics_df_0p))),</span>
<span id="cb44-12"><a href="#cb44-12"></a>  <span class="st">"canopy_2"</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(</span>
<span id="cb44-13"><a href="#cb44-13"></a>    coefs_clr_0p <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"canopy_sq"</span>, coefs)) <span class="sc">%&gt;%</span> </span>
<span id="cb44-14"><a href="#cb44-14"></a>      <span class="fu">pull</span>(value_nat) <span class="sc">%&gt;%</span> <span class="fu">t</span>() <span class="sc">%*%</span> <span class="fu">t</span>(<span class="fu">as.matrix</span>(hour_harmonics_df_0p))),</span>
<span id="cb44-15"><a href="#cb44-15"></a>  <span class="st">"slope"</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(</span>
<span id="cb44-16"><a href="#cb44-16"></a>    coefs_clr_0p <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"slope"</span>, coefs) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">grepl</span>(<span class="st">"sq"</span>, coefs)) <span class="sc">%&gt;%</span> </span>
<span id="cb44-17"><a href="#cb44-17"></a>      <span class="fu">pull</span>(value_nat) <span class="sc">%&gt;%</span> <span class="fu">t</span>() <span class="sc">%*%</span> <span class="fu">t</span>(<span class="fu">as.matrix</span>(hour_harmonics_df_0p))),</span>
<span id="cb44-18"><a href="#cb44-18"></a>  <span class="st">"herby"</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(</span>
<span id="cb44-19"><a href="#cb44-19"></a>    coefs_clr_0p <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"herby"</span>, coefs)) <span class="sc">%&gt;%</span> </span>
<span id="cb44-20"><a href="#cb44-20"></a>      <span class="fu">pull</span>(value_nat) <span class="sc">%&gt;%</span> <span class="fu">t</span>() <span class="sc">%*%</span> <span class="fu">t</span>(<span class="fu">as.matrix</span>(hour_harmonics_df_0p))),</span>
<span id="cb44-21"><a href="#cb44-21"></a>  <span class="st">"sl"</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(</span>
<span id="cb44-22"><a href="#cb44-22"></a>    coefs_clr_0p <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"step_l"</span>, coefs) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">grepl</span>(<span class="st">"log"</span>, coefs)) <span class="sc">%&gt;%</span> </span>
<span id="cb44-23"><a href="#cb44-23"></a>      <span class="fu">pull</span>(value_nat) <span class="sc">%&gt;%</span> <span class="fu">t</span>() <span class="sc">%*%</span> <span class="fu">t</span>(<span class="fu">as.matrix</span>(hour_harmonics_df_0p))),</span>
<span id="cb44-24"><a href="#cb44-24"></a>  <span class="st">"log_sl"</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(</span>
<span id="cb44-25"><a href="#cb44-25"></a>    coefs_clr_0p <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"log_step_l"</span>, coefs)) <span class="sc">%&gt;%</span> </span>
<span id="cb44-26"><a href="#cb44-26"></a>      <span class="fu">pull</span>(value_nat) <span class="sc">%&gt;%</span> <span class="fu">t</span>() <span class="sc">%*%</span> <span class="fu">t</span>(<span class="fu">as.matrix</span>(hour_harmonics_df_0p))),</span>
<span id="cb44-27"><a href="#cb44-27"></a>  <span class="st">"cos_ta"</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(</span>
<span id="cb44-28"><a href="#cb44-28"></a>    coefs_clr_0p <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"cos"</span>, coefs)) <span class="sc">%&gt;%</span> </span>
<span id="cb44-29"><a href="#cb44-29"></a>      <span class="fu">pull</span>(value_nat) <span class="sc">%&gt;%</span> <span class="fu">t</span>() <span class="sc">%*%</span> <span class="fu">t</span>(<span class="fu">as.matrix</span>(hour_harmonics_df_0p))))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
<div id="tabset-7-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-7-2-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1"></a>harmonics_nat_df_1p <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb45-2"><a href="#cb45-2"></a>  <span class="st">"hour"</span> <span class="ot">=</span> hour,</span>
<span id="cb45-3"><a href="#cb45-3"></a>  <span class="st">"ndvi"</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(</span>
<span id="cb45-4"><a href="#cb45-4"></a>    coefs_clr_1p <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"ndvi"</span>, coefs) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">grepl</span>(<span class="st">"sq"</span>, coefs)) <span class="sc">%&gt;%</span> </span>
<span id="cb45-5"><a href="#cb45-5"></a>      <span class="fu">pull</span>(value_nat) <span class="sc">%&gt;%</span> <span class="fu">t</span>() <span class="sc">%*%</span> <span class="fu">t</span>(<span class="fu">as.matrix</span>(hour_harmonics_df_1p))),</span>
<span id="cb45-6"><a href="#cb45-6"></a>  <span class="st">"ndvi_2"</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(</span>
<span id="cb45-7"><a href="#cb45-7"></a>    coefs_clr_1p <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"ndvi_sq"</span>, coefs)) <span class="sc">%&gt;%</span> </span>
<span id="cb45-8"><a href="#cb45-8"></a>      <span class="fu">pull</span>(value_nat) <span class="sc">%&gt;%</span> <span class="fu">t</span>() <span class="sc">%*%</span> <span class="fu">t</span>(<span class="fu">as.matrix</span>(hour_harmonics_df_1p))),</span>
<span id="cb45-9"><a href="#cb45-9"></a>  <span class="st">"canopy"</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(</span>
<span id="cb45-10"><a href="#cb45-10"></a>    coefs_clr_1p <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"canopy"</span>, coefs) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">grepl</span>(<span class="st">"sq"</span>, coefs)) <span class="sc">%&gt;%</span> </span>
<span id="cb45-11"><a href="#cb45-11"></a>      <span class="fu">pull</span>(value_nat) <span class="sc">%&gt;%</span> <span class="fu">t</span>() <span class="sc">%*%</span> <span class="fu">t</span>(<span class="fu">as.matrix</span>(hour_harmonics_df_1p))),</span>
<span id="cb45-12"><a href="#cb45-12"></a>  <span class="st">"canopy_2"</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(</span>
<span id="cb45-13"><a href="#cb45-13"></a>    coefs_clr_1p <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"canopy_sq"</span>, coefs)) <span class="sc">%&gt;%</span> </span>
<span id="cb45-14"><a href="#cb45-14"></a>      <span class="fu">pull</span>(value_nat) <span class="sc">%&gt;%</span> <span class="fu">t</span>() <span class="sc">%*%</span> <span class="fu">t</span>(<span class="fu">as.matrix</span>(hour_harmonics_df_1p))),</span>
<span id="cb45-15"><a href="#cb45-15"></a>  <span class="st">"slope"</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(</span>
<span id="cb45-16"><a href="#cb45-16"></a>    coefs_clr_1p <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"slope"</span>, coefs) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">grepl</span>(<span class="st">"sq"</span>, coefs)) <span class="sc">%&gt;%</span> </span>
<span id="cb45-17"><a href="#cb45-17"></a>      <span class="fu">pull</span>(value_nat) <span class="sc">%&gt;%</span> <span class="fu">t</span>() <span class="sc">%*%</span> <span class="fu">t</span>(<span class="fu">as.matrix</span>(hour_harmonics_df_1p))),</span>
<span id="cb45-18"><a href="#cb45-18"></a>  <span class="st">"herby"</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(</span>
<span id="cb45-19"><a href="#cb45-19"></a>    coefs_clr_1p <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"herby"</span>, coefs)) <span class="sc">%&gt;%</span> </span>
<span id="cb45-20"><a href="#cb45-20"></a>      <span class="fu">pull</span>(value_nat) <span class="sc">%&gt;%</span> <span class="fu">t</span>() <span class="sc">%*%</span> <span class="fu">t</span>(<span class="fu">as.matrix</span>(hour_harmonics_df_1p))),</span>
<span id="cb45-21"><a href="#cb45-21"></a>  <span class="st">"sl"</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(</span>
<span id="cb45-22"><a href="#cb45-22"></a>    coefs_clr_1p <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"step_l"</span>, coefs) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">grepl</span>(<span class="st">"log"</span>, coefs)) <span class="sc">%&gt;%</span> </span>
<span id="cb45-23"><a href="#cb45-23"></a>      <span class="fu">pull</span>(value_nat) <span class="sc">%&gt;%</span> <span class="fu">t</span>() <span class="sc">%*%</span> <span class="fu">t</span>(<span class="fu">as.matrix</span>(hour_harmonics_df_1p))),</span>
<span id="cb45-24"><a href="#cb45-24"></a>  <span class="st">"log_sl"</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(</span>
<span id="cb45-25"><a href="#cb45-25"></a>    coefs_clr_1p <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"log_step_l"</span>, coefs)) <span class="sc">%&gt;%</span> </span>
<span id="cb45-26"><a href="#cb45-26"></a>      <span class="fu">pull</span>(value_nat) <span class="sc">%&gt;%</span> <span class="fu">t</span>() <span class="sc">%*%</span> <span class="fu">t</span>(<span class="fu">as.matrix</span>(hour_harmonics_df_1p))),</span>
<span id="cb45-27"><a href="#cb45-27"></a>  <span class="st">"cos_ta"</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(</span>
<span id="cb45-28"><a href="#cb45-28"></a>    coefs_clr_1p <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"cos"</span>, coefs)) <span class="sc">%&gt;%</span> </span>
<span id="cb45-29"><a href="#cb45-29"></a>      <span class="fu">pull</span>(value_nat) <span class="sc">%&gt;%</span> <span class="fu">t</span>() <span class="sc">%*%</span> <span class="fu">t</span>(<span class="fu">as.matrix</span>(hour_harmonics_df_1p))))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
<div id="tabset-7-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-7-3-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1"></a>harmonics_nat_df_2p <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb46-2"><a href="#cb46-2"></a>  <span class="st">"hour"</span> <span class="ot">=</span> hour,</span>
<span id="cb46-3"><a href="#cb46-3"></a>  <span class="st">"ndvi"</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(</span>
<span id="cb46-4"><a href="#cb46-4"></a>    coefs_clr_2p <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"ndvi"</span>, coefs) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">grepl</span>(<span class="st">"sq"</span>, coefs)) <span class="sc">%&gt;%</span> </span>
<span id="cb46-5"><a href="#cb46-5"></a>      <span class="fu">pull</span>(value_nat) <span class="sc">%&gt;%</span> <span class="fu">t</span>() <span class="sc">%*%</span> <span class="fu">t</span>(<span class="fu">as.matrix</span>(hour_harmonics_df_2p))),</span>
<span id="cb46-6"><a href="#cb46-6"></a>  <span class="st">"ndvi_2"</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(</span>
<span id="cb46-7"><a href="#cb46-7"></a>    coefs_clr_2p <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"ndvi_sq"</span>, coefs)) <span class="sc">%&gt;%</span> </span>
<span id="cb46-8"><a href="#cb46-8"></a>      <span class="fu">pull</span>(value_nat) <span class="sc">%&gt;%</span> <span class="fu">t</span>() <span class="sc">%*%</span> <span class="fu">t</span>(<span class="fu">as.matrix</span>(hour_harmonics_df_2p))),</span>
<span id="cb46-9"><a href="#cb46-9"></a>  <span class="st">"canopy"</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(</span>
<span id="cb46-10"><a href="#cb46-10"></a>    coefs_clr_2p <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"canopy"</span>, coefs) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">grepl</span>(<span class="st">"sq"</span>, coefs)) <span class="sc">%&gt;%</span> </span>
<span id="cb46-11"><a href="#cb46-11"></a>      <span class="fu">pull</span>(value_nat) <span class="sc">%&gt;%</span> <span class="fu">t</span>() <span class="sc">%*%</span> <span class="fu">t</span>(<span class="fu">as.matrix</span>(hour_harmonics_df_2p))),</span>
<span id="cb46-12"><a href="#cb46-12"></a>  <span class="st">"canopy_2"</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(</span>
<span id="cb46-13"><a href="#cb46-13"></a>    coefs_clr_2p <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"canopy_sq"</span>, coefs)) <span class="sc">%&gt;%</span> </span>
<span id="cb46-14"><a href="#cb46-14"></a>      <span class="fu">pull</span>(value_nat) <span class="sc">%&gt;%</span> <span class="fu">t</span>() <span class="sc">%*%</span> <span class="fu">t</span>(<span class="fu">as.matrix</span>(hour_harmonics_df_2p))),</span>
<span id="cb46-15"><a href="#cb46-15"></a>  <span class="st">"slope"</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(</span>
<span id="cb46-16"><a href="#cb46-16"></a>    coefs_clr_2p <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"slope"</span>, coefs) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">grepl</span>(<span class="st">"sq"</span>, coefs)) <span class="sc">%&gt;%</span> </span>
<span id="cb46-17"><a href="#cb46-17"></a>      <span class="fu">pull</span>(value_nat) <span class="sc">%&gt;%</span> <span class="fu">t</span>() <span class="sc">%*%</span> <span class="fu">t</span>(<span class="fu">as.matrix</span>(hour_harmonics_df_2p))),</span>
<span id="cb46-18"><a href="#cb46-18"></a>  <span class="st">"herby"</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(</span>
<span id="cb46-19"><a href="#cb46-19"></a>    coefs_clr_2p <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"herby"</span>, coefs)) <span class="sc">%&gt;%</span> </span>
<span id="cb46-20"><a href="#cb46-20"></a>      <span class="fu">pull</span>(value_nat) <span class="sc">%&gt;%</span> <span class="fu">t</span>() <span class="sc">%*%</span> <span class="fu">t</span>(<span class="fu">as.matrix</span>(hour_harmonics_df_2p))),</span>
<span id="cb46-21"><a href="#cb46-21"></a>  <span class="st">"sl"</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(</span>
<span id="cb46-22"><a href="#cb46-22"></a>    coefs_clr_2p <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"step_l"</span>, coefs) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">grepl</span>(<span class="st">"log"</span>, coefs)) <span class="sc">%&gt;%</span> </span>
<span id="cb46-23"><a href="#cb46-23"></a>      <span class="fu">pull</span>(value_nat) <span class="sc">%&gt;%</span> <span class="fu">t</span>() <span class="sc">%*%</span> <span class="fu">t</span>(<span class="fu">as.matrix</span>(hour_harmonics_df_2p))),</span>
<span id="cb46-24"><a href="#cb46-24"></a>  <span class="st">"log_sl"</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(</span>
<span id="cb46-25"><a href="#cb46-25"></a>    coefs_clr_2p <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"log_step_l"</span>, coefs)) <span class="sc">%&gt;%</span> </span>
<span id="cb46-26"><a href="#cb46-26"></a>      <span class="fu">pull</span>(value_nat) <span class="sc">%&gt;%</span> <span class="fu">t</span>() <span class="sc">%*%</span> <span class="fu">t</span>(<span class="fu">as.matrix</span>(hour_harmonics_df_2p))),</span>
<span id="cb46-27"><a href="#cb46-27"></a>  <span class="st">"cos_ta"</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(</span>
<span id="cb46-28"><a href="#cb46-28"></a>    coefs_clr_2p <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"cos"</span>, coefs)) <span class="sc">%&gt;%</span> </span>
<span id="cb46-29"><a href="#cb46-29"></a>      <span class="fu">pull</span>(value_nat) <span class="sc">%&gt;%</span> <span class="fu">t</span>() <span class="sc">%*%</span> <span class="fu">t</span>(<span class="fu">as.matrix</span>(hour_harmonics_df_2p))))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
<div id="tabset-7-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-7-4-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1"></a>harmonics_nat_df_3p <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb47-2"><a href="#cb47-2"></a>  <span class="st">"hour"</span> <span class="ot">=</span> hour,</span>
<span id="cb47-3"><a href="#cb47-3"></a>  <span class="st">"ndvi"</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(</span>
<span id="cb47-4"><a href="#cb47-4"></a>    coefs_clr_3p <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"ndvi"</span>, coefs) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">grepl</span>(<span class="st">"sq"</span>, coefs)) <span class="sc">%&gt;%</span> </span>
<span id="cb47-5"><a href="#cb47-5"></a>      <span class="fu">pull</span>(value_nat) <span class="sc">%&gt;%</span> <span class="fu">t</span>() <span class="sc">%*%</span> <span class="fu">t</span>(<span class="fu">as.matrix</span>(hour_harmonics_df_3p))),</span>
<span id="cb47-6"><a href="#cb47-6"></a>  <span class="st">"ndvi_2"</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(</span>
<span id="cb47-7"><a href="#cb47-7"></a>    coefs_clr_3p <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"ndvi_sq"</span>, coefs)) <span class="sc">%&gt;%</span> </span>
<span id="cb47-8"><a href="#cb47-8"></a>      <span class="fu">pull</span>(value_nat) <span class="sc">%&gt;%</span> <span class="fu">t</span>() <span class="sc">%*%</span> <span class="fu">t</span>(<span class="fu">as.matrix</span>(hour_harmonics_df_3p))),</span>
<span id="cb47-9"><a href="#cb47-9"></a>  <span class="st">"canopy"</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(</span>
<span id="cb47-10"><a href="#cb47-10"></a>    coefs_clr_3p <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"canopy"</span>, coefs) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">grepl</span>(<span class="st">"sq"</span>, coefs)) <span class="sc">%&gt;%</span> </span>
<span id="cb47-11"><a href="#cb47-11"></a>      <span class="fu">pull</span>(value_nat) <span class="sc">%&gt;%</span> <span class="fu">t</span>() <span class="sc">%*%</span> <span class="fu">t</span>(<span class="fu">as.matrix</span>(hour_harmonics_df_3p))),</span>
<span id="cb47-12"><a href="#cb47-12"></a>  <span class="st">"canopy_2"</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(</span>
<span id="cb47-13"><a href="#cb47-13"></a>    coefs_clr_3p <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"canopy_sq"</span>, coefs)) <span class="sc">%&gt;%</span> </span>
<span id="cb47-14"><a href="#cb47-14"></a>      <span class="fu">pull</span>(value_nat) <span class="sc">%&gt;%</span> <span class="fu">t</span>() <span class="sc">%*%</span> <span class="fu">t</span>(<span class="fu">as.matrix</span>(hour_harmonics_df_3p))),</span>
<span id="cb47-15"><a href="#cb47-15"></a>  <span class="st">"slope"</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(</span>
<span id="cb47-16"><a href="#cb47-16"></a>    coefs_clr_3p <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"slope"</span>, coefs) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">grepl</span>(<span class="st">"sq"</span>, coefs)) <span class="sc">%&gt;%</span> </span>
<span id="cb47-17"><a href="#cb47-17"></a>      <span class="fu">pull</span>(value_nat) <span class="sc">%&gt;%</span> <span class="fu">t</span>() <span class="sc">%*%</span> <span class="fu">t</span>(<span class="fu">as.matrix</span>(hour_harmonics_df_3p))),</span>
<span id="cb47-18"><a href="#cb47-18"></a>  <span class="st">"herby"</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(</span>
<span id="cb47-19"><a href="#cb47-19"></a>    coefs_clr_3p <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"herby"</span>, coefs)) <span class="sc">%&gt;%</span> </span>
<span id="cb47-20"><a href="#cb47-20"></a>      <span class="fu">pull</span>(value_nat) <span class="sc">%&gt;%</span> <span class="fu">t</span>() <span class="sc">%*%</span> <span class="fu">t</span>(<span class="fu">as.matrix</span>(hour_harmonics_df_3p))),</span>
<span id="cb47-21"><a href="#cb47-21"></a>  <span class="st">"sl"</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(</span>
<span id="cb47-22"><a href="#cb47-22"></a>    coefs_clr_3p <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"step_l"</span>, coefs) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">grepl</span>(<span class="st">"log"</span>, coefs)) <span class="sc">%&gt;%</span> </span>
<span id="cb47-23"><a href="#cb47-23"></a>      <span class="fu">pull</span>(value_nat) <span class="sc">%&gt;%</span> <span class="fu">t</span>() <span class="sc">%*%</span> <span class="fu">t</span>(<span class="fu">as.matrix</span>(hour_harmonics_df_3p))),</span>
<span id="cb47-24"><a href="#cb47-24"></a>  <span class="st">"log_sl"</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(</span>
<span id="cb47-25"><a href="#cb47-25"></a>    coefs_clr_3p <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"log_step_l"</span>, coefs)) <span class="sc">%&gt;%</span> </span>
<span id="cb47-26"><a href="#cb47-26"></a>      <span class="fu">pull</span>(value_nat) <span class="sc">%&gt;%</span> <span class="fu">t</span>() <span class="sc">%*%</span> <span class="fu">t</span>(<span class="fu">as.matrix</span>(hour_harmonics_df_3p))),</span>
<span id="cb47-27"><a href="#cb47-27"></a>  <span class="st">"cos_ta"</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(</span>
<span id="cb47-28"><a href="#cb47-28"></a>    coefs_clr_3p <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"cos"</span>, coefs)) <span class="sc">%&gt;%</span> </span>
<span id="cb47-29"><a href="#cb47-29"></a>      <span class="fu">pull</span>(value_nat) <span class="sc">%&gt;%</span> <span class="fu">t</span>() <span class="sc">%*%</span> <span class="fu">t</span>(<span class="fu">as.matrix</span>(hour_harmonics_df_3p))))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
</section>
<section id="update-the-gamma-and-von-mises-distributions" class="level2">
<h2 class="anchored" data-anchor-id="update-the-gamma-and-von-mises-distributions">Update the Gamma and von Mises distributions</h2>
<p>To update the Gamma and von Mises distribution from the tentative distributions <span class="citation" data-cites="Fieberg2021-wx">(e.g. <a href="#ref-Fieberg2021-wx" role="doc-biblioref">Fieberg et al. 2021</a>, Appendix C)</span>, we just do the calculation at each time point (for the natural-scale coefficients).</p>
<div class="tabset-margin-container"></div><div class="panel-tabset" data-group="model">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-8-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-8-1" role="tab" aria-controls="tabset-8-1" aria-selected="true">0p</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-8-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-8-2" role="tab" aria-controls="tabset-8-2" aria-selected="false">1p</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-8-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-8-3" role="tab" aria-controls="tabset-8-3" aria-selected="false">2p</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-8-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-8-4" role="tab" aria-controls="tabset-8-4" aria-selected="false">3p</a></li></ul>
<div class="tab-content" data-group="model">
<div id="tabset-8-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-8-1-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1"></a><span class="co"># from the step generation script</span></span>
<span id="cb48-2"><a href="#cb48-2"></a>tentative_shape <span class="ot">&lt;-</span> <span class="fl">0.438167</span></span>
<span id="cb48-3"><a href="#cb48-3"></a>tentative_scale <span class="ot">&lt;-</span> <span class="fl">534.3507</span></span>
<span id="cb48-4"><a href="#cb48-4"></a>tentative_kappa <span class="ot">&lt;-</span> <span class="fl">0.1848126</span></span>
<span id="cb48-5"><a href="#cb48-5"></a></span>
<span id="cb48-6"><a href="#cb48-6"></a>hour_coefs_nat_df_0p <span class="ot">&lt;-</span> harmonics_nat_df_0p <span class="sc">%&gt;%</span> </span>
<span id="cb48-7"><a href="#cb48-7"></a>  <span class="fu">mutate</span>(<span class="at">shape =</span> tentative_shape <span class="sc">+</span> log_sl,</span>
<span id="cb48-8"><a href="#cb48-8"></a>         <span class="at">scale =</span> <span class="dv">1</span><span class="sc">/</span>((<span class="dv">1</span><span class="sc">/</span>tentative_scale) <span class="sc">-</span> sl),</span>
<span id="cb48-9"><a href="#cb48-9"></a>         <span class="at">kappa =</span> tentative_kappa <span class="sc">+</span> cos_ta)</span>
<span id="cb48-10"><a href="#cb48-10"></a></span>
<span id="cb48-11"><a href="#cb48-11"></a><span class="co"># save the coefficients to use in the simulations</span></span>
<span id="cb48-12"><a href="#cb48-12"></a><span class="fu">write_csv</span>(hour_coefs_nat_df_0p,</span>
<span id="cb48-13"><a href="#cb48-13"></a>          <span class="fu">paste0</span>(<span class="st">"ssf_coefficients/id"</span>, focal_id, <span class="st">"_0pDaily_coefs_"</span>, <span class="fu">Sys.Date</span>(), <span class="st">".csv"</span>))</span>
<span id="cb48-14"><a href="#cb48-14"></a></span>
<span id="cb48-15"><a href="#cb48-15"></a><span class="co"># turning into a long data frame</span></span>
<span id="cb48-16"><a href="#cb48-16"></a>hour_coefs_nat_long_0p <span class="ot">&lt;-</span> <span class="fu">pivot_longer</span>(hour_coefs_nat_df_0p, </span>
<span id="cb48-17"><a href="#cb48-17"></a>                                       <span class="at">cols =</span> <span class="sc">!</span><span class="dv">1</span>, </span>
<span id="cb48-18"><a href="#cb48-18"></a>                                       <span class="at">names_to =</span> <span class="st">"coef"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
<div id="tabset-8-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-8-2-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1"></a>hour_coefs_nat_df_1p <span class="ot">&lt;-</span> harmonics_nat_df_1p <span class="sc">%&gt;%</span> </span>
<span id="cb49-2"><a href="#cb49-2"></a>  <span class="fu">mutate</span>(<span class="at">shape =</span> tentative_shape <span class="sc">+</span> log_sl,</span>
<span id="cb49-3"><a href="#cb49-3"></a>         <span class="at">scale =</span> <span class="dv">1</span><span class="sc">/</span>((<span class="dv">1</span><span class="sc">/</span>tentative_scale) <span class="sc">-</span> sl),</span>
<span id="cb49-4"><a href="#cb49-4"></a>         <span class="at">kappa =</span> tentative_kappa <span class="sc">+</span> cos_ta)</span>
<span id="cb49-5"><a href="#cb49-5"></a></span>
<span id="cb49-6"><a href="#cb49-6"></a><span class="co"># save the coefficients to use in the simulations</span></span>
<span id="cb49-7"><a href="#cb49-7"></a><span class="fu">write_csv</span>(hour_coefs_nat_df_1p,</span>
<span id="cb49-8"><a href="#cb49-8"></a>          <span class="fu">paste0</span>(<span class="st">"ssf_coefficients/id"</span>, focal_id, <span class="st">"_1pDaily_coefs_"</span>,<span class="fu">Sys.Date</span>(), <span class="st">".csv"</span>))</span>
<span id="cb49-9"><a href="#cb49-9"></a></span>
<span id="cb49-10"><a href="#cb49-10"></a><span class="co"># turning into a long data frame</span></span>
<span id="cb49-11"><a href="#cb49-11"></a>hour_coefs_nat_long_1p <span class="ot">&lt;-</span> <span class="fu">pivot_longer</span>(hour_coefs_nat_df_1p, </span>
<span id="cb49-12"><a href="#cb49-12"></a>                                       <span class="at">cols =</span> <span class="sc">!</span><span class="dv">1</span>, <span class="at">names_to =</span> <span class="st">"coef"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
<div id="tabset-8-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-8-3-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1"></a>hour_coefs_nat_df_2p <span class="ot">&lt;-</span> harmonics_nat_df_2p <span class="sc">%&gt;%</span> </span>
<span id="cb50-2"><a href="#cb50-2"></a>  <span class="fu">mutate</span>(<span class="at">shape =</span> tentative_shape <span class="sc">+</span> log_sl,</span>
<span id="cb50-3"><a href="#cb50-3"></a>         <span class="at">scale =</span> <span class="dv">1</span><span class="sc">/</span>((<span class="dv">1</span><span class="sc">/</span>tentative_scale) <span class="sc">-</span> sl),</span>
<span id="cb50-4"><a href="#cb50-4"></a>         <span class="at">kappa =</span> tentative_kappa <span class="sc">+</span> cos_ta)</span>
<span id="cb50-5"><a href="#cb50-5"></a></span>
<span id="cb50-6"><a href="#cb50-6"></a><span class="co"># save the coefficients to use in the simulations</span></span>
<span id="cb50-7"><a href="#cb50-7"></a><span class="fu">write_csv</span>(hour_coefs_nat_df_2p,</span>
<span id="cb50-8"><a href="#cb50-8"></a>          <span class="fu">paste0</span>(<span class="st">"ssf_coefficients/id"</span>, focal_id, <span class="st">"_2pDaily_coefs_"</span>,<span class="fu">Sys.Date</span>(), <span class="st">".csv"</span>))</span>
<span id="cb50-9"><a href="#cb50-9"></a></span>
<span id="cb50-10"><a href="#cb50-10"></a><span class="co"># turning into a long data frame</span></span>
<span id="cb50-11"><a href="#cb50-11"></a>hour_coefs_nat_long_2p <span class="ot">&lt;-</span> <span class="fu">pivot_longer</span>(hour_coefs_nat_df_2p, <span class="at">cols =</span> <span class="sc">!</span><span class="dv">1</span>, </span>
<span id="cb50-12"><a href="#cb50-12"></a>                                       <span class="at">names_to =</span> <span class="st">"coef"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
<div id="tabset-8-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-8-4-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1"></a>hour_coefs_nat_df_3p <span class="ot">&lt;-</span> harmonics_nat_df_3p <span class="sc">%&gt;%</span> </span>
<span id="cb51-2"><a href="#cb51-2"></a>  <span class="fu">mutate</span>(<span class="at">shape =</span> tentative_shape <span class="sc">+</span> log_sl,</span>
<span id="cb51-3"><a href="#cb51-3"></a>         <span class="at">scale =</span> <span class="dv">1</span><span class="sc">/</span>((<span class="dv">1</span><span class="sc">/</span>tentative_scale) <span class="sc">-</span> sl),</span>
<span id="cb51-4"><a href="#cb51-4"></a>         <span class="at">kappa =</span> tentative_kappa <span class="sc">+</span> cos_ta)</span>
<span id="cb51-5"><a href="#cb51-5"></a></span>
<span id="cb51-6"><a href="#cb51-6"></a><span class="co"># save the coefficients to use in the simulations</span></span>
<span id="cb51-7"><a href="#cb51-7"></a><span class="fu">write_csv</span>(hour_coefs_nat_df_3p,</span>
<span id="cb51-8"><a href="#cb51-8"></a>          <span class="fu">paste0</span>(<span class="st">"ssf_coefficients/id"</span>, focal_id, <span class="st">"_3pDaily_coefs_"</span>, <span class="fu">Sys.Date</span>(), <span class="st">".csv"</span>))</span>
<span id="cb51-9"><a href="#cb51-9"></a></span>
<span id="cb51-10"><a href="#cb51-10"></a><span class="co"># turning into a long data frame</span></span>
<span id="cb51-11"><a href="#cb51-11"></a>hour_coefs_nat_long_3p <span class="ot">&lt;-</span> <span class="fu">pivot_longer</span>(hour_coefs_nat_df_3p, <span class="at">cols =</span> <span class="sc">!</span><span class="dv">1</span>, </span>
<span id="cb51-12"><a href="#cb51-12"></a>                                       <span class="at">names_to =</span> <span class="st">"coef"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
</section>
<section id="plot-the-natural-scale-temporally-dynamic-coefficients" class="level2">
<h2 class="anchored" data-anchor-id="plot-the-natural-scale-temporally-dynamic-coefficients">Plot the natural-scale temporally dynamic coefficients</h2>
<p>Now that the coefficients are in their natural scales, they will be larger or smaller depending on the scale of the covariate.</p>
<p>Plot just the habitat selection coefficients.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset" data-group="model">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-9-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-9-1" role="tab" aria-controls="tabset-9-1" aria-selected="true">0p</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-9-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-9-2" role="tab" aria-controls="tabset-9-2" aria-selected="false">1p</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-9-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-9-3" role="tab" aria-controls="tabset-9-3" aria-selected="false">2p</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-9-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-9-4" role="tab" aria-controls="tabset-9-4" aria-selected="false">3p</a></li></ul>
<div class="tab-content" data-group="model">
<div id="tabset-9-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-9-1-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb52-2"><a href="#cb52-2"></a>  <span class="fu">geom_path</span>(<span class="at">data =</span> hour_coefs_nat_long_0p <span class="sc">%&gt;%</span></span>
<span id="cb52-3"><a href="#cb52-3"></a>              <span class="fu">filter</span>(<span class="sc">!</span>coef <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"shape"</span>, <span class="st">"scale"</span>, <span class="st">"kappa"</span>)),</span>
<span id="cb52-4"><a href="#cb52-4"></a>            <span class="fu">aes</span>(<span class="at">x =</span> hour, <span class="at">y =</span> value, <span class="at">colour =</span> coef)) <span class="sc">+</span></span>
<span id="cb52-5"><a href="#cb52-5"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb52-6"><a href="#cb52-6"></a>  <span class="fu">scale_y_continuous</span>(<span class="fu">expression</span>(Time<span class="sc">-</span>varying<span class="sc">~</span>parameter<span class="sc">~</span>values<span class="sc">~</span>beta)) <span class="sc">+</span></span>
<span id="cb52-7"><a href="#cb52-7"></a>  <span class="fu">scale_x_continuous</span>(<span class="st">"Hour"</span>, <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">24</span>,<span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb52-8"><a href="#cb52-8"></a>  <span class="fu">scale_color_discrete</span>(<span class="st">"Estimate"</span>) <span class="sc">+</span></span>
<span id="cb52-9"><a href="#cb52-9"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb52-10"><a href="#cb52-10"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ssf_model_fit_id_files/figure-html/unnamed-chunk-34-1.png" class="img-fluid figure-img" width="2100"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-9-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-9-2-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb53-2"><a href="#cb53-2"></a>  <span class="fu">geom_path</span>(<span class="at">data =</span> hour_coefs_nat_long_1p <span class="sc">%&gt;%</span></span>
<span id="cb53-3"><a href="#cb53-3"></a>              <span class="fu">filter</span>(<span class="sc">!</span>coef <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"shape"</span>, <span class="st">"scale"</span>, <span class="st">"kappa"</span>)),</span>
<span id="cb53-4"><a href="#cb53-4"></a>            <span class="fu">aes</span>(<span class="at">x =</span> hour, <span class="at">y =</span> value, <span class="at">colour =</span> coef)) <span class="sc">+</span></span>
<span id="cb53-5"><a href="#cb53-5"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb53-6"><a href="#cb53-6"></a>  <span class="fu">scale_y_continuous</span>(<span class="fu">expression</span>(Time<span class="sc">-</span>varying<span class="sc">~</span>parameter<span class="sc">~</span>values<span class="sc">~</span>beta)) <span class="sc">+</span></span>
<span id="cb53-7"><a href="#cb53-7"></a>  <span class="fu">scale_x_continuous</span>(<span class="st">"Hour"</span>, <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">24</span>,<span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb53-8"><a href="#cb53-8"></a>  <span class="fu">scale_color_discrete</span>(<span class="st">"Estimate"</span>) <span class="sc">+</span></span>
<span id="cb53-9"><a href="#cb53-9"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb53-10"><a href="#cb53-10"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ssf_model_fit_id_files/figure-html/unnamed-chunk-35-1.png" class="img-fluid figure-img" width="2100"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-9-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-9-3-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb54-2"><a href="#cb54-2"></a>  <span class="fu">geom_path</span>(<span class="at">data =</span> hour_coefs_nat_long_2p <span class="sc">%&gt;%</span></span>
<span id="cb54-3"><a href="#cb54-3"></a>              <span class="fu">filter</span>(<span class="sc">!</span>coef <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"shape"</span>, <span class="st">"scale"</span>, <span class="st">"kappa"</span>)),</span>
<span id="cb54-4"><a href="#cb54-4"></a>            <span class="fu">aes</span>(<span class="at">x =</span> hour, <span class="at">y =</span> value, <span class="at">colour =</span> coef)) <span class="sc">+</span></span>
<span id="cb54-5"><a href="#cb54-5"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb54-6"><a href="#cb54-6"></a>  <span class="fu">scale_y_continuous</span>(<span class="fu">expression</span>(Time<span class="sc">-</span>varying<span class="sc">~</span>parameter<span class="sc">~</span>values<span class="sc">~</span>beta)) <span class="sc">+</span></span>
<span id="cb54-7"><a href="#cb54-7"></a>  <span class="fu">scale_x_continuous</span>(<span class="st">"Hour"</span>, <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">24</span>,<span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb54-8"><a href="#cb54-8"></a>  <span class="fu">scale_color_discrete</span>(<span class="st">"Estimate"</span>) <span class="sc">+</span></span>
<span id="cb54-9"><a href="#cb54-9"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb54-10"><a href="#cb54-10"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ssf_model_fit_id_files/figure-html/unnamed-chunk-36-1.png" class="img-fluid figure-img" width="2100"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-9-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-9-4-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb55-2"><a href="#cb55-2"></a>  <span class="fu">geom_path</span>(<span class="at">data =</span> hour_coefs_nat_long_3p <span class="sc">%&gt;%</span></span>
<span id="cb55-3"><a href="#cb55-3"></a>              <span class="fu">filter</span>(<span class="sc">!</span>coef <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"shape"</span>, <span class="st">"scale"</span>, <span class="st">"kappa"</span>)),</span>
<span id="cb55-4"><a href="#cb55-4"></a>            <span class="fu">aes</span>(<span class="at">x =</span> hour, <span class="at">y =</span> value, <span class="at">colour =</span> coef)) <span class="sc">+</span></span>
<span id="cb55-5"><a href="#cb55-5"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb55-6"><a href="#cb55-6"></a>  <span class="fu">scale_y_continuous</span>(<span class="fu">expression</span>(Time<span class="sc">-</span>varying<span class="sc">~</span>parameter<span class="sc">~</span>values<span class="sc">~</span>beta)) <span class="sc">+</span></span>
<span id="cb55-7"><a href="#cb55-7"></a>  <span class="fu">scale_x_continuous</span>(<span class="st">"Hour"</span>, <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">24</span>,<span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb55-8"><a href="#cb55-8"></a>  <span class="fu">scale_color_discrete</span>(<span class="st">"Estimate"</span>) <span class="sc">+</span></span>
<span id="cb55-9"><a href="#cb55-9"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb55-10"><a href="#cb55-10"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ssf_model_fit_id_files/figure-html/unnamed-chunk-37-1.png" class="img-fluid figure-img" width="2100"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="plot-only-the-temporally-dynamic-movement-parameters" class="level2">
<h2 class="anchored" data-anchor-id="plot-only-the-temporally-dynamic-movement-parameters">Plot only the temporally dynamic movement parameters</h2>
<div class="tabset-margin-container"></div><div class="panel-tabset" data-group="model">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-10-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-10-1" role="tab" aria-controls="tabset-10-1" aria-selected="true">0p</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-10-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-10-2" role="tab" aria-controls="tabset-10-2" aria-selected="false">1p</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-10-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-10-3" role="tab" aria-controls="tabset-10-3" aria-selected="false">2p</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-10-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-10-4" role="tab" aria-controls="tabset-10-4" aria-selected="false">3p</a></li></ul>
<div class="tab-content" data-group="model">
<div id="tabset-10-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-10-1-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb56-2"><a href="#cb56-2"></a>    <span class="fu">geom_path</span>(<span class="at">data =</span> hour_coefs_nat_long_0p <span class="sc">%&gt;%</span> </span>
<span id="cb56-3"><a href="#cb56-3"></a>              <span class="fu">filter</span>(coef <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"shape"</span>, <span class="st">"kappa"</span>)),</span>
<span id="cb56-4"><a href="#cb56-4"></a>              <span class="fu">aes</span>(<span class="at">x =</span> hour, <span class="at">y =</span> value, <span class="at">colour =</span> coef)) <span class="sc">+</span></span>
<span id="cb56-5"><a href="#cb56-5"></a>  <span class="fu">geom_path</span>(<span class="at">data =</span> hour_coefs_nat_long_0p <span class="sc">%&gt;%</span></span>
<span id="cb56-6"><a href="#cb56-6"></a>              <span class="fu">filter</span>(coef <span class="sc">==</span> <span class="st">"scale"</span>),</span>
<span id="cb56-7"><a href="#cb56-7"></a>              <span class="fu">aes</span>(<span class="at">x =</span> hour, <span class="at">y =</span> value<span class="sc">/</span><span class="dv">1000</span>, <span class="at">colour =</span> coef)) <span class="sc">+</span></span>
<span id="cb56-8"><a href="#cb56-8"></a>    <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb56-9"><a href="#cb56-9"></a>    <span class="fu">scale_y_continuous</span>(<span class="fu">expression</span>(beta)) <span class="sc">+</span></span>
<span id="cb56-10"><a href="#cb56-10"></a>  <span class="fu">scale_x_continuous</span>(<span class="st">"Hour"</span>, <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">24</span>,<span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb56-11"><a href="#cb56-11"></a>  <span class="fu">ggtitle</span>(<span class="st">"Note that the scale parameter is divided by 1000 for plotting"</span>) <span class="sc">+</span></span>
<span id="cb56-12"><a href="#cb56-12"></a>  <span class="fu">scale_color_discrete</span>(<span class="st">"Estimate"</span>,</span>
<span id="cb56-13"><a href="#cb56-13"></a>      <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"kappa"</span> <span class="ot">=</span> <span class="st">"von Mises kappa"</span>,</span>
<span id="cb56-14"><a href="#cb56-14"></a>                 <span class="st">"scale"</span> <span class="ot">=</span> <span class="st">"Gamma scale / 1000"</span>,</span>
<span id="cb56-15"><a href="#cb56-15"></a>                 <span class="st">"shape"</span> <span class="ot">=</span> <span class="st">"Gamma shape"</span>)) <span class="sc">+</span></span>
<span id="cb56-16"><a href="#cb56-16"></a>    <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb56-17"><a href="#cb56-17"></a>    <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"right"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ssf_model_fit_id_files/figure-html/unnamed-chunk-38-1.png" class="img-fluid figure-img" width="2100"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-10-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-10-2-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb57-2"><a href="#cb57-2"></a>    <span class="fu">geom_path</span>(<span class="at">data =</span> hour_coefs_nat_long_1p <span class="sc">%&gt;%</span> </span>
<span id="cb57-3"><a href="#cb57-3"></a>              <span class="fu">filter</span>(coef <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"shape"</span>, <span class="st">"kappa"</span>)),</span>
<span id="cb57-4"><a href="#cb57-4"></a>              <span class="fu">aes</span>(<span class="at">x =</span> hour, <span class="at">y =</span> value, <span class="at">colour =</span> coef)) <span class="sc">+</span></span>
<span id="cb57-5"><a href="#cb57-5"></a>  <span class="fu">geom_path</span>(<span class="at">data =</span> hour_coefs_nat_long_1p <span class="sc">%&gt;%</span></span>
<span id="cb57-6"><a href="#cb57-6"></a>              <span class="fu">filter</span>(coef <span class="sc">==</span> <span class="st">"scale"</span>),</span>
<span id="cb57-7"><a href="#cb57-7"></a>              <span class="fu">aes</span>(<span class="at">x =</span> hour, <span class="at">y =</span> value<span class="sc">/</span><span class="dv">1000</span>, <span class="at">colour =</span> coef)) <span class="sc">+</span></span>
<span id="cb57-8"><a href="#cb57-8"></a>    <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb57-9"><a href="#cb57-9"></a>    <span class="fu">scale_y_continuous</span>(<span class="fu">expression</span>(beta)) <span class="sc">+</span></span>
<span id="cb57-10"><a href="#cb57-10"></a>  <span class="fu">scale_x_continuous</span>(<span class="st">"Hour"</span>, <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">24</span>,<span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb57-11"><a href="#cb57-11"></a>  <span class="fu">ggtitle</span>(<span class="st">"Note that the scale parameter is divided by 1000 for plotting"</span>) <span class="sc">+</span></span>
<span id="cb57-12"><a href="#cb57-12"></a>  <span class="fu">scale_color_discrete</span>(<span class="st">"Estimate"</span>,</span>
<span id="cb57-13"><a href="#cb57-13"></a>      <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"kappa"</span> <span class="ot">=</span> <span class="st">"von Mises kappa"</span>,</span>
<span id="cb57-14"><a href="#cb57-14"></a>                 <span class="st">"scale"</span> <span class="ot">=</span> <span class="st">"Gamma scale / 1000"</span>,</span>
<span id="cb57-15"><a href="#cb57-15"></a>                 <span class="st">"shape"</span> <span class="ot">=</span> <span class="st">"Gamma shape"</span>)) <span class="sc">+</span></span>
<span id="cb57-16"><a href="#cb57-16"></a>    <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb57-17"><a href="#cb57-17"></a>    <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"right"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ssf_model_fit_id_files/figure-html/unnamed-chunk-39-1.png" class="img-fluid figure-img" width="2100"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-10-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-10-3-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb58-2"><a href="#cb58-2"></a>    <span class="fu">geom_path</span>(<span class="at">data =</span> hour_coefs_nat_long_2p <span class="sc">%&gt;%</span> </span>
<span id="cb58-3"><a href="#cb58-3"></a>              <span class="fu">filter</span>(coef <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"shape"</span>, <span class="st">"kappa"</span>)),</span>
<span id="cb58-4"><a href="#cb58-4"></a>              <span class="fu">aes</span>(<span class="at">x =</span> hour, <span class="at">y =</span> value, <span class="at">colour =</span> coef)) <span class="sc">+</span></span>
<span id="cb58-5"><a href="#cb58-5"></a>  <span class="fu">geom_path</span>(<span class="at">data =</span> hour_coefs_nat_long_2p <span class="sc">%&gt;%</span></span>
<span id="cb58-6"><a href="#cb58-6"></a>              <span class="fu">filter</span>(coef <span class="sc">==</span> <span class="st">"scale"</span>),</span>
<span id="cb58-7"><a href="#cb58-7"></a>              <span class="fu">aes</span>(<span class="at">x =</span> hour, <span class="at">y =</span> value<span class="sc">/</span><span class="dv">1000</span>, <span class="at">colour =</span> coef)) <span class="sc">+</span></span>
<span id="cb58-8"><a href="#cb58-8"></a>    <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb58-9"><a href="#cb58-9"></a>    <span class="fu">scale_y_continuous</span>(<span class="st">"Value of parameter"</span>) <span class="sc">+</span></span>
<span id="cb58-10"><a href="#cb58-10"></a>  <span class="fu">scale_x_continuous</span>(<span class="st">"Hour"</span>, <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">24</span>,<span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb58-11"><a href="#cb58-11"></a>  <span class="fu">ggtitle</span>(<span class="st">"*Note that the scale parameter is divided by 1000 for plotting"</span>) <span class="sc">+</span></span>
<span id="cb58-12"><a href="#cb58-12"></a>  <span class="fu">scale_color_discrete</span>(<span class="st">"Estimate"</span>,</span>
<span id="cb58-13"><a href="#cb58-13"></a>      <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"kappa"</span> <span class="ot">=</span> <span class="st">"von Mises kappa"</span>,</span>
<span id="cb58-14"><a href="#cb58-14"></a>                 <span class="st">"scale"</span> <span class="ot">=</span> <span class="st">"Gamma scale / 1000"</span>,</span>
<span id="cb58-15"><a href="#cb58-15"></a>                 <span class="st">"shape"</span> <span class="ot">=</span> <span class="st">"Gamma shape"</span>)) <span class="sc">+</span></span>
<span id="cb58-16"><a href="#cb58-16"></a>    <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb58-17"><a href="#cb58-17"></a>    <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"right"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ssf_model_fit_id_files/figure-html/unnamed-chunk-40-1.png" class="img-fluid figure-img" width="2100"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1"></a><span class="co"># ggsave(paste0("outputs/plots/manuscript_figs_R2/temporal_mvmt_params_",</span></span>
<span id="cb59-2"><a href="#cb59-2"></a><span class="co">#          Sys.Date(), ".png"),</span></span>
<span id="cb59-3"><a href="#cb59-3"></a><span class="co">#   width=150, height=90, units="mm", dpi = 1000)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
<div id="tabset-10-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-10-4-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb60-2"><a href="#cb60-2"></a>    <span class="fu">geom_path</span>(<span class="at">data =</span> hour_coefs_nat_long_3p <span class="sc">%&gt;%</span> </span>
<span id="cb60-3"><a href="#cb60-3"></a>              <span class="fu">filter</span>(coef <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"shape"</span>, <span class="st">"kappa"</span>)),</span>
<span id="cb60-4"><a href="#cb60-4"></a>              <span class="fu">aes</span>(<span class="at">x =</span> hour, <span class="at">y =</span> value, <span class="at">colour =</span> coef)) <span class="sc">+</span></span>
<span id="cb60-5"><a href="#cb60-5"></a>  <span class="fu">geom_path</span>(<span class="at">data =</span> hour_coefs_nat_long_3p <span class="sc">%&gt;%</span></span>
<span id="cb60-6"><a href="#cb60-6"></a>              <span class="fu">filter</span>(coef <span class="sc">==</span> <span class="st">"scale"</span>),</span>
<span id="cb60-7"><a href="#cb60-7"></a>              <span class="fu">aes</span>(<span class="at">x =</span> hour, <span class="at">y =</span> value<span class="sc">/</span><span class="dv">1000</span>, <span class="at">colour =</span> coef)) <span class="sc">+</span></span>
<span id="cb60-8"><a href="#cb60-8"></a>    <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb60-9"><a href="#cb60-9"></a>    <span class="fu">scale_y_continuous</span>(<span class="fu">expression</span>(beta)) <span class="sc">+</span></span>
<span id="cb60-10"><a href="#cb60-10"></a>  <span class="fu">scale_x_continuous</span>(<span class="st">"Hour"</span>, <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">24</span>,<span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb60-11"><a href="#cb60-11"></a>  <span class="fu">ggtitle</span>(<span class="st">"Note that the scale parameter is divided by 1000 for plotting"</span>) <span class="sc">+</span></span>
<span id="cb60-12"><a href="#cb60-12"></a>  <span class="fu">scale_color_discrete</span>(<span class="st">"Estimate"</span>,</span>
<span id="cb60-13"><a href="#cb60-13"></a>      <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"kappa"</span> <span class="ot">=</span> <span class="st">"von Mises kappa"</span>,</span>
<span id="cb60-14"><a href="#cb60-14"></a>                 <span class="st">"scale"</span> <span class="ot">=</span> <span class="st">"Gamma scale / 1000"</span>,</span>
<span id="cb60-15"><a href="#cb60-15"></a>                 <span class="st">"shape"</span> <span class="ot">=</span> <span class="st">"Gamma shape"</span>)) <span class="sc">+</span></span>
<span id="cb60-16"><a href="#cb60-16"></a>    <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb60-17"><a href="#cb60-17"></a>    <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"right"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ssf_model_fit_id_files/figure-html/unnamed-chunk-41-1.png" class="img-fluid figure-img" width="2100"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="sample-from-temporally-dynamic-movement-parameters" class="level2">
<h2 class="anchored" data-anchor-id="sample-from-temporally-dynamic-movement-parameters">Sample from temporally dynamic movement parameters</h2>
<p>Here we sample from the movement kernel to generate a distribution of step lengths for each hour of the day, to assess how well it matches the observed step lengths. This is the ‘selection-free’ movement kernel, so the step lengths and turning angles from the simulations will be different, as the steps will be conditioned on the habitat, but this is a useful diagnostic to assess whether the harmonics are capturing the observed movement dynamics.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset" data-group="model">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-11-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-11-1" role="tab" aria-controls="tabset-11-1" aria-selected="true">0p</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-11-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-11-2" role="tab" aria-controls="tabset-11-2" aria-selected="false">1p</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-11-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-11-3" role="tab" aria-controls="tabset-11-3" aria-selected="false">2p</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-11-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-11-4" role="tab" aria-controls="tabset-11-4" aria-selected="false">3p</a></li></ul>
<div class="tab-content" data-group="model">
<div id="tabset-11-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-11-1-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1"></a><span class="co"># summarise the observed step lengths by hour</span></span>
<span id="cb61-2"><a href="#cb61-2"></a>movement_summary_buffalo <span class="ot">&lt;-</span> buffalo_data <span class="sc">%&gt;%</span> </span>
<span id="cb61-3"><a href="#cb61-3"></a>  <span class="fu">filter</span>(y <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb61-4"><a href="#cb61-4"></a>  <span class="fu">group_by</span>(id, hour) <span class="sc">%&gt;%</span> </span>
<span id="cb61-5"><a href="#cb61-5"></a>  <span class="fu">summarise</span>(<span class="at">mean_sl =</span> <span class="fu">mean</span>(sl), <span class="at">median_sl =</span> <span class="fu">median</span>(sl))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'id'. You can override using the `.groups`
argument.</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1"></a><span class="co"># number of samples at each hour (more = smoother plotting, but slower)</span></span>
<span id="cb63-2"><a href="#cb63-2"></a>n <span class="ot">&lt;-</span> <span class="fl">1e5</span></span>
<span id="cb63-3"><a href="#cb63-3"></a></span>
<span id="cb63-4"><a href="#cb63-4"></a>gamma_dist_list <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="at">mode =</span> <span class="st">"list"</span>, <span class="at">length =</span> <span class="fu">nrow</span>(hour_coefs_nat_df_0p))</span>
<span id="cb63-5"><a href="#cb63-5"></a>gamma_mean <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb63-6"><a href="#cb63-6"></a>gamma_median <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb63-7"><a href="#cb63-7"></a>gamma_ratio <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb63-8"><a href="#cb63-8"></a></span>
<span id="cb63-9"><a href="#cb63-9"></a><span class="cf">for</span>(hour_no <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(hour_coefs_nat_df_0p)) {</span>
<span id="cb63-10"><a href="#cb63-10"></a>  </span>
<span id="cb63-11"><a href="#cb63-11"></a>  gamma_dist_list[[hour_no]] <span class="ot">&lt;-</span> <span class="fu">rgamma</span>(n, <span class="at">shape =</span> hour_coefs_nat_df_0p<span class="sc">$</span>shape[hour_no], </span>
<span id="cb63-12"><a href="#cb63-12"></a>                                       <span class="at">scale =</span> hour_coefs_nat_df_0p<span class="sc">$</span>scale[hour_no])</span>
<span id="cb63-13"><a href="#cb63-13"></a>  </span>
<span id="cb63-14"><a href="#cb63-14"></a>  gamma_mean[hour_no] <span class="ot">&lt;-</span> <span class="fu">mean</span>(gamma_dist_list[[hour_no]])</span>
<span id="cb63-15"><a href="#cb63-15"></a>  gamma_median[hour_no] <span class="ot">&lt;-</span> <span class="fu">median</span>(gamma_dist_list[[hour_no]])</span>
<span id="cb63-16"><a href="#cb63-16"></a>  gamma_ratio[hour_no] <span class="ot">&lt;-</span> gamma_mean[hour_no] <span class="sc">/</span> gamma_median[hour_no]</span>
<span id="cb63-17"><a href="#cb63-17"></a></span>
<span id="cb63-18"><a href="#cb63-18"></a>}</span>
<span id="cb63-19"><a href="#cb63-19"></a></span>
<span id="cb63-20"><a href="#cb63-20"></a>gamma_df_0p <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">model =</span> <span class="st">"0p"</span>, </span>
<span id="cb63-21"><a href="#cb63-21"></a>                          <span class="at">hour =</span> hour_coefs_nat_df_0p<span class="sc">$</span>hour, </span>
<span id="cb63-22"><a href="#cb63-22"></a>                          <span class="at">mean =</span> gamma_mean, </span>
<span id="cb63-23"><a href="#cb63-23"></a>                          <span class="at">median =</span> gamma_median, </span>
<span id="cb63-24"><a href="#cb63-24"></a>                          <span class="at">ratio =</span> gamma_ratio) </span>
<span id="cb63-25"><a href="#cb63-25"></a></span>
<span id="cb63-26"><a href="#cb63-26"></a>mean_sl_0p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb63-27"><a href="#cb63-27"></a>  <span class="fu">geom_path</span>(<span class="at">data =</span> movement_summary_buffalo, </span>
<span id="cb63-28"><a href="#cb63-28"></a>            <span class="fu">aes</span>(<span class="at">x =</span> hour, <span class="at">y =</span> mean_sl, <span class="at">colour =</span> <span class="fu">factor</span>(id))) <span class="sc">+</span></span>
<span id="cb63-29"><a href="#cb63-29"></a>  <span class="fu">geom_path</span>(<span class="at">data =</span> gamma_df_0p, </span>
<span id="cb63-30"><a href="#cb63-30"></a>            <span class="fu">aes</span>(<span class="at">x =</span> hour, <span class="at">y =</span> mean), <span class="at">colour =</span> <span class="st">"red"</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb63-31"><a href="#cb63-31"></a>  <span class="fu">scale_x_continuous</span>(<span class="st">"Hour"</span>, <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">24</span>,<span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb63-32"><a href="#cb63-32"></a>  <span class="fu">scale_y_continuous</span>(<span class="st">"Mean step length"</span>) <span class="sc">+</span></span>
<span id="cb63-33"><a href="#cb63-33"></a>  <span class="fu">scale_colour_viridis_d</span>(<span class="st">"Buffalo"</span>) <span class="sc">+</span></span>
<span id="cb63-34"><a href="#cb63-34"></a>  <span class="fu">ggtitle</span>(<span class="st">"Observed and modelled mean step length"</span>,</span>
<span id="cb63-35"><a href="#cb63-35"></a>          <span class="at">subtitle =</span> <span class="st">"No harmonics"</span>) <span class="sc">+</span></span>
<span id="cb63-36"><a href="#cb63-36"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb63-37"><a href="#cb63-37"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"right"</span>)</span>
<span id="cb63-38"><a href="#cb63-38"></a></span>
<span id="cb63-39"><a href="#cb63-39"></a>mean_sl_0p</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ssf_model_fit_id_files/figure-html/unnamed-chunk-42-1.png" class="img-fluid figure-img" width="2100"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1"></a>median_sl_0p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb64-2"><a href="#cb64-2"></a>  <span class="fu">geom_path</span>(<span class="at">data =</span> movement_summary_buffalo, </span>
<span id="cb64-3"><a href="#cb64-3"></a>            <span class="fu">aes</span>(<span class="at">x =</span> hour, <span class="at">y =</span> median_sl, <span class="at">colour =</span> <span class="fu">factor</span>(id))) <span class="sc">+</span></span>
<span id="cb64-4"><a href="#cb64-4"></a>  <span class="fu">geom_path</span>(<span class="at">data =</span> gamma_df_0p, <span class="fu">aes</span>(<span class="at">x =</span> hour, <span class="at">y =</span> median), </span>
<span id="cb64-5"><a href="#cb64-5"></a>            <span class="at">colour =</span> <span class="st">"red"</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb64-6"><a href="#cb64-6"></a>  <span class="fu">scale_x_continuous</span>(<span class="st">"Hour"</span>, <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">24</span>,<span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb64-7"><a href="#cb64-7"></a>  <span class="fu">scale_y_continuous</span>(<span class="st">"Median step length"</span>) <span class="sc">+</span></span>
<span id="cb64-8"><a href="#cb64-8"></a>  <span class="fu">scale_colour_viridis_d</span>(<span class="st">"Buffalo"</span>) <span class="sc">+</span></span>
<span id="cb64-9"><a href="#cb64-9"></a>  <span class="fu">ggtitle</span>(<span class="st">"Observed and modelled median step length"</span>,</span>
<span id="cb64-10"><a href="#cb64-10"></a>          <span class="at">subtitle =</span> <span class="st">"No harmonics"</span>) <span class="sc">+</span></span>
<span id="cb64-11"><a href="#cb64-11"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb64-12"><a href="#cb64-12"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"right"</span>)</span>
<span id="cb64-13"><a href="#cb64-13"></a></span>
<span id="cb64-14"><a href="#cb64-14"></a>median_sl_0p</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ssf_model_fit_id_files/figure-html/unnamed-chunk-42-2.png" class="img-fluid figure-img" width="2100"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1"></a><span class="co"># comparing the mean and median step lengths across all hours</span></span>
<span id="cb65-2"><a href="#cb65-2"></a><span class="co"># across the hours by individual buffalo</span></span>
<span id="cb65-3"><a href="#cb65-3"></a>buffalo_data_all <span class="sc">%&gt;%</span> <span class="fu">filter</span>(y <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span>  <span class="fu">group_by</span>(id) <span class="sc">%&gt;%</span> </span>
<span id="cb65-4"><a href="#cb65-4"></a>  <span class="fu">summarise</span>(<span class="at">mean_sl =</span> <span class="fu">mean</span>(sl), </span>
<span id="cb65-5"><a href="#cb65-5"></a>            <span class="at">median_sl =</span> <span class="fu">median</span>(sl), </span>
<span id="cb65-6"><a href="#cb65-6"></a>            <span class="at">ratio =</span> mean_sl<span class="sc">/</span>median_sl)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["id"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["mean_sl"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["median_sl"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["ratio"],"name":[4],"type":["dbl"],"align":["right"]}],"data":[{"1":"2005","2":"205.2670","3":"89.72304","4":"2.287785"},{"1":"2014","2":"134.9597","3":"13.47099","4":"10.018549"},{"1":"2018","2":"252.2108","3":"103.30967","4":"2.441309"},{"1":"2021","2":"183.1886","3":"94.84287","4":"1.931496"},{"1":"2022","2":"218.8117","3":"79.79482","4":"2.742179"},{"1":"2024","2":"210.8667","3":"70.93487","4":"2.972681"},{"1":"2039","2":"356.5105","3":"124.06029","4":"2.873687"},{"1":"2154","2":"189.0677","3":"88.85852","4":"2.127739"},{"1":"2158","2":"219.3728","3":"82.05715","4":"2.673415"},{"1":"2223","2":"248.7546","3":"80.19804","4":"3.101754"},{"1":"2327","2":"198.9214","3":"46.00576","4":"4.323837"},{"1":"2354","2":"232.3303","3":"79.70396","4":"2.914915"},{"1":"2387","2":"328.4411","3":"108.37576","4":"3.030577"},{"1":"2393","2":"321.5189","3":"127.21101","4":"2.527445"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1"></a><span class="co"># all buffalo</span></span>
<span id="cb66-2"><a href="#cb66-2"></a>buffalo_data_all <span class="sc">%&gt;%</span> <span class="fu">filter</span>(y <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb66-3"><a href="#cb66-3"></a>  <span class="fu">summarise</span>(<span class="at">mean_sl =</span> <span class="fu">mean</span>(sl), </span>
<span id="cb66-4"><a href="#cb66-4"></a>            <span class="at">median_sl =</span> <span class="fu">median</span>(sl), </span>
<span id="cb66-5"><a href="#cb66-5"></a>            <span class="at">ratio =</span> mean_sl<span class="sc">/</span>median_sl)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["mean_sl"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["median_sl"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["ratio"],"name":[3],"type":["dbl"],"align":["right"]}],"data":[{"1":"234.1126","2":"82.33592","3":"2.843384"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1"></a><span class="co"># fitted model</span></span>
<span id="cb67-2"><a href="#cb67-2"></a>gamma_df_0p <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="at">mean_mean =</span> <span class="fu">mean</span>(mean),</span>
<span id="cb67-3"><a href="#cb67-3"></a>                         <span class="at">median_mean =</span> <span class="fu">mean</span>(median), </span>
<span id="cb67-4"><a href="#cb67-4"></a>                         <span class="at">ratio_mean =</span> mean_mean<span class="sc">/</span>median_mean)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["mean_mean"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["median_mean"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["ratio_mean"],"name":[3],"type":["dbl"],"align":["right"]}],"data":[{"1":"206.7878","2":"92.39229","3":"2.23815"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
</div>
<div id="tabset-11-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-11-2-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1"></a>gamma_dist_list <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="at">mode =</span> <span class="st">"list"</span>, <span class="at">length =</span> <span class="fu">nrow</span>(hour_coefs_nat_df_1p))</span>
<span id="cb68-2"><a href="#cb68-2"></a>gamma_mean <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb68-3"><a href="#cb68-3"></a>gamma_median <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb68-4"><a href="#cb68-4"></a>gamma_ratio <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb68-5"><a href="#cb68-5"></a></span>
<span id="cb68-6"><a href="#cb68-6"></a><span class="cf">for</span>(hour_no <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(hour_coefs_nat_df_1p)) {</span>
<span id="cb68-7"><a href="#cb68-7"></a>  </span>
<span id="cb68-8"><a href="#cb68-8"></a>  gamma_dist_list[[hour_no]] <span class="ot">&lt;-</span> <span class="fu">rgamma</span>(n, </span>
<span id="cb68-9"><a href="#cb68-9"></a>                                       <span class="at">shape =</span> hour_coefs_nat_df_1p<span class="sc">$</span>shape[hour_no], </span>
<span id="cb68-10"><a href="#cb68-10"></a>                                       <span class="at">scale =</span> hour_coefs_nat_df_1p<span class="sc">$</span>scale[hour_no])</span>
<span id="cb68-11"><a href="#cb68-11"></a>  </span>
<span id="cb68-12"><a href="#cb68-12"></a>  gamma_mean[hour_no] <span class="ot">&lt;-</span> <span class="fu">mean</span>(gamma_dist_list[[hour_no]])</span>
<span id="cb68-13"><a href="#cb68-13"></a>  gamma_median[hour_no] <span class="ot">&lt;-</span> <span class="fu">median</span>(gamma_dist_list[[hour_no]])</span>
<span id="cb68-14"><a href="#cb68-14"></a>  gamma_ratio[hour_no] <span class="ot">&lt;-</span> gamma_mean[hour_no] <span class="sc">/</span> gamma_median[hour_no]</span>
<span id="cb68-15"><a href="#cb68-15"></a></span>
<span id="cb68-16"><a href="#cb68-16"></a>}</span>
<span id="cb68-17"><a href="#cb68-17"></a></span>
<span id="cb68-18"><a href="#cb68-18"></a>gamma_df_1p <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">model =</span> <span class="st">"1p"</span>, </span>
<span id="cb68-19"><a href="#cb68-19"></a>                          <span class="at">hour =</span> hour_coefs_nat_df_1p<span class="sc">$</span>hour, </span>
<span id="cb68-20"><a href="#cb68-20"></a>                          <span class="at">mean =</span> gamma_mean, </span>
<span id="cb68-21"><a href="#cb68-21"></a>                          <span class="at">median =</span> gamma_median, </span>
<span id="cb68-22"><a href="#cb68-22"></a>                          <span class="at">ratio =</span> gamma_ratio) </span>
<span id="cb68-23"><a href="#cb68-23"></a></span>
<span id="cb68-24"><a href="#cb68-24"></a>mean_sl_1p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb68-25"><a href="#cb68-25"></a>  <span class="fu">geom_path</span>(<span class="at">data =</span> movement_summary_buffalo, </span>
<span id="cb68-26"><a href="#cb68-26"></a>            <span class="fu">aes</span>(<span class="at">x =</span> hour, <span class="at">y =</span> mean_sl, <span class="at">colour =</span> <span class="fu">factor</span>(id))) <span class="sc">+</span></span>
<span id="cb68-27"><a href="#cb68-27"></a>  <span class="fu">geom_path</span>(<span class="at">data =</span> gamma_df_1p, </span>
<span id="cb68-28"><a href="#cb68-28"></a>            <span class="fu">aes</span>(<span class="at">x =</span> hour, <span class="at">y =</span> mean), </span>
<span id="cb68-29"><a href="#cb68-29"></a>            <span class="at">colour =</span> <span class="st">"red"</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb68-30"><a href="#cb68-30"></a>  <span class="fu">scale_x_continuous</span>(<span class="st">"Hour"</span>, <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">24</span>,<span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb68-31"><a href="#cb68-31"></a>  <span class="fu">scale_y_continuous</span>(<span class="st">"Mean step length"</span>) <span class="sc">+</span></span>
<span id="cb68-32"><a href="#cb68-32"></a>  <span class="fu">scale_colour_viridis_d</span>(<span class="st">"Buffalo"</span>) <span class="sc">+</span></span>
<span id="cb68-33"><a href="#cb68-33"></a>  <span class="fu">ggtitle</span>(<span class="st">"Observed and modelled mean step length"</span>,</span>
<span id="cb68-34"><a href="#cb68-34"></a>          <span class="at">subtitle =</span> <span class="st">"One pair of harmonics"</span>) <span class="sc">+</span></span>
<span id="cb68-35"><a href="#cb68-35"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb68-36"><a href="#cb68-36"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span>
<span id="cb68-37"><a href="#cb68-37"></a></span>
<span id="cb68-38"><a href="#cb68-38"></a>mean_sl_1p</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ssf_model_fit_id_files/figure-html/unnamed-chunk-43-1.png" class="img-fluid figure-img" width="2100"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1"></a>median_sl_1p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb69-2"><a href="#cb69-2"></a>  <span class="fu">geom_path</span>(<span class="at">data =</span> movement_summary_buffalo, </span>
<span id="cb69-3"><a href="#cb69-3"></a>            <span class="fu">aes</span>(<span class="at">x =</span> hour, <span class="at">y =</span> median_sl, <span class="at">colour =</span> <span class="fu">factor</span>(id))) <span class="sc">+</span></span>
<span id="cb69-4"><a href="#cb69-4"></a>  <span class="fu">geom_path</span>(<span class="at">data =</span> gamma_df_1p, </span>
<span id="cb69-5"><a href="#cb69-5"></a>            <span class="fu">aes</span>(<span class="at">x =</span> hour, <span class="at">y =</span> median), </span>
<span id="cb69-6"><a href="#cb69-6"></a>            <span class="at">colour =</span> <span class="st">"red"</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb69-7"><a href="#cb69-7"></a>  <span class="fu">scale_x_continuous</span>(<span class="st">"Hour"</span>, <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">24</span>,<span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb69-8"><a href="#cb69-8"></a>  <span class="fu">scale_y_continuous</span>(<span class="st">"Median step length"</span>) <span class="sc">+</span></span>
<span id="cb69-9"><a href="#cb69-9"></a>  <span class="fu">scale_colour_viridis_d</span>(<span class="st">"Buffalo"</span>) <span class="sc">+</span></span>
<span id="cb69-10"><a href="#cb69-10"></a>  <span class="fu">ggtitle</span>(<span class="st">"Observed and modelled median step length"</span>,</span>
<span id="cb69-11"><a href="#cb69-11"></a>          <span class="at">subtitle =</span> <span class="st">"One pair of harmonics"</span>) <span class="sc">+</span></span>
<span id="cb69-12"><a href="#cb69-12"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb69-13"><a href="#cb69-13"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span>
<span id="cb69-14"><a href="#cb69-14"></a></span>
<span id="cb69-15"><a href="#cb69-15"></a>median_sl_1p</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ssf_model_fit_id_files/figure-html/unnamed-chunk-43-2.png" class="img-fluid figure-img" width="2100"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1"></a><span class="co"># across the hours</span></span>
<span id="cb70-2"><a href="#cb70-2"></a>buffalo_data_all <span class="sc">%&gt;%</span> <span class="fu">filter</span>(y <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span>  <span class="fu">group_by</span>(id) <span class="sc">%&gt;%</span> </span>
<span id="cb70-3"><a href="#cb70-3"></a>  <span class="fu">summarise</span>(<span class="at">mean_sl =</span> <span class="fu">mean</span>(sl), </span>
<span id="cb70-4"><a href="#cb70-4"></a>            <span class="at">median_sl =</span> <span class="fu">median</span>(sl), </span>
<span id="cb70-5"><a href="#cb70-5"></a>            <span class="at">ratio =</span> mean_sl<span class="sc">/</span>median_sl)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["id"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["mean_sl"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["median_sl"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["ratio"],"name":[4],"type":["dbl"],"align":["right"]}],"data":[{"1":"2005","2":"205.2670","3":"89.72304","4":"2.287785"},{"1":"2014","2":"134.9597","3":"13.47099","4":"10.018549"},{"1":"2018","2":"252.2108","3":"103.30967","4":"2.441309"},{"1":"2021","2":"183.1886","3":"94.84287","4":"1.931496"},{"1":"2022","2":"218.8117","3":"79.79482","4":"2.742179"},{"1":"2024","2":"210.8667","3":"70.93487","4":"2.972681"},{"1":"2039","2":"356.5105","3":"124.06029","4":"2.873687"},{"1":"2154","2":"189.0677","3":"88.85852","4":"2.127739"},{"1":"2158","2":"219.3728","3":"82.05715","4":"2.673415"},{"1":"2223","2":"248.7546","3":"80.19804","4":"3.101754"},{"1":"2327","2":"198.9214","3":"46.00576","4":"4.323837"},{"1":"2354","2":"232.3303","3":"79.70396","4":"2.914915"},{"1":"2387","2":"328.4411","3":"108.37576","4":"3.030577"},{"1":"2393","2":"321.5189","3":"127.21101","4":"2.527445"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1"></a>buffalo_data_all <span class="sc">%&gt;%</span> <span class="fu">filter</span>(y <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb71-2"><a href="#cb71-2"></a>  <span class="fu">summarise</span>(<span class="at">mean_sl =</span> <span class="fu">mean</span>(sl), </span>
<span id="cb71-3"><a href="#cb71-3"></a>            <span class="at">median_sl =</span> <span class="fu">median</span>(sl), </span>
<span id="cb71-4"><a href="#cb71-4"></a>            <span class="at">ratio =</span> mean_sl<span class="sc">/</span>median_sl)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["mean_sl"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["median_sl"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["ratio"],"name":[3],"type":["dbl"],"align":["right"]}],"data":[{"1":"234.1126","2":"82.33592","3":"2.843384"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1"></a>gamma_df_1p <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="at">mean_mean =</span> <span class="fu">mean</span>(mean),</span>
<span id="cb72-2"><a href="#cb72-2"></a>                      <span class="at">median_mean =</span> <span class="fu">mean</span>(median), </span>
<span id="cb72-3"><a href="#cb72-3"></a>                      <span class="at">ratio_mean =</span> mean_mean<span class="sc">/</span>median_mean)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["mean_mean"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["median_mean"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["ratio_mean"],"name":[3],"type":["dbl"],"align":["right"]}],"data":[{"1":"206.7376","2":"99.60037","3":"2.075671"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
</div>
<div id="tabset-11-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-11-3-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1"></a>gamma_dist_list <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="at">mode =</span> <span class="st">"list"</span>, <span class="at">length =</span> <span class="fu">nrow</span>(hour_coefs_nat_df_2p))</span>
<span id="cb73-2"><a href="#cb73-2"></a>gamma_mean <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb73-3"><a href="#cb73-3"></a>gamma_median <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb73-4"><a href="#cb73-4"></a>gamma_ratio <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb73-5"><a href="#cb73-5"></a></span>
<span id="cb73-6"><a href="#cb73-6"></a><span class="cf">for</span>(hour_no <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(hour_coefs_nat_df_2p)) {</span>
<span id="cb73-7"><a href="#cb73-7"></a>  </span>
<span id="cb73-8"><a href="#cb73-8"></a>gamma_dist_list[[hour_no]] <span class="ot">&lt;-</span> <span class="fu">rgamma</span>(n, </span>
<span id="cb73-9"><a href="#cb73-9"></a>                                     <span class="at">shape =</span> hour_coefs_nat_df_2p<span class="sc">$</span>shape[hour_no], </span>
<span id="cb73-10"><a href="#cb73-10"></a>                                     <span class="at">scale =</span> hour_coefs_nat_df_2p<span class="sc">$</span>scale[hour_no])</span>
<span id="cb73-11"><a href="#cb73-11"></a></span>
<span id="cb73-12"><a href="#cb73-12"></a>gamma_mean[hour_no] <span class="ot">&lt;-</span> <span class="fu">mean</span>(gamma_dist_list[[hour_no]])</span>
<span id="cb73-13"><a href="#cb73-13"></a>gamma_median[hour_no] <span class="ot">&lt;-</span> <span class="fu">median</span>(gamma_dist_list[[hour_no]])</span>
<span id="cb73-14"><a href="#cb73-14"></a>gamma_ratio[hour_no] <span class="ot">&lt;-</span> gamma_mean[hour_no] <span class="sc">/</span> gamma_median[hour_no]</span>
<span id="cb73-15"><a href="#cb73-15"></a></span>
<span id="cb73-16"><a href="#cb73-16"></a>}</span>
<span id="cb73-17"><a href="#cb73-17"></a></span>
<span id="cb73-18"><a href="#cb73-18"></a>gamma_df_2p <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">model =</span> <span class="st">"2p"</span>, </span>
<span id="cb73-19"><a href="#cb73-19"></a>                          <span class="at">hour =</span> hour_coefs_nat_df_2p<span class="sc">$</span>hour, </span>
<span id="cb73-20"><a href="#cb73-20"></a>                          <span class="at">mean =</span> gamma_mean, </span>
<span id="cb73-21"><a href="#cb73-21"></a>                          <span class="at">median =</span> gamma_median, </span>
<span id="cb73-22"><a href="#cb73-22"></a>                          <span class="at">ratio =</span> gamma_ratio) </span>
<span id="cb73-23"><a href="#cb73-23"></a></span>
<span id="cb73-24"><a href="#cb73-24"></a>mean_sl_2p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb73-25"><a href="#cb73-25"></a>  <span class="fu">geom_path</span>(<span class="at">data =</span> movement_summary_buffalo, </span>
<span id="cb73-26"><a href="#cb73-26"></a>            <span class="fu">aes</span>(<span class="at">x =</span> hour, <span class="at">y =</span> mean_sl, <span class="at">colour =</span> <span class="fu">factor</span>(id))) <span class="sc">+</span></span>
<span id="cb73-27"><a href="#cb73-27"></a>  <span class="fu">geom_path</span>(<span class="at">data =</span> gamma_df_2p, </span>
<span id="cb73-28"><a href="#cb73-28"></a>            <span class="fu">aes</span>(<span class="at">x =</span> hour, <span class="at">y =</span> mean), </span>
<span id="cb73-29"><a href="#cb73-29"></a>            <span class="at">colour =</span> <span class="st">"red"</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb73-30"><a href="#cb73-30"></a>  <span class="fu">scale_x_continuous</span>(<span class="st">"Hour"</span>, <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">24</span>,<span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb73-31"><a href="#cb73-31"></a>  <span class="fu">scale_y_continuous</span>(<span class="st">"Mean step length"</span>) <span class="sc">+</span></span>
<span id="cb73-32"><a href="#cb73-32"></a>  <span class="fu">scale_colour_viridis_d</span>(<span class="st">"Buffalo"</span>) <span class="sc">+</span></span>
<span id="cb73-33"><a href="#cb73-33"></a>  <span class="fu">ggtitle</span>(<span class="st">"Observed and modelled mean step length"</span>,</span>
<span id="cb73-34"><a href="#cb73-34"></a>          <span class="at">subtitle =</span> <span class="st">"Two pairs of harmonics"</span>) <span class="sc">+</span></span>
<span id="cb73-35"><a href="#cb73-35"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb73-36"><a href="#cb73-36"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span>
<span id="cb73-37"><a href="#cb73-37"></a></span>
<span id="cb73-38"><a href="#cb73-38"></a>mean_sl_2p</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ssf_model_fit_id_files/figure-html/unnamed-chunk-44-1.png" class="img-fluid figure-img" width="2100"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1"></a>median_sl_2p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb74-2"><a href="#cb74-2"></a>  <span class="fu">geom_path</span>(<span class="at">data =</span> movement_summary_buffalo, </span>
<span id="cb74-3"><a href="#cb74-3"></a>            <span class="fu">aes</span>(<span class="at">x =</span> hour, <span class="at">y =</span> median_sl, <span class="at">colour =</span> <span class="fu">factor</span>(id))) <span class="sc">+</span></span>
<span id="cb74-4"><a href="#cb74-4"></a>  <span class="fu">geom_path</span>(<span class="at">data =</span> gamma_df_2p, </span>
<span id="cb74-5"><a href="#cb74-5"></a>            <span class="fu">aes</span>(<span class="at">x =</span> hour, <span class="at">y =</span> median), </span>
<span id="cb74-6"><a href="#cb74-6"></a>            <span class="at">colour =</span> <span class="st">"red"</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb74-7"><a href="#cb74-7"></a>  <span class="fu">scale_x_continuous</span>(<span class="st">"Hour"</span>, <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">24</span>,<span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb74-8"><a href="#cb74-8"></a>  <span class="fu">scale_y_continuous</span>(<span class="st">"Median step length"</span>) <span class="sc">+</span></span>
<span id="cb74-9"><a href="#cb74-9"></a>  <span class="fu">scale_colour_viridis_d</span>(<span class="st">"Buffalo"</span>) <span class="sc">+</span></span>
<span id="cb74-10"><a href="#cb74-10"></a>  <span class="fu">ggtitle</span>(<span class="st">"Observed and modelled median step length"</span>,</span>
<span id="cb74-11"><a href="#cb74-11"></a>          <span class="at">subtitle =</span> <span class="st">"Two pairs of harmonics"</span>) <span class="sc">+</span></span>
<span id="cb74-12"><a href="#cb74-12"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb74-13"><a href="#cb74-13"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span>
<span id="cb74-14"><a href="#cb74-14"></a></span>
<span id="cb74-15"><a href="#cb74-15"></a>median_sl_2p</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ssf_model_fit_id_files/figure-html/unnamed-chunk-44-2.png" class="img-fluid figure-img" width="2100"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1"></a><span class="co"># across the hours</span></span>
<span id="cb75-2"><a href="#cb75-2"></a>buffalo_data_all <span class="sc">%&gt;%</span> <span class="fu">filter</span>(y <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span>  <span class="fu">group_by</span>(id) <span class="sc">%&gt;%</span> </span>
<span id="cb75-3"><a href="#cb75-3"></a>  <span class="fu">summarise</span>(<span class="at">mean_sl =</span> <span class="fu">mean</span>(sl), </span>
<span id="cb75-4"><a href="#cb75-4"></a>            <span class="at">median_sl =</span> <span class="fu">median</span>(sl), </span>
<span id="cb75-5"><a href="#cb75-5"></a>            <span class="at">ratio =</span> mean_sl<span class="sc">/</span>median_sl)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["id"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["mean_sl"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["median_sl"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["ratio"],"name":[4],"type":["dbl"],"align":["right"]}],"data":[{"1":"2005","2":"205.2670","3":"89.72304","4":"2.287785"},{"1":"2014","2":"134.9597","3":"13.47099","4":"10.018549"},{"1":"2018","2":"252.2108","3":"103.30967","4":"2.441309"},{"1":"2021","2":"183.1886","3":"94.84287","4":"1.931496"},{"1":"2022","2":"218.8117","3":"79.79482","4":"2.742179"},{"1":"2024","2":"210.8667","3":"70.93487","4":"2.972681"},{"1":"2039","2":"356.5105","3":"124.06029","4":"2.873687"},{"1":"2154","2":"189.0677","3":"88.85852","4":"2.127739"},{"1":"2158","2":"219.3728","3":"82.05715","4":"2.673415"},{"1":"2223","2":"248.7546","3":"80.19804","4":"3.101754"},{"1":"2327","2":"198.9214","3":"46.00576","4":"4.323837"},{"1":"2354","2":"232.3303","3":"79.70396","4":"2.914915"},{"1":"2387","2":"328.4411","3":"108.37576","4":"3.030577"},{"1":"2393","2":"321.5189","3":"127.21101","4":"2.527445"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1"></a>buffalo_data_all <span class="sc">%&gt;%</span> <span class="fu">filter</span>(y <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb76-2"><a href="#cb76-2"></a>  <span class="fu">summarise</span>(<span class="at">mean_sl =</span> <span class="fu">mean</span>(sl), </span>
<span id="cb76-3"><a href="#cb76-3"></a>            <span class="at">median_sl =</span> <span class="fu">median</span>(sl), </span>
<span id="cb76-4"><a href="#cb76-4"></a>            <span class="at">ratio =</span> mean_sl<span class="sc">/</span>median_sl)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["mean_sl"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["median_sl"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["ratio"],"name":[3],"type":["dbl"],"align":["right"]}],"data":[{"1":"234.1126","2":"82.33592","3":"2.843384"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1"></a>gamma_df_2p <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="at">mean_mean =</span> <span class="fu">mean</span>(mean),</span>
<span id="cb77-2"><a href="#cb77-2"></a>                         <span class="at">median_mean =</span> <span class="fu">mean</span>(median), </span>
<span id="cb77-3"><a href="#cb77-3"></a>                         <span class="at">ratio_mean =</span> mean_mean<span class="sc">/</span>median_mean)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["mean_mean"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["median_mean"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["ratio_mean"],"name":[3],"type":["dbl"],"align":["right"]}],"data":[{"1":"208.5567","2":"106.5631","3":"1.957119"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
</div>
<div id="tabset-11-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-11-4-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1"></a>gamma_dist_list <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="at">mode =</span> <span class="st">"list"</span>, <span class="at">length =</span> <span class="fu">nrow</span>(hour_coefs_nat_df_3p))</span>
<span id="cb78-2"><a href="#cb78-2"></a>gamma_mean <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb78-3"><a href="#cb78-3"></a>gamma_median <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb78-4"><a href="#cb78-4"></a>gamma_ratio <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb78-5"><a href="#cb78-5"></a></span>
<span id="cb78-6"><a href="#cb78-6"></a><span class="cf">for</span>(hour_no <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(hour_coefs_nat_df_3p)) {</span>
<span id="cb78-7"><a href="#cb78-7"></a>  </span>
<span id="cb78-8"><a href="#cb78-8"></a>gamma_dist_list[[hour_no]] <span class="ot">&lt;-</span> <span class="fu">rgamma</span>(n, </span>
<span id="cb78-9"><a href="#cb78-9"></a>                                     <span class="at">shape =</span> hour_coefs_nat_df_3p<span class="sc">$</span>shape[hour_no], </span>
<span id="cb78-10"><a href="#cb78-10"></a>                                     <span class="at">scale =</span> hour_coefs_nat_df_3p<span class="sc">$</span>scale[hour_no])</span>
<span id="cb78-11"><a href="#cb78-11"></a></span>
<span id="cb78-12"><a href="#cb78-12"></a>gamma_mean[hour_no] <span class="ot">&lt;-</span> <span class="fu">mean</span>(gamma_dist_list[[hour_no]])</span>
<span id="cb78-13"><a href="#cb78-13"></a>gamma_median[hour_no] <span class="ot">&lt;-</span> <span class="fu">median</span>(gamma_dist_list[[hour_no]])</span>
<span id="cb78-14"><a href="#cb78-14"></a>gamma_ratio[hour_no] <span class="ot">&lt;-</span> gamma_mean[hour_no] <span class="sc">/</span> gamma_median[hour_no]</span>
<span id="cb78-15"><a href="#cb78-15"></a></span>
<span id="cb78-16"><a href="#cb78-16"></a>}</span>
<span id="cb78-17"><a href="#cb78-17"></a></span>
<span id="cb78-18"><a href="#cb78-18"></a>gamma_df_3p <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">model =</span> <span class="st">"3p"</span>, </span>
<span id="cb78-19"><a href="#cb78-19"></a>                          <span class="at">hour =</span> hour_coefs_nat_df_3p<span class="sc">$</span>hour, </span>
<span id="cb78-20"><a href="#cb78-20"></a>                          <span class="at">mean =</span> gamma_mean, </span>
<span id="cb78-21"><a href="#cb78-21"></a>                          <span class="at">median =</span> gamma_median, </span>
<span id="cb78-22"><a href="#cb78-22"></a>                          <span class="at">ratio =</span> gamma_ratio)</span>
<span id="cb78-23"><a href="#cb78-23"></a></span>
<span id="cb78-24"><a href="#cb78-24"></a>mean_sl_3p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb78-25"><a href="#cb78-25"></a>  <span class="fu">geom_path</span>(<span class="at">data =</span> movement_summary_buffalo, </span>
<span id="cb78-26"><a href="#cb78-26"></a>            <span class="fu">aes</span>(<span class="at">x =</span> hour, <span class="at">y =</span> mean_sl, <span class="at">colour =</span> <span class="fu">factor</span>(id))) <span class="sc">+</span></span>
<span id="cb78-27"><a href="#cb78-27"></a>  <span class="fu">geom_path</span>(<span class="at">data =</span> gamma_df_3p, </span>
<span id="cb78-28"><a href="#cb78-28"></a>            <span class="fu">aes</span>(<span class="at">x =</span> hour, <span class="at">y =</span> mean), </span>
<span id="cb78-29"><a href="#cb78-29"></a>            <span class="at">colour =</span> <span class="st">"red"</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb78-30"><a href="#cb78-30"></a>  <span class="fu">scale_x_continuous</span>(<span class="st">"Hour"</span>, <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">24</span>,<span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb78-31"><a href="#cb78-31"></a>  <span class="fu">scale_y_continuous</span>(<span class="st">"Mean step length"</span>) <span class="sc">+</span></span>
<span id="cb78-32"><a href="#cb78-32"></a>  <span class="fu">scale_colour_viridis_d</span>(<span class="st">"Buffalo"</span>) <span class="sc">+</span></span>
<span id="cb78-33"><a href="#cb78-33"></a>  <span class="fu">ggtitle</span>(<span class="st">"Observed and modelled mean step length"</span>,</span>
<span id="cb78-34"><a href="#cb78-34"></a>          <span class="at">subtitle =</span> <span class="st">"Three pairs of harmonics"</span>) <span class="sc">+</span></span>
<span id="cb78-35"><a href="#cb78-35"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb78-36"><a href="#cb78-36"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span>
<span id="cb78-37"><a href="#cb78-37"></a></span>
<span id="cb78-38"><a href="#cb78-38"></a>mean_sl_3p</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ssf_model_fit_id_files/figure-html/unnamed-chunk-45-1.png" class="img-fluid figure-img" width="2100"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1"></a>median_sl_3p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb79-2"><a href="#cb79-2"></a>  <span class="fu">geom_path</span>(<span class="at">data =</span> movement_summary_buffalo, </span>
<span id="cb79-3"><a href="#cb79-3"></a>            <span class="fu">aes</span>(<span class="at">x =</span> hour, <span class="at">y =</span> median_sl, <span class="at">colour =</span> <span class="fu">factor</span>(id))) <span class="sc">+</span></span>
<span id="cb79-4"><a href="#cb79-4"></a>  <span class="fu">geom_path</span>(<span class="at">data =</span> gamma_df_3p, </span>
<span id="cb79-5"><a href="#cb79-5"></a>            <span class="fu">aes</span>(<span class="at">x =</span> hour, <span class="at">y =</span> median), </span>
<span id="cb79-6"><a href="#cb79-6"></a>            <span class="at">colour =</span> <span class="st">"red"</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb79-7"><a href="#cb79-7"></a>  <span class="fu">scale_x_continuous</span>(<span class="st">"Hour"</span>, <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">24</span>,<span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb79-8"><a href="#cb79-8"></a>  <span class="fu">scale_y_continuous</span>(<span class="st">"Median step length"</span>) <span class="sc">+</span></span>
<span id="cb79-9"><a href="#cb79-9"></a>  <span class="fu">scale_colour_viridis_d</span>(<span class="st">"Buffalo"</span>) <span class="sc">+</span></span>
<span id="cb79-10"><a href="#cb79-10"></a>  <span class="fu">ggtitle</span>(<span class="st">"Observed and modelled median step length"</span>,</span>
<span id="cb79-11"><a href="#cb79-11"></a>          <span class="at">subtitle =</span> <span class="st">"Three pairs of harmonics"</span>) <span class="sc">+</span></span>
<span id="cb79-12"><a href="#cb79-12"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb79-13"><a href="#cb79-13"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span>
<span id="cb79-14"><a href="#cb79-14"></a></span>
<span id="cb79-15"><a href="#cb79-15"></a>median_sl_3p</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ssf_model_fit_id_files/figure-html/unnamed-chunk-45-2.png" class="img-fluid figure-img" width="2100"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1"></a><span class="co"># across the hours</span></span>
<span id="cb80-2"><a href="#cb80-2"></a>buffalo_data_all <span class="sc">%&gt;%</span> <span class="fu">filter</span>(y <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span>  <span class="fu">group_by</span>(id) <span class="sc">%&gt;%</span> </span>
<span id="cb80-3"><a href="#cb80-3"></a>  <span class="fu">summarise</span>(<span class="at">mean_sl =</span> <span class="fu">mean</span>(sl), </span>
<span id="cb80-4"><a href="#cb80-4"></a>            <span class="at">median_sl =</span> <span class="fu">median</span>(sl), </span>
<span id="cb80-5"><a href="#cb80-5"></a>            <span class="at">ratio =</span> mean_sl<span class="sc">/</span>median_sl)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["id"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["mean_sl"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["median_sl"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["ratio"],"name":[4],"type":["dbl"],"align":["right"]}],"data":[{"1":"2005","2":"205.2670","3":"89.72304","4":"2.287785"},{"1":"2014","2":"134.9597","3":"13.47099","4":"10.018549"},{"1":"2018","2":"252.2108","3":"103.30967","4":"2.441309"},{"1":"2021","2":"183.1886","3":"94.84287","4":"1.931496"},{"1":"2022","2":"218.8117","3":"79.79482","4":"2.742179"},{"1":"2024","2":"210.8667","3":"70.93487","4":"2.972681"},{"1":"2039","2":"356.5105","3":"124.06029","4":"2.873687"},{"1":"2154","2":"189.0677","3":"88.85852","4":"2.127739"},{"1":"2158","2":"219.3728","3":"82.05715","4":"2.673415"},{"1":"2223","2":"248.7546","3":"80.19804","4":"3.101754"},{"1":"2327","2":"198.9214","3":"46.00576","4":"4.323837"},{"1":"2354","2":"232.3303","3":"79.70396","4":"2.914915"},{"1":"2387","2":"328.4411","3":"108.37576","4":"3.030577"},{"1":"2393","2":"321.5189","3":"127.21101","4":"2.527445"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1"></a>buffalo_data_all <span class="sc">%&gt;%</span> <span class="fu">filter</span>(y <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb81-2"><a href="#cb81-2"></a>  <span class="fu">summarise</span>(<span class="at">mean_sl =</span> <span class="fu">mean</span>(sl), </span>
<span id="cb81-3"><a href="#cb81-3"></a>            <span class="at">median_sl =</span> <span class="fu">median</span>(sl), </span>
<span id="cb81-4"><a href="#cb81-4"></a>            <span class="at">ratio =</span> mean_sl<span class="sc">/</span>median_sl)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["mean_sl"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["median_sl"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["ratio"],"name":[3],"type":["dbl"],"align":["right"]}],"data":[{"1":"234.1126","2":"82.33592","3":"2.843384"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1"></a>gamma_df_3p <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="at">mean_mean =</span> <span class="fu">mean</span>(mean),</span>
<span id="cb82-2"><a href="#cb82-2"></a>                      <span class="at">median_mean =</span> <span class="fu">mean</span>(median), </span>
<span id="cb82-3"><a href="#cb82-3"></a>                      <span class="at">ratio_mean =</span> mean_mean<span class="sc">/</span>median_mean)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["mean_mean"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["median_mean"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["ratio_mean"],"name":[3],"type":["dbl"],"align":["right"]}],"data":[{"1":"205.6791","2":"114.2616","3":"1.800071"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="creating-selection-surfaces" class="level2">
<h2 class="anchored" data-anchor-id="creating-selection-surfaces">Creating selection surfaces</h2>
<p>As we have both quadratic and harmonic terms in the model, we can reconstruct a ‘selection surface’ to visualise how the animal’s respond to environmental features changes through time.</p>
<p>To illustrate, if we don’t have temporal dynamics (as is the case for this model), then we have a coefficient for the linear term and a coefficient for the quadratic term. Using these, we can plot the selection curve at the scale of the environmental variable (in this case NDVI).</p>
<p>Using the natural scale coefficients from the model:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1"></a><span class="co"># first get a sequence of NDVI values, </span></span>
<span id="cb83-2"><a href="#cb83-2"></a><span class="co"># starting from the minimum observed in the data to the maximum</span></span>
<span id="cb83-3"><a href="#cb83-3"></a>ndvi_min <span class="ot">&lt;-</span> <span class="fu">min</span>(buffalo_data<span class="sc">$</span>ndvi_temporal, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb83-4"><a href="#cb83-4"></a>ndvi_max <span class="ot">&lt;-</span> <span class="fu">max</span>(buffalo_data<span class="sc">$</span>ndvi_temporal, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb83-5"><a href="#cb83-5"></a>ndvi_seq <span class="ot">&lt;-</span> <span class="fu">seq</span>(ndvi_min, ndvi_max, <span class="at">by =</span> <span class="fl">0.01</span>)</span>
<span id="cb83-6"><a href="#cb83-6"></a></span>
<span id="cb83-7"><a href="#cb83-7"></a><span class="co"># take the coefficients from the model and calculation the selection value </span></span>
<span id="cb83-8"><a href="#cb83-8"></a><span class="co"># for every NDVI value in this sequence</span></span>
<span id="cb83-9"><a href="#cb83-9"></a></span>
<span id="cb83-10"><a href="#cb83-10"></a><span class="co"># we can separate to the linear term</span></span>
<span id="cb83-11"><a href="#cb83-11"></a>ndvi_linear_selection <span class="ot">&lt;-</span> hour_coefs_nat_df_0p<span class="sc">$</span>ndvi[<span class="dv">1</span>] <span class="sc">*</span> ndvi_seq </span>
<span id="cb83-12"><a href="#cb83-12"></a><span class="fu">plot</span>(<span class="at">x =</span> ndvi_seq, <span class="at">y =</span> ndvi_linear_selection,</span>
<span id="cb83-13"><a href="#cb83-13"></a>     <span class="at">main =</span> <span class="st">"Selection for NDVI - linear term"</span>,</span>
<span id="cb83-14"><a href="#cb83-14"></a>     <span class="at">xlab =</span> <span class="st">"NDVI"</span>, <span class="at">ylab =</span> <span class="st">"Estimated selection"</span>)</span>
<span id="cb83-15"><a href="#cb83-15"></a><span class="fu">lines</span>(ndvi_seq, <span class="fu">rep</span>(<span class="dv">0</span>,<span class="fu">length</span>(ndvi_seq)), <span class="at">lty =</span> <span class="st">"dashed"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ssf_model_fit_id_files/figure-html/unnamed-chunk-46-1.png" class="img-fluid figure-img" width="2100"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1"></a><span class="co"># and the quadratic term</span></span>
<span id="cb84-2"><a href="#cb84-2"></a>ndvi_quadratic_selection <span class="ot">&lt;-</span> (hour_coefs_nat_df_0p<span class="sc">$</span>ndvi_2[<span class="dv">1</span>] <span class="sc">*</span> (ndvi_seq <span class="sc">^</span> <span class="dv">2</span>))</span>
<span id="cb84-3"><a href="#cb84-3"></a><span class="fu">plot</span>(<span class="at">x =</span> ndvi_seq, <span class="at">y =</span> ndvi_quadratic_selection,</span>
<span id="cb84-4"><a href="#cb84-4"></a>     <span class="at">main =</span> <span class="st">"Selection for NDVI - quadratic term"</span>,</span>
<span id="cb84-5"><a href="#cb84-5"></a>     <span class="at">xlab =</span> <span class="st">"NDVI"</span>, <span class="at">ylab =</span> <span class="st">"Estimated selection"</span>)</span>
<span id="cb84-6"><a href="#cb84-6"></a><span class="fu">lines</span>(ndvi_seq, <span class="fu">rep</span>(<span class="dv">0</span>,<span class="fu">length</span>(ndvi_seq)), <span class="at">lty =</span> <span class="st">"dashed"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ssf_model_fit_id_files/figure-html/unnamed-chunk-46-2.png" class="img-fluid figure-img" width="2100"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1"></a><span class="co"># and the sum of both</span></span>
<span id="cb85-2"><a href="#cb85-2"></a>ndvi_sum_selection <span class="ot">&lt;-</span> ndvi_linear_selection <span class="sc">+</span> ndvi_quadratic_selection</span>
<span id="cb85-3"><a href="#cb85-3"></a><span class="fu">plot</span>(<span class="at">x =</span> ndvi_seq, <span class="at">y =</span> ndvi_sum_selection,</span>
<span id="cb85-4"><a href="#cb85-4"></a>     <span class="at">main =</span> <span class="st">"Selection for NDVI - sum of linear and quadratic terms"</span>,</span>
<span id="cb85-5"><a href="#cb85-5"></a>     <span class="at">xlab =</span> <span class="st">"NDVI"</span>, <span class="at">ylab =</span> <span class="st">"Estimated selection"</span>)</span>
<span id="cb85-6"><a href="#cb85-6"></a><span class="fu">lines</span>(ndvi_seq, <span class="fu">rep</span>(<span class="dv">0</span>,<span class="fu">length</span>(ndvi_seq)), <span class="at">lty =</span> <span class="st">"dashed"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ssf_model_fit_id_files/figure-html/unnamed-chunk-46-3.png" class="img-fluid figure-img" width="2100"></p>
</figure>
</div>
</div>
</div>
<p>When there are no temporal dynamics, then this quadratic curve will be the same throughout the day, but when we have temporally dynamic coefficients for both the linear term and the quadratic term, then we will have a curves that vary continuously throughout the day, which we can visualise as a selection surface.</p>
<p>Here we illustrate for the model with 2 pairs of harmonic terms.</p>
<p>For brevity we won’t plot the linear and quadratic terms separately, but we can do so if needed.</p>
<p>First for <strong>Hour 3</strong></p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1"></a>hour_no <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb86-2"><a href="#cb86-2"></a></span>
<span id="cb86-3"><a href="#cb86-3"></a><span class="co"># we can separate to the linear term</span></span>
<span id="cb86-4"><a href="#cb86-4"></a>ndvi_linear_selection <span class="ot">&lt;-</span> </span>
<span id="cb86-5"><a href="#cb86-5"></a>  hour_coefs_nat_df_1p<span class="sc">$</span>ndvi[<span class="fu">which</span>(hour_coefs_nat_df_1p<span class="sc">$</span>hour <span class="sc">==</span> hour_no)] <span class="sc">*</span> ndvi_seq</span>
<span id="cb86-6"><a href="#cb86-6"></a><span class="co"># plot(x = ndvi_seq, y = ndvi_linear_selection,</span></span>
<span id="cb86-7"><a href="#cb86-7"></a><span class="co">#      main = "Selection for NDVI - linear term",</span></span>
<span id="cb86-8"><a href="#cb86-8"></a><span class="co">#      xlab = "NDVI", ylab = "Estimated selection")</span></span>
<span id="cb86-9"><a href="#cb86-9"></a></span>
<span id="cb86-10"><a href="#cb86-10"></a><span class="co"># and the quadratic term</span></span>
<span id="cb86-11"><a href="#cb86-11"></a>ndvi_quadratic_selection <span class="ot">&lt;-</span> </span>
<span id="cb86-12"><a href="#cb86-12"></a>  (hour_coefs_nat_df_1p<span class="sc">$</span>ndvi_2[<span class="fu">which</span>(hour_coefs_nat_df_1p<span class="sc">$</span>hour <span class="sc">==</span> hour_no)] <span class="sc">*</span> (ndvi_seq <span class="sc">^</span> <span class="dv">2</span>))</span>
<span id="cb86-13"><a href="#cb86-13"></a><span class="co"># plot(x = ndvi_seq, y = ndvi_quadratic_selection,</span></span>
<span id="cb86-14"><a href="#cb86-14"></a><span class="co">#      main = "Selection for NDVI - quadratic term",</span></span>
<span id="cb86-15"><a href="#cb86-15"></a><span class="co">#      xlab = "NDVI", ylab = "Estimated selection")</span></span>
<span id="cb86-16"><a href="#cb86-16"></a></span>
<span id="cb86-17"><a href="#cb86-17"></a><span class="co"># and the sum of both</span></span>
<span id="cb86-18"><a href="#cb86-18"></a>ndvi_sum_selection <span class="ot">&lt;-</span> ndvi_linear_selection <span class="sc">+</span> ndvi_quadratic_selection</span>
<span id="cb86-19"><a href="#cb86-19"></a><span class="fu">plot</span>(<span class="at">x =</span> ndvi_seq, <span class="at">y =</span> ndvi_sum_selection,</span>
<span id="cb86-20"><a href="#cb86-20"></a>     <span class="at">main =</span> <span class="st">"Selection for NDVI - sum of linear and quadratic terms"</span>,</span>
<span id="cb86-21"><a href="#cb86-21"></a>     <span class="at">xlab =</span> <span class="st">"NDVI"</span>, <span class="at">ylab =</span> <span class="st">"Estimated selection"</span>)</span>
<span id="cb86-22"><a href="#cb86-22"></a><span class="fu">lines</span>(ndvi_seq, <span class="fu">rep</span>(<span class="dv">0</span>,<span class="fu">length</span>(ndvi_seq)), <span class="at">lty =</span> <span class="st">"dashed"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ssf_model_fit_id_files/figure-html/unnamed-chunk-47-1.png" class="img-fluid figure-img" width="2100"></p>
</figure>
</div>
</div>
</div>
<p>We can see that the coefficient at hour 3 shows highest selection for NDVI values slightly above 0.2, and the coefficient is mostly negative.</p>
<p>Secondly for <strong>Hour 12</strong></p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1"></a>hour_no <span class="ot">&lt;-</span> <span class="dv">12</span></span>
<span id="cb87-2"><a href="#cb87-2"></a></span>
<span id="cb87-3"><a href="#cb87-3"></a><span class="co"># we can separate to the linear term</span></span>
<span id="cb87-4"><a href="#cb87-4"></a>ndvi_linear_selection <span class="ot">&lt;-</span> </span>
<span id="cb87-5"><a href="#cb87-5"></a>  hour_coefs_nat_df_1p<span class="sc">$</span>ndvi[<span class="fu">which</span>(hour_coefs_nat_df_1p<span class="sc">$</span>hour <span class="sc">==</span> hour_no)] <span class="sc">*</span> ndvi_seq</span>
<span id="cb87-6"><a href="#cb87-6"></a><span class="co"># plot(x = ndvi_seq, y = ndvi_linear_selection,</span></span>
<span id="cb87-7"><a href="#cb87-7"></a><span class="co">#      main = "Selection for NDVI - linear term",</span></span>
<span id="cb87-8"><a href="#cb87-8"></a><span class="co">#      xlab = "NDVI", ylab = "Estimated selection")</span></span>
<span id="cb87-9"><a href="#cb87-9"></a></span>
<span id="cb87-10"><a href="#cb87-10"></a><span class="co"># and the quadratic term</span></span>
<span id="cb87-11"><a href="#cb87-11"></a>ndvi_quadratic_selection <span class="ot">&lt;-</span> </span>
<span id="cb87-12"><a href="#cb87-12"></a>  (hour_coefs_nat_df_1p<span class="sc">$</span>ndvi_2[<span class="fu">which</span>(hour_coefs_nat_df_1p<span class="sc">$</span>hour <span class="sc">==</span> hour_no)] <span class="sc">*</span> (ndvi_seq <span class="sc">^</span> <span class="dv">2</span>))</span>
<span id="cb87-13"><a href="#cb87-13"></a><span class="co"># plot(x = ndvi_seq, y = ndvi_quadratic_selection,</span></span>
<span id="cb87-14"><a href="#cb87-14"></a><span class="co">#      main = "Selection for NDVI - quadratic term",</span></span>
<span id="cb87-15"><a href="#cb87-15"></a><span class="co">#      xlab = "NDVI", ylab = "Estimated selection")</span></span>
<span id="cb87-16"><a href="#cb87-16"></a></span>
<span id="cb87-17"><a href="#cb87-17"></a><span class="co"># and the sum of both</span></span>
<span id="cb87-18"><a href="#cb87-18"></a>ndvi_sum_selection <span class="ot">&lt;-</span> ndvi_linear_selection <span class="sc">+</span> ndvi_quadratic_selection</span>
<span id="cb87-19"><a href="#cb87-19"></a><span class="fu">plot</span>(<span class="at">x =</span> ndvi_seq, <span class="at">y =</span> ndvi_sum_selection,</span>
<span id="cb87-20"><a href="#cb87-20"></a>     <span class="at">main =</span> <span class="st">"Selection for NDVI - sum of linear and quadratic terms"</span>,</span>
<span id="cb87-21"><a href="#cb87-21"></a>     <span class="at">xlab =</span> <span class="st">"NDVI"</span>, <span class="at">ylab =</span> <span class="st">"Estimated selection"</span>)</span>
<span id="cb87-22"><a href="#cb87-22"></a><span class="fu">lines</span>(ndvi_seq, <span class="fu">rep</span>(<span class="dv">0</span>,<span class="fu">length</span>(ndvi_seq)), <span class="at">lty =</span> <span class="st">"dashed"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ssf_model_fit_id_files/figure-html/unnamed-chunk-48-1.png" class="img-fluid figure-img" width="2100"></p>
</figure>
</div>
</div>
</div>
<p>Whereas for hour 12, the coefficient shows highest selection for NDVI values slightly above 0.4, and the coefficient is positive for NDVI values above 0.</p>
<p>We can imagine viewing these plots for every hour of the day, where each hour has a different quadratic curve, but this would be a lot of plots. We can also see it as a 3D surface, where the x-axis is the hour of the day, the y-axis is the NDVI value, and the z-axis (colour) is the coefficient value.</p>
<p>We simply index over the linear and quadratic terms and calculate the coefficient values at every time point.</p>
</section>
<section id="ndvi-selection-surface" class="level2">
<h2 class="anchored" data-anchor-id="ndvi-selection-surface">NDVI selection surface</h2>
<div class="tabset-margin-container"></div><div class="panel-tabset" data-group="model">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-12-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-12-1" role="tab" aria-controls="tabset-12-1" aria-selected="true">0p</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-12-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-12-2" role="tab" aria-controls="tabset-12-2" aria-selected="false">1p</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-12-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-12-3" role="tab" aria-controls="tabset-12-3" aria-selected="false">2p</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-12-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-12-4" role="tab" aria-controls="tabset-12-4" aria-selected="false">3p</a></li></ul>
<div class="tab-content" data-group="model">
<div id="tabset-12-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-12-1-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1"></a>ndvi_min <span class="ot">&lt;-</span> <span class="fu">min</span>(buffalo_data<span class="sc">$</span>ndvi_temporal, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb88-2"><a href="#cb88-2"></a>ndvi_max <span class="ot">&lt;-</span> <span class="fu">max</span>(buffalo_data<span class="sc">$</span>ndvi_temporal, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb88-3"><a href="#cb88-3"></a>ndvi_seq <span class="ot">&lt;-</span> <span class="fu">seq</span>(ndvi_min, ndvi_max, <span class="at">by =</span> <span class="fl">0.01</span>)</span>
<span id="cb88-4"><a href="#cb88-4"></a></span>
<span id="cb88-5"><a href="#cb88-5"></a><span class="co"># Create empty data frame</span></span>
<span id="cb88-6"><a href="#cb88-6"></a>ndvi_fresponse_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">matrix</span>(<span class="at">ncol =</span> <span class="fu">nrow</span>(hour_coefs_nat_df_0p), </span>
<span id="cb88-7"><a href="#cb88-7"></a>                                       <span class="at">nrow =</span> <span class="fu">length</span>(ndvi_seq)))</span>
<span id="cb88-8"><a href="#cb88-8"></a></span>
<span id="cb88-9"><a href="#cb88-9"></a><span class="co"># loop over each time increment, calculating the selection values for each NDVI value</span></span>
<span id="cb88-10"><a href="#cb88-10"></a><span class="co"># and storing each time increment as a column in a dataframe that we can use for plotting</span></span>
<span id="cb88-11"><a href="#cb88-11"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(hour_coefs_nat_df_0p)) {</span>
<span id="cb88-12"><a href="#cb88-12"></a>  <span class="co"># Assign the vector as a column to the dataframe</span></span>
<span id="cb88-13"><a href="#cb88-13"></a>  ndvi_fresponse_df[,i] <span class="ot">&lt;-</span> (hour_coefs_nat_df_0p<span class="sc">$</span>ndvi[i] <span class="sc">*</span> ndvi_seq) <span class="sc">+</span> </span>
<span id="cb88-14"><a href="#cb88-14"></a>    (hour_coefs_nat_df_0p<span class="sc">$</span>ndvi_2[i] <span class="sc">*</span> (ndvi_seq <span class="sc">^</span> <span class="dv">2</span>))</span>
<span id="cb88-15"><a href="#cb88-15"></a>}</span>
<span id="cb88-16"><a href="#cb88-16"></a></span>
<span id="cb88-17"><a href="#cb88-17"></a>ndvi_fresponse_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(ndvi_seq, ndvi_fresponse_df)</span>
<span id="cb88-18"><a href="#cb88-18"></a><span class="fu">colnames</span>(ndvi_fresponse_df) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"ndvi"</span>, hour)</span>
<span id="cb88-19"><a href="#cb88-19"></a>ndvi_fresponse_long <span class="ot">&lt;-</span> <span class="fu">pivot_longer</span>(ndvi_fresponse_df, </span>
<span id="cb88-20"><a href="#cb88-20"></a>                                    <span class="at">cols =</span> <span class="sc">!</span><span class="dv">1</span>, <span class="at">names_to =</span> <span class="st">"hour"</span>)</span>
<span id="cb88-21"><a href="#cb88-21"></a></span>
<span id="cb88-22"><a href="#cb88-22"></a>ndvi_contour_max <span class="ot">&lt;-</span> <span class="fu">max</span>(ndvi_fresponse_long<span class="sc">$</span>value) <span class="co"># 0.7890195</span></span>
<span id="cb88-23"><a href="#cb88-23"></a>ndvi_contour_min <span class="ot">&lt;-</span> <span class="fu">min</span>(ndvi_fresponse_long<span class="sc">$</span>value) <span class="co"># -0.7945691</span></span>
<span id="cb88-24"><a href="#cb88-24"></a>ndvi_contour_increment <span class="ot">&lt;-</span> (ndvi_contour_max<span class="sc">-</span>ndvi_contour_min)<span class="sc">/</span><span class="dv">10</span></span>
<span id="cb88-25"><a href="#cb88-25"></a></span>
<span id="cb88-26"><a href="#cb88-26"></a>ndvi_quad_0p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> ndvi_fresponse_long, </span>
<span id="cb88-27"><a href="#cb88-27"></a>                       <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">as.numeric</span>(hour), <span class="at">y =</span> ndvi)) <span class="sc">+</span></span>
<span id="cb88-28"><a href="#cb88-28"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">colour =</span> value)) <span class="sc">+</span> </span>
<span id="cb88-29"><a href="#cb88-29"></a>  <span class="fu">geom_contour</span>(<span class="fu">aes</span>(<span class="at">z =</span> value), </span>
<span id="cb88-30"><a href="#cb88-30"></a>               <span class="at">breaks =</span> <span class="fu">seq</span>(ndvi_contour_increment, </span>
<span id="cb88-31"><a href="#cb88-31"></a>                            ndvi_contour_max, </span>
<span id="cb88-32"><a href="#cb88-32"></a>                            ndvi_contour_increment), </span>
<span id="cb88-33"><a href="#cb88-33"></a>               <span class="at">colour =</span> <span class="st">"black"</span>, <span class="at">linewidth =</span> <span class="fl">0.25</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb88-34"><a href="#cb88-34"></a>  <span class="fu">geom_contour</span>(<span class="fu">aes</span>(<span class="at">z =</span> value), </span>
<span id="cb88-35"><a href="#cb88-35"></a>               <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="sc">-</span>ndvi_contour_increment, </span>
<span id="cb88-36"><a href="#cb88-36"></a>                            ndvi_contour_min, </span>
<span id="cb88-37"><a href="#cb88-37"></a>                            <span class="sc">-</span>ndvi_contour_increment), </span>
<span id="cb88-38"><a href="#cb88-38"></a>               <span class="at">colour =</span> <span class="st">"red"</span>, <span class="at">linewidth =</span> <span class="fl">0.25</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb88-39"><a href="#cb88-39"></a>  <span class="fu">geom_contour</span>(<span class="fu">aes</span>(<span class="at">z =</span> value), <span class="at">breaks =</span> <span class="dv">0</span>, <span class="at">colour =</span> <span class="st">"black"</span>, <span class="at">linewidth =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb88-40"><a href="#cb88-40"></a>  <span class="fu">scale_x_continuous</span>(<span class="st">"Hour"</span>, <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">24</span>,<span class="dv">6</span>)) <span class="sc">+</span></span>
<span id="cb88-41"><a href="#cb88-41"></a>  <span class="fu">scale_y_continuous</span>(<span class="st">"NDVI value"</span>, <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>, <span class="fl">0.25</span>)) <span class="sc">+</span></span>
<span id="cb88-42"><a href="#cb88-42"></a>  <span class="fu">scale_colour_viridis_c</span>(<span class="st">"Selection"</span>) <span class="sc">+</span></span>
<span id="cb88-43"><a href="#cb88-43"></a>  <span class="fu">ggtitle</span>(<span class="st">"Normalised Difference Vegetation Index (NDVI)"</span>) <span class="sc">+</span></span>
<span id="cb88-44"><a href="#cb88-44"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb88-45"><a href="#cb88-45"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span>
<span id="cb88-46"><a href="#cb88-46"></a></span>
<span id="cb88-47"><a href="#cb88-47"></a>ndvi_quad_0p</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ssf_model_fit_id_files/figure-html/unnamed-chunk-49-1.png" class="img-fluid figure-img" width="2100"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-12-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-12-2-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1"></a>ndvi_min <span class="ot">&lt;-</span> <span class="fu">min</span>(buffalo_data<span class="sc">$</span>ndvi_temporal, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb89-2"><a href="#cb89-2"></a>ndvi_max <span class="ot">&lt;-</span> <span class="fu">max</span>(buffalo_data<span class="sc">$</span>ndvi_temporal, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb89-3"><a href="#cb89-3"></a>ndvi_seq <span class="ot">&lt;-</span> <span class="fu">seq</span>(ndvi_min, ndvi_max, <span class="at">by =</span> <span class="fl">0.01</span>)</span>
<span id="cb89-4"><a href="#cb89-4"></a></span>
<span id="cb89-5"><a href="#cb89-5"></a><span class="co"># Create empty data frame</span></span>
<span id="cb89-6"><a href="#cb89-6"></a>ndvi_fresponse_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">matrix</span>(<span class="at">ncol =</span> <span class="fu">nrow</span>(hour_coefs_nat_df_1p), </span>
<span id="cb89-7"><a href="#cb89-7"></a>                                       <span class="at">nrow =</span> <span class="fu">length</span>(ndvi_seq)))</span>
<span id="cb89-8"><a href="#cb89-8"></a></span>
<span id="cb89-9"><a href="#cb89-9"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(hour_coefs_nat_df_1p)) {</span>
<span id="cb89-10"><a href="#cb89-10"></a>  <span class="co"># Assign the vector as a column to the dataframe</span></span>
<span id="cb89-11"><a href="#cb89-11"></a>  ndvi_fresponse_df[,i] <span class="ot">&lt;-</span> (hour_coefs_nat_df_1p<span class="sc">$</span>ndvi[i] <span class="sc">*</span> ndvi_seq) <span class="sc">+</span> </span>
<span id="cb89-12"><a href="#cb89-12"></a>    (hour_coefs_nat_df_1p<span class="sc">$</span>ndvi_2[i] <span class="sc">*</span> (ndvi_seq <span class="sc">^</span> <span class="dv">2</span>))</span>
<span id="cb89-13"><a href="#cb89-13"></a>}</span>
<span id="cb89-14"><a href="#cb89-14"></a></span>
<span id="cb89-15"><a href="#cb89-15"></a>ndvi_fresponse_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(ndvi_seq, ndvi_fresponse_df)</span>
<span id="cb89-16"><a href="#cb89-16"></a><span class="fu">colnames</span>(ndvi_fresponse_df) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"ndvi"</span>, hour)</span>
<span id="cb89-17"><a href="#cb89-17"></a>ndvi_fresponse_long <span class="ot">&lt;-</span> <span class="fu">pivot_longer</span>(ndvi_fresponse_df, <span class="at">cols =</span> <span class="sc">!</span><span class="dv">1</span>, <span class="at">names_to =</span> <span class="st">"hour"</span>)</span>
<span id="cb89-18"><a href="#cb89-18"></a></span>
<span id="cb89-19"><a href="#cb89-19"></a>ndvi_contour_max <span class="ot">&lt;-</span> <span class="fu">max</span>(ndvi_fresponse_long<span class="sc">$</span>value) <span class="co"># 0.7890195</span></span>
<span id="cb89-20"><a href="#cb89-20"></a>ndvi_contour_min <span class="ot">&lt;-</span> <span class="fu">min</span>(ndvi_fresponse_long<span class="sc">$</span>value) <span class="co"># -0.7945691</span></span>
<span id="cb89-21"><a href="#cb89-21"></a>ndvi_contour_increment <span class="ot">&lt;-</span> (ndvi_contour_max<span class="sc">-</span>ndvi_contour_min)<span class="sc">/</span><span class="dv">10</span></span>
<span id="cb89-22"><a href="#cb89-22"></a></span>
<span id="cb89-23"><a href="#cb89-23"></a>ndvi_quad_1p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> ndvi_fresponse_long, </span>
<span id="cb89-24"><a href="#cb89-24"></a>                       <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">as.numeric</span>(hour), <span class="at">y =</span> ndvi)) <span class="sc">+</span></span>
<span id="cb89-25"><a href="#cb89-25"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">colour =</span> value)) <span class="sc">+</span> <span class="co"># colour = "white"</span></span>
<span id="cb89-26"><a href="#cb89-26"></a>  <span class="fu">geom_contour</span>(<span class="fu">aes</span>(<span class="at">z =</span> value), </span>
<span id="cb89-27"><a href="#cb89-27"></a>               <span class="at">breaks =</span> <span class="fu">seq</span>(ndvi_contour_increment, </span>
<span id="cb89-28"><a href="#cb89-28"></a>                            ndvi_contour_max, </span>
<span id="cb89-29"><a href="#cb89-29"></a>                            ndvi_contour_increment), </span>
<span id="cb89-30"><a href="#cb89-30"></a>               <span class="at">colour =</span> <span class="st">"black"</span>, <span class="at">linewidth =</span> <span class="fl">0.25</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb89-31"><a href="#cb89-31"></a>  <span class="fu">geom_contour</span>(<span class="fu">aes</span>(<span class="at">z =</span> value), </span>
<span id="cb89-32"><a href="#cb89-32"></a>               <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="sc">-</span>ndvi_contour_increment, </span>
<span id="cb89-33"><a href="#cb89-33"></a>                            ndvi_contour_min, </span>
<span id="cb89-34"><a href="#cb89-34"></a>                            <span class="sc">-</span>ndvi_contour_increment), </span>
<span id="cb89-35"><a href="#cb89-35"></a>               <span class="at">colour =</span> <span class="st">"red"</span>, <span class="at">linewidth =</span> <span class="fl">0.25</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb89-36"><a href="#cb89-36"></a>  <span class="fu">geom_contour</span>(<span class="fu">aes</span>(<span class="at">z =</span> value), <span class="at">breaks =</span> <span class="dv">0</span>, <span class="at">colour =</span> <span class="st">"black"</span>, <span class="at">linewidth =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb89-37"><a href="#cb89-37"></a>  <span class="fu">scale_x_continuous</span>(<span class="st">"Hour"</span>, <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">24</span>,<span class="dv">6</span>)) <span class="sc">+</span></span>
<span id="cb89-38"><a href="#cb89-38"></a>  <span class="fu">scale_y_continuous</span>(<span class="st">"NDVI value"</span>, <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>, <span class="fl">0.25</span>)) <span class="sc">+</span></span>
<span id="cb89-39"><a href="#cb89-39"></a>  <span class="fu">scale_colour_viridis_c</span>(<span class="st">"Selection"</span>) <span class="sc">+</span></span>
<span id="cb89-40"><a href="#cb89-40"></a>  <span class="co"># ggtitle("Normalised Difference Vegetation Index (NDVI)") +</span></span>
<span id="cb89-41"><a href="#cb89-41"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb89-42"><a href="#cb89-42"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span>
<span id="cb89-43"><a href="#cb89-43"></a></span>
<span id="cb89-44"><a href="#cb89-44"></a>ndvi_quad_1p</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ssf_model_fit_id_files/figure-html/unnamed-chunk-50-1.png" class="img-fluid figure-img" width="2100"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-12-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-12-3-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1"></a>ndvi_min <span class="ot">&lt;-</span> <span class="fu">min</span>(buffalo_data<span class="sc">$</span>ndvi_temporal, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb90-2"><a href="#cb90-2"></a>ndvi_max <span class="ot">&lt;-</span> <span class="fu">max</span>(buffalo_data<span class="sc">$</span>ndvi_temporal, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb90-3"><a href="#cb90-3"></a>ndvi_seq <span class="ot">&lt;-</span> <span class="fu">seq</span>(ndvi_min, ndvi_max, <span class="at">by =</span> <span class="fl">0.01</span>)</span>
<span id="cb90-4"><a href="#cb90-4"></a></span>
<span id="cb90-5"><a href="#cb90-5"></a><span class="co"># Create empty data frame</span></span>
<span id="cb90-6"><a href="#cb90-6"></a>ndvi_fresponse_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">matrix</span>(<span class="at">ncol =</span> <span class="fu">nrow</span>(hour_coefs_nat_df_2p), </span>
<span id="cb90-7"><a href="#cb90-7"></a>                                       <span class="at">nrow =</span> <span class="fu">length</span>(ndvi_seq)))</span>
<span id="cb90-8"><a href="#cb90-8"></a></span>
<span id="cb90-9"><a href="#cb90-9"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(hour_coefs_nat_df_2p)) {</span>
<span id="cb90-10"><a href="#cb90-10"></a>  <span class="co"># Assign the vector as a column to the dataframe</span></span>
<span id="cb90-11"><a href="#cb90-11"></a>  ndvi_fresponse_df[,i] <span class="ot">&lt;-</span> (hour_coefs_nat_df_2p<span class="sc">$</span>ndvi[i] <span class="sc">*</span> ndvi_seq) <span class="sc">+</span> </span>
<span id="cb90-12"><a href="#cb90-12"></a>    (hour_coefs_nat_df_2p<span class="sc">$</span>ndvi_2[i] <span class="sc">*</span> (ndvi_seq <span class="sc">^</span> <span class="dv">2</span>))</span>
<span id="cb90-13"><a href="#cb90-13"></a>}</span>
<span id="cb90-14"><a href="#cb90-14"></a></span>
<span id="cb90-15"><a href="#cb90-15"></a>ndvi_fresponse_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(ndvi_seq, ndvi_fresponse_df)</span>
<span id="cb90-16"><a href="#cb90-16"></a><span class="fu">colnames</span>(ndvi_fresponse_df) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"ndvi"</span>, hour)</span>
<span id="cb90-17"><a href="#cb90-17"></a>ndvi_fresponse_long <span class="ot">&lt;-</span> <span class="fu">pivot_longer</span>(ndvi_fresponse_df, <span class="at">cols =</span> <span class="sc">!</span><span class="dv">1</span>, </span>
<span id="cb90-18"><a href="#cb90-18"></a>                                    <span class="at">names_to =</span> <span class="st">"hour"</span>)</span>
<span id="cb90-19"><a href="#cb90-19"></a></span>
<span id="cb90-20"><a href="#cb90-20"></a>ndvi_contour_max <span class="ot">&lt;-</span> <span class="fu">max</span>(ndvi_fresponse_long<span class="sc">$</span>value) <span class="co"># 0.7890195</span></span>
<span id="cb90-21"><a href="#cb90-21"></a>ndvi_contour_min <span class="ot">&lt;-</span> <span class="fu">min</span>(ndvi_fresponse_long<span class="sc">$</span>value) <span class="co"># -0.7945691</span></span>
<span id="cb90-22"><a href="#cb90-22"></a>ndvi_contour_increment <span class="ot">&lt;-</span> (ndvi_contour_max<span class="sc">-</span>ndvi_contour_min)<span class="sc">/</span><span class="dv">10</span></span>
<span id="cb90-23"><a href="#cb90-23"></a></span>
<span id="cb90-24"><a href="#cb90-24"></a>ndvi_quad_2p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> ndvi_fresponse_long, </span>
<span id="cb90-25"><a href="#cb90-25"></a>                       <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">as.numeric</span>(hour), <span class="at">y =</span> ndvi)) <span class="sc">+</span></span>
<span id="cb90-26"><a href="#cb90-26"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">colour =</span> value)) <span class="sc">+</span> <span class="co"># colour = "white"</span></span>
<span id="cb90-27"><a href="#cb90-27"></a>  <span class="fu">geom_contour</span>(<span class="fu">aes</span>(<span class="at">z =</span> value), </span>
<span id="cb90-28"><a href="#cb90-28"></a>               <span class="at">breaks =</span> <span class="fu">seq</span>(ndvi_contour_increment, </span>
<span id="cb90-29"><a href="#cb90-29"></a>                            ndvi_contour_max, </span>
<span id="cb90-30"><a href="#cb90-30"></a>                            ndvi_contour_increment), </span>
<span id="cb90-31"><a href="#cb90-31"></a>               <span class="at">colour =</span> <span class="st">"black"</span>, <span class="at">linewidth =</span> <span class="fl">0.25</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb90-32"><a href="#cb90-32"></a>  <span class="fu">geom_contour</span>(<span class="fu">aes</span>(<span class="at">z =</span> value), </span>
<span id="cb90-33"><a href="#cb90-33"></a>               <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="sc">-</span>ndvi_contour_increment, </span>
<span id="cb90-34"><a href="#cb90-34"></a>                            ndvi_contour_min, </span>
<span id="cb90-35"><a href="#cb90-35"></a>                            <span class="sc">-</span>ndvi_contour_increment), </span>
<span id="cb90-36"><a href="#cb90-36"></a>               <span class="at">colour =</span> <span class="st">"red"</span>, <span class="at">linewidth =</span> <span class="fl">0.25</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb90-37"><a href="#cb90-37"></a>  <span class="fu">geom_contour</span>(<span class="fu">aes</span>(<span class="at">z =</span> value), <span class="at">breaks =</span> <span class="dv">0</span>, <span class="at">colour =</span> <span class="st">"black"</span>, <span class="at">linewidth =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb90-38"><a href="#cb90-38"></a>  <span class="fu">scale_x_continuous</span>(<span class="st">"Hour"</span>, <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">24</span>,<span class="dv">6</span>)) <span class="sc">+</span></span>
<span id="cb90-39"><a href="#cb90-39"></a>  <span class="fu">scale_y_continuous</span>(<span class="st">"NDVI value"</span>, <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>, <span class="fl">0.25</span>)) <span class="sc">+</span></span>
<span id="cb90-40"><a href="#cb90-40"></a>  <span class="fu">scale_colour_viridis_c</span>(<span class="st">"Selection"</span>) <span class="sc">+</span></span>
<span id="cb90-41"><a href="#cb90-41"></a>  <span class="co"># ggtitle("Normalised Difference Vegetation Index (NDVI)") +</span></span>
<span id="cb90-42"><a href="#cb90-42"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb90-43"><a href="#cb90-43"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"right"</span>)</span>
<span id="cb90-44"><a href="#cb90-44"></a></span>
<span id="cb90-45"><a href="#cb90-45"></a>ndvi_quad_2p</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ssf_model_fit_id_files/figure-html/unnamed-chunk-51-1.png" class="img-fluid figure-img" width="2100"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1"></a><span class="co"># ggsave(paste0("outputs/plots/manuscript_figs_R2/ndvi_selection_surface_legend_",</span></span>
<span id="cb91-2"><a href="#cb91-2"></a><span class="co">#          Sys.Date(), ".png"),</span></span>
<span id="cb91-3"><a href="#cb91-3"></a><span class="co">#   width=170, height=90, units="mm", dpi = 1000)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
<div id="tabset-12-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-12-4-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1"></a>ndvi_min <span class="ot">&lt;-</span> <span class="fu">min</span>(buffalo_data<span class="sc">$</span>ndvi_temporal, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb92-2"><a href="#cb92-2"></a>ndvi_max <span class="ot">&lt;-</span> <span class="fu">max</span>(buffalo_data<span class="sc">$</span>ndvi_temporal, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb92-3"><a href="#cb92-3"></a>ndvi_seq <span class="ot">&lt;-</span> <span class="fu">seq</span>(ndvi_min, ndvi_max, <span class="at">by =</span> <span class="fl">0.01</span>)</span>
<span id="cb92-4"><a href="#cb92-4"></a></span>
<span id="cb92-5"><a href="#cb92-5"></a><span class="co"># Create empty data frame</span></span>
<span id="cb92-6"><a href="#cb92-6"></a>ndvi_fresponse_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">matrix</span>(<span class="at">ncol =</span> <span class="fu">nrow</span>(hour_coefs_nat_df_3p), </span>
<span id="cb92-7"><a href="#cb92-7"></a>                                       <span class="at">nrow =</span> <span class="fu">length</span>(ndvi_seq)))</span>
<span id="cb92-8"><a href="#cb92-8"></a></span>
<span id="cb92-9"><a href="#cb92-9"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(hour_coefs_nat_df_3p)) {</span>
<span id="cb92-10"><a href="#cb92-10"></a>  <span class="co"># Assign the vector as a column to the dataframe</span></span>
<span id="cb92-11"><a href="#cb92-11"></a>  ndvi_fresponse_df[,i] <span class="ot">&lt;-</span> (hour_coefs_nat_df_3p<span class="sc">$</span>ndvi[i] <span class="sc">*</span> ndvi_seq) <span class="sc">+</span> </span>
<span id="cb92-12"><a href="#cb92-12"></a>    (hour_coefs_nat_df_3p<span class="sc">$</span>ndvi_2[i] <span class="sc">*</span> (ndvi_seq <span class="sc">^</span> <span class="dv">2</span>))</span>
<span id="cb92-13"><a href="#cb92-13"></a>}</span>
<span id="cb92-14"><a href="#cb92-14"></a></span>
<span id="cb92-15"><a href="#cb92-15"></a>ndvi_fresponse_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(ndvi_seq, ndvi_fresponse_df)</span>
<span id="cb92-16"><a href="#cb92-16"></a><span class="fu">colnames</span>(ndvi_fresponse_df) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"ndvi"</span>, hour)</span>
<span id="cb92-17"><a href="#cb92-17"></a>ndvi_fresponse_long <span class="ot">&lt;-</span> <span class="fu">pivot_longer</span>(ndvi_fresponse_df, <span class="at">cols =</span> <span class="sc">!</span><span class="dv">1</span>, </span>
<span id="cb92-18"><a href="#cb92-18"></a>                                    <span class="at">names_to =</span> <span class="st">"hour"</span>)</span>
<span id="cb92-19"><a href="#cb92-19"></a></span>
<span id="cb92-20"><a href="#cb92-20"></a>ndvi_contour_max <span class="ot">&lt;-</span> <span class="fu">max</span>(ndvi_fresponse_long<span class="sc">$</span>value) <span class="co"># 0.7890195</span></span>
<span id="cb92-21"><a href="#cb92-21"></a>ndvi_contour_min <span class="ot">&lt;-</span> <span class="fu">min</span>(ndvi_fresponse_long<span class="sc">$</span>value) <span class="co"># -0.7945691</span></span>
<span id="cb92-22"><a href="#cb92-22"></a>ndvi_contour_increment <span class="ot">&lt;-</span> (ndvi_contour_max<span class="sc">-</span>ndvi_contour_min)<span class="sc">/</span><span class="dv">10</span></span>
<span id="cb92-23"><a href="#cb92-23"></a></span>
<span id="cb92-24"><a href="#cb92-24"></a>ndvi_quad_3p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> ndvi_fresponse_long, </span>
<span id="cb92-25"><a href="#cb92-25"></a>                       <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">as.numeric</span>(hour), <span class="at">y =</span> ndvi)) <span class="sc">+</span></span>
<span id="cb92-26"><a href="#cb92-26"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">colour =</span> value)) <span class="sc">+</span> <span class="co"># colour = "white"</span></span>
<span id="cb92-27"><a href="#cb92-27"></a>  <span class="fu">geom_contour</span>(<span class="fu">aes</span>(<span class="at">z =</span> value), </span>
<span id="cb92-28"><a href="#cb92-28"></a>               <span class="at">breaks =</span> <span class="fu">seq</span>(ndvi_contour_increment, </span>
<span id="cb92-29"><a href="#cb92-29"></a>                            ndvi_contour_max, </span>
<span id="cb92-30"><a href="#cb92-30"></a>                            ndvi_contour_increment), </span>
<span id="cb92-31"><a href="#cb92-31"></a>               <span class="at">colour =</span> <span class="st">"black"</span>, <span class="at">linewidth =</span> <span class="fl">0.25</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb92-32"><a href="#cb92-32"></a>  <span class="fu">geom_contour</span>(<span class="fu">aes</span>(<span class="at">z =</span> value), </span>
<span id="cb92-33"><a href="#cb92-33"></a>               <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="sc">-</span>ndvi_contour_increment, </span>
<span id="cb92-34"><a href="#cb92-34"></a>                            ndvi_contour_min, </span>
<span id="cb92-35"><a href="#cb92-35"></a>                            <span class="sc">-</span>ndvi_contour_increment), </span>
<span id="cb92-36"><a href="#cb92-36"></a>               <span class="at">colour =</span> <span class="st">"red"</span>, <span class="at">linewidth =</span> <span class="fl">0.25</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb92-37"><a href="#cb92-37"></a>  <span class="fu">geom_contour</span>(<span class="fu">aes</span>(<span class="at">z =</span> value), <span class="at">breaks =</span> <span class="dv">0</span>, <span class="at">colour =</span> <span class="st">"black"</span>, <span class="at">linewidth =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb92-38"><a href="#cb92-38"></a>  <span class="fu">scale_x_continuous</span>(<span class="st">"Hour"</span>, <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">24</span>,<span class="dv">6</span>)) <span class="sc">+</span></span>
<span id="cb92-39"><a href="#cb92-39"></a>  <span class="fu">scale_y_continuous</span>(<span class="st">"NDVI value"</span>, <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>, <span class="fl">0.25</span>)) <span class="sc">+</span></span>
<span id="cb92-40"><a href="#cb92-40"></a>  <span class="fu">scale_colour_viridis_c</span>(<span class="st">"Selection"</span>) <span class="sc">+</span></span>
<span id="cb92-41"><a href="#cb92-41"></a>  <span class="co"># ggtitle("Normalised Difference Vegetation Index (NDVI)") +</span></span>
<span id="cb92-42"><a href="#cb92-42"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb92-43"><a href="#cb92-43"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span>
<span id="cb92-44"><a href="#cb92-44"></a></span>
<span id="cb92-45"><a href="#cb92-45"></a>ndvi_quad_3p</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ssf_model_fit_id_files/figure-html/unnamed-chunk-52-1.png" class="img-fluid figure-img" width="2100"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="canopy-cover-selection-surface" class="level2">
<h2 class="anchored" data-anchor-id="canopy-cover-selection-surface">Canopy cover selection surface</h2>
<div class="tabset-margin-container"></div><div class="panel-tabset" data-group="model">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-13-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-13-1" role="tab" aria-controls="tabset-13-1" aria-selected="true">0p</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-13-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-13-2" role="tab" aria-controls="tabset-13-2" aria-selected="false">1p</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-13-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-13-3" role="tab" aria-controls="tabset-13-3" aria-selected="false">2p</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-13-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-13-4" role="tab" aria-controls="tabset-13-4" aria-selected="false">3p</a></li></ul>
<div class="tab-content" data-group="model">
<div id="tabset-13-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-13-1-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1"></a>canopy_min <span class="ot">&lt;-</span> <span class="fu">min</span>(buffalo_data<span class="sc">$</span>canopy_01, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb93-2"><a href="#cb93-2"></a>canopy_max <span class="ot">&lt;-</span> <span class="fu">max</span>(buffalo_data<span class="sc">$</span>canopy_01, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb93-3"><a href="#cb93-3"></a>canopy_seq <span class="ot">&lt;-</span> <span class="fu">seq</span>(canopy_min, canopy_max, <span class="at">by =</span> <span class="fl">0.01</span>)</span>
<span id="cb93-4"><a href="#cb93-4"></a></span>
<span id="cb93-5"><a href="#cb93-5"></a><span class="co"># Create empty data frame</span></span>
<span id="cb93-6"><a href="#cb93-6"></a>canopy_fresponse_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">matrix</span>(<span class="at">ncol =</span> <span class="fu">nrow</span>(hour_coefs_nat_df_0p), </span>
<span id="cb93-7"><a href="#cb93-7"></a>                                         <span class="at">nrow =</span> <span class="fu">length</span>(canopy_seq)))</span>
<span id="cb93-8"><a href="#cb93-8"></a></span>
<span id="cb93-9"><a href="#cb93-9"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(hour_coefs_nat_df_0p)) {</span>
<span id="cb93-10"><a href="#cb93-10"></a>  <span class="co"># Assign the vector as a column to the dataframe</span></span>
<span id="cb93-11"><a href="#cb93-11"></a>  canopy_fresponse_df[,i] <span class="ot">&lt;-</span> (hour_coefs_nat_df_0p<span class="sc">$</span>canopy[i] <span class="sc">*</span> canopy_seq) <span class="sc">+</span> </span>
<span id="cb93-12"><a href="#cb93-12"></a>    (hour_coefs_nat_df_0p<span class="sc">$</span>canopy_2[i] <span class="sc">*</span> (canopy_seq <span class="sc">^</span> <span class="dv">2</span>))</span>
<span id="cb93-13"><a href="#cb93-13"></a>}</span>
<span id="cb93-14"><a href="#cb93-14"></a></span>
<span id="cb93-15"><a href="#cb93-15"></a>canopy_fresponse_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(canopy_seq, canopy_fresponse_df)</span>
<span id="cb93-16"><a href="#cb93-16"></a><span class="fu">colnames</span>(canopy_fresponse_df) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"canopy"</span>, hour)</span>
<span id="cb93-17"><a href="#cb93-17"></a>canopy_fresponse_long <span class="ot">&lt;-</span> <span class="fu">pivot_longer</span>(canopy_fresponse_df, </span>
<span id="cb93-18"><a href="#cb93-18"></a>                                      <span class="at">cols =</span> <span class="sc">!</span><span class="dv">1</span>, </span>
<span id="cb93-19"><a href="#cb93-19"></a>                                      <span class="at">names_to =</span> <span class="st">"hour"</span>)</span>
<span id="cb93-20"><a href="#cb93-20"></a></span>
<span id="cb93-21"><a href="#cb93-21"></a>canopy_contour_min <span class="ot">&lt;-</span> <span class="fu">min</span>(canopy_fresponse_long<span class="sc">$</span>value) <span class="co"># 0</span></span>
<span id="cb93-22"><a href="#cb93-22"></a>canopy_contour_max <span class="ot">&lt;-</span> <span class="fu">max</span>(canopy_fresponse_long<span class="sc">$</span>value) <span class="co"># 2.181749</span></span>
<span id="cb93-23"><a href="#cb93-23"></a>canopy_contour_increment <span class="ot">&lt;-</span> (canopy_contour_max<span class="sc">-</span>canopy_contour_min)<span class="sc">/</span><span class="dv">10</span></span>
<span id="cb93-24"><a href="#cb93-24"></a></span>
<span id="cb93-25"><a href="#cb93-25"></a>canopy_quad_0p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> canopy_fresponse_long, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">as.numeric</span>(hour), </span>
<span id="cb93-26"><a href="#cb93-26"></a>                                                           <span class="at">y =</span> canopy)) <span class="sc">+</span></span>
<span id="cb93-27"><a href="#cb93-27"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">colour =</span> value)) <span class="sc">+</span></span>
<span id="cb93-28"><a href="#cb93-28"></a>  <span class="fu">geom_contour</span>(<span class="fu">aes</span>(<span class="at">z =</span> value), </span>
<span id="cb93-29"><a href="#cb93-29"></a>               <span class="at">breaks =</span> <span class="fu">seq</span>(canopy_contour_increment, canopy_contour_max, </span>
<span id="cb93-30"><a href="#cb93-30"></a>                            <span class="sc">-</span>canopy_contour_increment), </span>
<span id="cb93-31"><a href="#cb93-31"></a>               <span class="at">colour =</span> <span class="st">"black"</span>, <span class="at">linewidth =</span> <span class="fl">0.25</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb93-32"><a href="#cb93-32"></a>  <span class="fu">geom_contour</span>(<span class="fu">aes</span>(<span class="at">z =</span> value),</span>
<span id="cb93-33"><a href="#cb93-33"></a>  <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="sc">-</span>canopy_contour_increment, canopy_contour_min,</span>
<span id="cb93-34"><a href="#cb93-34"></a>               <span class="sc">-</span>canopy_contour_increment),</span>
<span id="cb93-35"><a href="#cb93-35"></a>               <span class="at">colour =</span> <span class="st">"red"</span>, <span class="at">linewidth =</span> <span class="fl">0.25</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb93-36"><a href="#cb93-36"></a>  <span class="fu">geom_contour</span>(<span class="fu">aes</span>(<span class="at">z =</span> value), <span class="at">breaks =</span> <span class="dv">0</span>, <span class="at">colour =</span> <span class="st">"black"</span>, <span class="at">linewidth =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb93-37"><a href="#cb93-37"></a>  <span class="fu">scale_x_continuous</span>(<span class="st">"Hour"</span>, <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">24</span>,<span class="dv">6</span>)) <span class="sc">+</span></span>
<span id="cb93-38"><a href="#cb93-38"></a>  <span class="fu">scale_y_continuous</span>(<span class="st">"Canopy cover"</span>, <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.25</span>)) <span class="sc">+</span></span>
<span id="cb93-39"><a href="#cb93-39"></a>  <span class="fu">scale_colour_viridis_c</span>(<span class="st">"Selection"</span>) <span class="sc">+</span></span>
<span id="cb93-40"><a href="#cb93-40"></a>  <span class="fu">ggtitle</span>(<span class="st">"Canopy Cover"</span>) <span class="sc">+</span></span>
<span id="cb93-41"><a href="#cb93-41"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb93-42"><a href="#cb93-42"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span>
<span id="cb93-43"><a href="#cb93-43"></a></span>
<span id="cb93-44"><a href="#cb93-44"></a>canopy_quad_0p</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ssf_model_fit_id_files/figure-html/unnamed-chunk-53-1.png" class="img-fluid figure-img" width="2100"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-13-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-13-2-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1"></a>canopy_min <span class="ot">&lt;-</span> <span class="fu">min</span>(buffalo_data<span class="sc">$</span>canopy_01, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb94-2"><a href="#cb94-2"></a>canopy_max <span class="ot">&lt;-</span> <span class="fu">max</span>(buffalo_data<span class="sc">$</span>canopy_01, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb94-3"><a href="#cb94-3"></a>canopy_seq <span class="ot">&lt;-</span> <span class="fu">seq</span>(canopy_min, canopy_max, <span class="at">by =</span> <span class="fl">0.01</span>)</span>
<span id="cb94-4"><a href="#cb94-4"></a></span>
<span id="cb94-5"><a href="#cb94-5"></a><span class="co"># Create empty data frame</span></span>
<span id="cb94-6"><a href="#cb94-6"></a>canopy_fresponse_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">matrix</span>(<span class="at">ncol =</span> <span class="fu">nrow</span>(hour_coefs_nat_df_1p), </span>
<span id="cb94-7"><a href="#cb94-7"></a>                                         <span class="at">nrow =</span> <span class="fu">length</span>(canopy_seq)))</span>
<span id="cb94-8"><a href="#cb94-8"></a></span>
<span id="cb94-9"><a href="#cb94-9"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(hour_coefs_nat_df_1p)) {</span>
<span id="cb94-10"><a href="#cb94-10"></a>  <span class="co"># Assign the vector as a column to the dataframe</span></span>
<span id="cb94-11"><a href="#cb94-11"></a>  canopy_fresponse_df[,i] <span class="ot">&lt;-</span> (hour_coefs_nat_df_1p<span class="sc">$</span>canopy[i] <span class="sc">*</span> canopy_seq) <span class="sc">+</span> </span>
<span id="cb94-12"><a href="#cb94-12"></a>    (hour_coefs_nat_df_1p<span class="sc">$</span>canopy_2[i] <span class="sc">*</span> (canopy_seq <span class="sc">^</span> <span class="dv">2</span>))</span>
<span id="cb94-13"><a href="#cb94-13"></a>}</span>
<span id="cb94-14"><a href="#cb94-14"></a></span>
<span id="cb94-15"><a href="#cb94-15"></a>canopy_fresponse_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(canopy_seq, canopy_fresponse_df)</span>
<span id="cb94-16"><a href="#cb94-16"></a><span class="fu">colnames</span>(canopy_fresponse_df) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"canopy"</span>, hour)</span>
<span id="cb94-17"><a href="#cb94-17"></a>canopy_fresponse_long <span class="ot">&lt;-</span> <span class="fu">pivot_longer</span>(canopy_fresponse_df, <span class="at">cols =</span> <span class="sc">!</span><span class="dv">1</span>, </span>
<span id="cb94-18"><a href="#cb94-18"></a>                                      <span class="at">names_to =</span> <span class="st">"hour"</span>)</span>
<span id="cb94-19"><a href="#cb94-19"></a></span>
<span id="cb94-20"><a href="#cb94-20"></a>canopy_contour_min <span class="ot">&lt;-</span> <span class="fu">min</span>(canopy_fresponse_long<span class="sc">$</span>value) <span class="co"># 0</span></span>
<span id="cb94-21"><a href="#cb94-21"></a>canopy_contour_max <span class="ot">&lt;-</span> <span class="fu">max</span>(canopy_fresponse_long<span class="sc">$</span>value) <span class="co"># 2.181749</span></span>
<span id="cb94-22"><a href="#cb94-22"></a>canopy_contour_increment <span class="ot">&lt;-</span> (canopy_contour_max<span class="sc">-</span>canopy_contour_min)<span class="sc">/</span><span class="dv">10</span></span>
<span id="cb94-23"><a href="#cb94-23"></a></span>
<span id="cb94-24"><a href="#cb94-24"></a>canopy_quad_1p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> canopy_fresponse_long, </span>
<span id="cb94-25"><a href="#cb94-25"></a>                         <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">as.numeric</span>(hour), <span class="at">y =</span> canopy)) <span class="sc">+</span></span>
<span id="cb94-26"><a href="#cb94-26"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">colour =</span> value)) <span class="sc">+</span></span>
<span id="cb94-27"><a href="#cb94-27"></a>  <span class="fu">geom_contour</span>(<span class="fu">aes</span>(<span class="at">z =</span> value), </span>
<span id="cb94-28"><a href="#cb94-28"></a>               <span class="at">breaks =</span> <span class="fu">seq</span>(canopy_contour_increment, </span>
<span id="cb94-29"><a href="#cb94-29"></a>                            canopy_contour_max, </span>
<span id="cb94-30"><a href="#cb94-30"></a>                            <span class="sc">-</span>canopy_contour_increment), </span>
<span id="cb94-31"><a href="#cb94-31"></a>               <span class="at">colour =</span> <span class="st">"black"</span>, <span class="at">linewidth =</span> <span class="fl">0.25</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb94-32"><a href="#cb94-32"></a>  <span class="fu">geom_contour</span>(<span class="fu">aes</span>(<span class="at">z =</span> value),</span>
<span id="cb94-33"><a href="#cb94-33"></a>               <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="sc">-</span>canopy_contour_increment, </span>
<span id="cb94-34"><a href="#cb94-34"></a>                            canopy_contour_min, </span>
<span id="cb94-35"><a href="#cb94-35"></a>                            <span class="sc">-</span>canopy_contour_increment),</span>
<span id="cb94-36"><a href="#cb94-36"></a>               <span class="at">colour =</span> <span class="st">"red"</span>, <span class="at">linewidth =</span> <span class="fl">0.25</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb94-37"><a href="#cb94-37"></a>  <span class="fu">geom_contour</span>(<span class="fu">aes</span>(<span class="at">z =</span> value), <span class="at">breaks =</span> <span class="dv">0</span>, <span class="at">colour =</span> <span class="st">"black"</span>, <span class="at">linewidth =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb94-38"><a href="#cb94-38"></a>  <span class="fu">scale_x_continuous</span>(<span class="st">"Hour"</span>, <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">24</span>,<span class="dv">6</span>)) <span class="sc">+</span></span>
<span id="cb94-39"><a href="#cb94-39"></a>  <span class="fu">scale_y_continuous</span>(<span class="st">"Canopy cover"</span>, <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.25</span>)) <span class="sc">+</span></span>
<span id="cb94-40"><a href="#cb94-40"></a>  <span class="fu">scale_colour_viridis_c</span>(<span class="st">"Selection"</span>) <span class="sc">+</span></span>
<span id="cb94-41"><a href="#cb94-41"></a>  <span class="co"># ggtitle("Canopy Cover") +</span></span>
<span id="cb94-42"><a href="#cb94-42"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb94-43"><a href="#cb94-43"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span>
<span id="cb94-44"><a href="#cb94-44"></a></span>
<span id="cb94-45"><a href="#cb94-45"></a>canopy_quad_1p</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: `stat_contour()`: Zero contours were generated</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in min(x): no non-missing arguments to min; returning Inf</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in max(x): no non-missing arguments to max; returning -Inf</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ssf_model_fit_id_files/figure-html/unnamed-chunk-54-1.png" class="img-fluid figure-img" width="2100"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-13-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-13-3-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1"></a>canopy_min <span class="ot">&lt;-</span> <span class="fu">min</span>(buffalo_data<span class="sc">$</span>canopy_01, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb98-2"><a href="#cb98-2"></a>canopy_max <span class="ot">&lt;-</span> <span class="fu">max</span>(buffalo_data<span class="sc">$</span>canopy_01, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb98-3"><a href="#cb98-3"></a>canopy_seq <span class="ot">&lt;-</span> <span class="fu">seq</span>(canopy_min, canopy_max, <span class="at">by =</span> <span class="fl">0.01</span>)</span>
<span id="cb98-4"><a href="#cb98-4"></a></span>
<span id="cb98-5"><a href="#cb98-5"></a><span class="co"># Create empty data frame</span></span>
<span id="cb98-6"><a href="#cb98-6"></a>canopy_fresponse_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">matrix</span>(<span class="at">ncol =</span> <span class="fu">nrow</span>(hour_coefs_nat_df_2p), </span>
<span id="cb98-7"><a href="#cb98-7"></a>                                         <span class="at">nrow =</span> <span class="fu">length</span>(canopy_seq)))</span>
<span id="cb98-8"><a href="#cb98-8"></a></span>
<span id="cb98-9"><a href="#cb98-9"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(hour_coefs_nat_df_2p)) {</span>
<span id="cb98-10"><a href="#cb98-10"></a>  <span class="co"># Assign the vector as a column to the dataframe</span></span>
<span id="cb98-11"><a href="#cb98-11"></a>  canopy_fresponse_df[,i] <span class="ot">&lt;-</span> (hour_coefs_nat_df_2p<span class="sc">$</span>canopy[i] <span class="sc">*</span> canopy_seq) <span class="sc">+</span> </span>
<span id="cb98-12"><a href="#cb98-12"></a>    (hour_coefs_nat_df_2p<span class="sc">$</span>canopy_2[i] <span class="sc">*</span> (canopy_seq <span class="sc">^</span> <span class="dv">2</span>))</span>
<span id="cb98-13"><a href="#cb98-13"></a>}</span>
<span id="cb98-14"><a href="#cb98-14"></a></span>
<span id="cb98-15"><a href="#cb98-15"></a>canopy_fresponse_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(canopy_seq, canopy_fresponse_df)</span>
<span id="cb98-16"><a href="#cb98-16"></a><span class="fu">colnames</span>(canopy_fresponse_df) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"canopy"</span>, hour)</span>
<span id="cb98-17"><a href="#cb98-17"></a>canopy_fresponse_long <span class="ot">&lt;-</span> <span class="fu">pivot_longer</span>(canopy_fresponse_df, <span class="at">cols =</span> <span class="sc">!</span><span class="dv">1</span>, </span>
<span id="cb98-18"><a href="#cb98-18"></a>                                      <span class="at">names_to =</span> <span class="st">"hour"</span>)</span>
<span id="cb98-19"><a href="#cb98-19"></a></span>
<span id="cb98-20"><a href="#cb98-20"></a>canopy_contour_min <span class="ot">&lt;-</span> <span class="fu">min</span>(canopy_fresponse_long<span class="sc">$</span>value) <span class="co"># 0</span></span>
<span id="cb98-21"><a href="#cb98-21"></a>canopy_contour_max <span class="ot">&lt;-</span> <span class="fu">max</span>(canopy_fresponse_long<span class="sc">$</span>value) <span class="co"># 2.181749</span></span>
<span id="cb98-22"><a href="#cb98-22"></a>canopy_contour_increment <span class="ot">&lt;-</span> (canopy_contour_max<span class="sc">-</span>canopy_contour_min)<span class="sc">/</span><span class="dv">10</span></span>
<span id="cb98-23"><a href="#cb98-23"></a></span>
<span id="cb98-24"><a href="#cb98-24"></a>canopy_quad_2p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> canopy_fresponse_long, </span>
<span id="cb98-25"><a href="#cb98-25"></a>                         <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">as.numeric</span>(hour), <span class="at">y =</span> canopy)) <span class="sc">+</span></span>
<span id="cb98-26"><a href="#cb98-26"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">colour =</span> value)) <span class="sc">+</span></span>
<span id="cb98-27"><a href="#cb98-27"></a>  <span class="fu">geom_contour</span>(<span class="fu">aes</span>(<span class="at">z =</span> value), </span>
<span id="cb98-28"><a href="#cb98-28"></a>               <span class="at">breaks =</span> <span class="fu">seq</span>(canopy_contour_increment, </span>
<span id="cb98-29"><a href="#cb98-29"></a>                            canopy_contour_max, </span>
<span id="cb98-30"><a href="#cb98-30"></a>                            <span class="sc">-</span>canopy_contour_increment), </span>
<span id="cb98-31"><a href="#cb98-31"></a>               <span class="at">colour =</span> <span class="st">"black"</span>, <span class="at">linewidth =</span> <span class="fl">0.25</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb98-32"><a href="#cb98-32"></a>  <span class="fu">geom_contour</span>(<span class="fu">aes</span>(<span class="at">z =</span> value),</span>
<span id="cb98-33"><a href="#cb98-33"></a>               <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="sc">-</span>canopy_contour_increment, </span>
<span id="cb98-34"><a href="#cb98-34"></a>                            canopy_contour_min, </span>
<span id="cb98-35"><a href="#cb98-35"></a>                            <span class="sc">-</span>canopy_contour_increment),</span>
<span id="cb98-36"><a href="#cb98-36"></a>               <span class="at">colour =</span> <span class="st">"red"</span>, <span class="at">linewidth =</span> <span class="fl">0.25</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb98-37"><a href="#cb98-37"></a>  <span class="fu">geom_contour</span>(<span class="fu">aes</span>(<span class="at">z =</span> value), <span class="at">breaks =</span> <span class="dv">0</span>, <span class="at">colour =</span> <span class="st">"black"</span>, <span class="at">linewidth =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb98-38"><a href="#cb98-38"></a>  <span class="fu">scale_x_continuous</span>(<span class="st">"Hour"</span>, <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">24</span>,<span class="dv">6</span>)) <span class="sc">+</span></span>
<span id="cb98-39"><a href="#cb98-39"></a>  <span class="fu">scale_y_continuous</span>(<span class="st">"Canopy cover"</span>, <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.25</span>)) <span class="sc">+</span></span>
<span id="cb98-40"><a href="#cb98-40"></a>  <span class="fu">scale_colour_viridis_c</span>(<span class="st">"Selection"</span>) <span class="sc">+</span></span>
<span id="cb98-41"><a href="#cb98-41"></a>  <span class="co"># ggtitle("Canopy Cover") +</span></span>
<span id="cb98-42"><a href="#cb98-42"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb98-43"><a href="#cb98-43"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span>
<span id="cb98-44"><a href="#cb98-44"></a></span>
<span id="cb98-45"><a href="#cb98-45"></a>canopy_quad_2p</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: `stat_contour()`: Zero contours were generated</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in min(x): no non-missing arguments to min; returning Inf</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in max(x): no non-missing arguments to max; returning -Inf</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ssf_model_fit_id_files/figure-html/unnamed-chunk-55-1.png" class="img-fluid figure-img" width="2100"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-13-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-13-4-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1"></a>canopy_min <span class="ot">&lt;-</span> <span class="fu">min</span>(buffalo_data<span class="sc">$</span>canopy_01, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb102-2"><a href="#cb102-2"></a>canopy_max <span class="ot">&lt;-</span> <span class="fu">max</span>(buffalo_data<span class="sc">$</span>canopy_01, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb102-3"><a href="#cb102-3"></a>canopy_seq <span class="ot">&lt;-</span> <span class="fu">seq</span>(canopy_min, canopy_max, <span class="at">by =</span> <span class="fl">0.01</span>)</span>
<span id="cb102-4"><a href="#cb102-4"></a></span>
<span id="cb102-5"><a href="#cb102-5"></a><span class="co"># Create empty data frame</span></span>
<span id="cb102-6"><a href="#cb102-6"></a>canopy_fresponse_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">matrix</span>(<span class="at">ncol =</span> <span class="fu">nrow</span>(hour_coefs_nat_df_3p), </span>
<span id="cb102-7"><a href="#cb102-7"></a>                                         <span class="at">nrow =</span> <span class="fu">length</span>(canopy_seq)))</span>
<span id="cb102-8"><a href="#cb102-8"></a></span>
<span id="cb102-9"><a href="#cb102-9"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(hour_coefs_nat_df_3p)) {</span>
<span id="cb102-10"><a href="#cb102-10"></a>  <span class="co"># Assign the vector as a column to the dataframe</span></span>
<span id="cb102-11"><a href="#cb102-11"></a>  canopy_fresponse_df[,i] <span class="ot">&lt;-</span> (hour_coefs_nat_df_3p<span class="sc">$</span>canopy[i] <span class="sc">*</span> canopy_seq) <span class="sc">+</span> </span>
<span id="cb102-12"><a href="#cb102-12"></a>    (hour_coefs_nat_df_3p<span class="sc">$</span>canopy_2[i] <span class="sc">*</span> (canopy_seq <span class="sc">^</span> <span class="dv">2</span>))</span>
<span id="cb102-13"><a href="#cb102-13"></a>}</span>
<span id="cb102-14"><a href="#cb102-14"></a></span>
<span id="cb102-15"><a href="#cb102-15"></a>canopy_fresponse_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(canopy_seq, canopy_fresponse_df)</span>
<span id="cb102-16"><a href="#cb102-16"></a><span class="fu">colnames</span>(canopy_fresponse_df) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"canopy"</span>, hour)</span>
<span id="cb102-17"><a href="#cb102-17"></a>canopy_fresponse_long <span class="ot">&lt;-</span> <span class="fu">pivot_longer</span>(canopy_fresponse_df, <span class="at">cols =</span> <span class="sc">!</span><span class="dv">1</span>, </span>
<span id="cb102-18"><a href="#cb102-18"></a>                                      <span class="at">names_to =</span> <span class="st">"hour"</span>)</span>
<span id="cb102-19"><a href="#cb102-19"></a></span>
<span id="cb102-20"><a href="#cb102-20"></a>canopy_contour_min <span class="ot">&lt;-</span> <span class="fu">min</span>(canopy_fresponse_long<span class="sc">$</span>value) <span class="co"># 0</span></span>
<span id="cb102-21"><a href="#cb102-21"></a>canopy_contour_max <span class="ot">&lt;-</span> <span class="fu">max</span>(canopy_fresponse_long<span class="sc">$</span>value) <span class="co"># 2.181749</span></span>
<span id="cb102-22"><a href="#cb102-22"></a>canopy_contour_increment <span class="ot">&lt;-</span> (canopy_contour_max<span class="sc">-</span>canopy_contour_min)<span class="sc">/</span><span class="dv">10</span></span>
<span id="cb102-23"><a href="#cb102-23"></a></span>
<span id="cb102-24"><a href="#cb102-24"></a>canopy_quad_3p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> canopy_fresponse_long, </span>
<span id="cb102-25"><a href="#cb102-25"></a>                         <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">as.numeric</span>(hour), <span class="at">y =</span> canopy)) <span class="sc">+</span></span>
<span id="cb102-26"><a href="#cb102-26"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">colour =</span> value)) <span class="sc">+</span></span>
<span id="cb102-27"><a href="#cb102-27"></a>  <span class="fu">geom_contour</span>(<span class="fu">aes</span>(<span class="at">z =</span> value), </span>
<span id="cb102-28"><a href="#cb102-28"></a>               <span class="at">breaks =</span> <span class="fu">seq</span>(canopy_contour_increment, </span>
<span id="cb102-29"><a href="#cb102-29"></a>                            canopy_contour_max, </span>
<span id="cb102-30"><a href="#cb102-30"></a>                            canopy_contour_increment), </span>
<span id="cb102-31"><a href="#cb102-31"></a>               <span class="at">colour =</span> <span class="st">"black"</span>, <span class="at">linewidth =</span> <span class="fl">0.25</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb102-32"><a href="#cb102-32"></a>  <span class="fu">geom_contour</span>(<span class="fu">aes</span>(<span class="at">z =</span> value),</span>
<span id="cb102-33"><a href="#cb102-33"></a>               <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="sc">-</span>canopy_contour_increment, </span>
<span id="cb102-34"><a href="#cb102-34"></a>                            canopy_contour_min, </span>
<span id="cb102-35"><a href="#cb102-35"></a>                            <span class="sc">-</span>canopy_contour_increment),</span>
<span id="cb102-36"><a href="#cb102-36"></a>               <span class="at">colour =</span> <span class="st">"red"</span>, <span class="at">linewidth =</span> <span class="fl">0.25</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb102-37"><a href="#cb102-37"></a>  <span class="fu">geom_contour</span>(<span class="fu">aes</span>(<span class="at">z =</span> value), <span class="at">breaks =</span> <span class="dv">0</span>, <span class="at">colour =</span> <span class="st">"black"</span>, <span class="at">linewidth =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb102-38"><a href="#cb102-38"></a>  <span class="fu">scale_x_continuous</span>(<span class="st">"Hour"</span>, <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">24</span>,<span class="dv">6</span>)) <span class="sc">+</span></span>
<span id="cb102-39"><a href="#cb102-39"></a>  <span class="fu">scale_y_continuous</span>(<span class="st">"Canopy cover"</span>, <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.25</span>)) <span class="sc">+</span></span>
<span id="cb102-40"><a href="#cb102-40"></a>  <span class="fu">scale_colour_viridis_c</span>(<span class="st">"Selection"</span>) <span class="sc">+</span></span>
<span id="cb102-41"><a href="#cb102-41"></a>  <span class="co"># ggtitle("Canopy Cover", </span></span>
<span id="cb102-42"><a href="#cb102-42"></a>  <span class="co">#         subtitle = "Three pairs of harmonics") +</span></span>
<span id="cb102-43"><a href="#cb102-43"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb102-44"><a href="#cb102-44"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span>
<span id="cb102-45"><a href="#cb102-45"></a></span>
<span id="cb102-46"><a href="#cb102-46"></a>canopy_quad_3p</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ssf_model_fit_id_files/figure-html/unnamed-chunk-56-1.png" class="img-fluid figure-img" width="2100"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
</section>
</section>
<section id="combining-the-plots" class="level1">
<h1>Combining the plots</h1>
<section id="movement-parameters" class="level2">
<h2 class="anchored" data-anchor-id="movement-parameters">Movement parameters</h2>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1"></a>gamma_df <span class="ot">&lt;-</span> <span class="fu">rbind</span>(gamma_df_0p, gamma_df_1p, gamma_df_2p, gamma_df_3p)</span>
<span id="cb103-2"><a href="#cb103-2"></a>gamma_df <span class="ot">&lt;-</span> gamma_df <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">model_f =</span> <span class="fu">as.numeric</span>(<span class="fu">factor</span>(model)))</span>
<span id="cb103-3"><a href="#cb103-3"></a></span>
<span id="cb103-4"><a href="#cb103-4"></a>mean_sl <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb103-5"><a href="#cb103-5"></a>  <span class="fu">geom_path</span>(<span class="at">data =</span> movement_summary_buffalo, </span>
<span id="cb103-6"><a href="#cb103-6"></a>            <span class="fu">aes</span>(<span class="at">x =</span> hour, <span class="at">y =</span> mean_sl, <span class="at">group =</span> <span class="fu">factor</span>(id)), </span>
<span id="cb103-7"><a href="#cb103-7"></a>            <span class="at">alpha =</span> <span class="fl">0.25</span>) <span class="sc">+</span></span>
<span id="cb103-8"><a href="#cb103-8"></a>  <span class="fu">geom_path</span>(<span class="at">data =</span> gamma_df, <span class="fu">aes</span>(<span class="at">x =</span> hour, <span class="at">y =</span> mean, <span class="at">linetype =</span> model)) <span class="sc">+</span></span>
<span id="cb103-9"><a href="#cb103-9"></a>  <span class="fu">scale_x_continuous</span>(<span class="st">"Hour"</span>, <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">24</span>,<span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb103-10"><a href="#cb103-10"></a>  <span class="fu">scale_y_continuous</span>(<span class="st">"Mean step length"</span>) <span class="sc">+</span></span>
<span id="cb103-11"><a href="#cb103-11"></a>  <span class="fu">scale_linetype_manual</span>(<span class="st">"Model"</span>, <span class="at">breaks=</span><span class="fu">c</span>(<span class="st">"0p"</span>,<span class="st">"1p"</span>, <span class="st">"2p"</span>, <span class="st">"3p"</span>), </span>
<span id="cb103-12"><a href="#cb103-12"></a>                        <span class="at">values=</span><span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">3</span>,<span class="dv">2</span>,<span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb103-13"><a href="#cb103-13"></a>  <span class="fu">ggtitle</span>(<span class="st">"Observed and modelled mean step length"</span>) <span class="sc">+</span></span>
<span id="cb103-14"><a href="#cb103-14"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb103-15"><a href="#cb103-15"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span>
<span id="cb103-16"><a href="#cb103-16"></a></span>
<span id="cb103-17"><a href="#cb103-17"></a>mean_sl</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ssf_model_fit_id_files/figure-html/unnamed-chunk-57-1.png" class="img-fluid figure-img" width="2100"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1"></a><span class="co"># ggsave(paste0("outputs/plots/manuscript_figs_R1/mean_sl_", </span></span>
<span id="cb104-2"><a href="#cb104-2"></a><span class="co">#          Sys.Date(), ".png"),</span></span>
<span id="cb104-3"><a href="#cb104-3"></a><span class="co">#   width=150, height=90, units="mm", dpi = 1000)</span></span>
<span id="cb104-4"><a href="#cb104-4"></a></span>
<span id="cb104-5"><a href="#cb104-5"></a>median_sl <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb104-6"><a href="#cb104-6"></a>  <span class="fu">geom_path</span>(<span class="at">data =</span> movement_summary_buffalo, </span>
<span id="cb104-7"><a href="#cb104-7"></a>            <span class="fu">aes</span>(<span class="at">x =</span> hour, <span class="at">y =</span> median_sl, <span class="at">group =</span> <span class="fu">factor</span>(id)), </span>
<span id="cb104-8"><a href="#cb104-8"></a>            <span class="at">alpha =</span> <span class="fl">0.25</span>) <span class="sc">+</span></span>
<span id="cb104-9"><a href="#cb104-9"></a>  <span class="fu">geom_path</span>(<span class="at">data =</span> gamma_df, <span class="fu">aes</span>(<span class="at">x =</span> hour, <span class="at">y =</span> median, <span class="at">linetype =</span> model)) <span class="sc">+</span></span>
<span id="cb104-10"><a href="#cb104-10"></a>  <span class="fu">scale_x_continuous</span>(<span class="st">"Hour"</span>, <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">24</span>,<span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb104-11"><a href="#cb104-11"></a>  <span class="fu">scale_y_continuous</span>(<span class="st">"Median step length"</span>) <span class="sc">+</span></span>
<span id="cb104-12"><a href="#cb104-12"></a>  <span class="fu">scale_linetype_manual</span>(<span class="st">"Model"</span>, <span class="at">breaks=</span><span class="fu">c</span>(<span class="st">"0p"</span>,<span class="st">"1p"</span>, <span class="st">"2p"</span>, <span class="st">"3p"</span>), </span>
<span id="cb104-13"><a href="#cb104-13"></a>                        <span class="at">values=</span><span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">3</span>,<span class="dv">2</span>,<span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb104-14"><a href="#cb104-14"></a>  <span class="fu">ggtitle</span>(<span class="st">"Observed and modelled median step length"</span>) <span class="sc">+</span></span>
<span id="cb104-15"><a href="#cb104-15"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb104-16"><a href="#cb104-16"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span>
<span id="cb104-17"><a href="#cb104-17"></a></span>
<span id="cb104-18"><a href="#cb104-18"></a>median_sl</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ssf_model_fit_id_files/figure-html/unnamed-chunk-57-2.png" class="img-fluid figure-img" width="2100"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1"></a><span class="co"># ggsave(paste0("outputs/plots/manuscript_figs_R1/median_sl_", </span></span>
<span id="cb105-2"><a href="#cb105-2"></a><span class="co">#          Sys.Date(), ".png"),</span></span>
<span id="cb105-3"><a href="#cb105-3"></a><span class="co">#   width=150, height=90, units="mm", dpi = 1000)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="habitat-selection" class="level2">
<h2 class="anchored" data-anchor-id="habitat-selection">Habitat selection</h2>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1"></a>harmonics_scaled_long_0p <span class="ot">&lt;-</span> harmonics_scaled_long_0p <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">model =</span> <span class="st">"0p"</span>)</span>
<span id="cb106-2"><a href="#cb106-2"></a>harmonics_scaled_long_1p <span class="ot">&lt;-</span> harmonics_scaled_long_1p <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">model =</span> <span class="st">"1p"</span>)</span>
<span id="cb106-3"><a href="#cb106-3"></a>harmonics_scaled_long_2p <span class="ot">&lt;-</span> harmonics_scaled_long_2p <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">model =</span> <span class="st">"2p"</span>)</span>
<span id="cb106-4"><a href="#cb106-4"></a>harmonics_scaled_long_3p <span class="ot">&lt;-</span> harmonics_scaled_long_3p <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">model =</span> <span class="st">"3p"</span>)</span>
<span id="cb106-5"><a href="#cb106-5"></a></span>
<span id="cb106-6"><a href="#cb106-6"></a>harmonics_scaled_long_Mp <span class="ot">&lt;-</span> <span class="fu">rbind</span>(harmonics_scaled_long_0p, </span>
<span id="cb106-7"><a href="#cb106-7"></a>                                  harmonics_scaled_long_1p, </span>
<span id="cb106-8"><a href="#cb106-8"></a>                                  harmonics_scaled_long_2p, </span>
<span id="cb106-9"><a href="#cb106-9"></a>                                  harmonics_scaled_long_3p)</span>
<span id="cb106-10"><a href="#cb106-10"></a></span>
<span id="cb106-11"><a href="#cb106-11"></a>coef_titles <span class="ot">&lt;-</span> <span class="fu">unique</span>(harmonics_scaled_long_Mp<span class="sc">$</span>coef)</span>
<span id="cb106-12"><a href="#cb106-12"></a></span>
<span id="cb106-13"><a href="#cb106-13"></a></span>
<span id="cb106-14"><a href="#cb106-14"></a>ndvi_harms <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb106-15"><a href="#cb106-15"></a>      <span class="fu">geom_path</span>(<span class="at">data =</span> harmonics_scaled_long_Mp <span class="sc">%&gt;%</span></span>
<span id="cb106-16"><a href="#cb106-16"></a>                <span class="fu">filter</span>(coef <span class="sc">==</span> <span class="st">"ndvi"</span>), </span>
<span id="cb106-17"><a href="#cb106-17"></a>                <span class="fu">aes</span>(<span class="at">x =</span> hour, <span class="at">y =</span> value, <span class="at">linetype =</span> model)) <span class="sc">+</span></span>
<span id="cb106-18"><a href="#cb106-18"></a>      <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">colour =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb106-19"><a href="#cb106-19"></a>      <span class="fu">scale_y_continuous</span>(<span class="fu">expression</span>(beta)) <span class="sc">+</span></span>
<span id="cb106-20"><a href="#cb106-20"></a>      <span class="fu">scale_x_continuous</span>(<span class="st">"Hour"</span>) <span class="sc">+</span></span>
<span id="cb106-21"><a href="#cb106-21"></a>  <span class="fu">scale_linetype_manual</span>(<span class="st">"Model"</span>, <span class="at">breaks=</span><span class="fu">c</span>(<span class="st">"0p"</span>,<span class="st">"1p"</span>, <span class="st">"2p"</span>, <span class="st">"3p"</span>), </span>
<span id="cb106-22"><a href="#cb106-22"></a>                        <span class="at">values=</span><span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">3</span>,<span class="dv">2</span>,<span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb106-23"><a href="#cb106-23"></a>      <span class="fu">ggtitle</span>(<span class="st">"NDVI"</span>) <span class="sc">+</span></span>
<span id="cb106-24"><a href="#cb106-24"></a>      <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb106-25"><a href="#cb106-25"></a>      <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span>
<span id="cb106-26"><a href="#cb106-26"></a></span>
<span id="cb106-27"><a href="#cb106-27"></a>ndvi_harms</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ssf_model_fit_id_files/figure-html/unnamed-chunk-58-1.png" class="img-fluid figure-img" width="2100"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1"></a>ndvi_2_harms <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb107-2"><a href="#cb107-2"></a>      <span class="fu">geom_path</span>(<span class="at">data =</span> harmonics_scaled_long_Mp <span class="sc">%&gt;%</span></span>
<span id="cb107-3"><a href="#cb107-3"></a>                <span class="fu">filter</span>(coef <span class="sc">==</span> <span class="st">"ndvi_2"</span>), </span>
<span id="cb107-4"><a href="#cb107-4"></a>                <span class="fu">aes</span>(<span class="at">x =</span> hour, <span class="at">y =</span> value, <span class="at">linetype =</span> model)) <span class="sc">+</span></span>
<span id="cb107-5"><a href="#cb107-5"></a>      <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">colour =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb107-6"><a href="#cb107-6"></a>      <span class="fu">scale_y_continuous</span>(<span class="fu">expression</span>(beta)) <span class="sc">+</span></span>
<span id="cb107-7"><a href="#cb107-7"></a>      <span class="fu">scale_x_continuous</span>(<span class="st">"Hour"</span>) <span class="sc">+</span></span>
<span id="cb107-8"><a href="#cb107-8"></a>  <span class="fu">scale_linetype_manual</span>(<span class="st">"Model"</span>, <span class="at">breaks=</span><span class="fu">c</span>(<span class="st">"0p"</span>,<span class="st">"1p"</span>, <span class="st">"2p"</span>, <span class="st">"3p"</span>), </span>
<span id="cb107-9"><a href="#cb107-9"></a>                        <span class="at">values=</span><span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">3</span>,<span class="dv">2</span>,<span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb107-10"><a href="#cb107-10"></a>      <span class="fu">ggtitle</span>(<span class="fu">expression</span>(NDVI<span class="sc">^</span><span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb107-11"><a href="#cb107-11"></a>      <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb107-12"><a href="#cb107-12"></a>      <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span>
<span id="cb107-13"><a href="#cb107-13"></a></span>
<span id="cb107-14"><a href="#cb107-14"></a>ndvi_2_harms</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ssf_model_fit_id_files/figure-html/unnamed-chunk-58-2.png" class="img-fluid figure-img" width="2100"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1"></a>canopy_harms <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb108-2"><a href="#cb108-2"></a>      <span class="fu">geom_path</span>(<span class="at">data =</span> harmonics_scaled_long_Mp <span class="sc">%&gt;%</span></span>
<span id="cb108-3"><a href="#cb108-3"></a>                <span class="fu">filter</span>(coef <span class="sc">==</span> <span class="st">"canopy"</span>), </span>
<span id="cb108-4"><a href="#cb108-4"></a>                <span class="fu">aes</span>(<span class="at">x =</span> hour, <span class="at">y =</span> value, <span class="at">linetype =</span> model)) <span class="sc">+</span></span>
<span id="cb108-5"><a href="#cb108-5"></a>      <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">colour =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb108-6"><a href="#cb108-6"></a>      <span class="fu">scale_y_continuous</span>(<span class="fu">expression</span>(beta)) <span class="sc">+</span></span>
<span id="cb108-7"><a href="#cb108-7"></a>      <span class="fu">scale_x_continuous</span>(<span class="st">"Hour"</span>) <span class="sc">+</span></span>
<span id="cb108-8"><a href="#cb108-8"></a>  <span class="fu">scale_linetype_manual</span>(<span class="st">"Model"</span>, <span class="at">breaks=</span><span class="fu">c</span>(<span class="st">"0p"</span>,<span class="st">"1p"</span>, <span class="st">"2p"</span>, <span class="st">"3p"</span>), </span>
<span id="cb108-9"><a href="#cb108-9"></a>                        <span class="at">values=</span><span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">3</span>,<span class="dv">2</span>,<span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb108-10"><a href="#cb108-10"></a>      <span class="fu">ggtitle</span>(<span class="st">"Canopy cover"</span>) <span class="sc">+</span></span>
<span id="cb108-11"><a href="#cb108-11"></a>      <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb108-12"><a href="#cb108-12"></a>      <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span>
<span id="cb108-13"><a href="#cb108-13"></a></span>
<span id="cb108-14"><a href="#cb108-14"></a>canopy_harms</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ssf_model_fit_id_files/figure-html/unnamed-chunk-58-3.png" class="img-fluid figure-img" width="2100"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb109-1"><a href="#cb109-1"></a>canopy_2_harms <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb109-2"><a href="#cb109-2"></a>      <span class="fu">geom_path</span>(<span class="at">data =</span> harmonics_scaled_long_Mp <span class="sc">%&gt;%</span></span>
<span id="cb109-3"><a href="#cb109-3"></a>                <span class="fu">filter</span>(coef <span class="sc">==</span> <span class="st">"canopy_2"</span>), </span>
<span id="cb109-4"><a href="#cb109-4"></a>                <span class="fu">aes</span>(<span class="at">x =</span> hour, <span class="at">y =</span> value, <span class="at">linetype =</span> model)) <span class="sc">+</span></span>
<span id="cb109-5"><a href="#cb109-5"></a>      <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">colour =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb109-6"><a href="#cb109-6"></a>      <span class="fu">scale_y_continuous</span>(<span class="fu">expression</span>(beta)) <span class="sc">+</span></span>
<span id="cb109-7"><a href="#cb109-7"></a>      <span class="fu">scale_x_continuous</span>(<span class="st">"Hour"</span>) <span class="sc">+</span></span>
<span id="cb109-8"><a href="#cb109-8"></a>  <span class="fu">scale_linetype_manual</span>(<span class="st">"Model"</span>, <span class="at">breaks=</span><span class="fu">c</span>(<span class="st">"0p"</span>,<span class="st">"1p"</span>, <span class="st">"2p"</span>, <span class="st">"3p"</span>), </span>
<span id="cb109-9"><a href="#cb109-9"></a>                        <span class="at">values=</span><span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">3</span>,<span class="dv">2</span>,<span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb109-10"><a href="#cb109-10"></a>      <span class="fu">ggtitle</span>(<span class="fu">expression</span>(Canopy<span class="sc">~</span>cover<span class="sc">^</span><span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb109-11"><a href="#cb109-11"></a>      <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb109-12"><a href="#cb109-12"></a>      <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span>
<span id="cb109-13"><a href="#cb109-13"></a></span>
<span id="cb109-14"><a href="#cb109-14"></a>canopy_2_harms</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ssf_model_fit_id_files/figure-html/unnamed-chunk-58-4.png" class="img-fluid figure-img" width="2100"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1"></a>herby_harms <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb110-2"><a href="#cb110-2"></a>      <span class="fu">geom_path</span>(<span class="at">data =</span> harmonics_scaled_long_Mp <span class="sc">%&gt;%</span></span>
<span id="cb110-3"><a href="#cb110-3"></a>                <span class="fu">filter</span>(coef <span class="sc">==</span> <span class="st">"herby"</span>), </span>
<span id="cb110-4"><a href="#cb110-4"></a>                <span class="fu">aes</span>(<span class="at">x =</span> hour, <span class="at">y =</span> value, <span class="at">linetype =</span> model)) <span class="sc">+</span></span>
<span id="cb110-5"><a href="#cb110-5"></a>      <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">colour =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb110-6"><a href="#cb110-6"></a>      <span class="fu">scale_y_continuous</span>(<span class="fu">expression</span>(beta), <span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.4</span>,<span class="fl">0.15</span>)) <span class="sc">+</span></span>
<span id="cb110-7"><a href="#cb110-7"></a>      <span class="fu">scale_x_continuous</span>(<span class="st">"Hour"</span>) <span class="sc">+</span></span>
<span id="cb110-8"><a href="#cb110-8"></a>  <span class="fu">scale_linetype_manual</span>(<span class="st">"Model"</span>, <span class="at">breaks=</span><span class="fu">c</span>(<span class="st">"0p"</span>,<span class="st">"1p"</span>, <span class="st">"2p"</span>, <span class="st">"3p"</span>), </span>
<span id="cb110-9"><a href="#cb110-9"></a>                        <span class="at">values=</span><span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">3</span>,<span class="dv">2</span>,<span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb110-10"><a href="#cb110-10"></a>      <span class="fu">ggtitle</span>(<span class="st">"Herbaceous vegetation"</span>) <span class="sc">+</span></span>
<span id="cb110-11"><a href="#cb110-11"></a>      <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb110-12"><a href="#cb110-12"></a>      <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span>
<span id="cb110-13"><a href="#cb110-13"></a></span>
<span id="cb110-14"><a href="#cb110-14"></a>herby_harms</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ssf_model_fit_id_files/figure-html/unnamed-chunk-58-5.png" class="img-fluid figure-img" width="2100"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb111-1"><a href="#cb111-1"></a>slope_harms <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb111-2"><a href="#cb111-2"></a>      <span class="fu">geom_path</span>(<span class="at">data =</span> harmonics_scaled_long_Mp <span class="sc">%&gt;%</span></span>
<span id="cb111-3"><a href="#cb111-3"></a>                <span class="fu">filter</span>(coef <span class="sc">==</span> <span class="st">"slope"</span>), </span>
<span id="cb111-4"><a href="#cb111-4"></a>                <span class="fu">aes</span>(<span class="at">x =</span> hour, <span class="at">y =</span> value, <span class="at">linetype =</span> model)) <span class="sc">+</span></span>
<span id="cb111-5"><a href="#cb111-5"></a>      <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">colour =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb111-6"><a href="#cb111-6"></a>      <span class="fu">scale_y_continuous</span>(<span class="fu">expression</span>(beta), <span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.4</span>,<span class="fl">0.15</span>)) <span class="sc">+</span></span>
<span id="cb111-7"><a href="#cb111-7"></a>      <span class="fu">scale_x_continuous</span>(<span class="st">"Hour"</span>) <span class="sc">+</span></span>
<span id="cb111-8"><a href="#cb111-8"></a>  <span class="fu">scale_linetype_manual</span>(<span class="st">"Model"</span>, <span class="at">breaks=</span><span class="fu">c</span>(<span class="st">"0p"</span>,<span class="st">"1p"</span>, <span class="st">"2p"</span>, <span class="st">"3p"</span>),</span>
<span id="cb111-9"><a href="#cb111-9"></a>                        <span class="at">values=</span><span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">3</span>,<span class="dv">2</span>,<span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb111-10"><a href="#cb111-10"></a>      <span class="fu">ggtitle</span>(<span class="st">"Slope"</span>) <span class="sc">+</span></span>
<span id="cb111-11"><a href="#cb111-11"></a>      <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb111-12"><a href="#cb111-12"></a>      <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span>
<span id="cb111-13"><a href="#cb111-13"></a></span>
<span id="cb111-14"><a href="#cb111-14"></a>slope_harms</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ssf_model_fit_id_files/figure-html/unnamed-chunk-58-6.png" class="img-fluid figure-img" width="2100"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1"></a><span class="fu">ggarrange</span>(herby_harms, </span>
<span id="cb112-2"><a href="#cb112-2"></a>          slope_harms, </span>
<span id="cb112-3"><a href="#cb112-3"></a>          <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"A"</span>, <span class="st">"B"</span>), </span>
<span id="cb112-4"><a href="#cb112-4"></a>          <span class="at">ncol =</span> <span class="dv">2</span>, <span class="at">nrow =</span> <span class="dv">1</span>,</span>
<span id="cb112-5"><a href="#cb112-5"></a>          <span class="at">align =</span> <span class="st">"hv"</span>,</span>
<span id="cb112-6"><a href="#cb112-6"></a>          <span class="at">legend =</span> <span class="st">"bottom"</span>, </span>
<span id="cb112-7"><a href="#cb112-7"></a>          <span class="at">common.legend =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ssf_model_fit_id_files/figure-html/unnamed-chunk-58-7.png" class="img-fluid figure-img" width="2100"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb113-1"><a href="#cb113-1"></a><span class="co"># ggsave(paste0("outputs/plots/manuscript_figs_R1/herby_slope_harmonic_functions_", </span></span>
<span id="cb113-2"><a href="#cb113-2"></a><span class="co">#          Sys.Date(), ".png"),</span></span>
<span id="cb113-3"><a href="#cb113-3"></a><span class="co">#   width=150, height=90, units="mm", dpi = 1000)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="combining-selection-surfaces" class="level1">
<h1>Combining selection surfaces</h1>
<section id="ndvi" class="level2">
<h2 class="anchored" data-anchor-id="ndvi">NDVI</h2>
<ul>
<li>A = 0p model</li>
<li>B = 1p model</li>
<li>C = 2p model</li>
<li>D = 3p model</li>
</ul>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1"></a><span class="fu">ggarrange</span>(ndvi_quad_0p <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb114-2"><a href="#cb114-2"></a>                               <span class="at">axis.title.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb114-3"><a href="#cb114-3"></a>                               <span class="at">axis.text.x =</span> <span class="fu">element_blank</span>()), </span>
<span id="cb114-4"><a href="#cb114-4"></a>          </span>
<span id="cb114-5"><a href="#cb114-5"></a>          ndvi_quad_1p <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_blank</span>(), </span>
<span id="cb114-6"><a href="#cb114-6"></a>                               <span class="at">axis.title.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb114-7"><a href="#cb114-7"></a>                               <span class="at">axis.text.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb114-8"><a href="#cb114-8"></a>                               <span class="at">axis.title.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb114-9"><a href="#cb114-9"></a>                               ), </span>
<span id="cb114-10"><a href="#cb114-10"></a>          </span>
<span id="cb114-11"><a href="#cb114-11"></a>          ndvi_quad_2p, </span>
<span id="cb114-12"><a href="#cb114-12"></a>          </span>
<span id="cb114-13"><a href="#cb114-13"></a>          ndvi_quad_3p <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_blank</span>(), </span>
<span id="cb114-14"><a href="#cb114-14"></a>                               <span class="at">axis.title.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb114-15"><a href="#cb114-15"></a>                               ),</span>
<span id="cb114-16"><a href="#cb114-16"></a>          </span>
<span id="cb114-17"><a href="#cb114-17"></a>          <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"A"</span>, <span class="st">"B"</span>, <span class="st">"C"</span>, <span class="st">"D"</span>),</span>
<span id="cb114-18"><a href="#cb114-18"></a>          <span class="at">ncol =</span> <span class="dv">2</span>, <span class="at">nrow =</span> <span class="dv">2</span>,</span>
<span id="cb114-19"><a href="#cb114-19"></a>          <span class="at">legend =</span> <span class="st">"none"</span>,</span>
<span id="cb114-20"><a href="#cb114-20"></a>          <span class="at">common.legend =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ssf_model_fit_id_files/figure-html/unnamed-chunk-59-1.png" class="img-fluid figure-img" width="2100"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb115-1"><a href="#cb115-1"></a><span class="co"># ggsave(paste0("outputs/plots/manuscript_figs_R1/",</span></span>
<span id="cb115-2"><a href="#cb115-2"></a><span class="co">#               "NDVI_2x2_CLR_TS_daily_GvM_10rs_", </span></span>
<span id="cb115-3"><a href="#cb115-3"></a><span class="co">#          Sys.Date(), ".png"),</span></span>
<span id="cb115-4"><a href="#cb115-4"></a><span class="co">#   width=150, height=120, units="mm", dpi = 1000)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="canopy-cover" class="level2">
<h2 class="anchored" data-anchor-id="canopy-cover">Canopy cover</h2>
<ul>
<li>A = 0p model</li>
<li>B = 1p model</li>
<li>C = 2p model</li>
<li>D = 3p model</li>
</ul>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb116-1"><a href="#cb116-1"></a><span class="fu">ggarrange</span>(canopy_quad_0p <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb116-2"><a href="#cb116-2"></a>                               <span class="at">axis.title.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb116-3"><a href="#cb116-3"></a>                               <span class="at">axis.text.x =</span> <span class="fu">element_blank</span>()), </span>
<span id="cb116-4"><a href="#cb116-4"></a>          </span>
<span id="cb116-5"><a href="#cb116-5"></a>          canopy_quad_1p <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_blank</span>(), </span>
<span id="cb116-6"><a href="#cb116-6"></a>                               <span class="at">axis.title.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb116-7"><a href="#cb116-7"></a>                               <span class="at">axis.text.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb116-8"><a href="#cb116-8"></a>                               <span class="at">axis.title.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb116-9"><a href="#cb116-9"></a>                               ), </span>
<span id="cb116-10"><a href="#cb116-10"></a>          </span>
<span id="cb116-11"><a href="#cb116-11"></a>          canopy_quad_2p, </span>
<span id="cb116-12"><a href="#cb116-12"></a>          </span>
<span id="cb116-13"><a href="#cb116-13"></a>          canopy_quad_3p <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_blank</span>(), </span>
<span id="cb116-14"><a href="#cb116-14"></a>                               <span class="at">axis.title.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb116-15"><a href="#cb116-15"></a>                               ),</span>
<span id="cb116-16"><a href="#cb116-16"></a>          </span>
<span id="cb116-17"><a href="#cb116-17"></a>          <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"A"</span>, <span class="st">"B"</span>, <span class="st">"C"</span>, <span class="st">"D"</span>),</span>
<span id="cb116-18"><a href="#cb116-18"></a>          <span class="at">ncol =</span> <span class="dv">2</span>, <span class="at">nrow =</span> <span class="dv">2</span>,</span>
<span id="cb116-19"><a href="#cb116-19"></a>          <span class="at">legend =</span> <span class="st">"none"</span>,</span>
<span id="cb116-20"><a href="#cb116-20"></a>          <span class="at">common.legend =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: `stat_contour()`: Zero contours were generated</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in min(x): no non-missing arguments to min; returning Inf</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in max(x): no non-missing arguments to max; returning -Inf</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: `stat_contour()`: Zero contours were generated</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in min(x): no non-missing arguments to min; returning Inf</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in max(x): no non-missing arguments to max; returning -Inf</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: `stat_contour()`: Zero contours were generated</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in min(x): no non-missing arguments to min; returning Inf</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in max(x): no non-missing arguments to max; returning -Inf</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: `stat_contour()`: Zero contours were generated</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in min(x): no non-missing arguments to min; returning Inf</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in max(x): no non-missing arguments to max; returning -Inf</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ssf_model_fit_id_files/figure-html/unnamed-chunk-60-1.png" class="img-fluid figure-img" width="2100"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb129"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb129-1"><a href="#cb129-1"></a><span class="co"># ggsave(paste0("outputs/plots/manuscript_figs_R1/",</span></span>
<span id="cb129-2"><a href="#cb129-2"></a><span class="co">#               "canopy_2x2_CLR_TS_daily_GvM_10rs_", </span></span>
<span id="cb129-3"><a href="#cb129-3"></a><span class="co">#          Sys.Date(), ".png"),</span></span>
<span id="cb129-4"><a href="#cb129-4"></a><span class="co">#   width=150, height=120, units="mm", dpi = 1000)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="adding-all-selection-surfaces-to-the-same-plot" class="level1">
<h1>Adding all selection surfaces to the same plot</h1>
<p>We combine these plots into the plot that is in the paper. On the top is the <strong>NDVI</strong> selection surface, and on the bottom is the <strong>canopy cover</strong> selection surface.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset" data-group="model">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-14-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-14-1" role="tab" aria-controls="tabset-14-1" aria-selected="true">0p</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-14-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-14-2" role="tab" aria-controls="tabset-14-2" aria-selected="false">1p</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-14-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-14-3" role="tab" aria-controls="tabset-14-3" aria-selected="false">2p</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-14-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-14-4" role="tab" aria-controls="tabset-14-4" aria-selected="false">3p</a></li></ul>
<div class="tab-content" data-group="model">
<div id="tabset-14-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-14-1-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb130"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb130-1"><a href="#cb130-1"></a>surface_plots_0p <span class="ot">&lt;-</span> <span class="fu">ggarrange</span>(ndvi_quad_0p <span class="sc">+</span> </span>
<span id="cb130-2"><a href="#cb130-2"></a>            <span class="fu">ggtitle</span>(<span class="st">"0p"</span>) <span class="sc">+</span></span>
<span id="cb130-3"><a href="#cb130-3"></a>            <span class="fu">theme</span>(<span class="at">axis.title.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb130-4"><a href="#cb130-4"></a>                  <span class="at">axis.text.x =</span> <span class="fu">element_blank</span>()), </span>
<span id="cb130-5"><a href="#cb130-5"></a>          </span>
<span id="cb130-6"><a href="#cb130-6"></a>          canopy_quad_0p <span class="sc">+</span>  </span>
<span id="cb130-7"><a href="#cb130-7"></a>            <span class="fu">scale_x_continuous</span>(<span class="st">"Hour"</span>, <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">12</span>,<span class="dv">24</span>)) <span class="sc">+</span></span>
<span id="cb130-8"><a href="#cb130-8"></a>            <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_blank</span>()), </span>
<span id="cb130-9"><a href="#cb130-9"></a>         </span>
<span id="cb130-10"><a href="#cb130-10"></a>          <span class="at">ncol =</span> <span class="dv">1</span>, <span class="at">nrow =</span> <span class="dv">2</span>,</span>
<span id="cb130-11"><a href="#cb130-11"></a>          <span class="at">align =</span> <span class="st">"v"</span>,</span>
<span id="cb130-12"><a href="#cb130-12"></a>          <span class="at">legend =</span> <span class="st">"none"</span>,</span>
<span id="cb130-13"><a href="#cb130-13"></a>          <span class="at">common.legend =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Scale for x is already present.
Adding another scale for x, which will replace the existing scale.</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb132"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb132-1"><a href="#cb132-1"></a>surface_plots_0p</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ssf_model_fit_id_files/figure-html/unnamed-chunk-61-1.png" class="img-fluid figure-img" width="2100"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-14-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-14-2-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb133"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb133-1"><a href="#cb133-1"></a>surface_plots_1p <span class="ot">&lt;-</span> <span class="fu">ggarrange</span>(ndvi_quad_1p <span class="sc">+</span> </span>
<span id="cb133-2"><a href="#cb133-2"></a>            <span class="fu">ggtitle</span>(<span class="st">"1p"</span>) <span class="sc">+</span></span>
<span id="cb133-3"><a href="#cb133-3"></a>            <span class="fu">theme</span>(<span class="at">axis.title.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb133-4"><a href="#cb133-4"></a>                  <span class="at">axis.text.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb133-5"><a href="#cb133-5"></a>                  <span class="at">axis.title.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb133-6"><a href="#cb133-6"></a>                  <span class="at">axis.text.y =</span> <span class="fu">element_blank</span>()), </span>
<span id="cb133-7"><a href="#cb133-7"></a>          </span>
<span id="cb133-8"><a href="#cb133-8"></a>          canopy_quad_1p <span class="sc">+</span> </span>
<span id="cb133-9"><a href="#cb133-9"></a>            <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_blank</span>(), </span>
<span id="cb133-10"><a href="#cb133-10"></a>                  <span class="at">axis.title.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb133-11"><a href="#cb133-11"></a>                  <span class="at">axis.text.y =</span> <span class="fu">element_blank</span>()),</span>
<span id="cb133-12"><a href="#cb133-12"></a>          </span>
<span id="cb133-13"><a href="#cb133-13"></a>          <span class="at">ncol =</span> <span class="dv">1</span>, <span class="at">nrow =</span> <span class="dv">2</span>,</span>
<span id="cb133-14"><a href="#cb133-14"></a>          <span class="at">align =</span> <span class="st">"v"</span>,</span>
<span id="cb133-15"><a href="#cb133-15"></a>          <span class="at">legend =</span> <span class="st">"none"</span>,</span>
<span id="cb133-16"><a href="#cb133-16"></a>          <span class="at">common.legend =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: `stat_contour()`: Zero contours were generated</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in min(x): no non-missing arguments to min; returning Inf</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in max(x): no non-missing arguments to max; returning -Inf</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: `stat_contour()`: Zero contours were generated</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in min(x): no non-missing arguments to min; returning Inf</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in max(x): no non-missing arguments to max; returning -Inf</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb140"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb140-1"><a href="#cb140-1"></a>surface_plots_1p</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ssf_model_fit_id_files/figure-html/unnamed-chunk-62-1.png" class="img-fluid figure-img" width="2100"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-14-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-14-3-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb141"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb141-1"><a href="#cb141-1"></a>surface_plots_2p <span class="ot">&lt;-</span> <span class="fu">ggarrange</span>(ndvi_quad_2p <span class="sc">+</span> </span>
<span id="cb141-2"><a href="#cb141-2"></a>            <span class="fu">ggtitle</span>(<span class="st">"2p"</span>) <span class="sc">+</span></span>
<span id="cb141-3"><a href="#cb141-3"></a>            <span class="fu">theme</span>(<span class="at">axis.title.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb141-4"><a href="#cb141-4"></a>                  <span class="at">axis.text.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb141-5"><a href="#cb141-5"></a>                  <span class="at">axis.title.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb141-6"><a href="#cb141-6"></a>                  <span class="at">axis.text.y =</span> <span class="fu">element_blank</span>()),</span>
<span id="cb141-7"><a href="#cb141-7"></a>          </span>
<span id="cb141-8"><a href="#cb141-8"></a>          canopy_quad_2p <span class="sc">+</span> </span>
<span id="cb141-9"><a href="#cb141-9"></a>            <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_blank</span>(), </span>
<span id="cb141-10"><a href="#cb141-10"></a>                  <span class="at">axis.title.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb141-11"><a href="#cb141-11"></a>                  <span class="at">axis.text.y =</span> <span class="fu">element_blank</span>()),</span>
<span id="cb141-12"><a href="#cb141-12"></a>          </span>
<span id="cb141-13"><a href="#cb141-13"></a>          <span class="at">ncol =</span> <span class="dv">1</span>, <span class="at">nrow =</span> <span class="dv">2</span>,</span>
<span id="cb141-14"><a href="#cb141-14"></a>          <span class="at">align =</span> <span class="st">"v"</span>,</span>
<span id="cb141-15"><a href="#cb141-15"></a>          <span class="at">legend =</span> <span class="st">"none"</span>,</span>
<span id="cb141-16"><a href="#cb141-16"></a>          <span class="at">common.legend =</span> <span class="cn">TRUE</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: `stat_contour()`: Zero contours were generated</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in min(x): no non-missing arguments to min; returning Inf</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in max(x): no non-missing arguments to max; returning -Inf</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: `stat_contour()`: Zero contours were generated</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in min(x): no non-missing arguments to min; returning Inf</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in max(x): no non-missing arguments to max; returning -Inf</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb148"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb148-1"><a href="#cb148-1"></a>surface_plots_2p</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ssf_model_fit_id_files/figure-html/unnamed-chunk-63-1.png" class="img-fluid figure-img" width="2100"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-14-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-14-4-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb149"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb149-1"><a href="#cb149-1"></a>surface_plots_3p <span class="ot">&lt;-</span> <span class="fu">ggarrange</span>(ndvi_quad_3p <span class="sc">+</span> </span>
<span id="cb149-2"><a href="#cb149-2"></a>            <span class="fu">ggtitle</span>(<span class="st">"3p"</span>) <span class="sc">+</span></span>
<span id="cb149-3"><a href="#cb149-3"></a>              <span class="fu">theme</span>(<span class="at">axis.title.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb149-4"><a href="#cb149-4"></a>                    <span class="at">axis.text.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb149-5"><a href="#cb149-5"></a>                    <span class="at">axis.title.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb149-6"><a href="#cb149-6"></a>                    <span class="at">axis.text.y =</span> <span class="fu">element_blank</span>()),</span>
<span id="cb149-7"><a href="#cb149-7"></a>           </span>
<span id="cb149-8"><a href="#cb149-8"></a>           canopy_quad_3p <span class="sc">+</span> </span>
<span id="cb149-9"><a href="#cb149-9"></a>            <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_blank</span>(), </span>
<span id="cb149-10"><a href="#cb149-10"></a>                  <span class="at">axis.title.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb149-11"><a href="#cb149-11"></a>                  <span class="at">axis.text.y =</span> <span class="fu">element_blank</span>()),</span>
<span id="cb149-12"><a href="#cb149-12"></a>          </span>
<span id="cb149-13"><a href="#cb149-13"></a>          <span class="at">ncol =</span> <span class="dv">1</span>, <span class="at">nrow =</span> <span class="dv">2</span>,</span>
<span id="cb149-14"><a href="#cb149-14"></a>          <span class="at">align =</span> <span class="st">"v"</span>,</span>
<span id="cb149-15"><a href="#cb149-15"></a>          <span class="at">legend =</span> <span class="st">"none"</span>,</span>
<span id="cb149-16"><a href="#cb149-16"></a>          <span class="at">common.legend =</span> <span class="cn">TRUE</span>)</span>
<span id="cb149-17"><a href="#cb149-17"></a></span>
<span id="cb149-18"><a href="#cb149-18"></a>surface_plots_3p</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ssf_model_fit_id_files/figure-html/unnamed-chunk-64-1.png" class="img-fluid figure-img" width="2100"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
<section id="all-selection-surfaces" class="level2">
<h2 class="anchored" data-anchor-id="all-selection-surfaces">All selection surfaces</h2>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb150"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb150-1"><a href="#cb150-1"></a>all_selection_surfaces <span class="ot">&lt;-</span> <span class="fu">ggarrange</span>(surface_plots_0p, surface_plots_1p, surface_plots_2p, surface_plots_3p,</span>
<span id="cb150-2"><a href="#cb150-2"></a>          <span class="at">ncol =</span> <span class="dv">4</span>, <span class="at">nrow =</span> <span class="dv">1</span></span>
<span id="cb150-3"><a href="#cb150-3"></a>          <span class="co"># legend = "none",</span></span>
<span id="cb150-4"><a href="#cb150-4"></a>          <span class="co"># legend.grob = get_legend(ndvi_quad_2p)</span></span>
<span id="cb150-5"><a href="#cb150-5"></a>          )</span>
<span id="cb150-6"><a href="#cb150-6"></a></span>
<span id="cb150-7"><a href="#cb150-7"></a>all_selection_surfaces</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ssf_model_fit_id_files/figure-html/unnamed-chunk-65-1.png" class="img-fluid figure-img" width="2100"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb151"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb151-1"><a href="#cb151-1"></a><span class="co"># ggsave(paste0("outputs/plots/manuscript_figs_R1/",</span></span>
<span id="cb151-2"><a href="#cb151-2"></a><span class="co">#               "all_quad_4x1_CLR_TS_daily_GvM_10rs_", </span></span>
<span id="cb151-3"><a href="#cb151-3"></a><span class="co">#          Sys.Date(), ".png"),</span></span>
<span id="cb151-4"><a href="#cb151-4"></a><span class="co">#   width=150, height=110, units="mm", dpi = 1000)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="references" class="level2">
<h2 class="anchored" data-anchor-id="references">References</h2>
<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-Fieberg2021-wx" class="csl-entry" role="listitem">
Fieberg, John, Johannes Signer, Brian Smith, and Tal Avgar. 2021. <span>“A ’How to’ Guide for Interpreting Parameters in Habitat-Selection Analyses.”</span> <em>The Journal of Animal Ecology</em> 90 (5): 1027–43. <a href="https://doi.org/10.1111/1365-2656.13441">https://doi.org/10.1111/1365-2656.13441</a>.
</div>
<div id="ref-Forrest2024-gc" class="csl-entry" role="listitem">
Forrest, Scott W, Dan Pagendam, Michael Bode, Christopher Drovandi, Jonathan R Potts, Justin Perry, Eric Vanderduys, and Andrew J Hoskins. 2024. <span>“Predicting Fine‐scale Distributions and Emergent Spatiotemporal Patterns from Temporally Dynamic Step Selection Simulations.”</span> <em>Ecography</em>, December. <a href="https://doi.org/10.1111/ecog.07421">https://doi.org/10.1111/ecog.07421</a>.
</div>
</div>
</section>
<section id="session-info" class="level2">
<h2 class="anchored" data-anchor-id="session-info">Session info</h2>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb152"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb152-1"><a href="#cb152-1"></a><span class="fu">sessionInfo</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>R version 4.4.1 (2024-06-14 ucrt)
Platform: x86_64-w64-mingw32/x64
Running under: Windows 10 x64 (build 19045)

Matrix products: default


locale:
[1] LC_COLLATE=English_Australia.utf8  LC_CTYPE=English_Australia.utf8   
[3] LC_MONETARY=English_Australia.utf8 LC_NUMERIC=C                      
[5] LC_TIME=English_Australia.utf8    

time zone: Australia/Brisbane
tzcode source: internal

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base     

other attached packages:
 [1] ggpubr_0.6.0    beepr_2.0       tictoc_1.2.1    terra_1.7-78   
 [5] amt_0.2.2.0     lubridate_1.9.3 forcats_1.0.0   stringr_1.5.1  
 [9] dplyr_1.1.4     purrr_1.0.2     readr_2.1.5     tidyr_1.3.1    
[13] tibble_3.2.1    ggplot2_3.5.1   tidyverse_2.0.0

loaded via a namespace (and not attached):
 [1] gtable_0.3.5       xfun_0.47          htmlwidgets_1.6.4  rstatix_0.7.2     
 [5] lattice_0.22-6     tzdb_0.4.0         vctrs_0.6.5        tools_4.4.1       
 [9] Rdpack_2.6.1       generics_0.1.3     parallel_4.4.1     proxy_0.4-27      
[13] fansi_1.0.6        pkgconfig_2.0.3    Matrix_1.7-0       KernSmooth_2.23-24
[17] lifecycle_1.0.4    farver_2.1.2       compiler_4.4.1     munsell_0.5.1     
[21] codetools_0.2-20   carData_3.0-5      htmltools_0.5.8.1  class_7.3-22      
[25] yaml_2.3.10        crayon_1.5.3       car_3.1-2          pillar_1.9.0      
[29] classInt_0.4-10    abind_1.4-8        tidyselect_1.2.1   digest_0.6.37     
[33] stringi_1.8.4      sf_1.0-17          labeling_0.4.3     splines_4.4.1     
[37] cowplot_1.1.3      fastmap_1.2.0      grid_4.4.1         colorspace_2.1-1  
[41] cli_3.6.3          magrittr_2.0.3     survival_3.6-4     utf8_1.2.4        
[45] broom_1.0.6        e1071_1.7-16       withr_3.0.1        backports_1.5.0   
[49] scales_1.3.0       bit64_4.0.5        timechange_0.3.0   rmarkdown_2.28    
[53] audio_0.1-11       bit_4.0.5          gridExtra_2.3      ggsignif_0.6.4    
[57] hms_1.1.3          evaluate_1.0.0     knitr_1.48         rbibutils_2.2.16  
[61] viridisLite_0.4.2  rlang_1.1.4        isoband_0.2.7      Rcpp_1.0.13       
[65] glue_1.7.0         DBI_1.2.3          vroom_1.6.5        jsonlite_1.8.8    
[69] R6_2.5.1           units_0.8-5       </code></pre>
</div>
</div>


<!-- -->

</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./Python/deepSSF_next_step_validation_S2.html" class="pagination-link" aria-label="deepSSF Validation - S2">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">deepSSF Validation - S2</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./ssf_validation.html" class="pagination-link" aria-label="SSF Validation">
        <span class="nav-page-text">SSF Validation</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb154" data-shortcodes="false"><pre class="sourceCode numberSource markdown number-lines code-with-copy"><code class="sourceCode markdown"><span id="cb154-1"><a href="#cb154-1"></a><span class="co">---</span></span>
<span id="cb154-2"><a href="#cb154-2"></a><span class="an">title:</span><span class="co"> "SSF Model Fitting"</span></span>
<span id="cb154-3"><a href="#cb154-3"></a><span class="an">author:</span></span>
<span id="cb154-4"><a href="#cb154-4"></a><span class="co">  - name: Scott Forrest</span></span>
<span id="cb154-5"><a href="#cb154-5"></a><span class="co">    url: https://swforrest.github.io/</span></span>
<span id="cb154-6"><a href="#cb154-6"></a><span class="co">    orcid: 0000-0001-9529-0108</span></span>
<span id="cb154-7"><a href="#cb154-7"></a><span class="co">    affiliation: Queensland University of Technology, CSIRO</span></span>
<span id="cb154-8"><a href="#cb154-8"></a><span class="co">    email: "scottwforrest@gmail.com"</span></span>
<span id="cb154-9"><a href="#cb154-9"></a><span class="an">date:</span><span class="co"> "`r Sys.Date()`"</span></span>
<span id="cb154-10"><a href="#cb154-10"></a><span class="an">execute:</span><span class="co"> </span></span>
<span id="cb154-11"><a href="#cb154-11"></a><span class="co">  cache: false</span></span>
<span id="cb154-12"><a href="#cb154-12"></a><span class="an">bibliography:</span><span class="co"> references.bib</span></span>
<span id="cb154-13"><a href="#cb154-13"></a><span class="an">toc:</span><span class="co"> true</span></span>
<span id="cb154-14"><a href="#cb154-14"></a><span class="an">format:</span><span class="co"> </span></span>
<span id="cb154-15"><a href="#cb154-15"></a><span class="co">  html:</span></span>
<span id="cb154-16"><a href="#cb154-16"></a><span class="co">    # self-contained: true</span></span>
<span id="cb154-17"><a href="#cb154-17"></a><span class="co">    code-fold: true</span></span>
<span id="cb154-18"><a href="#cb154-18"></a><span class="co">    code-tools: true</span></span>
<span id="cb154-19"><a href="#cb154-19"></a><span class="co">    df-print: paged</span></span>
<span id="cb154-20"><a href="#cb154-20"></a><span class="co">    code-line-numbers: true</span></span>
<span id="cb154-21"><a href="#cb154-21"></a><span class="co">    code-overflow: scroll</span></span>
<span id="cb154-22"><a href="#cb154-22"></a><span class="co">  pdf:</span></span>
<span id="cb154-23"><a href="#cb154-23"></a><span class="co">    geometry: </span></span>
<span id="cb154-24"><a href="#cb154-24"></a><span class="co">      - top=30mm</span></span>
<span id="cb154-25"><a href="#cb154-25"></a><span class="co">      - left=30mm</span></span>
<span id="cb154-26"><a href="#cb154-26"></a><span class="an">editor:</span></span>
<span id="cb154-27"><a href="#cb154-27"></a><span class="co">  source</span></span>
<span id="cb154-28"><a href="#cb154-28"></a><span class="an">abstract:</span><span class="co"> |</span></span>
<span id="cb154-29"><a href="#cb154-29"></a><span class="co">  To compare the next-step predictions of the deepSSF models to SSF models, we need to fit some SSF models to the same data and covariates. </span></span>
<span id="cb154-30"><a href="#cb154-30"></a><span class="co">  Here we fit SSF models with and without temporal harmonics to buffalo data, which is similar to the approach in @Forrest2024-gc except that here we</span></span>
<span id="cb154-31"><a href="#cb154-31"></a><span class="co">  are just fitting the models to the focal individual, rather than to multiple individuals. </span></span>
<span id="cb154-32"><a href="#cb154-32"></a><span class="co">  </span></span>
<span id="cb154-33"><a href="#cb154-33"></a><span class="co">  We use the estimated parameters of the SSF models to generate next-step predictions of the SSF models in the</span></span>
<span id="cb154-34"><a href="#cb154-34"></a><span class="co">  [SSF Validation](ssf_validation.qmd) script, and compare these to the next-step predictions of the deepSSF models.</span></span>
<span id="cb154-35"><a href="#cb154-35"></a><span class="co">  </span></span>
<span id="cb154-36"><a href="#cb154-36"></a><span class="co">  Whilst we have included temporal dynamics on an daily time-scale using the harmonics, also including seasonal temporal dynamics </span></span>
<span id="cb154-37"><a href="#cb154-37"></a><span class="co">  (such that daily behaviours also change across seasons - requiring an interaction between the daily and seasonal harmonics) is</span></span>
<span id="cb154-38"><a href="#cb154-38"></a><span class="co">  difficult. We have therefore only fitted the SSF models with daily temporal dynamics.</span></span>
<span id="cb154-39"><a href="#cb154-39"></a><span class="co">  </span></span>
<span id="cb154-40"><a href="#cb154-40"></a><span class="co">  We have also not fitted the SSF models to the Sentinel-2 data, as we have done with the deepSSF models. </span></span>
<span id="cb154-41"><a href="#cb154-41"></a><span class="co">  </span></span>
<span id="cb154-42"><a href="#cb154-42"></a><span class="co">---</span></span>
<span id="cb154-43"><a href="#cb154-43"></a></span>
<span id="cb154-46"><a href="#cb154-46"></a><span class="in">```{r}</span></span>
<span id="cb154-47"><a href="#cb154-47"></a><span class="co">#| label: img_params</span></span>
<span id="cb154-48"><a href="#cb154-48"></a><span class="co">#| code-summary: "Setting image parameters"</span></span>
<span id="cb154-49"><a href="#cb154-49"></a><span class="co">#| include: false</span></span>
<span id="cb154-50"><a href="#cb154-50"></a></span>
<span id="cb154-51"><a href="#cb154-51"></a>knitr<span class="sc">::</span>opts_chunk<span class="sc">$</span><span class="fu">set</span>(<span class="at">echo =</span> <span class="cn">TRUE</span>,</span>
<span id="cb154-52"><a href="#cb154-52"></a>                      <span class="at">dev =</span> <span class="st">'png'</span>,</span>
<span id="cb154-53"><a href="#cb154-53"></a>                      <span class="at">dpi =</span> <span class="dv">300</span>)</span>
<span id="cb154-54"><a href="#cb154-54"></a></span>
<span id="cb154-55"><a href="#cb154-55"></a><span class="in">```</span></span>
<span id="cb154-56"><a href="#cb154-56"></a></span>
<span id="cb154-57"><a href="#cb154-57"></a><span class="fu">## Load packages</span></span>
<span id="cb154-58"><a href="#cb154-58"></a></span>
<span id="cb154-59"><a href="#cb154-59"></a><span class="in">```{r }</span></span>
<span id="cb154-60"><a href="#cb154-60"></a><span class="in">#| label: packages</span></span>
<span id="cb154-61"><a href="#cb154-61"></a><span class="in">#| code-summary: "Loading packages"</span></span>
<span id="cb154-62"><a href="#cb154-62"></a><span class="in">#| message: false</span></span>
<span id="cb154-63"><a href="#cb154-63"></a><span class="in">#| warning: false</span></span>
<span id="cb154-64"><a href="#cb154-64"></a></span>
<span id="cb154-65"><a href="#cb154-65"></a><span class="in">options(scipen=999)</span></span>
<span id="cb154-66"><a href="#cb154-66"></a></span>
<span id="cb154-67"><a href="#cb154-67"></a><span class="in">library(tidyverse)</span></span>
<span id="cb154-68"><a href="#cb154-68"></a><span class="in">packages &lt;- c("amt", "lubridate", "terra", "tictoc", </span></span>
<span id="cb154-69"><a href="#cb154-69"></a><span class="in">              "beepr", "ggpubr")</span></span>
<span id="cb154-70"><a href="#cb154-70"></a><span class="in">walk(packages, require, character.only = T)</span></span>
<span id="cb154-71"><a href="#cb154-71"></a></span>
<span id="cb154-72"><a href="#cb154-72"></a><span class="in">```</span></span>
<span id="cb154-73"><a href="#cb154-73"></a></span>
<span id="cb154-74"><a href="#cb154-74"></a><span class="fu">## Importing buffalo data</span></span>
<span id="cb154-75"><a href="#cb154-75"></a></span>
<span id="cb154-76"><a href="#cb154-76"></a>Import the buffalo data with random steps and extracted covariates that we created for the paper @Forrest2024-gc, in the script <span class="in">`Ecography_DynamicSSF_1_Step_generation`</span>. This repo can be found at: <span class="co">[</span><span class="ot">swforrest/dynamic_SSF_sims</span><span class="co">](https://github.com/swforrest/dynamic_SSF_sims)</span>.</span>
<span id="cb154-77"><a href="#cb154-77"></a></span>
<span id="cb154-78"><a href="#cb154-78"></a>Here we create the sine and cosine terms that were interact with each of the covariates to fit temporally varying parameters.</span>
<span id="cb154-79"><a href="#cb154-79"></a></span>
<span id="cb154-82"><a href="#cb154-82"></a><span class="in">```{r}</span></span>
<span id="cb154-83"><a href="#cb154-83"></a><span class="co">#| label: import_data</span></span>
<span id="cb154-84"><a href="#cb154-84"></a><span class="co">#| code-summary: "Importing data"</span></span>
<span id="cb154-85"><a href="#cb154-85"></a></span>
<span id="cb154-86"><a href="#cb154-86"></a>buffalo_data_all <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"data/buffalo_parametric_popn_covs_GvM_10rs_2024-09-04.csv"</span>)</span>
<span id="cb154-87"><a href="#cb154-87"></a></span>
<span id="cb154-88"><a href="#cb154-88"></a>buffalo_data_all <span class="ot">&lt;-</span> buffalo_data_all <span class="sc">%&gt;%</span></span>
<span id="cb154-89"><a href="#cb154-89"></a>  <span class="fu">mutate</span>(<span class="at">t1_ =</span> lubridate<span class="sc">::</span><span class="fu">with_tz</span>(buffalo_data_all<span class="sc">$</span>t1_, <span class="at">tzone =</span> <span class="st">"Australia/Darwin"</span>),</span>
<span id="cb154-90"><a href="#cb154-90"></a>         <span class="at">t2_ =</span> lubridate<span class="sc">::</span><span class="fu">with_tz</span>(buffalo_data_all<span class="sc">$</span>t2_, <span class="at">tzone =</span> <span class="st">"Australia/Darwin"</span>))</span>
<span id="cb154-91"><a href="#cb154-91"></a></span>
<span id="cb154-92"><a href="#cb154-92"></a>buffalo_data_all <span class="ot">&lt;-</span> buffalo_data_all <span class="sc">%&gt;%</span></span>
<span id="cb154-93"><a href="#cb154-93"></a>  <span class="fu">mutate</span>(<span class="at">id_num =</span> <span class="fu">as.numeric</span>(<span class="fu">factor</span>(id)),</span>
<span id="cb154-94"><a href="#cb154-94"></a>         <span class="at">step_id =</span> step_id_,</span>
<span id="cb154-95"><a href="#cb154-95"></a>         <span class="at">x1 =</span> x1_, <span class="at">x2 =</span> x2_,</span>
<span id="cb154-96"><a href="#cb154-96"></a>         <span class="at">y1 =</span> y1_, <span class="at">y2 =</span> y2_,</span>
<span id="cb154-97"><a href="#cb154-97"></a>         <span class="at">t1 =</span> t1_,</span>
<span id="cb154-98"><a href="#cb154-98"></a>         <span class="at">t1_rounded =</span> <span class="fu">round_date</span>(buffalo_data_all<span class="sc">$</span>t1_, <span class="st">"hour"</span>),</span>
<span id="cb154-99"><a href="#cb154-99"></a>         <span class="at">hour_t1 =</span> <span class="fu">hour</span>(t1_rounded),</span>
<span id="cb154-100"><a href="#cb154-100"></a>         <span class="at">t2 =</span> t2_,</span>
<span id="cb154-101"><a href="#cb154-101"></a>         <span class="at">t2_rounded =</span> <span class="fu">round_date</span>(buffalo_data_all<span class="sc">$</span>t2_, <span class="st">"hour"</span>),</span>
<span id="cb154-102"><a href="#cb154-102"></a>         <span class="at">hour_t2 =</span> <span class="fu">hour</span>(t2_rounded),</span>
<span id="cb154-103"><a href="#cb154-103"></a>         <span class="at">hour =</span> hour_t2,</span>
<span id="cb154-104"><a href="#cb154-104"></a>         <span class="at">yday =</span> <span class="fu">yday</span>(t1_),</span>
<span id="cb154-105"><a href="#cb154-105"></a>         <span class="at">year =</span> <span class="fu">year</span>(t1_),</span>
<span id="cb154-106"><a href="#cb154-106"></a>         <span class="at">month =</span> <span class="fu">month</span>(t1_),</span>
<span id="cb154-107"><a href="#cb154-107"></a>         <span class="at">sl =</span> sl_,</span>
<span id="cb154-108"><a href="#cb154-108"></a>         <span class="at">log_sl =</span> <span class="fu">log</span>(sl_),</span>
<span id="cb154-109"><a href="#cb154-109"></a>         <span class="at">ta =</span> ta_,</span>
<span id="cb154-110"><a href="#cb154-110"></a>         <span class="at">cos_ta =</span> <span class="fu">cos</span>(ta_),</span>
<span id="cb154-111"><a href="#cb154-111"></a>         <span class="co"># scale canopy cover from 0 to 1</span></span>
<span id="cb154-112"><a href="#cb154-112"></a>         <span class="at">canopy_01 =</span> canopy_cover<span class="sc">/</span><span class="dv">100</span>,</span>
<span id="cb154-113"><a href="#cb154-113"></a>         <span class="co"># here we create the harmonic terms for the hour of the day</span></span>
<span id="cb154-114"><a href="#cb154-114"></a>         <span class="co"># for seasonal effects, change hour to yday (which is tau in the manuscript), </span></span>
<span id="cb154-115"><a href="#cb154-115"></a>         <span class="co"># and 24 to 365 (which is T)</span></span>
<span id="cb154-116"><a href="#cb154-116"></a>         <span class="at">hour_s1 =</span> <span class="fu">sin</span>(<span class="dv">2</span><span class="sc">*</span>pi<span class="sc">*</span>hour<span class="sc">/</span><span class="dv">24</span>),</span>
<span id="cb154-117"><a href="#cb154-117"></a>         <span class="at">hour_s2 =</span> <span class="fu">sin</span>(<span class="dv">4</span><span class="sc">*</span>pi<span class="sc">*</span>hour<span class="sc">/</span><span class="dv">24</span>),</span>
<span id="cb154-118"><a href="#cb154-118"></a>         <span class="at">hour_s3 =</span> <span class="fu">sin</span>(<span class="dv">6</span><span class="sc">*</span>pi<span class="sc">*</span>hour<span class="sc">/</span><span class="dv">24</span>),</span>
<span id="cb154-119"><a href="#cb154-119"></a>         <span class="at">hour_c1 =</span> <span class="fu">cos</span>(<span class="dv">2</span><span class="sc">*</span>pi<span class="sc">*</span>hour<span class="sc">/</span><span class="dv">24</span>),</span>
<span id="cb154-120"><a href="#cb154-120"></a>         <span class="at">hour_c2 =</span> <span class="fu">cos</span>(<span class="dv">4</span><span class="sc">*</span>pi<span class="sc">*</span>hour<span class="sc">/</span><span class="dv">24</span>),</span>
<span id="cb154-121"><a href="#cb154-121"></a>         <span class="at">hour_c3 =</span> <span class="fu">cos</span>(<span class="dv">6</span><span class="sc">*</span>pi<span class="sc">*</span>hour<span class="sc">/</span><span class="dv">24</span>))</span>
<span id="cb154-122"><a href="#cb154-122"></a></span>
<span id="cb154-123"><a href="#cb154-123"></a><span class="co"># to select a single year of data</span></span>
<span id="cb154-124"><a href="#cb154-124"></a><span class="co"># buffalo_data_all &lt;- buffalo_data_all %&gt;% filter(t1 &lt; "2019-07-25 09:32:42 ACST")</span></span>
<span id="cb154-125"><a href="#cb154-125"></a></span>
<span id="cb154-126"><a href="#cb154-126"></a>buffalo_ids <span class="ot">&lt;-</span> <span class="fu">unique</span>(buffalo_data_all<span class="sc">$</span>id)</span>
<span id="cb154-127"><a href="#cb154-127"></a></span>
<span id="cb154-128"><a href="#cb154-128"></a><span class="co"># Timeline of buffalo data</span></span>
<span id="cb154-129"><a href="#cb154-129"></a>buffalo_data_all <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> t1, <span class="at">y =</span> <span class="fu">factor</span>(id), <span class="at">colour =</span> <span class="fu">factor</span>(id))) <span class="sc">+</span></span>
<span id="cb154-130"><a href="#cb154-130"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb154-131"><a href="#cb154-131"></a>  <span class="fu">scale_y_discrete</span>(<span class="st">"Buffalo ID"</span>) <span class="sc">+</span></span>
<span id="cb154-132"><a href="#cb154-132"></a>  <span class="fu">scale_x_datetime</span>(<span class="st">"Date"</span>) <span class="sc">+</span></span>
<span id="cb154-133"><a href="#cb154-133"></a>  <span class="fu">scale_colour_viridis_d</span>() <span class="sc">+</span></span>
<span id="cb154-134"><a href="#cb154-134"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb154-135"><a href="#cb154-135"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span>
<span id="cb154-136"><a href="#cb154-136"></a></span>
<span id="cb154-137"><a href="#cb154-137"></a><span class="in">```</span></span>
<span id="cb154-138"><a href="#cb154-138"></a></span>
<span id="cb154-139"><a href="#cb154-139"></a><span class="fu"># Fitting the models</span></span>
<span id="cb154-140"><a href="#cb154-140"></a></span>
<span id="cb154-141"><a href="#cb154-141"></a><span class="fu">## Creating a data matrix</span></span>
<span id="cb154-142"><a href="#cb154-142"></a></span>
<span id="cb154-143"><a href="#cb154-143"></a>First we create a data matrix to be provided to the model, and then we scale and centre the full data matrix, with respect to each of the columns. That means that all variables are scaled and centred *after* the data has been split into wet and dry season data, and also after creating the quadratic and harmonic terms (when using them).</span>
<span id="cb154-144"><a href="#cb154-144"></a></span>
<span id="cb154-145"><a href="#cb154-145"></a>We should only include covariates in the data matrix that will be used in the model formula.</span>
<span id="cb154-146"><a href="#cb154-146"></a></span>
<span id="cb154-147"><a href="#cb154-147"></a>**Models**</span>
<span id="cb154-148"><a href="#cb154-148"></a></span>
<span id="cb154-149"><a href="#cb154-149"></a><span class="ss">-   </span>0p = 0 pairs of harmonics</span>
<span id="cb154-150"><a href="#cb154-150"></a><span class="ss">-   </span>1p = 1 pair of harmonics</span>
<span id="cb154-151"><a href="#cb154-151"></a><span class="ss">-   </span>2p = 2 pairs of harmonics</span>
<span id="cb154-152"><a href="#cb154-152"></a><span class="ss">-   </span>3p = 3 pairs of harmonics</span>
<span id="cb154-153"><a href="#cb154-153"></a></span>
<span id="cb154-154"><a href="#cb154-154"></a>For the dynamic models, we start to add the harmonic terms. As we have already created the harmonic terms for the hour of the day (s1, c1, s2, etc), we just interact (multiply) these with each of the covariates, including the quadratic terms, prior to model fitting. We store the scaling and centering variables to reconstruct the natural scale coefficients.</span>
<span id="cb154-155"><a href="#cb154-155"></a></span>
<span id="cb154-156"><a href="#cb154-156"></a>To provide some intuition about harmonic regression we have created a walkthrough script for @Forrest2024-gc, in the script <span class="in">`Ecography_DynamicSSF_Walkthrough_Harmonics_and_selection_surfaces`</span>, which can be found at: <span class="co">[</span><span class="ot">swforrest/dynamic_SSF_sims</span><span class="co">](https://github.com/swforrest/dynamic_SSF_sims)</span>, that introduces harmonics and how they can be used to model temporal variation in the data. It will help provide some understand the model outputs and how we construct the temporally varying coefficients in this script.</span>
<span id="cb154-157"><a href="#cb154-157"></a></span>
<span id="cb154-158"><a href="#cb154-158"></a><span class="fu">## Selecting data</span></span>
<span id="cb154-159"><a href="#cb154-159"></a></span>
<span id="cb154-162"><a href="#cb154-162"></a><span class="in">```{r}</span></span>
<span id="cb154-163"><a href="#cb154-163"></a>months_wet <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, <span class="dv">11</span><span class="sc">:</span><span class="dv">12</span>)</span>
<span id="cb154-164"><a href="#cb154-164"></a>buffalo_ids <span class="ot">&lt;-</span> <span class="fu">unique</span>(buffalo_data_all<span class="sc">$</span>id)</span>
<span id="cb154-165"><a href="#cb154-165"></a>focal_id <span class="ot">&lt;-</span> <span class="dv">2005</span></span>
<span id="cb154-166"><a href="#cb154-166"></a></span>
<span id="cb154-167"><a href="#cb154-167"></a><span class="co"># comment and uncomment the relevant lines to get either wet or dry season data</span></span>
<span id="cb154-168"><a href="#cb154-168"></a><span class="co"># buffalo_data &lt;- buffalo_data_all %&gt;% filter(id == focal_id &amp; month %in% months_wet) # wet season</span></span>
<span id="cb154-169"><a href="#cb154-169"></a><span class="co"># buffalo_data &lt;- buffalo_data_all %&gt;% filter(id == focal_id &amp; !month %in% months_wet) # dry season</span></span>
<span id="cb154-170"><a href="#cb154-170"></a></span>
<span id="cb154-171"><a href="#cb154-171"></a><span class="co"># all data</span></span>
<span id="cb154-172"><a href="#cb154-172"></a>buffalo_data <span class="ot">&lt;-</span> buffalo_data_all <span class="sc">%&gt;%</span> <span class="fu">filter</span>(id <span class="sc">==</span> focal_id)</span>
<span id="cb154-173"><a href="#cb154-173"></a></span>
<span id="cb154-174"><a href="#cb154-174"></a><span class="in">```</span></span>
<span id="cb154-175"><a href="#cb154-175"></a></span>
<span id="cb154-176"><a href="#cb154-176"></a></span>
<span id="cb154-177"><a href="#cb154-177"></a>::: {.panel-tabset group="model"}</span>
<span id="cb154-178"><a href="#cb154-178"></a></span>
<span id="cb154-179"><a href="#cb154-179"></a><span class="fu">## 0p</span></span>
<span id="cb154-180"><a href="#cb154-180"></a></span>
<span id="cb154-183"><a href="#cb154-183"></a><span class="in">```{r}</span></span>
<span id="cb154-184"><a href="#cb154-184"></a><span class="co">#| label: 0p_data_matrix</span></span>
<span id="cb154-185"><a href="#cb154-185"></a></span>
<span id="cb154-186"><a href="#cb154-186"></a>buffalo_data_matrix_unscaled <span class="ot">&lt;-</span> buffalo_data <span class="sc">%&gt;%</span> <span class="fu">transmute</span>(</span>
<span id="cb154-187"><a href="#cb154-187"></a>  </span>
<span id="cb154-188"><a href="#cb154-188"></a>  <span class="at">ndvi =</span> ndvi_temporal,</span>
<span id="cb154-189"><a href="#cb154-189"></a>  <span class="at">ndvi_sq =</span> ndvi_temporal <span class="sc">^</span> <span class="dv">2</span>,</span>
<span id="cb154-190"><a href="#cb154-190"></a>  <span class="at">canopy =</span> canopy_01,</span>
<span id="cb154-191"><a href="#cb154-191"></a>  <span class="at">canopy_sq =</span> canopy_01 <span class="sc">^</span> <span class="dv">2</span>,</span>
<span id="cb154-192"><a href="#cb154-192"></a>  <span class="at">slope =</span> slope,</span>
<span id="cb154-193"><a href="#cb154-193"></a>  <span class="at">herby =</span> veg_herby,</span>
<span id="cb154-194"><a href="#cb154-194"></a>  <span class="at">step_l =</span> sl,</span>
<span id="cb154-195"><a href="#cb154-195"></a>  <span class="at">log_step_l =</span> log_sl,</span>
<span id="cb154-196"><a href="#cb154-196"></a>  <span class="at">cos_turn_a =</span> cos_ta)</span>
<span id="cb154-197"><a href="#cb154-197"></a></span>
<span id="cb154-198"><a href="#cb154-198"></a>buffalo_data_matrix_scaled <span class="ot">&lt;-</span> <span class="fu">scale</span>(buffalo_data_matrix_unscaled)</span>
<span id="cb154-199"><a href="#cb154-199"></a></span>
<span id="cb154-200"><a href="#cb154-200"></a><span class="co"># save the scaling values to recover the natural scale of the coefficients</span></span>
<span id="cb154-201"><a href="#cb154-201"></a><span class="co"># which is required for the simulations </span></span>
<span id="cb154-202"><a href="#cb154-202"></a><span class="co"># (so then environmental variables don't need to be scaled)</span></span>
<span id="cb154-203"><a href="#cb154-203"></a>mean_vals <span class="ot">&lt;-</span> <span class="fu">attr</span>(buffalo_data_matrix_scaled, <span class="st">"scaled:center"</span>)</span>
<span id="cb154-204"><a href="#cb154-204"></a>sd_vals <span class="ot">&lt;-</span> <span class="fu">attr</span>(buffalo_data_matrix_scaled, <span class="st">"scaled:scale"</span>)</span>
<span id="cb154-205"><a href="#cb154-205"></a>scaling_attributes_0p <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">variable =</span> <span class="fu">names</span>(buffalo_data_matrix_unscaled), </span>
<span id="cb154-206"><a href="#cb154-206"></a>                                    <span class="at">mean =</span> mean_vals, <span class="at">sd =</span> sd_vals)</span>
<span id="cb154-207"><a href="#cb154-207"></a></span>
<span id="cb154-208"><a href="#cb154-208"></a><span class="co"># add the id, step_id columns and presence/absence columns to </span></span>
<span id="cb154-209"><a href="#cb154-209"></a><span class="co"># the scaled data matrix for model fitting</span></span>
<span id="cb154-210"><a href="#cb154-210"></a>buffalo_data_scaled_0p <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">id =</span> buffalo_data<span class="sc">$</span>id,  </span>
<span id="cb154-211"><a href="#cb154-211"></a>                                     <span class="at">step_id =</span> buffalo_data<span class="sc">$</span>step_id, </span>
<span id="cb154-212"><a href="#cb154-212"></a>                                     <span class="at">y =</span> buffalo_data<span class="sc">$</span>y, </span>
<span id="cb154-213"><a href="#cb154-213"></a>                                     buffalo_data_matrix_scaled)</span>
<span id="cb154-214"><a href="#cb154-214"></a></span>
<span id="cb154-215"><a href="#cb154-215"></a><span class="in">```</span></span>
<span id="cb154-216"><a href="#cb154-216"></a></span>
<span id="cb154-217"><a href="#cb154-217"></a><span class="fu">## 1p</span></span>
<span id="cb154-218"><a href="#cb154-218"></a></span>
<span id="cb154-221"><a href="#cb154-221"></a><span class="in">```{r}</span></span>
<span id="cb154-222"><a href="#cb154-222"></a>buffalo_data_matrix_unscaled <span class="ot">&lt;-</span> buffalo_data <span class="sc">%&gt;%</span> <span class="fu">transmute</span>(</span>
<span id="cb154-223"><a href="#cb154-223"></a>  </span>
<span id="cb154-224"><a href="#cb154-224"></a>  <span class="co"># the 'linear' term</span></span>
<span id="cb154-225"><a href="#cb154-225"></a>  <span class="at">ndvi =</span> ndvi_temporal,</span>
<span id="cb154-226"><a href="#cb154-226"></a>  <span class="co"># interact with the harmonic terms</span></span>
<span id="cb154-227"><a href="#cb154-227"></a>  <span class="at">ndvi_s1 =</span> ndvi_temporal <span class="sc">*</span> hour_s1,</span>
<span id="cb154-228"><a href="#cb154-228"></a>  <span class="at">ndvi_c1 =</span> ndvi_temporal <span class="sc">*</span> hour_c1,</span>
<span id="cb154-229"><a href="#cb154-229"></a>  </span>
<span id="cb154-230"><a href="#cb154-230"></a>  <span class="at">ndvi_sq =</span> ndvi_temporal <span class="sc">^</span> <span class="dv">2</span>,</span>
<span id="cb154-231"><a href="#cb154-231"></a>  <span class="at">ndvi_sq_s1 =</span> (ndvi_temporal <span class="sc">^</span> <span class="dv">2</span>) <span class="sc">*</span> hour_s1,</span>
<span id="cb154-232"><a href="#cb154-232"></a>  <span class="at">ndvi_sq_c1 =</span> (ndvi_temporal <span class="sc">^</span> <span class="dv">2</span>) <span class="sc">*</span> hour_c1,</span>
<span id="cb154-233"><a href="#cb154-233"></a>  </span>
<span id="cb154-234"><a href="#cb154-234"></a>  <span class="at">canopy =</span> canopy_01,</span>
<span id="cb154-235"><a href="#cb154-235"></a>  <span class="at">canopy_s1 =</span> canopy_01 <span class="sc">*</span> hour_s1,</span>
<span id="cb154-236"><a href="#cb154-236"></a>  <span class="at">canopy_c1 =</span> canopy_01 <span class="sc">*</span> hour_c1,</span>
<span id="cb154-237"><a href="#cb154-237"></a>  </span>
<span id="cb154-238"><a href="#cb154-238"></a>  <span class="at">canopy_sq =</span> canopy_01 <span class="sc">^</span> <span class="dv">2</span>,</span>
<span id="cb154-239"><a href="#cb154-239"></a>  <span class="at">canopy_sq_s1 =</span> (canopy_01 <span class="sc">^</span> <span class="dv">2</span>) <span class="sc">*</span> hour_s1,</span>
<span id="cb154-240"><a href="#cb154-240"></a>  <span class="at">canopy_sq_c1 =</span> (canopy_01 <span class="sc">^</span> <span class="dv">2</span>) <span class="sc">*</span> hour_c1,</span>
<span id="cb154-241"><a href="#cb154-241"></a>  </span>
<span id="cb154-242"><a href="#cb154-242"></a>  <span class="at">slope =</span> slope,</span>
<span id="cb154-243"><a href="#cb154-243"></a>  <span class="at">slope_s1 =</span> slope <span class="sc">*</span> hour_s1,</span>
<span id="cb154-244"><a href="#cb154-244"></a>  <span class="at">slope_c1 =</span> slope <span class="sc">*</span> hour_c1,</span>
<span id="cb154-245"><a href="#cb154-245"></a>  </span>
<span id="cb154-246"><a href="#cb154-246"></a>  <span class="at">herby =</span> veg_herby,</span>
<span id="cb154-247"><a href="#cb154-247"></a>  <span class="at">herby_s1 =</span> veg_herby <span class="sc">*</span> hour_s1,</span>
<span id="cb154-248"><a href="#cb154-248"></a>  <span class="at">herby_c1 =</span> veg_herby <span class="sc">*</span> hour_c1,</span>
<span id="cb154-249"><a href="#cb154-249"></a>  </span>
<span id="cb154-250"><a href="#cb154-250"></a>  <span class="at">step_l =</span> sl,</span>
<span id="cb154-251"><a href="#cb154-251"></a>  <span class="at">step_l_s1 =</span> sl <span class="sc">*</span> hour_s1,</span>
<span id="cb154-252"><a href="#cb154-252"></a>  <span class="at">step_l_c1 =</span> sl <span class="sc">*</span> hour_c1,</span>
<span id="cb154-253"><a href="#cb154-253"></a></span>
<span id="cb154-254"><a href="#cb154-254"></a>  <span class="at">log_step_l =</span> log_sl,</span>
<span id="cb154-255"><a href="#cb154-255"></a>  <span class="at">log_step_l_s1 =</span> log_sl <span class="sc">*</span> hour_s1,</span>
<span id="cb154-256"><a href="#cb154-256"></a>  <span class="at">log_step_l_c1 =</span> log_sl <span class="sc">*</span> hour_c1,</span>
<span id="cb154-257"><a href="#cb154-257"></a></span>
<span id="cb154-258"><a href="#cb154-258"></a>  <span class="at">cos_turn_a =</span> cos_ta,</span>
<span id="cb154-259"><a href="#cb154-259"></a>  <span class="at">cos_turn_a_s1 =</span> cos_ta <span class="sc">*</span> hour_s1,</span>
<span id="cb154-260"><a href="#cb154-260"></a>  <span class="at">cos_turn_a_c1 =</span> cos_ta <span class="sc">*</span> hour_c1)</span>
<span id="cb154-261"><a href="#cb154-261"></a></span>
<span id="cb154-262"><a href="#cb154-262"></a>buffalo_data_matrix_scaled <span class="ot">&lt;-</span> <span class="fu">scale</span>(buffalo_data_matrix_unscaled)</span>
<span id="cb154-263"><a href="#cb154-263"></a></span>
<span id="cb154-264"><a href="#cb154-264"></a>mean_vals <span class="ot">&lt;-</span> <span class="fu">attr</span>(buffalo_data_matrix_scaled, <span class="st">"scaled:center"</span>)</span>
<span id="cb154-265"><a href="#cb154-265"></a>sd_vals <span class="ot">&lt;-</span> <span class="fu">attr</span>(buffalo_data_matrix_scaled, <span class="st">"scaled:scale"</span>)</span>
<span id="cb154-266"><a href="#cb154-266"></a>scaling_attributes_1p <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">variable =</span> <span class="fu">names</span>(buffalo_data_matrix_unscaled), </span>
<span id="cb154-267"><a href="#cb154-267"></a>                                    <span class="at">mean =</span> mean_vals, <span class="at">sd =</span> sd_vals)</span>
<span id="cb154-268"><a href="#cb154-268"></a></span>
<span id="cb154-269"><a href="#cb154-269"></a>buffalo_data_scaled_1p <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">id =</span> buffalo_data<span class="sc">$</span>id,  </span>
<span id="cb154-270"><a href="#cb154-270"></a>                                     <span class="at">step_id =</span> buffalo_data<span class="sc">$</span>step_id, </span>
<span id="cb154-271"><a href="#cb154-271"></a>                                     <span class="at">y =</span> buffalo_data<span class="sc">$</span>y, </span>
<span id="cb154-272"><a href="#cb154-272"></a>                                     buffalo_data_matrix_scaled)</span>
<span id="cb154-273"><a href="#cb154-273"></a></span>
<span id="cb154-274"><a href="#cb154-274"></a><span class="in">```</span></span>
<span id="cb154-275"><a href="#cb154-275"></a></span>
<span id="cb154-276"><a href="#cb154-276"></a><span class="fu">## 2p</span></span>
<span id="cb154-277"><a href="#cb154-277"></a></span>
<span id="cb154-280"><a href="#cb154-280"></a><span class="in">```{r}</span></span>
<span id="cb154-281"><a href="#cb154-281"></a>buffalo_data_matrix_unscaled <span class="ot">&lt;-</span> buffalo_data <span class="sc">%&gt;%</span> <span class="fu">transmute</span>(</span>
<span id="cb154-282"><a href="#cb154-282"></a>  </span>
<span id="cb154-283"><a href="#cb154-283"></a>  <span class="at">ndvi =</span> ndvi_temporal,</span>
<span id="cb154-284"><a href="#cb154-284"></a>  <span class="at">ndvi_s1 =</span> ndvi_temporal <span class="sc">*</span> hour_s1,</span>
<span id="cb154-285"><a href="#cb154-285"></a>  <span class="at">ndvi_s2 =</span> ndvi_temporal <span class="sc">*</span> hour_s2,</span>
<span id="cb154-286"><a href="#cb154-286"></a>  <span class="at">ndvi_c1 =</span> ndvi_temporal <span class="sc">*</span> hour_c1,</span>
<span id="cb154-287"><a href="#cb154-287"></a>  <span class="at">ndvi_c2 =</span> ndvi_temporal <span class="sc">*</span> hour_c2,</span>
<span id="cb154-288"><a href="#cb154-288"></a>  </span>
<span id="cb154-289"><a href="#cb154-289"></a>  <span class="at">ndvi_sq =</span> ndvi_temporal <span class="sc">^</span> <span class="dv">2</span>,</span>
<span id="cb154-290"><a href="#cb154-290"></a>  <span class="at">ndvi_sq_s1 =</span> (ndvi_temporal <span class="sc">^</span> <span class="dv">2</span>) <span class="sc">*</span> hour_s1,</span>
<span id="cb154-291"><a href="#cb154-291"></a>  <span class="at">ndvi_sq_s2 =</span> (ndvi_temporal <span class="sc">^</span> <span class="dv">2</span>) <span class="sc">*</span> hour_s2,</span>
<span id="cb154-292"><a href="#cb154-292"></a>  <span class="at">ndvi_sq_c1 =</span> (ndvi_temporal <span class="sc">^</span> <span class="dv">2</span>) <span class="sc">*</span> hour_c1,</span>
<span id="cb154-293"><a href="#cb154-293"></a>  <span class="at">ndvi_sq_c2 =</span> (ndvi_temporal <span class="sc">^</span> <span class="dv">2</span>) <span class="sc">*</span> hour_c2,</span>
<span id="cb154-294"><a href="#cb154-294"></a>  </span>
<span id="cb154-295"><a href="#cb154-295"></a>  <span class="at">canopy =</span> canopy_01,</span>
<span id="cb154-296"><a href="#cb154-296"></a>  <span class="at">canopy_s1 =</span> canopy_01 <span class="sc">*</span> hour_s1,</span>
<span id="cb154-297"><a href="#cb154-297"></a>  <span class="at">canopy_s2 =</span> canopy_01 <span class="sc">*</span> hour_s2,</span>
<span id="cb154-298"><a href="#cb154-298"></a>  <span class="at">canopy_c1 =</span> canopy_01 <span class="sc">*</span> hour_c1,</span>
<span id="cb154-299"><a href="#cb154-299"></a>  <span class="at">canopy_c2 =</span> canopy_01 <span class="sc">*</span> hour_c2,</span>
<span id="cb154-300"><a href="#cb154-300"></a>  </span>
<span id="cb154-301"><a href="#cb154-301"></a>  <span class="at">canopy_sq =</span> canopy_01 <span class="sc">^</span> <span class="dv">2</span>,</span>
<span id="cb154-302"><a href="#cb154-302"></a>  <span class="at">canopy_sq_s1 =</span> (canopy_01 <span class="sc">^</span> <span class="dv">2</span>) <span class="sc">*</span> hour_s1,</span>
<span id="cb154-303"><a href="#cb154-303"></a>  <span class="at">canopy_sq_s2 =</span> (canopy_01 <span class="sc">^</span> <span class="dv">2</span>) <span class="sc">*</span> hour_s2,</span>
<span id="cb154-304"><a href="#cb154-304"></a>  <span class="at">canopy_sq_c1 =</span> (canopy_01 <span class="sc">^</span> <span class="dv">2</span>) <span class="sc">*</span> hour_c1,</span>
<span id="cb154-305"><a href="#cb154-305"></a>  <span class="at">canopy_sq_c2 =</span> (canopy_01 <span class="sc">^</span> <span class="dv">2</span>) <span class="sc">*</span> hour_c2,</span>
<span id="cb154-306"><a href="#cb154-306"></a>  </span>
<span id="cb154-307"><a href="#cb154-307"></a>  <span class="at">slope =</span> slope,</span>
<span id="cb154-308"><a href="#cb154-308"></a>  <span class="at">slope_s1 =</span> slope <span class="sc">*</span> hour_s1,</span>
<span id="cb154-309"><a href="#cb154-309"></a>  <span class="at">slope_s2 =</span> slope <span class="sc">*</span> hour_s2,</span>
<span id="cb154-310"><a href="#cb154-310"></a>  <span class="at">slope_c1 =</span> slope <span class="sc">*</span> hour_c1,</span>
<span id="cb154-311"><a href="#cb154-311"></a>  <span class="at">slope_c2 =</span> slope <span class="sc">*</span> hour_c2,</span>
<span id="cb154-312"><a href="#cb154-312"></a>  </span>
<span id="cb154-313"><a href="#cb154-313"></a>  <span class="at">herby =</span> veg_herby,</span>
<span id="cb154-314"><a href="#cb154-314"></a>  <span class="at">herby_s1 =</span> veg_herby <span class="sc">*</span> hour_s1,</span>
<span id="cb154-315"><a href="#cb154-315"></a>  <span class="at">herby_s2 =</span> veg_herby <span class="sc">*</span> hour_s2,</span>
<span id="cb154-316"><a href="#cb154-316"></a>  <span class="at">herby_c1 =</span> veg_herby <span class="sc">*</span> hour_c1,</span>
<span id="cb154-317"><a href="#cb154-317"></a>  <span class="at">herby_c2 =</span> veg_herby <span class="sc">*</span> hour_c2,</span>
<span id="cb154-318"><a href="#cb154-318"></a>  </span>
<span id="cb154-319"><a href="#cb154-319"></a>  <span class="at">step_l =</span> sl,</span>
<span id="cb154-320"><a href="#cb154-320"></a>  <span class="at">step_l_s1 =</span> sl <span class="sc">*</span> hour_s1,</span>
<span id="cb154-321"><a href="#cb154-321"></a>  <span class="at">step_l_s2 =</span> sl <span class="sc">*</span> hour_s2,</span>
<span id="cb154-322"><a href="#cb154-322"></a>  <span class="at">step_l_c1 =</span> sl <span class="sc">*</span> hour_c1,</span>
<span id="cb154-323"><a href="#cb154-323"></a>  <span class="at">step_l_c2 =</span> sl <span class="sc">*</span> hour_c2,</span>
<span id="cb154-324"><a href="#cb154-324"></a></span>
<span id="cb154-325"><a href="#cb154-325"></a>  <span class="at">log_step_l =</span> log_sl,</span>
<span id="cb154-326"><a href="#cb154-326"></a>  <span class="at">log_step_l_s1 =</span> log_sl <span class="sc">*</span> hour_s1,</span>
<span id="cb154-327"><a href="#cb154-327"></a>  <span class="at">log_step_l_s2 =</span> log_sl <span class="sc">*</span> hour_s2,</span>
<span id="cb154-328"><a href="#cb154-328"></a>  <span class="at">log_step_l_c1 =</span> log_sl <span class="sc">*</span> hour_c1,</span>
<span id="cb154-329"><a href="#cb154-329"></a>  <span class="at">log_step_l_c2 =</span> log_sl <span class="sc">*</span> hour_c2,</span>
<span id="cb154-330"><a href="#cb154-330"></a></span>
<span id="cb154-331"><a href="#cb154-331"></a>  <span class="at">cos_turn_a =</span> cos_ta,</span>
<span id="cb154-332"><a href="#cb154-332"></a>  <span class="at">cos_turn_a_s1 =</span> cos_ta <span class="sc">*</span> hour_s1,</span>
<span id="cb154-333"><a href="#cb154-333"></a>  <span class="at">cos_turn_a_s2 =</span> cos_ta <span class="sc">*</span> hour_s2,</span>
<span id="cb154-334"><a href="#cb154-334"></a>  <span class="at">cos_turn_a_c1 =</span> cos_ta <span class="sc">*</span> hour_c1,</span>
<span id="cb154-335"><a href="#cb154-335"></a>  <span class="at">cos_turn_a_c2 =</span> cos_ta <span class="sc">*</span> hour_c2)</span>
<span id="cb154-336"><a href="#cb154-336"></a></span>
<span id="cb154-337"><a href="#cb154-337"></a>buffalo_data_matrix_scaled <span class="ot">&lt;-</span> <span class="fu">scale</span>(buffalo_data_matrix_unscaled)</span>
<span id="cb154-338"><a href="#cb154-338"></a></span>
<span id="cb154-339"><a href="#cb154-339"></a>mean_vals <span class="ot">&lt;-</span> <span class="fu">attr</span>(buffalo_data_matrix_scaled, <span class="st">"scaled:center"</span>)</span>
<span id="cb154-340"><a href="#cb154-340"></a>sd_vals <span class="ot">&lt;-</span> <span class="fu">attr</span>(buffalo_data_matrix_scaled, <span class="st">"scaled:scale"</span>)</span>
<span id="cb154-341"><a href="#cb154-341"></a>scaling_attributes_2p <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">variable =</span> <span class="fu">names</span>(buffalo_data_matrix_unscaled), </span>
<span id="cb154-342"><a href="#cb154-342"></a>                                    <span class="at">mean =</span> mean_vals, <span class="at">sd =</span> sd_vals)</span>
<span id="cb154-343"><a href="#cb154-343"></a></span>
<span id="cb154-344"><a href="#cb154-344"></a>buffalo_data_scaled_2p <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">id =</span> buffalo_data<span class="sc">$</span>id,  </span>
<span id="cb154-345"><a href="#cb154-345"></a>                                     <span class="at">step_id =</span> buffalo_data<span class="sc">$</span>step_id, </span>
<span id="cb154-346"><a href="#cb154-346"></a>                                     <span class="at">y =</span> buffalo_data<span class="sc">$</span>y, </span>
<span id="cb154-347"><a href="#cb154-347"></a>                                     buffalo_data_matrix_scaled)</span>
<span id="cb154-348"><a href="#cb154-348"></a></span>
<span id="cb154-349"><a href="#cb154-349"></a><span class="in">```</span></span>
<span id="cb154-350"><a href="#cb154-350"></a></span>
<span id="cb154-351"><a href="#cb154-351"></a><span class="fu">## 3p</span></span>
<span id="cb154-352"><a href="#cb154-352"></a></span>
<span id="cb154-355"><a href="#cb154-355"></a><span class="in">```{r}</span></span>
<span id="cb154-356"><a href="#cb154-356"></a>buffalo_data_matrix_unscaled <span class="ot">&lt;-</span> buffalo_data <span class="sc">%&gt;%</span> <span class="fu">transmute</span>(</span>
<span id="cb154-357"><a href="#cb154-357"></a>  </span>
<span id="cb154-358"><a href="#cb154-358"></a>  <span class="at">ndvi =</span> ndvi_temporal,</span>
<span id="cb154-359"><a href="#cb154-359"></a>  <span class="at">ndvi_s1 =</span> ndvi_temporal <span class="sc">*</span> hour_s1,</span>
<span id="cb154-360"><a href="#cb154-360"></a>  <span class="at">ndvi_s2 =</span> ndvi_temporal <span class="sc">*</span> hour_s2,</span>
<span id="cb154-361"><a href="#cb154-361"></a>  <span class="at">ndvi_s3 =</span> ndvi_temporal <span class="sc">*</span> hour_s3,</span>
<span id="cb154-362"><a href="#cb154-362"></a>  <span class="at">ndvi_c1 =</span> ndvi_temporal <span class="sc">*</span> hour_c1,</span>
<span id="cb154-363"><a href="#cb154-363"></a>  <span class="at">ndvi_c2 =</span> ndvi_temporal <span class="sc">*</span> hour_c2,</span>
<span id="cb154-364"><a href="#cb154-364"></a>  <span class="at">ndvi_c3 =</span> ndvi_temporal <span class="sc">*</span> hour_c3,   </span>
<span id="cb154-365"><a href="#cb154-365"></a>  </span>
<span id="cb154-366"><a href="#cb154-366"></a>  <span class="at">ndvi_sq =</span> ndvi_temporal <span class="sc">^</span> <span class="dv">2</span>,</span>
<span id="cb154-367"><a href="#cb154-367"></a>  <span class="at">ndvi_sq_s1 =</span> (ndvi_temporal <span class="sc">^</span> <span class="dv">2</span>) <span class="sc">*</span> hour_s1,</span>
<span id="cb154-368"><a href="#cb154-368"></a>  <span class="at">ndvi_sq_s2 =</span> (ndvi_temporal <span class="sc">^</span> <span class="dv">2</span>) <span class="sc">*</span> hour_s2,</span>
<span id="cb154-369"><a href="#cb154-369"></a>  <span class="at">ndvi_sq_s3 =</span> (ndvi_temporal <span class="sc">^</span> <span class="dv">2</span>) <span class="sc">*</span> hour_s3,</span>
<span id="cb154-370"><a href="#cb154-370"></a>  <span class="at">ndvi_sq_c1 =</span> (ndvi_temporal <span class="sc">^</span> <span class="dv">2</span>) <span class="sc">*</span> hour_c1,</span>
<span id="cb154-371"><a href="#cb154-371"></a>  <span class="at">ndvi_sq_c2 =</span> (ndvi_temporal <span class="sc">^</span> <span class="dv">2</span>) <span class="sc">*</span> hour_c2,</span>
<span id="cb154-372"><a href="#cb154-372"></a>  <span class="at">ndvi_sq_c3 =</span> (ndvi_temporal <span class="sc">^</span> <span class="dv">2</span>) <span class="sc">*</span> hour_c3,   </span>
<span id="cb154-373"><a href="#cb154-373"></a>  </span>
<span id="cb154-374"><a href="#cb154-374"></a>  <span class="at">canopy =</span> canopy_01,</span>
<span id="cb154-375"><a href="#cb154-375"></a>  <span class="at">canopy_s1 =</span> canopy_01 <span class="sc">*</span> hour_s1,</span>
<span id="cb154-376"><a href="#cb154-376"></a>  <span class="at">canopy_s2 =</span> canopy_01 <span class="sc">*</span> hour_s2,</span>
<span id="cb154-377"><a href="#cb154-377"></a>  <span class="at">canopy_s3 =</span> canopy_01 <span class="sc">*</span> hour_s3,</span>
<span id="cb154-378"><a href="#cb154-378"></a>  <span class="at">canopy_c1 =</span> canopy_01 <span class="sc">*</span> hour_c1,</span>
<span id="cb154-379"><a href="#cb154-379"></a>  <span class="at">canopy_c2 =</span> canopy_01 <span class="sc">*</span> hour_c2,</span>
<span id="cb154-380"><a href="#cb154-380"></a>  <span class="at">canopy_c3 =</span> canopy_01 <span class="sc">*</span> hour_c3,   </span>
<span id="cb154-381"><a href="#cb154-381"></a>  </span>
<span id="cb154-382"><a href="#cb154-382"></a>  <span class="at">canopy_sq =</span> canopy_01 <span class="sc">^</span> <span class="dv">2</span>,</span>
<span id="cb154-383"><a href="#cb154-383"></a>  <span class="at">canopy_sq_s1 =</span> (canopy_01 <span class="sc">^</span> <span class="dv">2</span>) <span class="sc">*</span> hour_s1,</span>
<span id="cb154-384"><a href="#cb154-384"></a>  <span class="at">canopy_sq_s2 =</span> (canopy_01 <span class="sc">^</span> <span class="dv">2</span>) <span class="sc">*</span> hour_s2,</span>
<span id="cb154-385"><a href="#cb154-385"></a>  <span class="at">canopy_sq_s3 =</span> (canopy_01 <span class="sc">^</span> <span class="dv">2</span>) <span class="sc">*</span> hour_s3,</span>
<span id="cb154-386"><a href="#cb154-386"></a>  <span class="at">canopy_sq_c1 =</span> (canopy_01 <span class="sc">^</span> <span class="dv">2</span>) <span class="sc">*</span> hour_c1,</span>
<span id="cb154-387"><a href="#cb154-387"></a>  <span class="at">canopy_sq_c2 =</span> (canopy_01 <span class="sc">^</span> <span class="dv">2</span>) <span class="sc">*</span> hour_c2,</span>
<span id="cb154-388"><a href="#cb154-388"></a>  <span class="at">canopy_sq_c3 =</span> (canopy_01 <span class="sc">^</span> <span class="dv">2</span>) <span class="sc">*</span> hour_c3,   </span>
<span id="cb154-389"><a href="#cb154-389"></a>  </span>
<span id="cb154-390"><a href="#cb154-390"></a>  <span class="at">slope =</span> slope,</span>
<span id="cb154-391"><a href="#cb154-391"></a>  <span class="at">slope_s1 =</span> slope <span class="sc">*</span> hour_s1,</span>
<span id="cb154-392"><a href="#cb154-392"></a>  <span class="at">slope_s2 =</span> slope <span class="sc">*</span> hour_s2,</span>
<span id="cb154-393"><a href="#cb154-393"></a>  <span class="at">slope_s3 =</span> slope <span class="sc">*</span> hour_s3,</span>
<span id="cb154-394"><a href="#cb154-394"></a>  <span class="at">slope_c1 =</span> slope <span class="sc">*</span> hour_c1,</span>
<span id="cb154-395"><a href="#cb154-395"></a>  <span class="at">slope_c2 =</span> slope <span class="sc">*</span> hour_c2,</span>
<span id="cb154-396"><a href="#cb154-396"></a>  <span class="at">slope_c3 =</span> slope <span class="sc">*</span> hour_c3,   </span>
<span id="cb154-397"><a href="#cb154-397"></a>  </span>
<span id="cb154-398"><a href="#cb154-398"></a>  <span class="at">herby =</span> veg_herby,</span>
<span id="cb154-399"><a href="#cb154-399"></a>  <span class="at">herby_s1 =</span> veg_herby <span class="sc">*</span> hour_s1,</span>
<span id="cb154-400"><a href="#cb154-400"></a>  <span class="at">herby_s2 =</span> veg_herby <span class="sc">*</span> hour_s2,</span>
<span id="cb154-401"><a href="#cb154-401"></a>  <span class="at">herby_s3 =</span> veg_herby <span class="sc">*</span> hour_s3,</span>
<span id="cb154-402"><a href="#cb154-402"></a>  <span class="at">herby_c1 =</span> veg_herby <span class="sc">*</span> hour_c1,</span>
<span id="cb154-403"><a href="#cb154-403"></a>  <span class="at">herby_c2 =</span> veg_herby <span class="sc">*</span> hour_c2,</span>
<span id="cb154-404"><a href="#cb154-404"></a>  <span class="at">herby_c3 =</span> veg_herby <span class="sc">*</span> hour_c3,     </span>
<span id="cb154-405"><a href="#cb154-405"></a>  </span>
<span id="cb154-406"><a href="#cb154-406"></a>  <span class="at">step_l =</span> sl,</span>
<span id="cb154-407"><a href="#cb154-407"></a>  <span class="at">step_l_s1 =</span> sl <span class="sc">*</span> hour_s1,</span>
<span id="cb154-408"><a href="#cb154-408"></a>  <span class="at">step_l_s2 =</span> sl <span class="sc">*</span> hour_s2,</span>
<span id="cb154-409"><a href="#cb154-409"></a>  <span class="at">step_l_s3 =</span> sl <span class="sc">*</span> hour_s3,</span>
<span id="cb154-410"><a href="#cb154-410"></a>  <span class="at">step_l_c1 =</span> sl <span class="sc">*</span> hour_c1,</span>
<span id="cb154-411"><a href="#cb154-411"></a>  <span class="at">step_l_c2 =</span> sl <span class="sc">*</span> hour_c2,</span>
<span id="cb154-412"><a href="#cb154-412"></a>  <span class="at">step_l_c3 =</span> sl <span class="sc">*</span> hour_c3,</span>
<span id="cb154-413"><a href="#cb154-413"></a></span>
<span id="cb154-414"><a href="#cb154-414"></a>  <span class="at">log_step_l =</span> log_sl,</span>
<span id="cb154-415"><a href="#cb154-415"></a>  <span class="at">log_step_l_s1 =</span> log_sl <span class="sc">*</span> hour_s1,</span>
<span id="cb154-416"><a href="#cb154-416"></a>  <span class="at">log_step_l_s2 =</span> log_sl <span class="sc">*</span> hour_s2,</span>
<span id="cb154-417"><a href="#cb154-417"></a>  <span class="at">log_step_l_s3 =</span> log_sl <span class="sc">*</span> hour_s3,</span>
<span id="cb154-418"><a href="#cb154-418"></a>  <span class="at">log_step_l_c1 =</span> log_sl <span class="sc">*</span> hour_c1,</span>
<span id="cb154-419"><a href="#cb154-419"></a>  <span class="at">log_step_l_c2 =</span> log_sl <span class="sc">*</span> hour_c2,</span>
<span id="cb154-420"><a href="#cb154-420"></a>  <span class="at">log_step_l_c3 =</span> log_sl <span class="sc">*</span> hour_c3,</span>
<span id="cb154-421"><a href="#cb154-421"></a></span>
<span id="cb154-422"><a href="#cb154-422"></a>  <span class="at">cos_turn_a =</span> cos_ta,</span>
<span id="cb154-423"><a href="#cb154-423"></a>  <span class="at">cos_turn_a_s1 =</span> cos_ta <span class="sc">*</span> hour_s1,</span>
<span id="cb154-424"><a href="#cb154-424"></a>  <span class="at">cos_turn_a_s2 =</span> cos_ta <span class="sc">*</span> hour_s2,</span>
<span id="cb154-425"><a href="#cb154-425"></a>  <span class="at">cos_turn_a_s3 =</span> cos_ta <span class="sc">*</span> hour_s3,</span>
<span id="cb154-426"><a href="#cb154-426"></a>  <span class="at">cos_turn_a_c1 =</span> cos_ta <span class="sc">*</span> hour_c1,</span>
<span id="cb154-427"><a href="#cb154-427"></a>  <span class="at">cos_turn_a_c2 =</span> cos_ta <span class="sc">*</span> hour_c2,</span>
<span id="cb154-428"><a href="#cb154-428"></a>  <span class="at">cos_turn_a_c3 =</span> cos_ta <span class="sc">*</span> hour_c3)</span>
<span id="cb154-429"><a href="#cb154-429"></a></span>
<span id="cb154-430"><a href="#cb154-430"></a>buffalo_data_matrix_scaled <span class="ot">&lt;-</span> <span class="fu">scale</span>(buffalo_data_matrix_unscaled)</span>
<span id="cb154-431"><a href="#cb154-431"></a></span>
<span id="cb154-432"><a href="#cb154-432"></a>mean_vals <span class="ot">&lt;-</span> <span class="fu">attr</span>(buffalo_data_matrix_scaled, <span class="st">"scaled:center"</span>)</span>
<span id="cb154-433"><a href="#cb154-433"></a>sd_vals <span class="ot">&lt;-</span> <span class="fu">attr</span>(buffalo_data_matrix_scaled, <span class="st">"scaled:scale"</span>)</span>
<span id="cb154-434"><a href="#cb154-434"></a>scaling_attributes_3p <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">variable =</span> <span class="fu">names</span>(buffalo_data_matrix_unscaled), </span>
<span id="cb154-435"><a href="#cb154-435"></a>                                    <span class="at">mean =</span> mean_vals, <span class="at">sd =</span> sd_vals)</span>
<span id="cb154-436"><a href="#cb154-436"></a></span>
<span id="cb154-437"><a href="#cb154-437"></a>buffalo_data_scaled_3p <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">id =</span> buffalo_data<span class="sc">$</span>id,  </span>
<span id="cb154-438"><a href="#cb154-438"></a>                                     <span class="at">step_id =</span> buffalo_data<span class="sc">$</span>step_id, </span>
<span id="cb154-439"><a href="#cb154-439"></a>                                     <span class="at">y =</span> buffalo_data<span class="sc">$</span>y, </span>
<span id="cb154-440"><a href="#cb154-440"></a>                                     buffalo_data_matrix_scaled)</span>
<span id="cb154-441"><a href="#cb154-441"></a></span>
<span id="cb154-442"><a href="#cb154-442"></a><span class="in">```</span></span>
<span id="cb154-443"><a href="#cb154-443"></a>:::</span>
<span id="cb154-444"><a href="#cb154-444"></a></span>
<span id="cb154-445"><a href="#cb154-445"></a><span class="fu">## Model formula</span></span>
<span id="cb154-446"><a href="#cb154-446"></a></span>
<span id="cb154-447"><a href="#cb154-447"></a>As we have already precomputed and scaled the covariates, quadratic terms and interactions with the harmonics, we just include each parameter as a linear predictor.</span>
<span id="cb154-448"><a href="#cb154-448"></a></span>
<span id="cb154-449"><a href="#cb154-449"></a>::: {.panel-tabset group="model"}</span>
<span id="cb154-450"><a href="#cb154-450"></a><span class="fu">## 0p</span></span>
<span id="cb154-451"><a href="#cb154-451"></a></span>
<span id="cb154-454"><a href="#cb154-454"></a><span class="in">```{r}</span></span>
<span id="cb154-455"><a href="#cb154-455"></a><span class="co">#| label: 0p_formula</span></span>
<span id="cb154-456"><a href="#cb154-456"></a></span>
<span id="cb154-457"><a href="#cb154-457"></a>formula_0p <span class="ot">&lt;-</span> y <span class="sc">~</span> </span>
<span id="cb154-458"><a href="#cb154-458"></a>  </span>
<span id="cb154-459"><a href="#cb154-459"></a>  ndvi <span class="sc">+</span></span>
<span id="cb154-460"><a href="#cb154-460"></a>  ndvi_sq <span class="sc">+</span></span>
<span id="cb154-461"><a href="#cb154-461"></a>  canopy <span class="sc">+</span></span>
<span id="cb154-462"><a href="#cb154-462"></a>  canopy_sq <span class="sc">+</span></span>
<span id="cb154-463"><a href="#cb154-463"></a>  slope <span class="sc">+</span></span>
<span id="cb154-464"><a href="#cb154-464"></a>  herby <span class="sc">+</span></span>
<span id="cb154-465"><a href="#cb154-465"></a>  step_l <span class="sc">+</span></span>
<span id="cb154-466"><a href="#cb154-466"></a>  log_step_l <span class="sc">+</span></span>
<span id="cb154-467"><a href="#cb154-467"></a>  cos_turn_a <span class="sc">+</span></span>
<span id="cb154-468"><a href="#cb154-468"></a>  </span>
<span id="cb154-469"><a href="#cb154-469"></a>  <span class="fu">strata</span>(step_id)</span>
<span id="cb154-470"><a href="#cb154-470"></a></span>
<span id="cb154-471"><a href="#cb154-471"></a><span class="in">```</span></span>
<span id="cb154-472"><a href="#cb154-472"></a></span>
<span id="cb154-473"><a href="#cb154-473"></a><span class="fu">## 1p</span></span>
<span id="cb154-474"><a href="#cb154-474"></a></span>
<span id="cb154-477"><a href="#cb154-477"></a><span class="in">```{r}</span></span>
<span id="cb154-478"><a href="#cb154-478"></a><span class="co">#| label: 1p_formula</span></span>
<span id="cb154-479"><a href="#cb154-479"></a></span>
<span id="cb154-480"><a href="#cb154-480"></a>formula_1p <span class="ot">&lt;-</span> y <span class="sc">~</span> </span>
<span id="cb154-481"><a href="#cb154-481"></a>  </span>
<span id="cb154-482"><a href="#cb154-482"></a>  ndvi <span class="sc">+</span></span>
<span id="cb154-483"><a href="#cb154-483"></a>  ndvi_s1 <span class="sc">+</span></span>
<span id="cb154-484"><a href="#cb154-484"></a>  ndvi_c1 <span class="sc">+</span></span>
<span id="cb154-485"><a href="#cb154-485"></a>  </span>
<span id="cb154-486"><a href="#cb154-486"></a>  ndvi_sq <span class="sc">+</span></span>
<span id="cb154-487"><a href="#cb154-487"></a>  ndvi_sq_s1 <span class="sc">+</span></span>
<span id="cb154-488"><a href="#cb154-488"></a>  ndvi_sq_c1 <span class="sc">+</span></span>
<span id="cb154-489"><a href="#cb154-489"></a>  </span>
<span id="cb154-490"><a href="#cb154-490"></a>  canopy <span class="sc">+</span></span>
<span id="cb154-491"><a href="#cb154-491"></a>  canopy_s1 <span class="sc">+</span></span>
<span id="cb154-492"><a href="#cb154-492"></a>  canopy_c1 <span class="sc">+</span></span>
<span id="cb154-493"><a href="#cb154-493"></a>  </span>
<span id="cb154-494"><a href="#cb154-494"></a>  canopy_sq <span class="sc">+</span></span>
<span id="cb154-495"><a href="#cb154-495"></a>  canopy_sq_s1 <span class="sc">+</span></span>
<span id="cb154-496"><a href="#cb154-496"></a>  canopy_sq_c1 <span class="sc">+</span></span>
<span id="cb154-497"><a href="#cb154-497"></a>  </span>
<span id="cb154-498"><a href="#cb154-498"></a>  slope <span class="sc">+</span></span>
<span id="cb154-499"><a href="#cb154-499"></a>  slope_s1 <span class="sc">+</span></span>
<span id="cb154-500"><a href="#cb154-500"></a>  slope_c1 <span class="sc">+</span></span>
<span id="cb154-501"><a href="#cb154-501"></a>  </span>
<span id="cb154-502"><a href="#cb154-502"></a>  herby <span class="sc">+</span></span>
<span id="cb154-503"><a href="#cb154-503"></a>  herby_s1 <span class="sc">+</span></span>
<span id="cb154-504"><a href="#cb154-504"></a>  herby_c1 <span class="sc">+</span></span>
<span id="cb154-505"><a href="#cb154-505"></a>  </span>
<span id="cb154-506"><a href="#cb154-506"></a>  step_l <span class="sc">+</span></span>
<span id="cb154-507"><a href="#cb154-507"></a>  step_l_s1 <span class="sc">+</span></span>
<span id="cb154-508"><a href="#cb154-508"></a>  step_l_c1 <span class="sc">+</span></span>
<span id="cb154-509"><a href="#cb154-509"></a>  </span>
<span id="cb154-510"><a href="#cb154-510"></a>  log_step_l <span class="sc">+</span></span>
<span id="cb154-511"><a href="#cb154-511"></a>  log_step_l_s1 <span class="sc">+</span></span>
<span id="cb154-512"><a href="#cb154-512"></a>  log_step_l_c1 <span class="sc">+</span></span>
<span id="cb154-513"><a href="#cb154-513"></a></span>
<span id="cb154-514"><a href="#cb154-514"></a>  cos_turn_a <span class="sc">+</span></span>
<span id="cb154-515"><a href="#cb154-515"></a>  cos_turn_a_s1 <span class="sc">+</span></span>
<span id="cb154-516"><a href="#cb154-516"></a>  cos_turn_a_c1 <span class="sc">+</span></span>
<span id="cb154-517"><a href="#cb154-517"></a>  </span>
<span id="cb154-518"><a href="#cb154-518"></a>  <span class="fu">strata</span>(step_id) </span>
<span id="cb154-519"><a href="#cb154-519"></a></span>
<span id="cb154-520"><a href="#cb154-520"></a><span class="in">```</span></span>
<span id="cb154-521"><a href="#cb154-521"></a></span>
<span id="cb154-522"><a href="#cb154-522"></a><span class="fu">## 2p</span></span>
<span id="cb154-523"><a href="#cb154-523"></a></span>
<span id="cb154-526"><a href="#cb154-526"></a><span class="in">```{r}</span></span>
<span id="cb154-527"><a href="#cb154-527"></a><span class="co">#| label: 2p_formula</span></span>
<span id="cb154-528"><a href="#cb154-528"></a></span>
<span id="cb154-529"><a href="#cb154-529"></a>formula_2p <span class="ot">&lt;-</span> y <span class="sc">~</span> </span>
<span id="cb154-530"><a href="#cb154-530"></a>  </span>
<span id="cb154-531"><a href="#cb154-531"></a>  ndvi <span class="sc">+</span></span>
<span id="cb154-532"><a href="#cb154-532"></a>  ndvi_s1 <span class="sc">+</span></span>
<span id="cb154-533"><a href="#cb154-533"></a>  ndvi_s2 <span class="sc">+</span></span>
<span id="cb154-534"><a href="#cb154-534"></a>  ndvi_c1 <span class="sc">+</span></span>
<span id="cb154-535"><a href="#cb154-535"></a>  ndvi_c2 <span class="sc">+</span></span>
<span id="cb154-536"><a href="#cb154-536"></a>  </span>
<span id="cb154-537"><a href="#cb154-537"></a>  ndvi_sq <span class="sc">+</span></span>
<span id="cb154-538"><a href="#cb154-538"></a>  ndvi_sq_s1 <span class="sc">+</span></span>
<span id="cb154-539"><a href="#cb154-539"></a>  ndvi_sq_s2 <span class="sc">+</span></span>
<span id="cb154-540"><a href="#cb154-540"></a>  ndvi_sq_c1 <span class="sc">+</span></span>
<span id="cb154-541"><a href="#cb154-541"></a>  ndvi_sq_c2 <span class="sc">+</span></span>
<span id="cb154-542"><a href="#cb154-542"></a>  </span>
<span id="cb154-543"><a href="#cb154-543"></a>  canopy <span class="sc">+</span></span>
<span id="cb154-544"><a href="#cb154-544"></a>  canopy_s1 <span class="sc">+</span></span>
<span id="cb154-545"><a href="#cb154-545"></a>  canopy_s2 <span class="sc">+</span></span>
<span id="cb154-546"><a href="#cb154-546"></a>  canopy_c1 <span class="sc">+</span></span>
<span id="cb154-547"><a href="#cb154-547"></a>  canopy_c2 <span class="sc">+</span></span>
<span id="cb154-548"><a href="#cb154-548"></a>  </span>
<span id="cb154-549"><a href="#cb154-549"></a>  canopy_sq <span class="sc">+</span></span>
<span id="cb154-550"><a href="#cb154-550"></a>  canopy_sq_s1 <span class="sc">+</span></span>
<span id="cb154-551"><a href="#cb154-551"></a>  canopy_sq_s2 <span class="sc">+</span></span>
<span id="cb154-552"><a href="#cb154-552"></a>  canopy_sq_c1 <span class="sc">+</span></span>
<span id="cb154-553"><a href="#cb154-553"></a>  canopy_sq_c2 <span class="sc">+</span></span>
<span id="cb154-554"><a href="#cb154-554"></a>  </span>
<span id="cb154-555"><a href="#cb154-555"></a>  slope <span class="sc">+</span></span>
<span id="cb154-556"><a href="#cb154-556"></a>  slope_s1 <span class="sc">+</span></span>
<span id="cb154-557"><a href="#cb154-557"></a>  slope_s2 <span class="sc">+</span></span>
<span id="cb154-558"><a href="#cb154-558"></a>  slope_c1 <span class="sc">+</span></span>
<span id="cb154-559"><a href="#cb154-559"></a>  slope_c2 <span class="sc">+</span></span>
<span id="cb154-560"><a href="#cb154-560"></a>  </span>
<span id="cb154-561"><a href="#cb154-561"></a>  herby <span class="sc">+</span></span>
<span id="cb154-562"><a href="#cb154-562"></a>  herby_s1 <span class="sc">+</span></span>
<span id="cb154-563"><a href="#cb154-563"></a>  herby_s2 <span class="sc">+</span></span>
<span id="cb154-564"><a href="#cb154-564"></a>  herby_c1 <span class="sc">+</span></span>
<span id="cb154-565"><a href="#cb154-565"></a>  herby_c2 <span class="sc">+</span></span>
<span id="cb154-566"><a href="#cb154-566"></a>  </span>
<span id="cb154-567"><a href="#cb154-567"></a>  step_l <span class="sc">+</span></span>
<span id="cb154-568"><a href="#cb154-568"></a>  step_l_s1 <span class="sc">+</span></span>
<span id="cb154-569"><a href="#cb154-569"></a>  step_l_s2 <span class="sc">+</span></span>
<span id="cb154-570"><a href="#cb154-570"></a>  step_l_c1 <span class="sc">+</span></span>
<span id="cb154-571"><a href="#cb154-571"></a>  step_l_c2 <span class="sc">+</span></span>
<span id="cb154-572"><a href="#cb154-572"></a>  </span>
<span id="cb154-573"><a href="#cb154-573"></a>  log_step_l <span class="sc">+</span></span>
<span id="cb154-574"><a href="#cb154-574"></a>  log_step_l_s1 <span class="sc">+</span></span>
<span id="cb154-575"><a href="#cb154-575"></a>  log_step_l_s2 <span class="sc">+</span></span>
<span id="cb154-576"><a href="#cb154-576"></a>  log_step_l_c1 <span class="sc">+</span></span>
<span id="cb154-577"><a href="#cb154-577"></a>  log_step_l_c2 <span class="sc">+</span></span>
<span id="cb154-578"><a href="#cb154-578"></a></span>
<span id="cb154-579"><a href="#cb154-579"></a>  cos_turn_a <span class="sc">+</span></span>
<span id="cb154-580"><a href="#cb154-580"></a>  cos_turn_a_s1 <span class="sc">+</span></span>
<span id="cb154-581"><a href="#cb154-581"></a>  cos_turn_a_s2 <span class="sc">+</span></span>
<span id="cb154-582"><a href="#cb154-582"></a>  cos_turn_a_c1 <span class="sc">+</span></span>
<span id="cb154-583"><a href="#cb154-583"></a>  cos_turn_a_c2 <span class="sc">+</span></span>
<span id="cb154-584"><a href="#cb154-584"></a>  </span>
<span id="cb154-585"><a href="#cb154-585"></a>  <span class="fu">strata</span>(step_id) </span>
<span id="cb154-586"><a href="#cb154-586"></a></span>
<span id="cb154-587"><a href="#cb154-587"></a><span class="in">```</span></span>
<span id="cb154-588"><a href="#cb154-588"></a></span>
<span id="cb154-589"><a href="#cb154-589"></a><span class="fu">## 3p</span></span>
<span id="cb154-590"><a href="#cb154-590"></a></span>
<span id="cb154-593"><a href="#cb154-593"></a><span class="in">```{r}</span></span>
<span id="cb154-594"><a href="#cb154-594"></a><span class="co">#| label: 3p_formula</span></span>
<span id="cb154-595"><a href="#cb154-595"></a></span>
<span id="cb154-596"><a href="#cb154-596"></a>formula_3p <span class="ot">&lt;-</span> y <span class="sc">~</span> </span>
<span id="cb154-597"><a href="#cb154-597"></a>  </span>
<span id="cb154-598"><a href="#cb154-598"></a>  ndvi <span class="sc">+</span></span>
<span id="cb154-599"><a href="#cb154-599"></a>  ndvi_s1 <span class="sc">+</span></span>
<span id="cb154-600"><a href="#cb154-600"></a>  ndvi_s2 <span class="sc">+</span></span>
<span id="cb154-601"><a href="#cb154-601"></a>  ndvi_s3 <span class="sc">+</span>  </span>
<span id="cb154-602"><a href="#cb154-602"></a>  ndvi_c1 <span class="sc">+</span></span>
<span id="cb154-603"><a href="#cb154-603"></a>  ndvi_c2 <span class="sc">+</span></span>
<span id="cb154-604"><a href="#cb154-604"></a>  ndvi_c3 <span class="sc">+</span>  </span>
<span id="cb154-605"><a href="#cb154-605"></a>  </span>
<span id="cb154-606"><a href="#cb154-606"></a>  ndvi_sq <span class="sc">+</span></span>
<span id="cb154-607"><a href="#cb154-607"></a>  ndvi_sq_s1 <span class="sc">+</span></span>
<span id="cb154-608"><a href="#cb154-608"></a>  ndvi_sq_s2 <span class="sc">+</span></span>
<span id="cb154-609"><a href="#cb154-609"></a>  ndvi_sq_s3 <span class="sc">+</span>  </span>
<span id="cb154-610"><a href="#cb154-610"></a>  ndvi_sq_c1 <span class="sc">+</span></span>
<span id="cb154-611"><a href="#cb154-611"></a>  ndvi_sq_c2 <span class="sc">+</span></span>
<span id="cb154-612"><a href="#cb154-612"></a>  ndvi_sq_c3 <span class="sc">+</span>  </span>
<span id="cb154-613"><a href="#cb154-613"></a>  </span>
<span id="cb154-614"><a href="#cb154-614"></a>  canopy <span class="sc">+</span></span>
<span id="cb154-615"><a href="#cb154-615"></a>  canopy_s1 <span class="sc">+</span></span>
<span id="cb154-616"><a href="#cb154-616"></a>  canopy_s2 <span class="sc">+</span></span>
<span id="cb154-617"><a href="#cb154-617"></a>  canopy_s3 <span class="sc">+</span>  </span>
<span id="cb154-618"><a href="#cb154-618"></a>  canopy_c1 <span class="sc">+</span></span>
<span id="cb154-619"><a href="#cb154-619"></a>  canopy_c2 <span class="sc">+</span></span>
<span id="cb154-620"><a href="#cb154-620"></a>  canopy_c3 <span class="sc">+</span>  </span>
<span id="cb154-621"><a href="#cb154-621"></a>  </span>
<span id="cb154-622"><a href="#cb154-622"></a>  canopy_sq <span class="sc">+</span></span>
<span id="cb154-623"><a href="#cb154-623"></a>  canopy_sq_s1 <span class="sc">+</span></span>
<span id="cb154-624"><a href="#cb154-624"></a>  canopy_sq_s2 <span class="sc">+</span></span>
<span id="cb154-625"><a href="#cb154-625"></a>  canopy_sq_s3 <span class="sc">+</span>  </span>
<span id="cb154-626"><a href="#cb154-626"></a>  canopy_sq_c1 <span class="sc">+</span></span>
<span id="cb154-627"><a href="#cb154-627"></a>  canopy_sq_c2 <span class="sc">+</span></span>
<span id="cb154-628"><a href="#cb154-628"></a>  canopy_sq_c3 <span class="sc">+</span>  </span>
<span id="cb154-629"><a href="#cb154-629"></a>  </span>
<span id="cb154-630"><a href="#cb154-630"></a>  slope <span class="sc">+</span></span>
<span id="cb154-631"><a href="#cb154-631"></a>  slope_s1 <span class="sc">+</span></span>
<span id="cb154-632"><a href="#cb154-632"></a>  slope_s2 <span class="sc">+</span></span>
<span id="cb154-633"><a href="#cb154-633"></a>  slope_s3 <span class="sc">+</span>  </span>
<span id="cb154-634"><a href="#cb154-634"></a>  slope_c1 <span class="sc">+</span></span>
<span id="cb154-635"><a href="#cb154-635"></a>  slope_c2 <span class="sc">+</span></span>
<span id="cb154-636"><a href="#cb154-636"></a>  slope_c3 <span class="sc">+</span>  </span>
<span id="cb154-637"><a href="#cb154-637"></a>  </span>
<span id="cb154-638"><a href="#cb154-638"></a>  herby <span class="sc">+</span></span>
<span id="cb154-639"><a href="#cb154-639"></a>  herby_s1 <span class="sc">+</span></span>
<span id="cb154-640"><a href="#cb154-640"></a>  herby_s2 <span class="sc">+</span></span>
<span id="cb154-641"><a href="#cb154-641"></a>  herby_s3 <span class="sc">+</span>  </span>
<span id="cb154-642"><a href="#cb154-642"></a>  herby_c1 <span class="sc">+</span></span>
<span id="cb154-643"><a href="#cb154-643"></a>  herby_c2 <span class="sc">+</span></span>
<span id="cb154-644"><a href="#cb154-644"></a>  herby_c3 <span class="sc">+</span>   </span>
<span id="cb154-645"><a href="#cb154-645"></a>  </span>
<span id="cb154-646"><a href="#cb154-646"></a>  step_l <span class="sc">+</span></span>
<span id="cb154-647"><a href="#cb154-647"></a>  step_l_s1 <span class="sc">+</span></span>
<span id="cb154-648"><a href="#cb154-648"></a>  step_l_s2 <span class="sc">+</span></span>
<span id="cb154-649"><a href="#cb154-649"></a>  step_l_s3 <span class="sc">+</span>  </span>
<span id="cb154-650"><a href="#cb154-650"></a>  step_l_c1 <span class="sc">+</span></span>
<span id="cb154-651"><a href="#cb154-651"></a>  step_l_c2 <span class="sc">+</span></span>
<span id="cb154-652"><a href="#cb154-652"></a>  step_l_c3 <span class="sc">+</span>  </span>
<span id="cb154-653"><a href="#cb154-653"></a>  </span>
<span id="cb154-654"><a href="#cb154-654"></a>  log_step_l <span class="sc">+</span></span>
<span id="cb154-655"><a href="#cb154-655"></a>  log_step_l_s1 <span class="sc">+</span></span>
<span id="cb154-656"><a href="#cb154-656"></a>  log_step_l_s2 <span class="sc">+</span></span>
<span id="cb154-657"><a href="#cb154-657"></a>  log_step_l_s3 <span class="sc">+</span>  </span>
<span id="cb154-658"><a href="#cb154-658"></a>  log_step_l_c1 <span class="sc">+</span></span>
<span id="cb154-659"><a href="#cb154-659"></a>  log_step_l_c2 <span class="sc">+</span></span>
<span id="cb154-660"><a href="#cb154-660"></a>  log_step_l_c3 <span class="sc">+</span>  </span>
<span id="cb154-661"><a href="#cb154-661"></a>  </span>
<span id="cb154-662"><a href="#cb154-662"></a>  cos_turn_a <span class="sc">+</span></span>
<span id="cb154-663"><a href="#cb154-663"></a>  cos_turn_a_s1 <span class="sc">+</span></span>
<span id="cb154-664"><a href="#cb154-664"></a>  cos_turn_a_s2 <span class="sc">+</span></span>
<span id="cb154-665"><a href="#cb154-665"></a>  cos_turn_a_s3 <span class="sc">+</span>  </span>
<span id="cb154-666"><a href="#cb154-666"></a>  cos_turn_a_c1 <span class="sc">+</span></span>
<span id="cb154-667"><a href="#cb154-667"></a>  cos_turn_a_c2 <span class="sc">+</span></span>
<span id="cb154-668"><a href="#cb154-668"></a>  cos_turn_a_c3 <span class="sc">+</span></span>
<span id="cb154-669"><a href="#cb154-669"></a>  </span>
<span id="cb154-670"><a href="#cb154-670"></a>  <span class="fu">strata</span>(step_id)</span>
<span id="cb154-671"><a href="#cb154-671"></a></span>
<span id="cb154-672"><a href="#cb154-672"></a><span class="in">```</span></span>
<span id="cb154-673"><a href="#cb154-673"></a>:::</span>
<span id="cb154-674"><a href="#cb154-674"></a></span>
<span id="cb154-675"><a href="#cb154-675"></a><span class="fu">## Fit the model</span></span>
<span id="cb154-676"><a href="#cb154-676"></a></span>
<span id="cb154-677"><a href="#cb154-677"></a>As we have already fitted the model, we will load it here, but if the model_fit file doesn't exist, it will run the model fitting code. Be careful here that if you change the model formula, you will need to delete or rename the model_fit file to re-run the model fitting code, otherwise it will just load the previous model.</span>
<span id="cb154-678"><a href="#cb154-678"></a></span>
<span id="cb154-679"><a href="#cb154-679"></a>We are fitting a single model to the focal individual.</span>
<span id="cb154-680"><a href="#cb154-680"></a></span>
<span id="cb154-681"><a href="#cb154-681"></a>::: {.panel-tabset group="model"}</span>
<span id="cb154-682"><a href="#cb154-682"></a><span class="fu">## 0p</span></span>
<span id="cb154-683"><a href="#cb154-683"></a></span>
<span id="cb154-686"><a href="#cb154-686"></a><span class="in">```{r}</span></span>
<span id="cb154-687"><a href="#cb154-687"></a><span class="co">#| label: 0p_model_fit</span></span>
<span id="cb154-688"><a href="#cb154-688"></a></span>
<span id="cb154-689"><a href="#cb154-689"></a><span class="cf">if</span>(<span class="fu">file.exists</span>(<span class="fu">paste0</span>(<span class="st">"ssf_coefficients/model_id"</span>, focal_id, <span class="st">"_0p_harms.rds"</span>))) {</span>
<span id="cb154-690"><a href="#cb154-690"></a>  </span>
<span id="cb154-691"><a href="#cb154-691"></a>  model_0p_harms <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="fu">paste0</span>(<span class="st">"ssf_coefficients/model_id"</span>, focal_id, <span class="st">"_0p_harms.rds"</span>))</span>
<span id="cb154-692"><a href="#cb154-692"></a>  <span class="fu">print</span>(<span class="st">"Read existing model"</span>)</span>
<span id="cb154-693"><a href="#cb154-693"></a>  </span>
<span id="cb154-694"><a href="#cb154-694"></a>} <span class="cf">else</span> {</span>
<span id="cb154-695"><a href="#cb154-695"></a>  </span>
<span id="cb154-696"><a href="#cb154-696"></a>  <span class="fu">tic</span>()</span>
<span id="cb154-697"><a href="#cb154-697"></a>    model_0p_harms <span class="ot">&lt;-</span> <span class="fu">fit_clogit</span>(<span class="at">formula =</span> formula_0p,</span>
<span id="cb154-698"><a href="#cb154-698"></a>                                 <span class="at">data =</span> buffalo_data_scaled_0p)</span>
<span id="cb154-699"><a href="#cb154-699"></a>  <span class="fu">toc</span>()</span>
<span id="cb154-700"><a href="#cb154-700"></a>  </span>
<span id="cb154-701"><a href="#cb154-701"></a>  <span class="co"># save model object</span></span>
<span id="cb154-702"><a href="#cb154-702"></a>  <span class="fu">saveRDS</span>(model_0p_harms, <span class="at">file =</span> <span class="fu">paste0</span>(<span class="st">"ssf_coefficients/model_id"</span>, focal_id, <span class="st">"_0p_harms.rds"</span>))</span>
<span id="cb154-703"><a href="#cb154-703"></a>  </span>
<span id="cb154-704"><a href="#cb154-704"></a>  <span class="fu">print</span>(<span class="st">"Fitted model"</span>)</span>
<span id="cb154-705"><a href="#cb154-705"></a>  <span class="fu">beep</span>(<span class="at">sound =</span> <span class="dv">2</span>)</span>
<span id="cb154-706"><a href="#cb154-706"></a></span>
<span id="cb154-707"><a href="#cb154-707"></a>}</span>
<span id="cb154-708"><a href="#cb154-708"></a></span>
<span id="cb154-709"><a href="#cb154-709"></a>model_0p_harms</span>
<span id="cb154-710"><a href="#cb154-710"></a></span>
<span id="cb154-711"><a href="#cb154-711"></a><span class="in">```</span></span>
<span id="cb154-712"><a href="#cb154-712"></a></span>
<span id="cb154-713"><a href="#cb154-713"></a><span class="fu">## 1p</span></span>
<span id="cb154-714"><a href="#cb154-714"></a></span>
<span id="cb154-715"><a href="#cb154-715"></a><span class="in">```{r model fit 1p}</span></span>
<span id="cb154-716"><a href="#cb154-716"></a></span>
<span id="cb154-717"><a href="#cb154-717"></a><span class="in">if(file.exists(paste0("ssf_coefficients/model_id", focal_id, "_1p_harms.rds"))) {</span></span>
<span id="cb154-718"><a href="#cb154-718"></a><span class="in">  </span></span>
<span id="cb154-719"><a href="#cb154-719"></a><span class="in">  model_1p_harms &lt;- readRDS(paste0("ssf_coefficients/model_id", focal_id, "_1p_harms.rds"))</span></span>
<span id="cb154-720"><a href="#cb154-720"></a><span class="in">  print("Read existing model")</span></span>
<span id="cb154-721"><a href="#cb154-721"></a><span class="in">  </span></span>
<span id="cb154-722"><a href="#cb154-722"></a><span class="in">} else {</span></span>
<span id="cb154-723"><a href="#cb154-723"></a></span>
<span id="cb154-724"><a href="#cb154-724"></a><span class="in">  tic()</span></span>
<span id="cb154-725"><a href="#cb154-725"></a><span class="in">  model_1p_harms &lt;- fit_clogit(formula = formula_1p,</span></span>
<span id="cb154-726"><a href="#cb154-726"></a><span class="in">                               data = buffalo_data_scaled_1p)</span></span>
<span id="cb154-727"><a href="#cb154-727"></a><span class="in">  toc()</span></span>
<span id="cb154-728"><a href="#cb154-728"></a><span class="in">  </span></span>
<span id="cb154-729"><a href="#cb154-729"></a><span class="in">  # save model object</span></span>
<span id="cb154-730"><a href="#cb154-730"></a><span class="in">  saveRDS(model_1p_harms, file = paste0("ssf_coefficients/model_id", focal_id, "_1p_harms.rds"))</span></span>
<span id="cb154-731"><a href="#cb154-731"></a><span class="in">  </span></span>
<span id="cb154-732"><a href="#cb154-732"></a><span class="in">  print("Fitted model")</span></span>
<span id="cb154-733"><a href="#cb154-733"></a><span class="in">  beep(sound = 2)</span></span>
<span id="cb154-734"><a href="#cb154-734"></a></span>
<span id="cb154-735"><a href="#cb154-735"></a><span class="in">}</span></span>
<span id="cb154-736"><a href="#cb154-736"></a></span>
<span id="cb154-737"><a href="#cb154-737"></a><span class="in">model_1p_harms</span></span>
<span id="cb154-738"><a href="#cb154-738"></a></span>
<span id="cb154-739"><a href="#cb154-739"></a><span class="in">```</span></span>
<span id="cb154-740"><a href="#cb154-740"></a></span>
<span id="cb154-741"><a href="#cb154-741"></a><span class="fu">## 2p</span></span>
<span id="cb154-742"><a href="#cb154-742"></a></span>
<span id="cb154-743"><a href="#cb154-743"></a><span class="in">```{r model fit 2p}</span></span>
<span id="cb154-744"><a href="#cb154-744"></a></span>
<span id="cb154-745"><a href="#cb154-745"></a><span class="in">if(file.exists(paste0("ssf_coefficients/model_id", focal_id, "_2p_harms.rds"))) {</span></span>
<span id="cb154-746"><a href="#cb154-746"></a><span class="in">  </span></span>
<span id="cb154-747"><a href="#cb154-747"></a><span class="in">  model_2p_harms &lt;- readRDS(paste0("ssf_coefficients/model_id", focal_id, "_2p_harms.rds"))</span></span>
<span id="cb154-748"><a href="#cb154-748"></a><span class="in">  print("Read existing model")</span></span>
<span id="cb154-749"><a href="#cb154-749"></a><span class="in">  </span></span>
<span id="cb154-750"><a href="#cb154-750"></a><span class="in">} else {</span></span>
<span id="cb154-751"><a href="#cb154-751"></a></span>
<span id="cb154-752"><a href="#cb154-752"></a><span class="in">  tic()</span></span>
<span id="cb154-753"><a href="#cb154-753"></a><span class="in">  model_2p_harms &lt;- fit_clogit(formula = formula_2p,</span></span>
<span id="cb154-754"><a href="#cb154-754"></a><span class="in">                               data = buffalo_data_scaled_2p)</span></span>
<span id="cb154-755"><a href="#cb154-755"></a><span class="in">  toc()</span></span>
<span id="cb154-756"><a href="#cb154-756"></a><span class="in">  </span></span>
<span id="cb154-757"><a href="#cb154-757"></a><span class="in">  # save model object</span></span>
<span id="cb154-758"><a href="#cb154-758"></a><span class="in">  saveRDS(model_2p_harms, file = paste0("ssf_coefficients/model_id", focal_id, "_2p_harms.rds"))</span></span>
<span id="cb154-759"><a href="#cb154-759"></a><span class="in">  </span></span>
<span id="cb154-760"><a href="#cb154-760"></a><span class="in">  print("Fitted model")</span></span>
<span id="cb154-761"><a href="#cb154-761"></a><span class="in">  beep(sound = 2)</span></span>
<span id="cb154-762"><a href="#cb154-762"></a></span>
<span id="cb154-763"><a href="#cb154-763"></a><span class="in">}</span></span>
<span id="cb154-764"><a href="#cb154-764"></a></span>
<span id="cb154-765"><a href="#cb154-765"></a><span class="in">model_2p_harms</span></span>
<span id="cb154-766"><a href="#cb154-766"></a></span>
<span id="cb154-767"><a href="#cb154-767"></a><span class="in">```</span></span>
<span id="cb154-768"><a href="#cb154-768"></a></span>
<span id="cb154-769"><a href="#cb154-769"></a><span class="fu">## 3p</span></span>
<span id="cb154-770"><a href="#cb154-770"></a></span>
<span id="cb154-771"><a href="#cb154-771"></a><span class="in">```{r model fit 3p}</span></span>
<span id="cb154-772"><a href="#cb154-772"></a></span>
<span id="cb154-773"><a href="#cb154-773"></a><span class="in">if(file.exists(paste0("ssf_coefficients/model_id", focal_id, "_3p_harms.rds"))) {</span></span>
<span id="cb154-774"><a href="#cb154-774"></a><span class="in">  </span></span>
<span id="cb154-775"><a href="#cb154-775"></a><span class="in">  model_3p_harms &lt;- readRDS(paste0("ssf_coefficients/model_id", focal_id, "_3p_harms.rds"))</span></span>
<span id="cb154-776"><a href="#cb154-776"></a><span class="in">  print("Read existing model")</span></span>
<span id="cb154-777"><a href="#cb154-777"></a><span class="in">  </span></span>
<span id="cb154-778"><a href="#cb154-778"></a><span class="in">} else {</span></span>
<span id="cb154-779"><a href="#cb154-779"></a></span>
<span id="cb154-780"><a href="#cb154-780"></a><span class="in">  tic()</span></span>
<span id="cb154-781"><a href="#cb154-781"></a><span class="in">  model_3p_harms &lt;- fit_clogit(formula = formula_3p,</span></span>
<span id="cb154-782"><a href="#cb154-782"></a><span class="in">                               data = buffalo_data_scaled_3p)</span></span>
<span id="cb154-783"><a href="#cb154-783"></a><span class="in">  toc()</span></span>
<span id="cb154-784"><a href="#cb154-784"></a><span class="in">  </span></span>
<span id="cb154-785"><a href="#cb154-785"></a><span class="in">  # save model object</span></span>
<span id="cb154-786"><a href="#cb154-786"></a><span class="in">  saveRDS(model_3p_harms, file = paste0("ssf_coefficients/model_id", focal_id, "_3p_harms.rds"))</span></span>
<span id="cb154-787"><a href="#cb154-787"></a><span class="in">  </span></span>
<span id="cb154-788"><a href="#cb154-788"></a><span class="in">  print("Fitted model")</span></span>
<span id="cb154-789"><a href="#cb154-789"></a><span class="in">  beep(sound = 2)</span></span>
<span id="cb154-790"><a href="#cb154-790"></a></span>
<span id="cb154-791"><a href="#cb154-791"></a><span class="in">}</span></span>
<span id="cb154-792"><a href="#cb154-792"></a></span>
<span id="cb154-793"><a href="#cb154-793"></a><span class="in">model_3p_harms</span></span>
<span id="cb154-794"><a href="#cb154-794"></a></span>
<span id="cb154-795"><a href="#cb154-795"></a><span class="in">```</span></span>
<span id="cb154-796"><a href="#cb154-796"></a>:::</span>
<span id="cb154-797"><a href="#cb154-797"></a></span>
<span id="cb154-798"><a href="#cb154-798"></a><span class="fu">## Check the fitted model outputs</span></span>
<span id="cb154-799"><a href="#cb154-799"></a></span>
<span id="cb154-800"><a href="#cb154-800"></a>Create a dataframe of the coefficients with the scaling attributes that we saved when creating the data matrix. We can then return the coefficients to their natural scale by dividing by the scaling factor (standard deviation).</span>
<span id="cb154-801"><a href="#cb154-801"></a></span>
<span id="cb154-802"><a href="#cb154-802"></a>As we can see, we have a coefficient for each covariate by itself, and then one for each of the harmonic interactions. These are the 'weights' that we played around with in the <span class="in">`Ecography_DynamicSSF_Walkthrough_Harmonics_and_selection_surfaces`</span> walkthrough script in: <span class="co">[</span><span class="ot">swforrest/dynamic_SSF_sims</span><span class="co">](https://github.com/swforrest/dynamic_SSF_sims)</span>, and we reconstruct them in exactly the same way. We also have the coefficients for the quadratic terms and the interactions with the harmonics, which we have denoted as <span class="in">`ndvi_sq`</span> for instance. We will come back to these when we look at the selection surfaces.</span>
<span id="cb154-803"><a href="#cb154-803"></a></span>
<span id="cb154-804"><a href="#cb154-804"></a>::: {.panel-tabset group="model"}</span>
<span id="cb154-805"><a href="#cb154-805"></a><span class="fu">## 0p</span></span>
<span id="cb154-806"><a href="#cb154-806"></a></span>
<span id="cb154-809"><a href="#cb154-809"></a><span class="in">```{r}</span></span>
<span id="cb154-810"><a href="#cb154-810"></a><span class="co">#| label: 0p_model_summary</span></span>
<span id="cb154-811"><a href="#cb154-811"></a></span>
<span id="cb154-812"><a href="#cb154-812"></a>model_0p_harms</span>
<span id="cb154-813"><a href="#cb154-813"></a></span>
<span id="cb154-814"><a href="#cb154-814"></a><span class="co"># these create massive outputs for the dynamic models so we've commented them out</span></span>
<span id="cb154-815"><a href="#cb154-815"></a><span class="co"># model_0p_harms$model$coefficients</span></span>
<span id="cb154-816"><a href="#cb154-816"></a><span class="co"># model_0p_harms$se</span></span>
<span id="cb154-817"><a href="#cb154-817"></a><span class="co"># model_0p_harms$vcov</span></span>
<span id="cb154-818"><a href="#cb154-818"></a><span class="co"># diag(model_0p_harms$D) # between cluster variance</span></span>
<span id="cb154-819"><a href="#cb154-819"></a><span class="co"># model_0p_harms$r.effect # individual estimates</span></span>
<span id="cb154-820"><a href="#cb154-820"></a></span>
<span id="cb154-821"><a href="#cb154-821"></a><span class="co"># create a dataframe of the coefficients and their scaling attributes</span></span>
<span id="cb154-822"><a href="#cb154-822"></a>coefs_clr_0p <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">coefs =</span> <span class="fu">names</span>(model_0p_harms<span class="sc">$</span>model<span class="sc">$</span>coefficients), </span>
<span id="cb154-823"><a href="#cb154-823"></a>                           <span class="at">value =</span> model_0p_harms<span class="sc">$</span>model<span class="sc">$</span>coefficients)</span>
<span id="cb154-824"><a href="#cb154-824"></a></span>
<span id="cb154-825"><a href="#cb154-825"></a><span class="co"># return coefficients to natural scale</span></span>
<span id="cb154-826"><a href="#cb154-826"></a>coefs_clr_0p<span class="sc">$</span>scale_sd <span class="ot">&lt;-</span> scaling_attributes_0p<span class="sc">$</span>sd</span>
<span id="cb154-827"><a href="#cb154-827"></a>coefs_clr_0p <span class="ot">&lt;-</span> coefs_clr_0p <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">value_nat =</span> value <span class="sc">/</span> scale_sd)</span>
<span id="cb154-828"><a href="#cb154-828"></a></span>
<span id="cb154-829"><a href="#cb154-829"></a><span class="co"># show the first few rows</span></span>
<span id="cb154-830"><a href="#cb154-830"></a><span class="fu">head</span>(coefs_clr_0p)</span>
<span id="cb154-831"><a href="#cb154-831"></a></span>
<span id="cb154-832"><a href="#cb154-832"></a><span class="in">```</span></span>
<span id="cb154-833"><a href="#cb154-833"></a></span>
<span id="cb154-834"><a href="#cb154-834"></a><span class="fu">## 1p</span></span>
<span id="cb154-835"><a href="#cb154-835"></a></span>
<span id="cb154-838"><a href="#cb154-838"></a><span class="in">```{r}</span></span>
<span id="cb154-839"><a href="#cb154-839"></a><span class="co"># creates a huge output due to the correlation matrix</span></span>
<span id="cb154-840"><a href="#cb154-840"></a><span class="co"># model_1p_harms</span></span>
<span id="cb154-841"><a href="#cb154-841"></a></span>
<span id="cb154-842"><a href="#cb154-842"></a><span class="co"># model_1p_harms</span></span>
<span id="cb154-843"><a href="#cb154-843"></a><span class="co"># model_1p_harms$model$coefficients</span></span>
<span id="cb154-844"><a href="#cb154-844"></a><span class="co"># model_1p_harms$se</span></span>
<span id="cb154-845"><a href="#cb154-845"></a><span class="co"># model_1p_harms$vcov</span></span>
<span id="cb154-846"><a href="#cb154-846"></a><span class="co"># diag(model_1p_harms$D) # between cluster variance</span></span>
<span id="cb154-847"><a href="#cb154-847"></a><span class="co"># model_1p_harms$r.effect # individual estimates</span></span>
<span id="cb154-848"><a href="#cb154-848"></a></span>
<span id="cb154-849"><a href="#cb154-849"></a>coefs_clr_1p <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">coefs =</span> <span class="fu">names</span>(model_1p_harms<span class="sc">$</span>model<span class="sc">$</span>coefficients), </span>
<span id="cb154-850"><a href="#cb154-850"></a>                           <span class="at">value =</span> model_1p_harms<span class="sc">$</span>model<span class="sc">$</span>coefficients)</span>
<span id="cb154-851"><a href="#cb154-851"></a></span>
<span id="cb154-852"><a href="#cb154-852"></a><span class="co"># return coefficients to natural scale</span></span>
<span id="cb154-853"><a href="#cb154-853"></a>coefs_clr_1p<span class="sc">$</span>scale_sd <span class="ot">&lt;-</span> scaling_attributes_1p<span class="sc">$</span>sd</span>
<span id="cb154-854"><a href="#cb154-854"></a>coefs_clr_1p <span class="ot">&lt;-</span> coefs_clr_1p <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">value_nat =</span> value <span class="sc">/</span> scale_sd)</span>
<span id="cb154-855"><a href="#cb154-855"></a></span>
<span id="cb154-856"><a href="#cb154-856"></a><span class="co"># show the first few rows</span></span>
<span id="cb154-857"><a href="#cb154-857"></a><span class="fu">head</span>(coefs_clr_1p)</span>
<span id="cb154-858"><a href="#cb154-858"></a></span>
<span id="cb154-859"><a href="#cb154-859"></a><span class="in">```</span></span>
<span id="cb154-860"><a href="#cb154-860"></a></span>
<span id="cb154-861"><a href="#cb154-861"></a><span class="fu">## 2p</span></span>
<span id="cb154-862"><a href="#cb154-862"></a></span>
<span id="cb154-865"><a href="#cb154-865"></a><span class="in">```{r}</span></span>
<span id="cb154-866"><a href="#cb154-866"></a><span class="co"># creates a huge output due to the correlation matrix</span></span>
<span id="cb154-867"><a href="#cb154-867"></a><span class="co"># model_2p_harms</span></span>
<span id="cb154-868"><a href="#cb154-868"></a></span>
<span id="cb154-869"><a href="#cb154-869"></a><span class="co"># model_2p_harms</span></span>
<span id="cb154-870"><a href="#cb154-870"></a><span class="co"># model_2p_harms$model$coefficients</span></span>
<span id="cb154-871"><a href="#cb154-871"></a><span class="co"># model_2p_harms$se</span></span>
<span id="cb154-872"><a href="#cb154-872"></a><span class="co"># model_2p_harms$vcov</span></span>
<span id="cb154-873"><a href="#cb154-873"></a><span class="co"># diag(model_2p_harms$D) # between cluster variance</span></span>
<span id="cb154-874"><a href="#cb154-874"></a><span class="co"># model_2p_harms$r.effect # individual estimates</span></span>
<span id="cb154-875"><a href="#cb154-875"></a></span>
<span id="cb154-876"><a href="#cb154-876"></a><span class="co"># creating data frame of model coefficients</span></span>
<span id="cb154-877"><a href="#cb154-877"></a>coefs_clr_2p <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">coefs =</span> <span class="fu">names</span>(model_2p_harms<span class="sc">$</span>model<span class="sc">$</span>coefficients), </span>
<span id="cb154-878"><a href="#cb154-878"></a>                           <span class="at">value =</span> model_2p_harms<span class="sc">$</span>model<span class="sc">$</span>coefficients)</span>
<span id="cb154-879"><a href="#cb154-879"></a></span>
<span id="cb154-880"><a href="#cb154-880"></a><span class="co"># return coefficients to natural scale</span></span>
<span id="cb154-881"><a href="#cb154-881"></a>coefs_clr_2p<span class="sc">$</span>scale_sd <span class="ot">&lt;-</span> scaling_attributes_2p<span class="sc">$</span>sd</span>
<span id="cb154-882"><a href="#cb154-882"></a>coefs_clr_2p <span class="ot">&lt;-</span> coefs_clr_2p <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">value_nat =</span> value <span class="sc">/</span> scale_sd)</span>
<span id="cb154-883"><a href="#cb154-883"></a></span>
<span id="cb154-884"><a href="#cb154-884"></a><span class="co"># show the first few rows</span></span>
<span id="cb154-885"><a href="#cb154-885"></a><span class="fu">head</span>(coefs_clr_2p)</span>
<span id="cb154-886"><a href="#cb154-886"></a></span>
<span id="cb154-887"><a href="#cb154-887"></a><span class="in">```</span></span>
<span id="cb154-888"><a href="#cb154-888"></a></span>
<span id="cb154-889"><a href="#cb154-889"></a><span class="fu">## 3p</span></span>
<span id="cb154-890"><a href="#cb154-890"></a></span>
<span id="cb154-893"><a href="#cb154-893"></a><span class="in">```{r}</span></span>
<span id="cb154-894"><a href="#cb154-894"></a><span class="co"># creates a huge output due to the correlation matrix</span></span>
<span id="cb154-895"><a href="#cb154-895"></a><span class="co"># model_3p_harms</span></span>
<span id="cb154-896"><a href="#cb154-896"></a></span>
<span id="cb154-897"><a href="#cb154-897"></a><span class="co"># model_3p_harms$model$coefficients</span></span>
<span id="cb154-898"><a href="#cb154-898"></a><span class="co"># model_3p_harms$se</span></span>
<span id="cb154-899"><a href="#cb154-899"></a><span class="co"># model_3p_harms$vcov</span></span>
<span id="cb154-900"><a href="#cb154-900"></a><span class="co"># diag(model_3p_harms$D) # between cluster variance</span></span>
<span id="cb154-901"><a href="#cb154-901"></a><span class="co"># model_3p_harms$r.effect # individual estimates</span></span>
<span id="cb154-902"><a href="#cb154-902"></a></span>
<span id="cb154-903"><a href="#cb154-903"></a><span class="co"># creating dataframe of coefficients</span></span>
<span id="cb154-904"><a href="#cb154-904"></a>coefs_clr_3p <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">coefs =</span> <span class="fu">names</span>(model_3p_harms<span class="sc">$</span>model<span class="sc">$</span>coefficients), </span>
<span id="cb154-905"><a href="#cb154-905"></a>                           <span class="at">value =</span> model_3p_harms<span class="sc">$</span>model<span class="sc">$</span>coefficients)</span>
<span id="cb154-906"><a href="#cb154-906"></a></span>
<span id="cb154-907"><a href="#cb154-907"></a><span class="co"># return coefficients to natural scale</span></span>
<span id="cb154-908"><a href="#cb154-908"></a>coefs_clr_3p<span class="sc">$</span>scale_sd <span class="ot">&lt;-</span> scaling_attributes_3p<span class="sc">$</span>sd</span>
<span id="cb154-909"><a href="#cb154-909"></a>coefs_clr_3p <span class="ot">&lt;-</span> coefs_clr_3p <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">value_nat =</span> value <span class="sc">/</span> scale_sd)</span>
<span id="cb154-910"><a href="#cb154-910"></a></span>
<span id="cb154-911"><a href="#cb154-911"></a><span class="co"># show the first few rows</span></span>
<span id="cb154-912"><a href="#cb154-912"></a><span class="fu">head</span>(coefs_clr_3p)</span>
<span id="cb154-913"><a href="#cb154-913"></a></span>
<span id="cb154-914"><a href="#cb154-914"></a><span class="in">```</span></span>
<span id="cb154-915"><a href="#cb154-915"></a></span>
<span id="cb154-916"><a href="#cb154-916"></a>:::</span>
<span id="cb154-917"><a href="#cb154-917"></a></span>
<span id="cb154-918"><a href="#cb154-918"></a><span class="fu">## Reconstruct the temporally dynamic coefficients</span></span>
<span id="cb154-919"><a href="#cb154-919"></a></span>
<span id="cb154-920"><a href="#cb154-920"></a>First we reconstruct the hourly coefficients for the model with no harmonics. This step isn't necessary as we already have the coefficients, and we have already rescaled them in the dataframe we created above. But as we are also fitting harmonic models and recover their coefficients across time, we have used the same approach here so then we can plot them together and illustrate the static/dynamic outputs of the models. It also means that we can use the same simulation code (which indexes across the hour of the day), and just change the data frame of coefficients (as it will index across the coefficients of the static model but they won't change).</span>
<span id="cb154-921"><a href="#cb154-921"></a></span>
<span id="cb154-922"><a href="#cb154-922"></a>We need a sequence of values that covers a full period (or the period that we want to construct the function over, which can be more or less than 1 period). The sequence can be arbitrarily finely spaced. The smaller the increment the smoother the function will be for plotting. When simulating data from the temporally dynamic coefficients, we will subset to the increment that relates to the data collection and model fitting (i.e. one hour in this case).</span>
<span id="cb154-923"><a href="#cb154-923"></a></span>
<span id="cb154-924"><a href="#cb154-924"></a>Essentially, the coefficients can be considered as weights of the harmonics, which combine into a single function.</span>
<span id="cb154-925"><a href="#cb154-925"></a></span>
<span id="cb154-926"><a href="#cb154-926"></a>Now we can reconstruct the harmonic function using the formula that we put into our model by interacting the harmonic terms with each of the covariates, for two pairs of harmonics (2p) a single covariate, let's say herbaceous vegetation (herby), this would be written down as:</span>
<span id="cb154-927"><a href="#cb154-927"></a></span>
<span id="cb154-928"><a href="#cb154-928"></a>$$</span>
<span id="cb154-929"><a href="#cb154-929"></a>f = \beta_{herby} + </span>
<span id="cb154-930"><a href="#cb154-930"></a>\beta_{herby<span class="sc">\_</span>s1} \sin\left(\frac{2\pi t}{24}\right) +</span>
<span id="cb154-931"><a href="#cb154-931"></a>\beta_{herby<span class="sc">\_</span>c1} \cos\left(\frac{2\pi t}{24}\right) +</span>
<span id="cb154-932"><a href="#cb154-932"></a>\beta_{herby<span class="sc">\_</span>s2} \sin\left(\frac{4\pi t}{24}\right) +</span>
<span id="cb154-933"><a href="#cb154-933"></a>\beta_{herby<span class="sc">\_</span>c2} \cos\left(\frac{4\pi t}{24}\right),</span>
<span id="cb154-934"><a href="#cb154-934"></a>$$</span>
<span id="cb154-935"><a href="#cb154-935"></a></span>
<span id="cb154-936"><a href="#cb154-936"></a>where we have 5 $\beta_{herby}$ coefficients, one for the linear term, and one for each of the harmonic terms.</span>
<span id="cb154-937"><a href="#cb154-937"></a></span>
<span id="cb154-938"><a href="#cb154-938"></a>Here we use matrix multiplication to reconstruct the temporally dynamic coefficients. We provide some background in the <span class="in">`Ecography_DynamicSSF_Walkthrough_Harmonics_and_selection_surfaces`</span> script.</span>
<span id="cb154-939"><a href="#cb154-939"></a></span>
<span id="cb154-940"><a href="#cb154-940"></a>First we create a matrix of the values of the harmonics, which is just the sin and cos terms for each harmonic, and then we can multiply this by the coefficients to get the function. When we use two pairs of harmonics we will have 5 coefficients for each covariate (linear + 2 sine and 2 cosine), so there will be 5 columns in the matrix.</span>
<span id="cb154-941"><a href="#cb154-941"></a></span>
<span id="cb154-942"><a href="#cb154-942"></a>For matrix multiplication, the number of columns in the first matrix must be equal to the number of rows in the second matrix. The result will then have the same number of rows as the first matrix and the same number of columns as the second matrix.</span>
<span id="cb154-943"><a href="#cb154-943"></a></span>
<span id="cb154-944"><a href="#cb154-944"></a>Or in other words, if we have a 24 x 5 matrix of harmonics and a 5 x 1 matrix of coefficients, we will get a 24 x 1 matrix of the function, which corresponds to our 24 hours of the day.</span>
<span id="cb154-945"><a href="#cb154-945"></a></span>
<span id="cb154-946"><a href="#cb154-946"></a>::: {.panel-tabset group="model"}</span>
<span id="cb154-947"><a href="#cb154-947"></a><span class="fu">## 0p</span></span>
<span id="cb154-948"><a href="#cb154-948"></a></span>
<span id="cb154-951"><a href="#cb154-951"></a><span class="in">```{r}</span></span>
<span id="cb154-952"><a href="#cb154-952"></a><span class="co">#| label: 0p_reconstruct_coefs</span></span>
<span id="cb154-953"><a href="#cb154-953"></a></span>
<span id="cb154-954"><a href="#cb154-954"></a><span class="co"># increments are arbitrary - finer results in smoother curves</span></span>
<span id="cb154-955"><a href="#cb154-955"></a><span class="co"># for the simulations we will subset to the step interval</span></span>
<span id="cb154-956"><a href="#cb154-956"></a>hour <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="fl">23.9</span>,<span class="fl">0.1</span>) </span>
<span id="cb154-957"><a href="#cb154-957"></a></span>
<span id="cb154-958"><a href="#cb154-958"></a><span class="co"># create the dataframe of values of the harmonic terms over the period (here just the linear term)</span></span>
<span id="cb154-959"><a href="#cb154-959"></a>hour_harmonics_df_0p <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="st">"linear_term"</span> <span class="ot">=</span> <span class="fu">rep</span>(<span class="dv">1</span>, <span class="fu">length</span>(hour)))</span>
<span id="cb154-960"><a href="#cb154-960"></a></span>
<span id="cb154-961"><a href="#cb154-961"></a>harmonics_scaled_df_0p <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb154-962"><a href="#cb154-962"></a>  <span class="st">"hour"</span> <span class="ot">=</span> hour,</span>
<span id="cb154-963"><a href="#cb154-963"></a>  <span class="st">"ndvi"</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(</span>
<span id="cb154-964"><a href="#cb154-964"></a>    coefs_clr_0p <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"ndvi"</span>, coefs) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">grepl</span>(<span class="st">"sq"</span>, coefs)) <span class="sc">%&gt;%</span> </span>
<span id="cb154-965"><a href="#cb154-965"></a>      <span class="fu">pull</span>(value) <span class="sc">%&gt;%</span> <span class="fu">t</span>() <span class="sc">%*%</span> <span class="fu">t</span>(<span class="fu">as.matrix</span>(hour_harmonics_df_0p))),</span>
<span id="cb154-966"><a href="#cb154-966"></a>  <span class="st">"ndvi_2"</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(</span>
<span id="cb154-967"><a href="#cb154-967"></a>    coefs_clr_0p <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"ndvi_sq"</span>, coefs)) <span class="sc">%&gt;%</span> </span>
<span id="cb154-968"><a href="#cb154-968"></a>      <span class="fu">pull</span>(value) <span class="sc">%&gt;%</span> <span class="fu">t</span>() <span class="sc">%*%</span> <span class="fu">t</span>(<span class="fu">as.matrix</span>(hour_harmonics_df_0p))),</span>
<span id="cb154-969"><a href="#cb154-969"></a>  <span class="st">"canopy"</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(</span>
<span id="cb154-970"><a href="#cb154-970"></a>    coefs_clr_0p <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"canopy"</span>, coefs) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">grepl</span>(<span class="st">"sq"</span>, coefs)) <span class="sc">%&gt;%</span> </span>
<span id="cb154-971"><a href="#cb154-971"></a>      <span class="fu">pull</span>(value) <span class="sc">%&gt;%</span> <span class="fu">t</span>() <span class="sc">%*%</span> <span class="fu">t</span>(<span class="fu">as.matrix</span>(hour_harmonics_df_0p))),</span>
<span id="cb154-972"><a href="#cb154-972"></a>  <span class="st">"canopy_2"</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(</span>
<span id="cb154-973"><a href="#cb154-973"></a>    coefs_clr_0p <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"canopy_sq"</span>, coefs)) <span class="sc">%&gt;%</span> </span>
<span id="cb154-974"><a href="#cb154-974"></a>      <span class="fu">pull</span>(value) <span class="sc">%&gt;%</span> <span class="fu">t</span>() <span class="sc">%*%</span> <span class="fu">t</span>(<span class="fu">as.matrix</span>(hour_harmonics_df_0p))),</span>
<span id="cb154-975"><a href="#cb154-975"></a>  <span class="st">"slope"</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(</span>
<span id="cb154-976"><a href="#cb154-976"></a>    coefs_clr_0p <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"slope"</span>, coefs)) <span class="sc">%&gt;%</span> </span>
<span id="cb154-977"><a href="#cb154-977"></a>      <span class="fu">pull</span>(value) <span class="sc">%&gt;%</span> <span class="fu">t</span>() <span class="sc">%*%</span> <span class="fu">t</span>(<span class="fu">as.matrix</span>(hour_harmonics_df_0p))),</span>
<span id="cb154-978"><a href="#cb154-978"></a>  <span class="st">"herby"</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(</span>
<span id="cb154-979"><a href="#cb154-979"></a>    coefs_clr_0p <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"herby"</span>, coefs)) <span class="sc">%&gt;%</span> </span>
<span id="cb154-980"><a href="#cb154-980"></a>      <span class="fu">pull</span>(value) <span class="sc">%&gt;%</span> <span class="fu">t</span>() <span class="sc">%*%</span> <span class="fu">t</span>(<span class="fu">as.matrix</span>(hour_harmonics_df_0p))),</span>
<span id="cb154-981"><a href="#cb154-981"></a>  <span class="st">"sl"</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(</span>
<span id="cb154-982"><a href="#cb154-982"></a>    coefs_clr_0p <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"step_l"</span>, coefs) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">grepl</span>(<span class="st">"log"</span>, coefs)) <span class="sc">%&gt;%</span> </span>
<span id="cb154-983"><a href="#cb154-983"></a>      <span class="fu">pull</span>(value) <span class="sc">%&gt;%</span> <span class="fu">t</span>() <span class="sc">%*%</span> <span class="fu">t</span>(<span class="fu">as.matrix</span>(hour_harmonics_df_0p))),</span>
<span id="cb154-984"><a href="#cb154-984"></a>  <span class="st">"log_sl"</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(</span>
<span id="cb154-985"><a href="#cb154-985"></a>    coefs_clr_0p <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"log_step_l"</span>, coefs)) <span class="sc">%&gt;%</span> </span>
<span id="cb154-986"><a href="#cb154-986"></a>      <span class="fu">pull</span>(value) <span class="sc">%&gt;%</span> <span class="fu">t</span>() <span class="sc">%*%</span> <span class="fu">t</span>(<span class="fu">as.matrix</span>(hour_harmonics_df_0p))),</span>
<span id="cb154-987"><a href="#cb154-987"></a>  <span class="st">"cos_ta"</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(</span>
<span id="cb154-988"><a href="#cb154-988"></a>    coefs_clr_0p <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"cos"</span>, coefs)) <span class="sc">%&gt;%</span> </span>
<span id="cb154-989"><a href="#cb154-989"></a>      <span class="fu">pull</span>(value) <span class="sc">%&gt;%</span> <span class="fu">t</span>() <span class="sc">%*%</span> <span class="fu">t</span>(<span class="fu">as.matrix</span>(hour_harmonics_df_0p))))</span>
<span id="cb154-990"><a href="#cb154-990"></a></span>
<span id="cb154-991"><a href="#cb154-991"></a>harmonics_scaled_long_0p <span class="ot">&lt;-</span> <span class="fu">pivot_longer</span>(harmonics_scaled_df_0p, </span>
<span id="cb154-992"><a href="#cb154-992"></a>                                         <span class="at">cols =</span> <span class="sc">!</span><span class="dv">1</span>, </span>
<span id="cb154-993"><a href="#cb154-993"></a>                                         <span class="at">names_to =</span> <span class="st">"coef"</span>)</span>
<span id="cb154-994"><a href="#cb154-994"></a></span>
<span id="cb154-995"><a href="#cb154-995"></a><span class="in">```</span></span>
<span id="cb154-996"><a href="#cb154-996"></a></span>
<span id="cb154-997"><a href="#cb154-997"></a><span class="fu">## 1p</span></span>
<span id="cb154-998"><a href="#cb154-998"></a></span>
<span id="cb154-1001"><a href="#cb154-1001"></a><span class="in">```{r}</span></span>
<span id="cb154-1002"><a href="#cb154-1002"></a><span class="co"># create the dataframe of values of the harmonic terms over the period</span></span>
<span id="cb154-1003"><a href="#cb154-1003"></a>hour_harmonics_df_1p <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="st">"linear_term"</span> <span class="ot">=</span> <span class="fu">rep</span>(<span class="dv">1</span>, <span class="fu">length</span>(hour)),</span>
<span id="cb154-1004"><a href="#cb154-1004"></a>                                <span class="st">"hour_s1"</span> <span class="ot">=</span> <span class="fu">sin</span>(<span class="dv">2</span><span class="sc">*</span>pi<span class="sc">*</span>hour<span class="sc">/</span><span class="dv">24</span>),</span>
<span id="cb154-1005"><a href="#cb154-1005"></a>                                <span class="st">"hour_c1"</span> <span class="ot">=</span> <span class="fu">cos</span>(<span class="dv">2</span><span class="sc">*</span>pi<span class="sc">*</span>hour<span class="sc">/</span><span class="dv">24</span>))</span>
<span id="cb154-1006"><a href="#cb154-1006"></a></span>
<span id="cb154-1007"><a href="#cb154-1007"></a>harmonics_scaled_df_1p <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb154-1008"><a href="#cb154-1008"></a>  <span class="st">"hour"</span> <span class="ot">=</span> hour,</span>
<span id="cb154-1009"><a href="#cb154-1009"></a>  <span class="st">"ndvi"</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(</span>
<span id="cb154-1010"><a href="#cb154-1010"></a>    coefs_clr_1p <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"ndvi"</span>, coefs) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">grepl</span>(<span class="st">"sq"</span>, coefs)) <span class="sc">%&gt;%</span> </span>
<span id="cb154-1011"><a href="#cb154-1011"></a>      <span class="fu">pull</span>(value) <span class="sc">%&gt;%</span> <span class="fu">t</span>() <span class="sc">%*%</span> <span class="fu">t</span>(<span class="fu">as.matrix</span>(hour_harmonics_df_1p))),</span>
<span id="cb154-1012"><a href="#cb154-1012"></a>  <span class="st">"ndvi_2"</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(</span>
<span id="cb154-1013"><a href="#cb154-1013"></a>    coefs_clr_1p <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"ndvi_sq"</span>, coefs)) <span class="sc">%&gt;%</span> </span>
<span id="cb154-1014"><a href="#cb154-1014"></a>      <span class="fu">pull</span>(value) <span class="sc">%&gt;%</span> <span class="fu">t</span>() <span class="sc">%*%</span> <span class="fu">t</span>(<span class="fu">as.matrix</span>(hour_harmonics_df_1p))),</span>
<span id="cb154-1015"><a href="#cb154-1015"></a>  <span class="st">"canopy"</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(</span>
<span id="cb154-1016"><a href="#cb154-1016"></a>    coefs_clr_1p <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"canopy"</span>, coefs) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">grepl</span>(<span class="st">"sq"</span>, coefs)) <span class="sc">%&gt;%</span> </span>
<span id="cb154-1017"><a href="#cb154-1017"></a>      <span class="fu">pull</span>(value) <span class="sc">%&gt;%</span> <span class="fu">t</span>() <span class="sc">%*%</span> <span class="fu">t</span>(<span class="fu">as.matrix</span>(hour_harmonics_df_1p))),</span>
<span id="cb154-1018"><a href="#cb154-1018"></a>  <span class="st">"canopy_2"</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(</span>
<span id="cb154-1019"><a href="#cb154-1019"></a>    coefs_clr_1p <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"canopy_sq"</span>, coefs)) <span class="sc">%&gt;%</span> </span>
<span id="cb154-1020"><a href="#cb154-1020"></a>      <span class="fu">pull</span>(value) <span class="sc">%&gt;%</span> <span class="fu">t</span>() <span class="sc">%*%</span> <span class="fu">t</span>(<span class="fu">as.matrix</span>(hour_harmonics_df_1p))),</span>
<span id="cb154-1021"><a href="#cb154-1021"></a>  <span class="st">"slope"</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(</span>
<span id="cb154-1022"><a href="#cb154-1022"></a>    coefs_clr_1p <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"slope"</span>, coefs)) <span class="sc">%&gt;%</span> </span>
<span id="cb154-1023"><a href="#cb154-1023"></a>      <span class="fu">pull</span>(value) <span class="sc">%&gt;%</span> <span class="fu">t</span>() <span class="sc">%*%</span> <span class="fu">t</span>(<span class="fu">as.matrix</span>(hour_harmonics_df_1p))),</span>
<span id="cb154-1024"><a href="#cb154-1024"></a>  <span class="st">"herby"</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(</span>
<span id="cb154-1025"><a href="#cb154-1025"></a>    coefs_clr_1p <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"herby"</span>, coefs)) <span class="sc">%&gt;%</span> </span>
<span id="cb154-1026"><a href="#cb154-1026"></a>      <span class="fu">pull</span>(value) <span class="sc">%&gt;%</span> <span class="fu">t</span>() <span class="sc">%*%</span> <span class="fu">t</span>(<span class="fu">as.matrix</span>(hour_harmonics_df_1p))),</span>
<span id="cb154-1027"><a href="#cb154-1027"></a>  <span class="st">"sl"</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(</span>
<span id="cb154-1028"><a href="#cb154-1028"></a>    coefs_clr_1p <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"step_l"</span>, coefs) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">grepl</span>(<span class="st">"log"</span>, coefs)) <span class="sc">%&gt;%</span> </span>
<span id="cb154-1029"><a href="#cb154-1029"></a>      <span class="fu">pull</span>(value) <span class="sc">%&gt;%</span> <span class="fu">t</span>() <span class="sc">%*%</span> <span class="fu">t</span>(<span class="fu">as.matrix</span>(hour_harmonics_df_1p))),</span>
<span id="cb154-1030"><a href="#cb154-1030"></a>  <span class="st">"log_sl"</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(</span>
<span id="cb154-1031"><a href="#cb154-1031"></a>    coefs_clr_1p <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"log_step_l"</span>, coefs)) <span class="sc">%&gt;%</span> </span>
<span id="cb154-1032"><a href="#cb154-1032"></a>      <span class="fu">pull</span>(value) <span class="sc">%&gt;%</span> <span class="fu">t</span>() <span class="sc">%*%</span> <span class="fu">t</span>(<span class="fu">as.matrix</span>(hour_harmonics_df_1p))),</span>
<span id="cb154-1033"><a href="#cb154-1033"></a>  <span class="st">"cos_ta"</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(</span>
<span id="cb154-1034"><a href="#cb154-1034"></a>    coefs_clr_1p <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"cos"</span>, coefs)) <span class="sc">%&gt;%</span> </span>
<span id="cb154-1035"><a href="#cb154-1035"></a>      <span class="fu">pull</span>(value) <span class="sc">%&gt;%</span> <span class="fu">t</span>() <span class="sc">%*%</span> <span class="fu">t</span>(<span class="fu">as.matrix</span>(hour_harmonics_df_1p))))</span>
<span id="cb154-1036"><a href="#cb154-1036"></a></span>
<span id="cb154-1037"><a href="#cb154-1037"></a>harmonics_scaled_long_1p <span class="ot">&lt;-</span> <span class="fu">pivot_longer</span>(harmonics_scaled_df_1p, </span>
<span id="cb154-1038"><a href="#cb154-1038"></a>                                         <span class="at">cols =</span> <span class="sc">!</span><span class="dv">1</span>, </span>
<span id="cb154-1039"><a href="#cb154-1039"></a>                                         <span class="at">names_to =</span> <span class="st">"coef"</span>)</span>
<span id="cb154-1040"><a href="#cb154-1040"></a></span>
<span id="cb154-1041"><a href="#cb154-1041"></a><span class="in">```</span></span>
<span id="cb154-1042"><a href="#cb154-1042"></a></span>
<span id="cb154-1043"><a href="#cb154-1043"></a><span class="fu">## 2p</span></span>
<span id="cb154-1044"><a href="#cb154-1044"></a></span>
<span id="cb154-1047"><a href="#cb154-1047"></a><span class="in">```{r}</span></span>
<span id="cb154-1048"><a href="#cb154-1048"></a><span class="co"># create the dataframe of values of the harmonic terms over the period</span></span>
<span id="cb154-1049"><a href="#cb154-1049"></a>hour_harmonics_df_2p <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="st">"linear_term"</span> <span class="ot">=</span> <span class="fu">rep</span>(<span class="dv">1</span>, <span class="fu">length</span>(hour)),</span>
<span id="cb154-1050"><a href="#cb154-1050"></a>                                <span class="st">"hour_s1"</span> <span class="ot">=</span> <span class="fu">sin</span>(<span class="dv">2</span><span class="sc">*</span>pi<span class="sc">*</span>hour<span class="sc">/</span><span class="dv">24</span>),</span>
<span id="cb154-1051"><a href="#cb154-1051"></a>                                <span class="st">"hour_s2"</span> <span class="ot">=</span> <span class="fu">sin</span>(<span class="dv">4</span><span class="sc">*</span>pi<span class="sc">*</span>hour<span class="sc">/</span><span class="dv">24</span>),</span>
<span id="cb154-1052"><a href="#cb154-1052"></a>                                <span class="st">"hour_c1"</span> <span class="ot">=</span> <span class="fu">cos</span>(<span class="dv">2</span><span class="sc">*</span>pi<span class="sc">*</span>hour<span class="sc">/</span><span class="dv">24</span>),</span>
<span id="cb154-1053"><a href="#cb154-1053"></a>                                <span class="st">"hour_c2"</span> <span class="ot">=</span> <span class="fu">cos</span>(<span class="dv">4</span><span class="sc">*</span>pi<span class="sc">*</span>hour<span class="sc">/</span><span class="dv">24</span>))</span>
<span id="cb154-1054"><a href="#cb154-1054"></a></span>
<span id="cb154-1055"><a href="#cb154-1055"></a>harmonics_scaled_df_2p <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb154-1056"><a href="#cb154-1056"></a>  <span class="st">"hour"</span> <span class="ot">=</span> hour,</span>
<span id="cb154-1057"><a href="#cb154-1057"></a>  <span class="st">"ndvi"</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(</span>
<span id="cb154-1058"><a href="#cb154-1058"></a>    coefs_clr_2p <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"ndvi"</span>, coefs) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">grepl</span>(<span class="st">"sq"</span>, coefs)) <span class="sc">%&gt;%</span> </span>
<span id="cb154-1059"><a href="#cb154-1059"></a>      <span class="fu">pull</span>(value) <span class="sc">%&gt;%</span> <span class="fu">t</span>() <span class="sc">%*%</span> <span class="fu">t</span>(<span class="fu">as.matrix</span>(hour_harmonics_df_2p))),</span>
<span id="cb154-1060"><a href="#cb154-1060"></a>  <span class="st">"ndvi_2"</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(</span>
<span id="cb154-1061"><a href="#cb154-1061"></a>    coefs_clr_2p <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"ndvi_sq"</span>, coefs)) <span class="sc">%&gt;%</span> </span>
<span id="cb154-1062"><a href="#cb154-1062"></a>      <span class="fu">pull</span>(value) <span class="sc">%&gt;%</span> <span class="fu">t</span>() <span class="sc">%*%</span> <span class="fu">t</span>(<span class="fu">as.matrix</span>(hour_harmonics_df_2p))),</span>
<span id="cb154-1063"><a href="#cb154-1063"></a>  <span class="st">"canopy"</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(</span>
<span id="cb154-1064"><a href="#cb154-1064"></a>    coefs_clr_2p <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"canopy"</span>, coefs) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">grepl</span>(<span class="st">"sq"</span>, coefs)) <span class="sc">%&gt;%</span> </span>
<span id="cb154-1065"><a href="#cb154-1065"></a>      <span class="fu">pull</span>(value) <span class="sc">%&gt;%</span> <span class="fu">t</span>() <span class="sc">%*%</span> <span class="fu">t</span>(<span class="fu">as.matrix</span>(hour_harmonics_df_2p))),</span>
<span id="cb154-1066"><a href="#cb154-1066"></a>  <span class="st">"canopy_2"</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(</span>
<span id="cb154-1067"><a href="#cb154-1067"></a>    coefs_clr_2p <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"canopy_sq"</span>, coefs)) <span class="sc">%&gt;%</span> </span>
<span id="cb154-1068"><a href="#cb154-1068"></a>      <span class="fu">pull</span>(value) <span class="sc">%&gt;%</span> <span class="fu">t</span>() <span class="sc">%*%</span> <span class="fu">t</span>(<span class="fu">as.matrix</span>(hour_harmonics_df_2p))),</span>
<span id="cb154-1069"><a href="#cb154-1069"></a>  <span class="st">"slope"</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(</span>
<span id="cb154-1070"><a href="#cb154-1070"></a>    coefs_clr_2p <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"slope"</span>, coefs)) <span class="sc">%&gt;%</span> </span>
<span id="cb154-1071"><a href="#cb154-1071"></a>      <span class="fu">pull</span>(value) <span class="sc">%&gt;%</span> <span class="fu">t</span>() <span class="sc">%*%</span> <span class="fu">t</span>(<span class="fu">as.matrix</span>(hour_harmonics_df_2p))),</span>
<span id="cb154-1072"><a href="#cb154-1072"></a>  <span class="st">"herby"</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(</span>
<span id="cb154-1073"><a href="#cb154-1073"></a>    coefs_clr_2p <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"herby"</span>, coefs)) <span class="sc">%&gt;%</span> </span>
<span id="cb154-1074"><a href="#cb154-1074"></a>      <span class="fu">pull</span>(value) <span class="sc">%&gt;%</span> <span class="fu">t</span>() <span class="sc">%*%</span> <span class="fu">t</span>(<span class="fu">as.matrix</span>(hour_harmonics_df_2p))),</span>
<span id="cb154-1075"><a href="#cb154-1075"></a>  <span class="st">"sl"</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(</span>
<span id="cb154-1076"><a href="#cb154-1076"></a>    coefs_clr_2p <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"step_l"</span>, coefs) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">grepl</span>(<span class="st">"log"</span>, coefs)) <span class="sc">%&gt;%</span> </span>
<span id="cb154-1077"><a href="#cb154-1077"></a>      <span class="fu">pull</span>(value) <span class="sc">%&gt;%</span> <span class="fu">t</span>() <span class="sc">%*%</span> <span class="fu">t</span>(<span class="fu">as.matrix</span>(hour_harmonics_df_2p))),</span>
<span id="cb154-1078"><a href="#cb154-1078"></a>  <span class="st">"log_sl"</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(</span>
<span id="cb154-1079"><a href="#cb154-1079"></a>    coefs_clr_2p <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"log_step_l"</span>, coefs)) <span class="sc">%&gt;%</span> </span>
<span id="cb154-1080"><a href="#cb154-1080"></a>      <span class="fu">pull</span>(value) <span class="sc">%&gt;%</span> <span class="fu">t</span>() <span class="sc">%*%</span> <span class="fu">t</span>(<span class="fu">as.matrix</span>(hour_harmonics_df_2p))),</span>
<span id="cb154-1081"><a href="#cb154-1081"></a>  <span class="st">"cos_ta"</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(</span>
<span id="cb154-1082"><a href="#cb154-1082"></a>    coefs_clr_2p <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"cos"</span>, coefs)) <span class="sc">%&gt;%</span> </span>
<span id="cb154-1083"><a href="#cb154-1083"></a>      <span class="fu">pull</span>(value) <span class="sc">%&gt;%</span> <span class="fu">t</span>() <span class="sc">%*%</span> <span class="fu">t</span>(<span class="fu">as.matrix</span>(hour_harmonics_df_2p))))</span>
<span id="cb154-1084"><a href="#cb154-1084"></a></span>
<span id="cb154-1085"><a href="#cb154-1085"></a>harmonics_scaled_long_2p <span class="ot">&lt;-</span> <span class="fu">pivot_longer</span>(harmonics_scaled_df_2p, <span class="at">cols =</span> <span class="sc">!</span><span class="dv">1</span>, </span>
<span id="cb154-1086"><a href="#cb154-1086"></a>                                         <span class="at">names_to =</span> <span class="st">"coef"</span>)</span>
<span id="cb154-1087"><a href="#cb154-1087"></a></span>
<span id="cb154-1088"><a href="#cb154-1088"></a><span class="in">```</span></span>
<span id="cb154-1089"><a href="#cb154-1089"></a></span>
<span id="cb154-1090"><a href="#cb154-1090"></a><span class="fu">## 3p</span></span>
<span id="cb154-1091"><a href="#cb154-1091"></a></span>
<span id="cb154-1094"><a href="#cb154-1094"></a><span class="in">```{r}</span></span>
<span id="cb154-1095"><a href="#cb154-1095"></a><span class="co"># create the dataframe of values of the harmonic terms over the period</span></span>
<span id="cb154-1096"><a href="#cb154-1096"></a>hour_harmonics_df_3p <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="st">"linear_term"</span> <span class="ot">=</span> <span class="fu">rep</span>(<span class="dv">1</span>, <span class="fu">length</span>(hour)),</span>
<span id="cb154-1097"><a href="#cb154-1097"></a>                                <span class="st">"hour_s1"</span> <span class="ot">=</span> <span class="fu">sin</span>(<span class="dv">2</span><span class="sc">*</span>pi<span class="sc">*</span>hour<span class="sc">/</span><span class="dv">24</span>),</span>
<span id="cb154-1098"><a href="#cb154-1098"></a>                                <span class="st">"hour_s2"</span> <span class="ot">=</span> <span class="fu">sin</span>(<span class="dv">4</span><span class="sc">*</span>pi<span class="sc">*</span>hour<span class="sc">/</span><span class="dv">24</span>),</span>
<span id="cb154-1099"><a href="#cb154-1099"></a>                                <span class="st">"hour_s3"</span> <span class="ot">=</span> <span class="fu">sin</span>(<span class="dv">6</span><span class="sc">*</span>pi<span class="sc">*</span>hour<span class="sc">/</span><span class="dv">24</span>),</span>
<span id="cb154-1100"><a href="#cb154-1100"></a>                                <span class="st">"hour_c1"</span> <span class="ot">=</span> <span class="fu">cos</span>(<span class="dv">2</span><span class="sc">*</span>pi<span class="sc">*</span>hour<span class="sc">/</span><span class="dv">24</span>),</span>
<span id="cb154-1101"><a href="#cb154-1101"></a>                                <span class="st">"hour_c2"</span> <span class="ot">=</span> <span class="fu">cos</span>(<span class="dv">4</span><span class="sc">*</span>pi<span class="sc">*</span>hour<span class="sc">/</span><span class="dv">24</span>),</span>
<span id="cb154-1102"><a href="#cb154-1102"></a>                                <span class="st">"hour_c3"</span> <span class="ot">=</span> <span class="fu">cos</span>(<span class="dv">6</span><span class="sc">*</span>pi<span class="sc">*</span>hour<span class="sc">/</span><span class="dv">24</span>))</span>
<span id="cb154-1103"><a href="#cb154-1103"></a></span>
<span id="cb154-1104"><a href="#cb154-1104"></a>harmonics_scaled_df_3p <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb154-1105"><a href="#cb154-1105"></a>  <span class="st">"hour"</span> <span class="ot">=</span> hour,</span>
<span id="cb154-1106"><a href="#cb154-1106"></a>  <span class="st">"ndvi"</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(</span>
<span id="cb154-1107"><a href="#cb154-1107"></a>    coefs_clr_3p <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"ndvi"</span>, coefs) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">grepl</span>(<span class="st">"sq"</span>, coefs)) <span class="sc">%&gt;%</span> </span>
<span id="cb154-1108"><a href="#cb154-1108"></a>      <span class="fu">pull</span>(value) <span class="sc">%&gt;%</span> <span class="fu">t</span>() <span class="sc">%*%</span> <span class="fu">t</span>(<span class="fu">as.matrix</span>(hour_harmonics_df_3p))),</span>
<span id="cb154-1109"><a href="#cb154-1109"></a>  <span class="st">"ndvi_2"</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(</span>
<span id="cb154-1110"><a href="#cb154-1110"></a>    coefs_clr_3p <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"ndvi_sq"</span>, coefs)) <span class="sc">%&gt;%</span> </span>
<span id="cb154-1111"><a href="#cb154-1111"></a>      <span class="fu">pull</span>(value) <span class="sc">%&gt;%</span> <span class="fu">t</span>() <span class="sc">%*%</span> <span class="fu">t</span>(<span class="fu">as.matrix</span>(hour_harmonics_df_3p))),</span>
<span id="cb154-1112"><a href="#cb154-1112"></a>  <span class="st">"canopy"</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(</span>
<span id="cb154-1113"><a href="#cb154-1113"></a>    coefs_clr_3p <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"canopy"</span>, coefs) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">grepl</span>(<span class="st">"sq"</span>, coefs)) <span class="sc">%&gt;%</span> </span>
<span id="cb154-1114"><a href="#cb154-1114"></a>      <span class="fu">pull</span>(value) <span class="sc">%&gt;%</span> <span class="fu">t</span>() <span class="sc">%*%</span> <span class="fu">t</span>(<span class="fu">as.matrix</span>(hour_harmonics_df_3p))),</span>
<span id="cb154-1115"><a href="#cb154-1115"></a>  <span class="st">"canopy_2"</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(</span>
<span id="cb154-1116"><a href="#cb154-1116"></a>    coefs_clr_3p <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"canopy_sq"</span>, coefs)) <span class="sc">%&gt;%</span> </span>
<span id="cb154-1117"><a href="#cb154-1117"></a>      <span class="fu">pull</span>(value) <span class="sc">%&gt;%</span> <span class="fu">t</span>() <span class="sc">%*%</span> <span class="fu">t</span>(<span class="fu">as.matrix</span>(hour_harmonics_df_3p))),</span>
<span id="cb154-1118"><a href="#cb154-1118"></a>  <span class="st">"slope"</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(</span>
<span id="cb154-1119"><a href="#cb154-1119"></a>    coefs_clr_3p <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"slope"</span>, coefs)) <span class="sc">%&gt;%</span> </span>
<span id="cb154-1120"><a href="#cb154-1120"></a>      <span class="fu">pull</span>(value) <span class="sc">%&gt;%</span> <span class="fu">t</span>() <span class="sc">%*%</span> <span class="fu">t</span>(<span class="fu">as.matrix</span>(hour_harmonics_df_3p))),</span>
<span id="cb154-1121"><a href="#cb154-1121"></a>  <span class="st">"herby"</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(</span>
<span id="cb154-1122"><a href="#cb154-1122"></a>    coefs_clr_3p <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"herby"</span>, coefs)) <span class="sc">%&gt;%</span> </span>
<span id="cb154-1123"><a href="#cb154-1123"></a>      <span class="fu">pull</span>(value) <span class="sc">%&gt;%</span> <span class="fu">t</span>() <span class="sc">%*%</span> <span class="fu">t</span>(<span class="fu">as.matrix</span>(hour_harmonics_df_3p))),</span>
<span id="cb154-1124"><a href="#cb154-1124"></a>  <span class="st">"sl"</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(</span>
<span id="cb154-1125"><a href="#cb154-1125"></a>    coefs_clr_3p <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"step_l"</span>, coefs) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">grepl</span>(<span class="st">"log"</span>, coefs)) <span class="sc">%&gt;%</span> </span>
<span id="cb154-1126"><a href="#cb154-1126"></a>      <span class="fu">pull</span>(value) <span class="sc">%&gt;%</span> <span class="fu">t</span>() <span class="sc">%*%</span> <span class="fu">t</span>(<span class="fu">as.matrix</span>(hour_harmonics_df_3p))),</span>
<span id="cb154-1127"><a href="#cb154-1127"></a>  <span class="st">"log_sl"</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(</span>
<span id="cb154-1128"><a href="#cb154-1128"></a>    coefs_clr_3p <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"log_step_l"</span>, coefs)) <span class="sc">%&gt;%</span> </span>
<span id="cb154-1129"><a href="#cb154-1129"></a>      <span class="fu">pull</span>(value) <span class="sc">%&gt;%</span> <span class="fu">t</span>() <span class="sc">%*%</span> <span class="fu">t</span>(<span class="fu">as.matrix</span>(hour_harmonics_df_3p))),</span>
<span id="cb154-1130"><a href="#cb154-1130"></a>  <span class="st">"cos_ta"</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(</span>
<span id="cb154-1131"><a href="#cb154-1131"></a>    coefs_clr_3p <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"cos"</span>, coefs)) <span class="sc">%&gt;%</span> </span>
<span id="cb154-1132"><a href="#cb154-1132"></a>      <span class="fu">pull</span>(value) <span class="sc">%&gt;%</span> <span class="fu">t</span>() <span class="sc">%*%</span> <span class="fu">t</span>(<span class="fu">as.matrix</span>(hour_harmonics_df_3p))))</span>
<span id="cb154-1133"><a href="#cb154-1133"></a></span>
<span id="cb154-1134"><a href="#cb154-1134"></a>harmonics_scaled_long_3p <span class="ot">&lt;-</span> <span class="fu">pivot_longer</span>(harmonics_scaled_df_3p, <span class="at">cols =</span> <span class="sc">!</span><span class="dv">1</span>, </span>
<span id="cb154-1135"><a href="#cb154-1135"></a>                                         <span class="at">names_to =</span> <span class="st">"coef"</span>)</span>
<span id="cb154-1136"><a href="#cb154-1136"></a></span>
<span id="cb154-1137"><a href="#cb154-1137"></a><span class="in">```</span></span>
<span id="cb154-1138"><a href="#cb154-1138"></a>:::</span>
<span id="cb154-1139"><a href="#cb154-1139"></a></span>
<span id="cb154-1140"><a href="#cb154-1140"></a><span class="fu">## Plot the results - scaled temporally dynamic coefficients</span></span>
<span id="cb154-1141"><a href="#cb154-1141"></a></span>
<span id="cb154-1142"><a href="#cb154-1142"></a>Here we show the temporally-varying coefficients across time (which are currently still scaled).</span>
<span id="cb154-1143"><a href="#cb154-1143"></a></span>
<span id="cb154-1144"><a href="#cb154-1144"></a>::: {.panel-tabset group="model"}</span>
<span id="cb154-1145"><a href="#cb154-1145"></a><span class="fu">## 0p</span></span>
<span id="cb154-1146"><a href="#cb154-1146"></a></span>
<span id="cb154-1149"><a href="#cb154-1149"></a><span class="in">```{r}</span></span>
<span id="cb154-1150"><a href="#cb154-1150"></a><span class="co">#| label: 0p_plot_coefs</span></span>
<span id="cb154-1151"><a href="#cb154-1151"></a></span>
<span id="cb154-1152"><a href="#cb154-1152"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb154-1153"><a href="#cb154-1153"></a>    <span class="fu">geom_path</span>(<span class="at">data =</span> harmonics_scaled_long_0p,</span>
<span id="cb154-1154"><a href="#cb154-1154"></a>              <span class="fu">aes</span>(<span class="at">x =</span> hour, <span class="at">y =</span> value, <span class="at">colour =</span> coef)) <span class="sc">+</span></span>
<span id="cb154-1155"><a href="#cb154-1155"></a>    <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb154-1156"><a href="#cb154-1156"></a>    <span class="fu">scale_y_continuous</span>(<span class="fu">expression</span>(Time<span class="sc">-</span>varying<span class="sc">~</span>parameter<span class="sc">~</span>values<span class="sc">~</span>beta)) <span class="sc">+</span></span>
<span id="cb154-1157"><a href="#cb154-1157"></a>    <span class="fu">scale_x_continuous</span>(<span class="st">"Hour"</span>) <span class="sc">+</span></span>
<span id="cb154-1158"><a href="#cb154-1158"></a>    <span class="fu">scale_color_discrete</span>(<span class="st">"Estimate"</span>) <span class="sc">+</span></span>
<span id="cb154-1159"><a href="#cb154-1159"></a>    <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb154-1160"><a href="#cb154-1160"></a>    <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span>
<span id="cb154-1161"><a href="#cb154-1161"></a></span>
<span id="cb154-1162"><a href="#cb154-1162"></a><span class="in">```</span></span>
<span id="cb154-1163"><a href="#cb154-1163"></a></span>
<span id="cb154-1164"><a href="#cb154-1164"></a><span class="fu">## 1p</span></span>
<span id="cb154-1165"><a href="#cb154-1165"></a></span>
<span id="cb154-1168"><a href="#cb154-1168"></a><span class="in">```{r}</span></span>
<span id="cb154-1169"><a href="#cb154-1169"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb154-1170"><a href="#cb154-1170"></a>    <span class="fu">geom_path</span>(<span class="at">data =</span> harmonics_scaled_long_1p,</span>
<span id="cb154-1171"><a href="#cb154-1171"></a>              <span class="fu">aes</span>(<span class="at">x =</span> hour, <span class="at">y =</span> value, <span class="at">colour =</span> coef)) <span class="sc">+</span></span>
<span id="cb154-1172"><a href="#cb154-1172"></a>    <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb154-1173"><a href="#cb154-1173"></a>    <span class="fu">scale_y_continuous</span>(<span class="fu">expression</span>(Time<span class="sc">-</span>varying<span class="sc">~</span>parameter<span class="sc">~</span>values<span class="sc">~</span>beta)) <span class="sc">+</span></span>
<span id="cb154-1174"><a href="#cb154-1174"></a>    <span class="fu">scale_x_continuous</span>(<span class="st">"Hour"</span>) <span class="sc">+</span></span>
<span id="cb154-1175"><a href="#cb154-1175"></a>    <span class="fu">scale_color_discrete</span>(<span class="st">"Estimate"</span>) <span class="sc">+</span></span>
<span id="cb154-1176"><a href="#cb154-1176"></a>    <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb154-1177"><a href="#cb154-1177"></a>    <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span>
<span id="cb154-1178"><a href="#cb154-1178"></a></span>
<span id="cb154-1179"><a href="#cb154-1179"></a><span class="in">```</span></span>
<span id="cb154-1180"><a href="#cb154-1180"></a></span>
<span id="cb154-1181"><a href="#cb154-1181"></a><span class="fu">## 2p</span></span>
<span id="cb154-1182"><a href="#cb154-1182"></a></span>
<span id="cb154-1185"><a href="#cb154-1185"></a><span class="in">```{r}</span></span>
<span id="cb154-1186"><a href="#cb154-1186"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb154-1187"><a href="#cb154-1187"></a>    <span class="fu">geom_path</span>(<span class="at">data =</span> harmonics_scaled_long_2p,</span>
<span id="cb154-1188"><a href="#cb154-1188"></a>              <span class="fu">aes</span>(<span class="at">x =</span> hour, <span class="at">y =</span> value, <span class="at">colour =</span> coef)) <span class="sc">+</span></span>
<span id="cb154-1189"><a href="#cb154-1189"></a>    <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb154-1190"><a href="#cb154-1190"></a>    <span class="fu">scale_y_continuous</span>(<span class="fu">expression</span>(Time<span class="sc">-</span>varying<span class="sc">~</span>parameter<span class="sc">~</span>values<span class="sc">~</span>beta)) <span class="sc">+</span></span>
<span id="cb154-1191"><a href="#cb154-1191"></a>    <span class="fu">scale_x_continuous</span>(<span class="st">"Hour"</span>) <span class="sc">+</span></span>
<span id="cb154-1192"><a href="#cb154-1192"></a>    <span class="fu">scale_color_discrete</span>(<span class="st">"Estimate"</span>) <span class="sc">+</span></span>
<span id="cb154-1193"><a href="#cb154-1193"></a>    <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb154-1194"><a href="#cb154-1194"></a>    <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span>
<span id="cb154-1195"><a href="#cb154-1195"></a></span>
<span id="cb154-1196"><a href="#cb154-1196"></a><span class="in">```</span></span>
<span id="cb154-1197"><a href="#cb154-1197"></a></span>
<span id="cb154-1198"><a href="#cb154-1198"></a><span class="fu">## 3p</span></span>
<span id="cb154-1199"><a href="#cb154-1199"></a></span>
<span id="cb154-1202"><a href="#cb154-1202"></a><span class="in">```{r}</span></span>
<span id="cb154-1203"><a href="#cb154-1203"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb154-1204"><a href="#cb154-1204"></a>    <span class="fu">geom_path</span>(<span class="at">data =</span> harmonics_scaled_long_3p,</span>
<span id="cb154-1205"><a href="#cb154-1205"></a>              <span class="fu">aes</span>(<span class="at">x =</span> hour, <span class="at">y =</span> value, <span class="at">colour =</span> coef)) <span class="sc">+</span></span>
<span id="cb154-1206"><a href="#cb154-1206"></a>    <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb154-1207"><a href="#cb154-1207"></a>    <span class="fu">scale_y_continuous</span>(<span class="fu">expression</span>(Time<span class="sc">-</span>varying<span class="sc">~</span>parameter<span class="sc">~</span>values<span class="sc">~</span>beta)) <span class="sc">+</span></span>
<span id="cb154-1208"><a href="#cb154-1208"></a>    <span class="fu">scale_x_continuous</span>(<span class="st">"Hour"</span>) <span class="sc">+</span></span>
<span id="cb154-1209"><a href="#cb154-1209"></a>    <span class="fu">scale_color_discrete</span>(<span class="st">"Estimate"</span>) <span class="sc">+</span></span>
<span id="cb154-1210"><a href="#cb154-1210"></a>    <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb154-1211"><a href="#cb154-1211"></a>    <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span>
<span id="cb154-1212"><a href="#cb154-1212"></a></span>
<span id="cb154-1213"><a href="#cb154-1213"></a><span class="in">```</span></span>
<span id="cb154-1214"><a href="#cb154-1214"></a>:::</span>
<span id="cb154-1215"><a href="#cb154-1215"></a></span>
<span id="cb154-1216"><a href="#cb154-1216"></a><span class="fu">## Reconstructing the natural-scale temporally dynamic coefficients</span></span>
<span id="cb154-1217"><a href="#cb154-1217"></a></span>
<span id="cb154-1218"><a href="#cb154-1218"></a>As we scaled the covariate values prior to fitting the models, we want to rescale the coefficients to their natural scale. This is important for the simulations, as the environmental variables will not be scaled when we simulate steps.</span>
<span id="cb154-1219"><a href="#cb154-1219"></a></span>
<span id="cb154-1220"><a href="#cb154-1220"></a>::: {.panel-tabset group="model"}</span>
<span id="cb154-1221"><a href="#cb154-1221"></a><span class="fu">## 0p</span></span>
<span id="cb154-1222"><a href="#cb154-1222"></a></span>
<span id="cb154-1225"><a href="#cb154-1225"></a><span class="in">```{r}</span></span>
<span id="cb154-1226"><a href="#cb154-1226"></a><span class="co">#| label: 0p_reconstruct_nat_coefs</span></span>
<span id="cb154-1227"><a href="#cb154-1227"></a></span>
<span id="cb154-1228"><a href="#cb154-1228"></a>harmonics_nat_df_0p <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb154-1229"><a href="#cb154-1229"></a>  <span class="st">"hour"</span> <span class="ot">=</span> hour,</span>
<span id="cb154-1230"><a href="#cb154-1230"></a>  <span class="st">"ndvi"</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(</span>
<span id="cb154-1231"><a href="#cb154-1231"></a>    coefs_clr_0p <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"ndvi"</span>, coefs) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">grepl</span>(<span class="st">"sq"</span>, coefs)) <span class="sc">%&gt;%</span> </span>
<span id="cb154-1232"><a href="#cb154-1232"></a>      <span class="fu">pull</span>(value_nat) <span class="sc">%&gt;%</span> <span class="fu">t</span>() <span class="sc">%*%</span> <span class="fu">t</span>(<span class="fu">as.matrix</span>(hour_harmonics_df_0p))),</span>
<span id="cb154-1233"><a href="#cb154-1233"></a>  <span class="st">"ndvi_2"</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(</span>
<span id="cb154-1234"><a href="#cb154-1234"></a>    coefs_clr_0p <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"ndvi_sq"</span>, coefs)) <span class="sc">%&gt;%</span> </span>
<span id="cb154-1235"><a href="#cb154-1235"></a>      <span class="fu">pull</span>(value_nat) <span class="sc">%&gt;%</span> <span class="fu">t</span>() <span class="sc">%*%</span> <span class="fu">t</span>(<span class="fu">as.matrix</span>(hour_harmonics_df_0p))),</span>
<span id="cb154-1236"><a href="#cb154-1236"></a>  <span class="st">"canopy"</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(</span>
<span id="cb154-1237"><a href="#cb154-1237"></a>    coefs_clr_0p <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"canopy"</span>, coefs) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">grepl</span>(<span class="st">"sq"</span>, coefs)) <span class="sc">%&gt;%</span> </span>
<span id="cb154-1238"><a href="#cb154-1238"></a>      <span class="fu">pull</span>(value_nat) <span class="sc">%&gt;%</span> <span class="fu">t</span>() <span class="sc">%*%</span> <span class="fu">t</span>(<span class="fu">as.matrix</span>(hour_harmonics_df_0p))),</span>
<span id="cb154-1239"><a href="#cb154-1239"></a>  <span class="st">"canopy_2"</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(</span>
<span id="cb154-1240"><a href="#cb154-1240"></a>    coefs_clr_0p <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"canopy_sq"</span>, coefs)) <span class="sc">%&gt;%</span> </span>
<span id="cb154-1241"><a href="#cb154-1241"></a>      <span class="fu">pull</span>(value_nat) <span class="sc">%&gt;%</span> <span class="fu">t</span>() <span class="sc">%*%</span> <span class="fu">t</span>(<span class="fu">as.matrix</span>(hour_harmonics_df_0p))),</span>
<span id="cb154-1242"><a href="#cb154-1242"></a>  <span class="st">"slope"</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(</span>
<span id="cb154-1243"><a href="#cb154-1243"></a>    coefs_clr_0p <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"slope"</span>, coefs) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">grepl</span>(<span class="st">"sq"</span>, coefs)) <span class="sc">%&gt;%</span> </span>
<span id="cb154-1244"><a href="#cb154-1244"></a>      <span class="fu">pull</span>(value_nat) <span class="sc">%&gt;%</span> <span class="fu">t</span>() <span class="sc">%*%</span> <span class="fu">t</span>(<span class="fu">as.matrix</span>(hour_harmonics_df_0p))),</span>
<span id="cb154-1245"><a href="#cb154-1245"></a>  <span class="st">"herby"</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(</span>
<span id="cb154-1246"><a href="#cb154-1246"></a>    coefs_clr_0p <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"herby"</span>, coefs)) <span class="sc">%&gt;%</span> </span>
<span id="cb154-1247"><a href="#cb154-1247"></a>      <span class="fu">pull</span>(value_nat) <span class="sc">%&gt;%</span> <span class="fu">t</span>() <span class="sc">%*%</span> <span class="fu">t</span>(<span class="fu">as.matrix</span>(hour_harmonics_df_0p))),</span>
<span id="cb154-1248"><a href="#cb154-1248"></a>  <span class="st">"sl"</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(</span>
<span id="cb154-1249"><a href="#cb154-1249"></a>    coefs_clr_0p <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"step_l"</span>, coefs) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">grepl</span>(<span class="st">"log"</span>, coefs)) <span class="sc">%&gt;%</span> </span>
<span id="cb154-1250"><a href="#cb154-1250"></a>      <span class="fu">pull</span>(value_nat) <span class="sc">%&gt;%</span> <span class="fu">t</span>() <span class="sc">%*%</span> <span class="fu">t</span>(<span class="fu">as.matrix</span>(hour_harmonics_df_0p))),</span>
<span id="cb154-1251"><a href="#cb154-1251"></a>  <span class="st">"log_sl"</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(</span>
<span id="cb154-1252"><a href="#cb154-1252"></a>    coefs_clr_0p <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"log_step_l"</span>, coefs)) <span class="sc">%&gt;%</span> </span>
<span id="cb154-1253"><a href="#cb154-1253"></a>      <span class="fu">pull</span>(value_nat) <span class="sc">%&gt;%</span> <span class="fu">t</span>() <span class="sc">%*%</span> <span class="fu">t</span>(<span class="fu">as.matrix</span>(hour_harmonics_df_0p))),</span>
<span id="cb154-1254"><a href="#cb154-1254"></a>  <span class="st">"cos_ta"</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(</span>
<span id="cb154-1255"><a href="#cb154-1255"></a>    coefs_clr_0p <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"cos"</span>, coefs)) <span class="sc">%&gt;%</span> </span>
<span id="cb154-1256"><a href="#cb154-1256"></a>      <span class="fu">pull</span>(value_nat) <span class="sc">%&gt;%</span> <span class="fu">t</span>() <span class="sc">%*%</span> <span class="fu">t</span>(<span class="fu">as.matrix</span>(hour_harmonics_df_0p))))</span>
<span id="cb154-1257"><a href="#cb154-1257"></a></span>
<span id="cb154-1258"><a href="#cb154-1258"></a><span class="in">```</span></span>
<span id="cb154-1259"><a href="#cb154-1259"></a></span>
<span id="cb154-1260"><a href="#cb154-1260"></a><span class="fu">## 1p</span></span>
<span id="cb154-1261"><a href="#cb154-1261"></a></span>
<span id="cb154-1264"><a href="#cb154-1264"></a><span class="in">```{r}</span></span>
<span id="cb154-1265"><a href="#cb154-1265"></a>harmonics_nat_df_1p <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb154-1266"><a href="#cb154-1266"></a>  <span class="st">"hour"</span> <span class="ot">=</span> hour,</span>
<span id="cb154-1267"><a href="#cb154-1267"></a>  <span class="st">"ndvi"</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(</span>
<span id="cb154-1268"><a href="#cb154-1268"></a>    coefs_clr_1p <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"ndvi"</span>, coefs) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">grepl</span>(<span class="st">"sq"</span>, coefs)) <span class="sc">%&gt;%</span> </span>
<span id="cb154-1269"><a href="#cb154-1269"></a>      <span class="fu">pull</span>(value_nat) <span class="sc">%&gt;%</span> <span class="fu">t</span>() <span class="sc">%*%</span> <span class="fu">t</span>(<span class="fu">as.matrix</span>(hour_harmonics_df_1p))),</span>
<span id="cb154-1270"><a href="#cb154-1270"></a>  <span class="st">"ndvi_2"</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(</span>
<span id="cb154-1271"><a href="#cb154-1271"></a>    coefs_clr_1p <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"ndvi_sq"</span>, coefs)) <span class="sc">%&gt;%</span> </span>
<span id="cb154-1272"><a href="#cb154-1272"></a>      <span class="fu">pull</span>(value_nat) <span class="sc">%&gt;%</span> <span class="fu">t</span>() <span class="sc">%*%</span> <span class="fu">t</span>(<span class="fu">as.matrix</span>(hour_harmonics_df_1p))),</span>
<span id="cb154-1273"><a href="#cb154-1273"></a>  <span class="st">"canopy"</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(</span>
<span id="cb154-1274"><a href="#cb154-1274"></a>    coefs_clr_1p <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"canopy"</span>, coefs) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">grepl</span>(<span class="st">"sq"</span>, coefs)) <span class="sc">%&gt;%</span> </span>
<span id="cb154-1275"><a href="#cb154-1275"></a>      <span class="fu">pull</span>(value_nat) <span class="sc">%&gt;%</span> <span class="fu">t</span>() <span class="sc">%*%</span> <span class="fu">t</span>(<span class="fu">as.matrix</span>(hour_harmonics_df_1p))),</span>
<span id="cb154-1276"><a href="#cb154-1276"></a>  <span class="st">"canopy_2"</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(</span>
<span id="cb154-1277"><a href="#cb154-1277"></a>    coefs_clr_1p <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"canopy_sq"</span>, coefs)) <span class="sc">%&gt;%</span> </span>
<span id="cb154-1278"><a href="#cb154-1278"></a>      <span class="fu">pull</span>(value_nat) <span class="sc">%&gt;%</span> <span class="fu">t</span>() <span class="sc">%*%</span> <span class="fu">t</span>(<span class="fu">as.matrix</span>(hour_harmonics_df_1p))),</span>
<span id="cb154-1279"><a href="#cb154-1279"></a>  <span class="st">"slope"</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(</span>
<span id="cb154-1280"><a href="#cb154-1280"></a>    coefs_clr_1p <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"slope"</span>, coefs) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">grepl</span>(<span class="st">"sq"</span>, coefs)) <span class="sc">%&gt;%</span> </span>
<span id="cb154-1281"><a href="#cb154-1281"></a>      <span class="fu">pull</span>(value_nat) <span class="sc">%&gt;%</span> <span class="fu">t</span>() <span class="sc">%*%</span> <span class="fu">t</span>(<span class="fu">as.matrix</span>(hour_harmonics_df_1p))),</span>
<span id="cb154-1282"><a href="#cb154-1282"></a>  <span class="st">"herby"</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(</span>
<span id="cb154-1283"><a href="#cb154-1283"></a>    coefs_clr_1p <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"herby"</span>, coefs)) <span class="sc">%&gt;%</span> </span>
<span id="cb154-1284"><a href="#cb154-1284"></a>      <span class="fu">pull</span>(value_nat) <span class="sc">%&gt;%</span> <span class="fu">t</span>() <span class="sc">%*%</span> <span class="fu">t</span>(<span class="fu">as.matrix</span>(hour_harmonics_df_1p))),</span>
<span id="cb154-1285"><a href="#cb154-1285"></a>  <span class="st">"sl"</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(</span>
<span id="cb154-1286"><a href="#cb154-1286"></a>    coefs_clr_1p <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"step_l"</span>, coefs) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">grepl</span>(<span class="st">"log"</span>, coefs)) <span class="sc">%&gt;%</span> </span>
<span id="cb154-1287"><a href="#cb154-1287"></a>      <span class="fu">pull</span>(value_nat) <span class="sc">%&gt;%</span> <span class="fu">t</span>() <span class="sc">%*%</span> <span class="fu">t</span>(<span class="fu">as.matrix</span>(hour_harmonics_df_1p))),</span>
<span id="cb154-1288"><a href="#cb154-1288"></a>  <span class="st">"log_sl"</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(</span>
<span id="cb154-1289"><a href="#cb154-1289"></a>    coefs_clr_1p <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"log_step_l"</span>, coefs)) <span class="sc">%&gt;%</span> </span>
<span id="cb154-1290"><a href="#cb154-1290"></a>      <span class="fu">pull</span>(value_nat) <span class="sc">%&gt;%</span> <span class="fu">t</span>() <span class="sc">%*%</span> <span class="fu">t</span>(<span class="fu">as.matrix</span>(hour_harmonics_df_1p))),</span>
<span id="cb154-1291"><a href="#cb154-1291"></a>  <span class="st">"cos_ta"</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(</span>
<span id="cb154-1292"><a href="#cb154-1292"></a>    coefs_clr_1p <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"cos"</span>, coefs)) <span class="sc">%&gt;%</span> </span>
<span id="cb154-1293"><a href="#cb154-1293"></a>      <span class="fu">pull</span>(value_nat) <span class="sc">%&gt;%</span> <span class="fu">t</span>() <span class="sc">%*%</span> <span class="fu">t</span>(<span class="fu">as.matrix</span>(hour_harmonics_df_1p))))</span>
<span id="cb154-1294"><a href="#cb154-1294"></a></span>
<span id="cb154-1295"><a href="#cb154-1295"></a><span class="in">```</span></span>
<span id="cb154-1296"><a href="#cb154-1296"></a></span>
<span id="cb154-1297"><a href="#cb154-1297"></a><span class="fu">## 2p</span></span>
<span id="cb154-1298"><a href="#cb154-1298"></a></span>
<span id="cb154-1301"><a href="#cb154-1301"></a><span class="in">```{r}</span></span>
<span id="cb154-1302"><a href="#cb154-1302"></a>harmonics_nat_df_2p <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb154-1303"><a href="#cb154-1303"></a>  <span class="st">"hour"</span> <span class="ot">=</span> hour,</span>
<span id="cb154-1304"><a href="#cb154-1304"></a>  <span class="st">"ndvi"</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(</span>
<span id="cb154-1305"><a href="#cb154-1305"></a>    coefs_clr_2p <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"ndvi"</span>, coefs) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">grepl</span>(<span class="st">"sq"</span>, coefs)) <span class="sc">%&gt;%</span> </span>
<span id="cb154-1306"><a href="#cb154-1306"></a>      <span class="fu">pull</span>(value_nat) <span class="sc">%&gt;%</span> <span class="fu">t</span>() <span class="sc">%*%</span> <span class="fu">t</span>(<span class="fu">as.matrix</span>(hour_harmonics_df_2p))),</span>
<span id="cb154-1307"><a href="#cb154-1307"></a>  <span class="st">"ndvi_2"</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(</span>
<span id="cb154-1308"><a href="#cb154-1308"></a>    coefs_clr_2p <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"ndvi_sq"</span>, coefs)) <span class="sc">%&gt;%</span> </span>
<span id="cb154-1309"><a href="#cb154-1309"></a>      <span class="fu">pull</span>(value_nat) <span class="sc">%&gt;%</span> <span class="fu">t</span>() <span class="sc">%*%</span> <span class="fu">t</span>(<span class="fu">as.matrix</span>(hour_harmonics_df_2p))),</span>
<span id="cb154-1310"><a href="#cb154-1310"></a>  <span class="st">"canopy"</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(</span>
<span id="cb154-1311"><a href="#cb154-1311"></a>    coefs_clr_2p <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"canopy"</span>, coefs) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">grepl</span>(<span class="st">"sq"</span>, coefs)) <span class="sc">%&gt;%</span> </span>
<span id="cb154-1312"><a href="#cb154-1312"></a>      <span class="fu">pull</span>(value_nat) <span class="sc">%&gt;%</span> <span class="fu">t</span>() <span class="sc">%*%</span> <span class="fu">t</span>(<span class="fu">as.matrix</span>(hour_harmonics_df_2p))),</span>
<span id="cb154-1313"><a href="#cb154-1313"></a>  <span class="st">"canopy_2"</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(</span>
<span id="cb154-1314"><a href="#cb154-1314"></a>    coefs_clr_2p <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"canopy_sq"</span>, coefs)) <span class="sc">%&gt;%</span> </span>
<span id="cb154-1315"><a href="#cb154-1315"></a>      <span class="fu">pull</span>(value_nat) <span class="sc">%&gt;%</span> <span class="fu">t</span>() <span class="sc">%*%</span> <span class="fu">t</span>(<span class="fu">as.matrix</span>(hour_harmonics_df_2p))),</span>
<span id="cb154-1316"><a href="#cb154-1316"></a>  <span class="st">"slope"</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(</span>
<span id="cb154-1317"><a href="#cb154-1317"></a>    coefs_clr_2p <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"slope"</span>, coefs) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">grepl</span>(<span class="st">"sq"</span>, coefs)) <span class="sc">%&gt;%</span> </span>
<span id="cb154-1318"><a href="#cb154-1318"></a>      <span class="fu">pull</span>(value_nat) <span class="sc">%&gt;%</span> <span class="fu">t</span>() <span class="sc">%*%</span> <span class="fu">t</span>(<span class="fu">as.matrix</span>(hour_harmonics_df_2p))),</span>
<span id="cb154-1319"><a href="#cb154-1319"></a>  <span class="st">"herby"</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(</span>
<span id="cb154-1320"><a href="#cb154-1320"></a>    coefs_clr_2p <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"herby"</span>, coefs)) <span class="sc">%&gt;%</span> </span>
<span id="cb154-1321"><a href="#cb154-1321"></a>      <span class="fu">pull</span>(value_nat) <span class="sc">%&gt;%</span> <span class="fu">t</span>() <span class="sc">%*%</span> <span class="fu">t</span>(<span class="fu">as.matrix</span>(hour_harmonics_df_2p))),</span>
<span id="cb154-1322"><a href="#cb154-1322"></a>  <span class="st">"sl"</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(</span>
<span id="cb154-1323"><a href="#cb154-1323"></a>    coefs_clr_2p <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"step_l"</span>, coefs) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">grepl</span>(<span class="st">"log"</span>, coefs)) <span class="sc">%&gt;%</span> </span>
<span id="cb154-1324"><a href="#cb154-1324"></a>      <span class="fu">pull</span>(value_nat) <span class="sc">%&gt;%</span> <span class="fu">t</span>() <span class="sc">%*%</span> <span class="fu">t</span>(<span class="fu">as.matrix</span>(hour_harmonics_df_2p))),</span>
<span id="cb154-1325"><a href="#cb154-1325"></a>  <span class="st">"log_sl"</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(</span>
<span id="cb154-1326"><a href="#cb154-1326"></a>    coefs_clr_2p <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"log_step_l"</span>, coefs)) <span class="sc">%&gt;%</span> </span>
<span id="cb154-1327"><a href="#cb154-1327"></a>      <span class="fu">pull</span>(value_nat) <span class="sc">%&gt;%</span> <span class="fu">t</span>() <span class="sc">%*%</span> <span class="fu">t</span>(<span class="fu">as.matrix</span>(hour_harmonics_df_2p))),</span>
<span id="cb154-1328"><a href="#cb154-1328"></a>  <span class="st">"cos_ta"</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(</span>
<span id="cb154-1329"><a href="#cb154-1329"></a>    coefs_clr_2p <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"cos"</span>, coefs)) <span class="sc">%&gt;%</span> </span>
<span id="cb154-1330"><a href="#cb154-1330"></a>      <span class="fu">pull</span>(value_nat) <span class="sc">%&gt;%</span> <span class="fu">t</span>() <span class="sc">%*%</span> <span class="fu">t</span>(<span class="fu">as.matrix</span>(hour_harmonics_df_2p))))</span>
<span id="cb154-1331"><a href="#cb154-1331"></a></span>
<span id="cb154-1332"><a href="#cb154-1332"></a><span class="in">```</span></span>
<span id="cb154-1333"><a href="#cb154-1333"></a></span>
<span id="cb154-1334"><a href="#cb154-1334"></a><span class="fu">## 3p</span></span>
<span id="cb154-1335"><a href="#cb154-1335"></a></span>
<span id="cb154-1338"><a href="#cb154-1338"></a><span class="in">```{r}</span></span>
<span id="cb154-1339"><a href="#cb154-1339"></a>harmonics_nat_df_3p <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb154-1340"><a href="#cb154-1340"></a>  <span class="st">"hour"</span> <span class="ot">=</span> hour,</span>
<span id="cb154-1341"><a href="#cb154-1341"></a>  <span class="st">"ndvi"</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(</span>
<span id="cb154-1342"><a href="#cb154-1342"></a>    coefs_clr_3p <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"ndvi"</span>, coefs) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">grepl</span>(<span class="st">"sq"</span>, coefs)) <span class="sc">%&gt;%</span> </span>
<span id="cb154-1343"><a href="#cb154-1343"></a>      <span class="fu">pull</span>(value_nat) <span class="sc">%&gt;%</span> <span class="fu">t</span>() <span class="sc">%*%</span> <span class="fu">t</span>(<span class="fu">as.matrix</span>(hour_harmonics_df_3p))),</span>
<span id="cb154-1344"><a href="#cb154-1344"></a>  <span class="st">"ndvi_2"</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(</span>
<span id="cb154-1345"><a href="#cb154-1345"></a>    coefs_clr_3p <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"ndvi_sq"</span>, coefs)) <span class="sc">%&gt;%</span> </span>
<span id="cb154-1346"><a href="#cb154-1346"></a>      <span class="fu">pull</span>(value_nat) <span class="sc">%&gt;%</span> <span class="fu">t</span>() <span class="sc">%*%</span> <span class="fu">t</span>(<span class="fu">as.matrix</span>(hour_harmonics_df_3p))),</span>
<span id="cb154-1347"><a href="#cb154-1347"></a>  <span class="st">"canopy"</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(</span>
<span id="cb154-1348"><a href="#cb154-1348"></a>    coefs_clr_3p <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"canopy"</span>, coefs) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">grepl</span>(<span class="st">"sq"</span>, coefs)) <span class="sc">%&gt;%</span> </span>
<span id="cb154-1349"><a href="#cb154-1349"></a>      <span class="fu">pull</span>(value_nat) <span class="sc">%&gt;%</span> <span class="fu">t</span>() <span class="sc">%*%</span> <span class="fu">t</span>(<span class="fu">as.matrix</span>(hour_harmonics_df_3p))),</span>
<span id="cb154-1350"><a href="#cb154-1350"></a>  <span class="st">"canopy_2"</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(</span>
<span id="cb154-1351"><a href="#cb154-1351"></a>    coefs_clr_3p <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"canopy_sq"</span>, coefs)) <span class="sc">%&gt;%</span> </span>
<span id="cb154-1352"><a href="#cb154-1352"></a>      <span class="fu">pull</span>(value_nat) <span class="sc">%&gt;%</span> <span class="fu">t</span>() <span class="sc">%*%</span> <span class="fu">t</span>(<span class="fu">as.matrix</span>(hour_harmonics_df_3p))),</span>
<span id="cb154-1353"><a href="#cb154-1353"></a>  <span class="st">"slope"</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(</span>
<span id="cb154-1354"><a href="#cb154-1354"></a>    coefs_clr_3p <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"slope"</span>, coefs) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">grepl</span>(<span class="st">"sq"</span>, coefs)) <span class="sc">%&gt;%</span> </span>
<span id="cb154-1355"><a href="#cb154-1355"></a>      <span class="fu">pull</span>(value_nat) <span class="sc">%&gt;%</span> <span class="fu">t</span>() <span class="sc">%*%</span> <span class="fu">t</span>(<span class="fu">as.matrix</span>(hour_harmonics_df_3p))),</span>
<span id="cb154-1356"><a href="#cb154-1356"></a>  <span class="st">"herby"</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(</span>
<span id="cb154-1357"><a href="#cb154-1357"></a>    coefs_clr_3p <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"herby"</span>, coefs)) <span class="sc">%&gt;%</span> </span>
<span id="cb154-1358"><a href="#cb154-1358"></a>      <span class="fu">pull</span>(value_nat) <span class="sc">%&gt;%</span> <span class="fu">t</span>() <span class="sc">%*%</span> <span class="fu">t</span>(<span class="fu">as.matrix</span>(hour_harmonics_df_3p))),</span>
<span id="cb154-1359"><a href="#cb154-1359"></a>  <span class="st">"sl"</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(</span>
<span id="cb154-1360"><a href="#cb154-1360"></a>    coefs_clr_3p <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"step_l"</span>, coefs) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">grepl</span>(<span class="st">"log"</span>, coefs)) <span class="sc">%&gt;%</span> </span>
<span id="cb154-1361"><a href="#cb154-1361"></a>      <span class="fu">pull</span>(value_nat) <span class="sc">%&gt;%</span> <span class="fu">t</span>() <span class="sc">%*%</span> <span class="fu">t</span>(<span class="fu">as.matrix</span>(hour_harmonics_df_3p))),</span>
<span id="cb154-1362"><a href="#cb154-1362"></a>  <span class="st">"log_sl"</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(</span>
<span id="cb154-1363"><a href="#cb154-1363"></a>    coefs_clr_3p <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"log_step_l"</span>, coefs)) <span class="sc">%&gt;%</span> </span>
<span id="cb154-1364"><a href="#cb154-1364"></a>      <span class="fu">pull</span>(value_nat) <span class="sc">%&gt;%</span> <span class="fu">t</span>() <span class="sc">%*%</span> <span class="fu">t</span>(<span class="fu">as.matrix</span>(hour_harmonics_df_3p))),</span>
<span id="cb154-1365"><a href="#cb154-1365"></a>  <span class="st">"cos_ta"</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(</span>
<span id="cb154-1366"><a href="#cb154-1366"></a>    coefs_clr_3p <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"cos"</span>, coefs)) <span class="sc">%&gt;%</span> </span>
<span id="cb154-1367"><a href="#cb154-1367"></a>      <span class="fu">pull</span>(value_nat) <span class="sc">%&gt;%</span> <span class="fu">t</span>() <span class="sc">%*%</span> <span class="fu">t</span>(<span class="fu">as.matrix</span>(hour_harmonics_df_3p))))</span>
<span id="cb154-1368"><a href="#cb154-1368"></a></span>
<span id="cb154-1369"><a href="#cb154-1369"></a><span class="in">```</span></span>
<span id="cb154-1370"><a href="#cb154-1370"></a>:::</span>
<span id="cb154-1371"><a href="#cb154-1371"></a></span>
<span id="cb154-1372"><a href="#cb154-1372"></a><span class="fu">## Update the Gamma and von Mises distributions</span></span>
<span id="cb154-1373"><a href="#cb154-1373"></a></span>
<span id="cb154-1374"><a href="#cb154-1374"></a>To update the Gamma and von Mises distribution from the tentative distributions <span class="co">[</span><span class="ot">e.g. @Fieberg2021-wx, Appendix C</span><span class="co">]</span>, we just do the calculation at each time point (for the natural-scale coefficients).</span>
<span id="cb154-1375"><a href="#cb154-1375"></a></span>
<span id="cb154-1376"><a href="#cb154-1376"></a>::: {.panel-tabset group="model"}</span>
<span id="cb154-1377"><a href="#cb154-1377"></a><span class="fu">## 0p</span></span>
<span id="cb154-1378"><a href="#cb154-1378"></a></span>
<span id="cb154-1381"><a href="#cb154-1381"></a><span class="in">```{r}</span></span>
<span id="cb154-1382"><a href="#cb154-1382"></a><span class="co"># from the step generation script</span></span>
<span id="cb154-1383"><a href="#cb154-1383"></a>tentative_shape <span class="ot">&lt;-</span> <span class="fl">0.438167</span></span>
<span id="cb154-1384"><a href="#cb154-1384"></a>tentative_scale <span class="ot">&lt;-</span> <span class="fl">534.3507</span></span>
<span id="cb154-1385"><a href="#cb154-1385"></a>tentative_kappa <span class="ot">&lt;-</span> <span class="fl">0.1848126</span></span>
<span id="cb154-1386"><a href="#cb154-1386"></a></span>
<span id="cb154-1387"><a href="#cb154-1387"></a>hour_coefs_nat_df_0p <span class="ot">&lt;-</span> harmonics_nat_df_0p <span class="sc">%&gt;%</span> </span>
<span id="cb154-1388"><a href="#cb154-1388"></a>  <span class="fu">mutate</span>(<span class="at">shape =</span> tentative_shape <span class="sc">+</span> log_sl,</span>
<span id="cb154-1389"><a href="#cb154-1389"></a>         <span class="at">scale =</span> <span class="dv">1</span><span class="sc">/</span>((<span class="dv">1</span><span class="sc">/</span>tentative_scale) <span class="sc">-</span> sl),</span>
<span id="cb154-1390"><a href="#cb154-1390"></a>         <span class="at">kappa =</span> tentative_kappa <span class="sc">+</span> cos_ta)</span>
<span id="cb154-1391"><a href="#cb154-1391"></a></span>
<span id="cb154-1392"><a href="#cb154-1392"></a><span class="co"># save the coefficients to use in the simulations</span></span>
<span id="cb154-1393"><a href="#cb154-1393"></a><span class="fu">write_csv</span>(hour_coefs_nat_df_0p,</span>
<span id="cb154-1394"><a href="#cb154-1394"></a>          <span class="fu">paste0</span>(<span class="st">"ssf_coefficients/id"</span>, focal_id, <span class="st">"_0pDaily_coefs_"</span>, <span class="fu">Sys.Date</span>(), <span class="st">".csv"</span>))</span>
<span id="cb154-1395"><a href="#cb154-1395"></a></span>
<span id="cb154-1396"><a href="#cb154-1396"></a><span class="co"># turning into a long data frame</span></span>
<span id="cb154-1397"><a href="#cb154-1397"></a>hour_coefs_nat_long_0p <span class="ot">&lt;-</span> <span class="fu">pivot_longer</span>(hour_coefs_nat_df_0p, </span>
<span id="cb154-1398"><a href="#cb154-1398"></a>                                       <span class="at">cols =</span> <span class="sc">!</span><span class="dv">1</span>, </span>
<span id="cb154-1399"><a href="#cb154-1399"></a>                                       <span class="at">names_to =</span> <span class="st">"coef"</span>)</span>
<span id="cb154-1400"><a href="#cb154-1400"></a></span>
<span id="cb154-1401"><a href="#cb154-1401"></a><span class="in">```</span></span>
<span id="cb154-1402"><a href="#cb154-1402"></a></span>
<span id="cb154-1403"><a href="#cb154-1403"></a><span class="fu">## 1p</span></span>
<span id="cb154-1404"><a href="#cb154-1404"></a></span>
<span id="cb154-1407"><a href="#cb154-1407"></a><span class="in">```{r}</span></span>
<span id="cb154-1408"><a href="#cb154-1408"></a>hour_coefs_nat_df_1p <span class="ot">&lt;-</span> harmonics_nat_df_1p <span class="sc">%&gt;%</span> </span>
<span id="cb154-1409"><a href="#cb154-1409"></a>  <span class="fu">mutate</span>(<span class="at">shape =</span> tentative_shape <span class="sc">+</span> log_sl,</span>
<span id="cb154-1410"><a href="#cb154-1410"></a>         <span class="at">scale =</span> <span class="dv">1</span><span class="sc">/</span>((<span class="dv">1</span><span class="sc">/</span>tentative_scale) <span class="sc">-</span> sl),</span>
<span id="cb154-1411"><a href="#cb154-1411"></a>         <span class="at">kappa =</span> tentative_kappa <span class="sc">+</span> cos_ta)</span>
<span id="cb154-1412"><a href="#cb154-1412"></a></span>
<span id="cb154-1413"><a href="#cb154-1413"></a><span class="co"># save the coefficients to use in the simulations</span></span>
<span id="cb154-1414"><a href="#cb154-1414"></a><span class="fu">write_csv</span>(hour_coefs_nat_df_1p,</span>
<span id="cb154-1415"><a href="#cb154-1415"></a>          <span class="fu">paste0</span>(<span class="st">"ssf_coefficients/id"</span>, focal_id, <span class="st">"_1pDaily_coefs_"</span>,<span class="fu">Sys.Date</span>(), <span class="st">".csv"</span>))</span>
<span id="cb154-1416"><a href="#cb154-1416"></a></span>
<span id="cb154-1417"><a href="#cb154-1417"></a><span class="co"># turning into a long data frame</span></span>
<span id="cb154-1418"><a href="#cb154-1418"></a>hour_coefs_nat_long_1p <span class="ot">&lt;-</span> <span class="fu">pivot_longer</span>(hour_coefs_nat_df_1p, </span>
<span id="cb154-1419"><a href="#cb154-1419"></a>                                       <span class="at">cols =</span> <span class="sc">!</span><span class="dv">1</span>, <span class="at">names_to =</span> <span class="st">"coef"</span>)</span>
<span id="cb154-1420"><a href="#cb154-1420"></a></span>
<span id="cb154-1421"><a href="#cb154-1421"></a><span class="in">```</span></span>
<span id="cb154-1422"><a href="#cb154-1422"></a></span>
<span id="cb154-1423"><a href="#cb154-1423"></a><span class="fu">## 2p</span></span>
<span id="cb154-1424"><a href="#cb154-1424"></a></span>
<span id="cb154-1427"><a href="#cb154-1427"></a><span class="in">```{r}</span></span>
<span id="cb154-1428"><a href="#cb154-1428"></a>hour_coefs_nat_df_2p <span class="ot">&lt;-</span> harmonics_nat_df_2p <span class="sc">%&gt;%</span> </span>
<span id="cb154-1429"><a href="#cb154-1429"></a>  <span class="fu">mutate</span>(<span class="at">shape =</span> tentative_shape <span class="sc">+</span> log_sl,</span>
<span id="cb154-1430"><a href="#cb154-1430"></a>         <span class="at">scale =</span> <span class="dv">1</span><span class="sc">/</span>((<span class="dv">1</span><span class="sc">/</span>tentative_scale) <span class="sc">-</span> sl),</span>
<span id="cb154-1431"><a href="#cb154-1431"></a>         <span class="at">kappa =</span> tentative_kappa <span class="sc">+</span> cos_ta)</span>
<span id="cb154-1432"><a href="#cb154-1432"></a></span>
<span id="cb154-1433"><a href="#cb154-1433"></a><span class="co"># save the coefficients to use in the simulations</span></span>
<span id="cb154-1434"><a href="#cb154-1434"></a><span class="fu">write_csv</span>(hour_coefs_nat_df_2p,</span>
<span id="cb154-1435"><a href="#cb154-1435"></a>          <span class="fu">paste0</span>(<span class="st">"ssf_coefficients/id"</span>, focal_id, <span class="st">"_2pDaily_coefs_"</span>,<span class="fu">Sys.Date</span>(), <span class="st">".csv"</span>))</span>
<span id="cb154-1436"><a href="#cb154-1436"></a></span>
<span id="cb154-1437"><a href="#cb154-1437"></a><span class="co"># turning into a long data frame</span></span>
<span id="cb154-1438"><a href="#cb154-1438"></a>hour_coefs_nat_long_2p <span class="ot">&lt;-</span> <span class="fu">pivot_longer</span>(hour_coefs_nat_df_2p, <span class="at">cols =</span> <span class="sc">!</span><span class="dv">1</span>, </span>
<span id="cb154-1439"><a href="#cb154-1439"></a>                                       <span class="at">names_to =</span> <span class="st">"coef"</span>)</span>
<span id="cb154-1440"><a href="#cb154-1440"></a></span>
<span id="cb154-1441"><a href="#cb154-1441"></a><span class="in">```</span></span>
<span id="cb154-1442"><a href="#cb154-1442"></a></span>
<span id="cb154-1443"><a href="#cb154-1443"></a><span class="fu">## 3p</span></span>
<span id="cb154-1444"><a href="#cb154-1444"></a></span>
<span id="cb154-1447"><a href="#cb154-1447"></a><span class="in">```{r}</span></span>
<span id="cb154-1448"><a href="#cb154-1448"></a>hour_coefs_nat_df_3p <span class="ot">&lt;-</span> harmonics_nat_df_3p <span class="sc">%&gt;%</span> </span>
<span id="cb154-1449"><a href="#cb154-1449"></a>  <span class="fu">mutate</span>(<span class="at">shape =</span> tentative_shape <span class="sc">+</span> log_sl,</span>
<span id="cb154-1450"><a href="#cb154-1450"></a>         <span class="at">scale =</span> <span class="dv">1</span><span class="sc">/</span>((<span class="dv">1</span><span class="sc">/</span>tentative_scale) <span class="sc">-</span> sl),</span>
<span id="cb154-1451"><a href="#cb154-1451"></a>         <span class="at">kappa =</span> tentative_kappa <span class="sc">+</span> cos_ta)</span>
<span id="cb154-1452"><a href="#cb154-1452"></a></span>
<span id="cb154-1453"><a href="#cb154-1453"></a><span class="co"># save the coefficients to use in the simulations</span></span>
<span id="cb154-1454"><a href="#cb154-1454"></a><span class="fu">write_csv</span>(hour_coefs_nat_df_3p,</span>
<span id="cb154-1455"><a href="#cb154-1455"></a>          <span class="fu">paste0</span>(<span class="st">"ssf_coefficients/id"</span>, focal_id, <span class="st">"_3pDaily_coefs_"</span>, <span class="fu">Sys.Date</span>(), <span class="st">".csv"</span>))</span>
<span id="cb154-1456"><a href="#cb154-1456"></a></span>
<span id="cb154-1457"><a href="#cb154-1457"></a><span class="co"># turning into a long data frame</span></span>
<span id="cb154-1458"><a href="#cb154-1458"></a>hour_coefs_nat_long_3p <span class="ot">&lt;-</span> <span class="fu">pivot_longer</span>(hour_coefs_nat_df_3p, <span class="at">cols =</span> <span class="sc">!</span><span class="dv">1</span>, </span>
<span id="cb154-1459"><a href="#cb154-1459"></a>                                       <span class="at">names_to =</span> <span class="st">"coef"</span>)</span>
<span id="cb154-1460"><a href="#cb154-1460"></a></span>
<span id="cb154-1461"><a href="#cb154-1461"></a><span class="in">```</span></span>
<span id="cb154-1462"><a href="#cb154-1462"></a>:::</span>
<span id="cb154-1463"><a href="#cb154-1463"></a></span>
<span id="cb154-1464"><a href="#cb154-1464"></a><span class="fu">## Plot the natural-scale temporally dynamic coefficients</span></span>
<span id="cb154-1465"><a href="#cb154-1465"></a></span>
<span id="cb154-1466"><a href="#cb154-1466"></a>Now that the coefficients are in their natural scales, they will be larger or smaller depending on the scale of the covariate.</span>
<span id="cb154-1467"><a href="#cb154-1467"></a></span>
<span id="cb154-1468"><a href="#cb154-1468"></a>Plot just the habitat selection coefficients.</span>
<span id="cb154-1469"><a href="#cb154-1469"></a></span>
<span id="cb154-1470"><a href="#cb154-1470"></a>::: {.panel-tabset group="model"}</span>
<span id="cb154-1471"><a href="#cb154-1471"></a><span class="fu">## 0p</span></span>
<span id="cb154-1472"><a href="#cb154-1472"></a></span>
<span id="cb154-1475"><a href="#cb154-1475"></a><span class="in">```{r}</span></span>
<span id="cb154-1476"><a href="#cb154-1476"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb154-1477"><a href="#cb154-1477"></a>  <span class="fu">geom_path</span>(<span class="at">data =</span> hour_coefs_nat_long_0p <span class="sc">%&gt;%</span></span>
<span id="cb154-1478"><a href="#cb154-1478"></a>              <span class="fu">filter</span>(<span class="sc">!</span>coef <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"shape"</span>, <span class="st">"scale"</span>, <span class="st">"kappa"</span>)),</span>
<span id="cb154-1479"><a href="#cb154-1479"></a>            <span class="fu">aes</span>(<span class="at">x =</span> hour, <span class="at">y =</span> value, <span class="at">colour =</span> coef)) <span class="sc">+</span></span>
<span id="cb154-1480"><a href="#cb154-1480"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb154-1481"><a href="#cb154-1481"></a>  <span class="fu">scale_y_continuous</span>(<span class="fu">expression</span>(Time<span class="sc">-</span>varying<span class="sc">~</span>parameter<span class="sc">~</span>values<span class="sc">~</span>beta)) <span class="sc">+</span></span>
<span id="cb154-1482"><a href="#cb154-1482"></a>  <span class="fu">scale_x_continuous</span>(<span class="st">"Hour"</span>, <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">24</span>,<span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb154-1483"><a href="#cb154-1483"></a>  <span class="fu">scale_color_discrete</span>(<span class="st">"Estimate"</span>) <span class="sc">+</span></span>
<span id="cb154-1484"><a href="#cb154-1484"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb154-1485"><a href="#cb154-1485"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span>
<span id="cb154-1486"><a href="#cb154-1486"></a></span>
<span id="cb154-1487"><a href="#cb154-1487"></a><span class="in">```</span></span>
<span id="cb154-1488"><a href="#cb154-1488"></a></span>
<span id="cb154-1489"><a href="#cb154-1489"></a><span class="fu">## 1p</span></span>
<span id="cb154-1490"><a href="#cb154-1490"></a></span>
<span id="cb154-1493"><a href="#cb154-1493"></a><span class="in">```{r}</span></span>
<span id="cb154-1494"><a href="#cb154-1494"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb154-1495"><a href="#cb154-1495"></a>  <span class="fu">geom_path</span>(<span class="at">data =</span> hour_coefs_nat_long_1p <span class="sc">%&gt;%</span></span>
<span id="cb154-1496"><a href="#cb154-1496"></a>              <span class="fu">filter</span>(<span class="sc">!</span>coef <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"shape"</span>, <span class="st">"scale"</span>, <span class="st">"kappa"</span>)),</span>
<span id="cb154-1497"><a href="#cb154-1497"></a>            <span class="fu">aes</span>(<span class="at">x =</span> hour, <span class="at">y =</span> value, <span class="at">colour =</span> coef)) <span class="sc">+</span></span>
<span id="cb154-1498"><a href="#cb154-1498"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb154-1499"><a href="#cb154-1499"></a>  <span class="fu">scale_y_continuous</span>(<span class="fu">expression</span>(Time<span class="sc">-</span>varying<span class="sc">~</span>parameter<span class="sc">~</span>values<span class="sc">~</span>beta)) <span class="sc">+</span></span>
<span id="cb154-1500"><a href="#cb154-1500"></a>  <span class="fu">scale_x_continuous</span>(<span class="st">"Hour"</span>, <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">24</span>,<span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb154-1501"><a href="#cb154-1501"></a>  <span class="fu">scale_color_discrete</span>(<span class="st">"Estimate"</span>) <span class="sc">+</span></span>
<span id="cb154-1502"><a href="#cb154-1502"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb154-1503"><a href="#cb154-1503"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span>
<span id="cb154-1504"><a href="#cb154-1504"></a></span>
<span id="cb154-1505"><a href="#cb154-1505"></a><span class="in">```</span></span>
<span id="cb154-1506"><a href="#cb154-1506"></a></span>
<span id="cb154-1507"><a href="#cb154-1507"></a><span class="fu">## 2p</span></span>
<span id="cb154-1508"><a href="#cb154-1508"></a></span>
<span id="cb154-1511"><a href="#cb154-1511"></a><span class="in">```{r}</span></span>
<span id="cb154-1512"><a href="#cb154-1512"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb154-1513"><a href="#cb154-1513"></a>  <span class="fu">geom_path</span>(<span class="at">data =</span> hour_coefs_nat_long_2p <span class="sc">%&gt;%</span></span>
<span id="cb154-1514"><a href="#cb154-1514"></a>              <span class="fu">filter</span>(<span class="sc">!</span>coef <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"shape"</span>, <span class="st">"scale"</span>, <span class="st">"kappa"</span>)),</span>
<span id="cb154-1515"><a href="#cb154-1515"></a>            <span class="fu">aes</span>(<span class="at">x =</span> hour, <span class="at">y =</span> value, <span class="at">colour =</span> coef)) <span class="sc">+</span></span>
<span id="cb154-1516"><a href="#cb154-1516"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb154-1517"><a href="#cb154-1517"></a>  <span class="fu">scale_y_continuous</span>(<span class="fu">expression</span>(Time<span class="sc">-</span>varying<span class="sc">~</span>parameter<span class="sc">~</span>values<span class="sc">~</span>beta)) <span class="sc">+</span></span>
<span id="cb154-1518"><a href="#cb154-1518"></a>  <span class="fu">scale_x_continuous</span>(<span class="st">"Hour"</span>, <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">24</span>,<span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb154-1519"><a href="#cb154-1519"></a>  <span class="fu">scale_color_discrete</span>(<span class="st">"Estimate"</span>) <span class="sc">+</span></span>
<span id="cb154-1520"><a href="#cb154-1520"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb154-1521"><a href="#cb154-1521"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span>
<span id="cb154-1522"><a href="#cb154-1522"></a></span>
<span id="cb154-1523"><a href="#cb154-1523"></a><span class="in">```</span></span>
<span id="cb154-1524"><a href="#cb154-1524"></a></span>
<span id="cb154-1525"><a href="#cb154-1525"></a><span class="fu">## 3p</span></span>
<span id="cb154-1526"><a href="#cb154-1526"></a></span>
<span id="cb154-1529"><a href="#cb154-1529"></a><span class="in">```{r}</span></span>
<span id="cb154-1530"><a href="#cb154-1530"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb154-1531"><a href="#cb154-1531"></a>  <span class="fu">geom_path</span>(<span class="at">data =</span> hour_coefs_nat_long_3p <span class="sc">%&gt;%</span></span>
<span id="cb154-1532"><a href="#cb154-1532"></a>              <span class="fu">filter</span>(<span class="sc">!</span>coef <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"shape"</span>, <span class="st">"scale"</span>, <span class="st">"kappa"</span>)),</span>
<span id="cb154-1533"><a href="#cb154-1533"></a>            <span class="fu">aes</span>(<span class="at">x =</span> hour, <span class="at">y =</span> value, <span class="at">colour =</span> coef)) <span class="sc">+</span></span>
<span id="cb154-1534"><a href="#cb154-1534"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb154-1535"><a href="#cb154-1535"></a>  <span class="fu">scale_y_continuous</span>(<span class="fu">expression</span>(Time<span class="sc">-</span>varying<span class="sc">~</span>parameter<span class="sc">~</span>values<span class="sc">~</span>beta)) <span class="sc">+</span></span>
<span id="cb154-1536"><a href="#cb154-1536"></a>  <span class="fu">scale_x_continuous</span>(<span class="st">"Hour"</span>, <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">24</span>,<span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb154-1537"><a href="#cb154-1537"></a>  <span class="fu">scale_color_discrete</span>(<span class="st">"Estimate"</span>) <span class="sc">+</span></span>
<span id="cb154-1538"><a href="#cb154-1538"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb154-1539"><a href="#cb154-1539"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span>
<span id="cb154-1540"><a href="#cb154-1540"></a></span>
<span id="cb154-1541"><a href="#cb154-1541"></a><span class="in">```</span></span>
<span id="cb154-1542"><a href="#cb154-1542"></a>:::</span>
<span id="cb154-1543"><a href="#cb154-1543"></a></span>
<span id="cb154-1544"><a href="#cb154-1544"></a><span class="fu">## Plot only the temporally dynamic movement parameters</span></span>
<span id="cb154-1545"><a href="#cb154-1545"></a></span>
<span id="cb154-1546"><a href="#cb154-1546"></a>::: {.panel-tabset group="model"}</span>
<span id="cb154-1547"><a href="#cb154-1547"></a><span class="fu">## 0p</span></span>
<span id="cb154-1548"><a href="#cb154-1548"></a></span>
<span id="cb154-1551"><a href="#cb154-1551"></a><span class="in">```{r}</span></span>
<span id="cb154-1552"><a href="#cb154-1552"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb154-1553"><a href="#cb154-1553"></a>    <span class="fu">geom_path</span>(<span class="at">data =</span> hour_coefs_nat_long_0p <span class="sc">%&gt;%</span> </span>
<span id="cb154-1554"><a href="#cb154-1554"></a>              <span class="fu">filter</span>(coef <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"shape"</span>, <span class="st">"kappa"</span>)),</span>
<span id="cb154-1555"><a href="#cb154-1555"></a>              <span class="fu">aes</span>(<span class="at">x =</span> hour, <span class="at">y =</span> value, <span class="at">colour =</span> coef)) <span class="sc">+</span></span>
<span id="cb154-1556"><a href="#cb154-1556"></a>  <span class="fu">geom_path</span>(<span class="at">data =</span> hour_coefs_nat_long_0p <span class="sc">%&gt;%</span></span>
<span id="cb154-1557"><a href="#cb154-1557"></a>              <span class="fu">filter</span>(coef <span class="sc">==</span> <span class="st">"scale"</span>),</span>
<span id="cb154-1558"><a href="#cb154-1558"></a>              <span class="fu">aes</span>(<span class="at">x =</span> hour, <span class="at">y =</span> value<span class="sc">/</span><span class="dv">1000</span>, <span class="at">colour =</span> coef)) <span class="sc">+</span></span>
<span id="cb154-1559"><a href="#cb154-1559"></a>    <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb154-1560"><a href="#cb154-1560"></a>    <span class="fu">scale_y_continuous</span>(<span class="fu">expression</span>(beta)) <span class="sc">+</span></span>
<span id="cb154-1561"><a href="#cb154-1561"></a>  <span class="fu">scale_x_continuous</span>(<span class="st">"Hour"</span>, <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">24</span>,<span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb154-1562"><a href="#cb154-1562"></a>  <span class="fu">ggtitle</span>(<span class="st">"Note that the scale parameter is divided by 1000 for plotting"</span>) <span class="sc">+</span></span>
<span id="cb154-1563"><a href="#cb154-1563"></a>  <span class="fu">scale_color_discrete</span>(<span class="st">"Estimate"</span>,</span>
<span id="cb154-1564"><a href="#cb154-1564"></a>      <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"kappa"</span> <span class="ot">=</span> <span class="st">"von Mises kappa"</span>,</span>
<span id="cb154-1565"><a href="#cb154-1565"></a>                 <span class="st">"scale"</span> <span class="ot">=</span> <span class="st">"Gamma scale / 1000"</span>,</span>
<span id="cb154-1566"><a href="#cb154-1566"></a>                 <span class="st">"shape"</span> <span class="ot">=</span> <span class="st">"Gamma shape"</span>)) <span class="sc">+</span></span>
<span id="cb154-1567"><a href="#cb154-1567"></a>    <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb154-1568"><a href="#cb154-1568"></a>    <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"right"</span>)</span>
<span id="cb154-1569"><a href="#cb154-1569"></a></span>
<span id="cb154-1570"><a href="#cb154-1570"></a><span class="in">```</span></span>
<span id="cb154-1571"><a href="#cb154-1571"></a></span>
<span id="cb154-1572"><a href="#cb154-1572"></a><span class="fu">## 1p</span></span>
<span id="cb154-1573"><a href="#cb154-1573"></a></span>
<span id="cb154-1576"><a href="#cb154-1576"></a><span class="in">```{r}</span></span>
<span id="cb154-1577"><a href="#cb154-1577"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb154-1578"><a href="#cb154-1578"></a>    <span class="fu">geom_path</span>(<span class="at">data =</span> hour_coefs_nat_long_1p <span class="sc">%&gt;%</span> </span>
<span id="cb154-1579"><a href="#cb154-1579"></a>              <span class="fu">filter</span>(coef <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"shape"</span>, <span class="st">"kappa"</span>)),</span>
<span id="cb154-1580"><a href="#cb154-1580"></a>              <span class="fu">aes</span>(<span class="at">x =</span> hour, <span class="at">y =</span> value, <span class="at">colour =</span> coef)) <span class="sc">+</span></span>
<span id="cb154-1581"><a href="#cb154-1581"></a>  <span class="fu">geom_path</span>(<span class="at">data =</span> hour_coefs_nat_long_1p <span class="sc">%&gt;%</span></span>
<span id="cb154-1582"><a href="#cb154-1582"></a>              <span class="fu">filter</span>(coef <span class="sc">==</span> <span class="st">"scale"</span>),</span>
<span id="cb154-1583"><a href="#cb154-1583"></a>              <span class="fu">aes</span>(<span class="at">x =</span> hour, <span class="at">y =</span> value<span class="sc">/</span><span class="dv">1000</span>, <span class="at">colour =</span> coef)) <span class="sc">+</span></span>
<span id="cb154-1584"><a href="#cb154-1584"></a>    <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb154-1585"><a href="#cb154-1585"></a>    <span class="fu">scale_y_continuous</span>(<span class="fu">expression</span>(beta)) <span class="sc">+</span></span>
<span id="cb154-1586"><a href="#cb154-1586"></a>  <span class="fu">scale_x_continuous</span>(<span class="st">"Hour"</span>, <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">24</span>,<span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb154-1587"><a href="#cb154-1587"></a>  <span class="fu">ggtitle</span>(<span class="st">"Note that the scale parameter is divided by 1000 for plotting"</span>) <span class="sc">+</span></span>
<span id="cb154-1588"><a href="#cb154-1588"></a>  <span class="fu">scale_color_discrete</span>(<span class="st">"Estimate"</span>,</span>
<span id="cb154-1589"><a href="#cb154-1589"></a>      <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"kappa"</span> <span class="ot">=</span> <span class="st">"von Mises kappa"</span>,</span>
<span id="cb154-1590"><a href="#cb154-1590"></a>                 <span class="st">"scale"</span> <span class="ot">=</span> <span class="st">"Gamma scale / 1000"</span>,</span>
<span id="cb154-1591"><a href="#cb154-1591"></a>                 <span class="st">"shape"</span> <span class="ot">=</span> <span class="st">"Gamma shape"</span>)) <span class="sc">+</span></span>
<span id="cb154-1592"><a href="#cb154-1592"></a>    <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb154-1593"><a href="#cb154-1593"></a>    <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"right"</span>)</span>
<span id="cb154-1594"><a href="#cb154-1594"></a></span>
<span id="cb154-1595"><a href="#cb154-1595"></a><span class="in">```</span></span>
<span id="cb154-1596"><a href="#cb154-1596"></a></span>
<span id="cb154-1597"><a href="#cb154-1597"></a><span class="fu">## 2p</span></span>
<span id="cb154-1598"><a href="#cb154-1598"></a></span>
<span id="cb154-1601"><a href="#cb154-1601"></a><span class="in">```{r}</span></span>
<span id="cb154-1602"><a href="#cb154-1602"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb154-1603"><a href="#cb154-1603"></a>    <span class="fu">geom_path</span>(<span class="at">data =</span> hour_coefs_nat_long_2p <span class="sc">%&gt;%</span> </span>
<span id="cb154-1604"><a href="#cb154-1604"></a>              <span class="fu">filter</span>(coef <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"shape"</span>, <span class="st">"kappa"</span>)),</span>
<span id="cb154-1605"><a href="#cb154-1605"></a>              <span class="fu">aes</span>(<span class="at">x =</span> hour, <span class="at">y =</span> value, <span class="at">colour =</span> coef)) <span class="sc">+</span></span>
<span id="cb154-1606"><a href="#cb154-1606"></a>  <span class="fu">geom_path</span>(<span class="at">data =</span> hour_coefs_nat_long_2p <span class="sc">%&gt;%</span></span>
<span id="cb154-1607"><a href="#cb154-1607"></a>              <span class="fu">filter</span>(coef <span class="sc">==</span> <span class="st">"scale"</span>),</span>
<span id="cb154-1608"><a href="#cb154-1608"></a>              <span class="fu">aes</span>(<span class="at">x =</span> hour, <span class="at">y =</span> value<span class="sc">/</span><span class="dv">1000</span>, <span class="at">colour =</span> coef)) <span class="sc">+</span></span>
<span id="cb154-1609"><a href="#cb154-1609"></a>    <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb154-1610"><a href="#cb154-1610"></a>    <span class="fu">scale_y_continuous</span>(<span class="st">"Value of parameter"</span>) <span class="sc">+</span></span>
<span id="cb154-1611"><a href="#cb154-1611"></a>  <span class="fu">scale_x_continuous</span>(<span class="st">"Hour"</span>, <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">24</span>,<span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb154-1612"><a href="#cb154-1612"></a>  <span class="fu">ggtitle</span>(<span class="st">"*Note that the scale parameter is divided by 1000 for plotting"</span>) <span class="sc">+</span></span>
<span id="cb154-1613"><a href="#cb154-1613"></a>  <span class="fu">scale_color_discrete</span>(<span class="st">"Estimate"</span>,</span>
<span id="cb154-1614"><a href="#cb154-1614"></a>      <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"kappa"</span> <span class="ot">=</span> <span class="st">"von Mises kappa"</span>,</span>
<span id="cb154-1615"><a href="#cb154-1615"></a>                 <span class="st">"scale"</span> <span class="ot">=</span> <span class="st">"Gamma scale / 1000"</span>,</span>
<span id="cb154-1616"><a href="#cb154-1616"></a>                 <span class="st">"shape"</span> <span class="ot">=</span> <span class="st">"Gamma shape"</span>)) <span class="sc">+</span></span>
<span id="cb154-1617"><a href="#cb154-1617"></a>    <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb154-1618"><a href="#cb154-1618"></a>    <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"right"</span>)</span>
<span id="cb154-1619"><a href="#cb154-1619"></a></span>
<span id="cb154-1620"><a href="#cb154-1620"></a><span class="co"># ggsave(paste0("outputs/plots/manuscript_figs_R2/temporal_mvmt_params_",</span></span>
<span id="cb154-1621"><a href="#cb154-1621"></a><span class="co">#          Sys.Date(), ".png"),</span></span>
<span id="cb154-1622"><a href="#cb154-1622"></a><span class="co">#   width=150, height=90, units="mm", dpi = 1000)</span></span>
<span id="cb154-1623"><a href="#cb154-1623"></a></span>
<span id="cb154-1624"><a href="#cb154-1624"></a><span class="in">```</span></span>
<span id="cb154-1625"><a href="#cb154-1625"></a></span>
<span id="cb154-1626"><a href="#cb154-1626"></a><span class="fu">## 3p</span></span>
<span id="cb154-1627"><a href="#cb154-1627"></a></span>
<span id="cb154-1630"><a href="#cb154-1630"></a><span class="in">```{r}</span></span>
<span id="cb154-1631"><a href="#cb154-1631"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb154-1632"><a href="#cb154-1632"></a>    <span class="fu">geom_path</span>(<span class="at">data =</span> hour_coefs_nat_long_3p <span class="sc">%&gt;%</span> </span>
<span id="cb154-1633"><a href="#cb154-1633"></a>              <span class="fu">filter</span>(coef <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"shape"</span>, <span class="st">"kappa"</span>)),</span>
<span id="cb154-1634"><a href="#cb154-1634"></a>              <span class="fu">aes</span>(<span class="at">x =</span> hour, <span class="at">y =</span> value, <span class="at">colour =</span> coef)) <span class="sc">+</span></span>
<span id="cb154-1635"><a href="#cb154-1635"></a>  <span class="fu">geom_path</span>(<span class="at">data =</span> hour_coefs_nat_long_3p <span class="sc">%&gt;%</span></span>
<span id="cb154-1636"><a href="#cb154-1636"></a>              <span class="fu">filter</span>(coef <span class="sc">==</span> <span class="st">"scale"</span>),</span>
<span id="cb154-1637"><a href="#cb154-1637"></a>              <span class="fu">aes</span>(<span class="at">x =</span> hour, <span class="at">y =</span> value<span class="sc">/</span><span class="dv">1000</span>, <span class="at">colour =</span> coef)) <span class="sc">+</span></span>
<span id="cb154-1638"><a href="#cb154-1638"></a>    <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb154-1639"><a href="#cb154-1639"></a>    <span class="fu">scale_y_continuous</span>(<span class="fu">expression</span>(beta)) <span class="sc">+</span></span>
<span id="cb154-1640"><a href="#cb154-1640"></a>  <span class="fu">scale_x_continuous</span>(<span class="st">"Hour"</span>, <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">24</span>,<span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb154-1641"><a href="#cb154-1641"></a>  <span class="fu">ggtitle</span>(<span class="st">"Note that the scale parameter is divided by 1000 for plotting"</span>) <span class="sc">+</span></span>
<span id="cb154-1642"><a href="#cb154-1642"></a>  <span class="fu">scale_color_discrete</span>(<span class="st">"Estimate"</span>,</span>
<span id="cb154-1643"><a href="#cb154-1643"></a>      <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"kappa"</span> <span class="ot">=</span> <span class="st">"von Mises kappa"</span>,</span>
<span id="cb154-1644"><a href="#cb154-1644"></a>                 <span class="st">"scale"</span> <span class="ot">=</span> <span class="st">"Gamma scale / 1000"</span>,</span>
<span id="cb154-1645"><a href="#cb154-1645"></a>                 <span class="st">"shape"</span> <span class="ot">=</span> <span class="st">"Gamma shape"</span>)) <span class="sc">+</span></span>
<span id="cb154-1646"><a href="#cb154-1646"></a>    <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb154-1647"><a href="#cb154-1647"></a>    <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"right"</span>)</span>
<span id="cb154-1648"><a href="#cb154-1648"></a></span>
<span id="cb154-1649"><a href="#cb154-1649"></a><span class="in">```</span></span>
<span id="cb154-1650"><a href="#cb154-1650"></a>:::</span>
<span id="cb154-1651"><a href="#cb154-1651"></a></span>
<span id="cb154-1652"><a href="#cb154-1652"></a><span class="fu">## Sample from temporally dynamic movement parameters</span></span>
<span id="cb154-1653"><a href="#cb154-1653"></a></span>
<span id="cb154-1654"><a href="#cb154-1654"></a>Here we sample from the movement kernel to generate a distribution of step lengths for each hour of the day, to assess how well it matches the observed step lengths. This is the 'selection-free' movement kernel, so the step lengths and turning angles from the simulations will be different, as the steps will be conditioned on the habitat, but this is a useful diagnostic to assess whether the harmonics are capturing the observed movement dynamics.</span>
<span id="cb154-1655"><a href="#cb154-1655"></a></span>
<span id="cb154-1656"><a href="#cb154-1656"></a>::: {.panel-tabset group="model"}</span>
<span id="cb154-1657"><a href="#cb154-1657"></a></span>
<span id="cb154-1658"><a href="#cb154-1658"></a><span class="fu">## 0p</span></span>
<span id="cb154-1659"><a href="#cb154-1659"></a></span>
<span id="cb154-1662"><a href="#cb154-1662"></a><span class="in">```{r}</span></span>
<span id="cb154-1663"><a href="#cb154-1663"></a><span class="co"># summarise the observed step lengths by hour</span></span>
<span id="cb154-1664"><a href="#cb154-1664"></a>movement_summary_buffalo <span class="ot">&lt;-</span> buffalo_data <span class="sc">%&gt;%</span> </span>
<span id="cb154-1665"><a href="#cb154-1665"></a>  <span class="fu">filter</span>(y <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb154-1666"><a href="#cb154-1666"></a>  <span class="fu">group_by</span>(id, hour) <span class="sc">%&gt;%</span> </span>
<span id="cb154-1667"><a href="#cb154-1667"></a>  <span class="fu">summarise</span>(<span class="at">mean_sl =</span> <span class="fu">mean</span>(sl), <span class="at">median_sl =</span> <span class="fu">median</span>(sl))</span>
<span id="cb154-1668"><a href="#cb154-1668"></a></span>
<span id="cb154-1669"><a href="#cb154-1669"></a><span class="co"># number of samples at each hour (more = smoother plotting, but slower)</span></span>
<span id="cb154-1670"><a href="#cb154-1670"></a>n <span class="ot">&lt;-</span> <span class="fl">1e5</span></span>
<span id="cb154-1671"><a href="#cb154-1671"></a></span>
<span id="cb154-1672"><a href="#cb154-1672"></a>gamma_dist_list <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="at">mode =</span> <span class="st">"list"</span>, <span class="at">length =</span> <span class="fu">nrow</span>(hour_coefs_nat_df_0p))</span>
<span id="cb154-1673"><a href="#cb154-1673"></a>gamma_mean <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb154-1674"><a href="#cb154-1674"></a>gamma_median <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb154-1675"><a href="#cb154-1675"></a>gamma_ratio <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb154-1676"><a href="#cb154-1676"></a></span>
<span id="cb154-1677"><a href="#cb154-1677"></a><span class="cf">for</span>(hour_no <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(hour_coefs_nat_df_0p)) {</span>
<span id="cb154-1678"><a href="#cb154-1678"></a>  </span>
<span id="cb154-1679"><a href="#cb154-1679"></a>  gamma_dist_list[[hour_no]] <span class="ot">&lt;-</span> <span class="fu">rgamma</span>(n, <span class="at">shape =</span> hour_coefs_nat_df_0p<span class="sc">$</span>shape[hour_no], </span>
<span id="cb154-1680"><a href="#cb154-1680"></a>                                       <span class="at">scale =</span> hour_coefs_nat_df_0p<span class="sc">$</span>scale[hour_no])</span>
<span id="cb154-1681"><a href="#cb154-1681"></a>  </span>
<span id="cb154-1682"><a href="#cb154-1682"></a>  gamma_mean[hour_no] <span class="ot">&lt;-</span> <span class="fu">mean</span>(gamma_dist_list[[hour_no]])</span>
<span id="cb154-1683"><a href="#cb154-1683"></a>  gamma_median[hour_no] <span class="ot">&lt;-</span> <span class="fu">median</span>(gamma_dist_list[[hour_no]])</span>
<span id="cb154-1684"><a href="#cb154-1684"></a>  gamma_ratio[hour_no] <span class="ot">&lt;-</span> gamma_mean[hour_no] <span class="sc">/</span> gamma_median[hour_no]</span>
<span id="cb154-1685"><a href="#cb154-1685"></a></span>
<span id="cb154-1686"><a href="#cb154-1686"></a>}</span>
<span id="cb154-1687"><a href="#cb154-1687"></a></span>
<span id="cb154-1688"><a href="#cb154-1688"></a>gamma_df_0p <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">model =</span> <span class="st">"0p"</span>, </span>
<span id="cb154-1689"><a href="#cb154-1689"></a>                          <span class="at">hour =</span> hour_coefs_nat_df_0p<span class="sc">$</span>hour, </span>
<span id="cb154-1690"><a href="#cb154-1690"></a>                          <span class="at">mean =</span> gamma_mean, </span>
<span id="cb154-1691"><a href="#cb154-1691"></a>                          <span class="at">median =</span> gamma_median, </span>
<span id="cb154-1692"><a href="#cb154-1692"></a>                          <span class="at">ratio =</span> gamma_ratio) </span>
<span id="cb154-1693"><a href="#cb154-1693"></a></span>
<span id="cb154-1694"><a href="#cb154-1694"></a>mean_sl_0p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb154-1695"><a href="#cb154-1695"></a>  <span class="fu">geom_path</span>(<span class="at">data =</span> movement_summary_buffalo, </span>
<span id="cb154-1696"><a href="#cb154-1696"></a>            <span class="fu">aes</span>(<span class="at">x =</span> hour, <span class="at">y =</span> mean_sl, <span class="at">colour =</span> <span class="fu">factor</span>(id))) <span class="sc">+</span></span>
<span id="cb154-1697"><a href="#cb154-1697"></a>  <span class="fu">geom_path</span>(<span class="at">data =</span> gamma_df_0p, </span>
<span id="cb154-1698"><a href="#cb154-1698"></a>            <span class="fu">aes</span>(<span class="at">x =</span> hour, <span class="at">y =</span> mean), <span class="at">colour =</span> <span class="st">"red"</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb154-1699"><a href="#cb154-1699"></a>  <span class="fu">scale_x_continuous</span>(<span class="st">"Hour"</span>, <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">24</span>,<span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb154-1700"><a href="#cb154-1700"></a>  <span class="fu">scale_y_continuous</span>(<span class="st">"Mean step length"</span>) <span class="sc">+</span></span>
<span id="cb154-1701"><a href="#cb154-1701"></a>  <span class="fu">scale_colour_viridis_d</span>(<span class="st">"Buffalo"</span>) <span class="sc">+</span></span>
<span id="cb154-1702"><a href="#cb154-1702"></a>  <span class="fu">ggtitle</span>(<span class="st">"Observed and modelled mean step length"</span>,</span>
<span id="cb154-1703"><a href="#cb154-1703"></a>          <span class="at">subtitle =</span> <span class="st">"No harmonics"</span>) <span class="sc">+</span></span>
<span id="cb154-1704"><a href="#cb154-1704"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb154-1705"><a href="#cb154-1705"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"right"</span>)</span>
<span id="cb154-1706"><a href="#cb154-1706"></a></span>
<span id="cb154-1707"><a href="#cb154-1707"></a>mean_sl_0p</span>
<span id="cb154-1708"><a href="#cb154-1708"></a></span>
<span id="cb154-1709"><a href="#cb154-1709"></a></span>
<span id="cb154-1710"><a href="#cb154-1710"></a>median_sl_0p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb154-1711"><a href="#cb154-1711"></a>  <span class="fu">geom_path</span>(<span class="at">data =</span> movement_summary_buffalo, </span>
<span id="cb154-1712"><a href="#cb154-1712"></a>            <span class="fu">aes</span>(<span class="at">x =</span> hour, <span class="at">y =</span> median_sl, <span class="at">colour =</span> <span class="fu">factor</span>(id))) <span class="sc">+</span></span>
<span id="cb154-1713"><a href="#cb154-1713"></a>  <span class="fu">geom_path</span>(<span class="at">data =</span> gamma_df_0p, <span class="fu">aes</span>(<span class="at">x =</span> hour, <span class="at">y =</span> median), </span>
<span id="cb154-1714"><a href="#cb154-1714"></a>            <span class="at">colour =</span> <span class="st">"red"</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb154-1715"><a href="#cb154-1715"></a>  <span class="fu">scale_x_continuous</span>(<span class="st">"Hour"</span>, <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">24</span>,<span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb154-1716"><a href="#cb154-1716"></a>  <span class="fu">scale_y_continuous</span>(<span class="st">"Median step length"</span>) <span class="sc">+</span></span>
<span id="cb154-1717"><a href="#cb154-1717"></a>  <span class="fu">scale_colour_viridis_d</span>(<span class="st">"Buffalo"</span>) <span class="sc">+</span></span>
<span id="cb154-1718"><a href="#cb154-1718"></a>  <span class="fu">ggtitle</span>(<span class="st">"Observed and modelled median step length"</span>,</span>
<span id="cb154-1719"><a href="#cb154-1719"></a>          <span class="at">subtitle =</span> <span class="st">"No harmonics"</span>) <span class="sc">+</span></span>
<span id="cb154-1720"><a href="#cb154-1720"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb154-1721"><a href="#cb154-1721"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"right"</span>)</span>
<span id="cb154-1722"><a href="#cb154-1722"></a></span>
<span id="cb154-1723"><a href="#cb154-1723"></a>median_sl_0p</span>
<span id="cb154-1724"><a href="#cb154-1724"></a></span>
<span id="cb154-1725"><a href="#cb154-1725"></a></span>
<span id="cb154-1726"><a href="#cb154-1726"></a><span class="co"># comparing the mean and median step lengths across all hours</span></span>
<span id="cb154-1727"><a href="#cb154-1727"></a><span class="co"># across the hours by individual buffalo</span></span>
<span id="cb154-1728"><a href="#cb154-1728"></a>buffalo_data_all <span class="sc">%&gt;%</span> <span class="fu">filter</span>(y <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span>  <span class="fu">group_by</span>(id) <span class="sc">%&gt;%</span> </span>
<span id="cb154-1729"><a href="#cb154-1729"></a>  <span class="fu">summarise</span>(<span class="at">mean_sl =</span> <span class="fu">mean</span>(sl), </span>
<span id="cb154-1730"><a href="#cb154-1730"></a>            <span class="at">median_sl =</span> <span class="fu">median</span>(sl), </span>
<span id="cb154-1731"><a href="#cb154-1731"></a>            <span class="at">ratio =</span> mean_sl<span class="sc">/</span>median_sl)</span>
<span id="cb154-1732"><a href="#cb154-1732"></a></span>
<span id="cb154-1733"><a href="#cb154-1733"></a><span class="co"># all buffalo</span></span>
<span id="cb154-1734"><a href="#cb154-1734"></a>buffalo_data_all <span class="sc">%&gt;%</span> <span class="fu">filter</span>(y <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb154-1735"><a href="#cb154-1735"></a>  <span class="fu">summarise</span>(<span class="at">mean_sl =</span> <span class="fu">mean</span>(sl), </span>
<span id="cb154-1736"><a href="#cb154-1736"></a>            <span class="at">median_sl =</span> <span class="fu">median</span>(sl), </span>
<span id="cb154-1737"><a href="#cb154-1737"></a>            <span class="at">ratio =</span> mean_sl<span class="sc">/</span>median_sl)</span>
<span id="cb154-1738"><a href="#cb154-1738"></a></span>
<span id="cb154-1739"><a href="#cb154-1739"></a><span class="co"># fitted model</span></span>
<span id="cb154-1740"><a href="#cb154-1740"></a>gamma_df_0p <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="at">mean_mean =</span> <span class="fu">mean</span>(mean),</span>
<span id="cb154-1741"><a href="#cb154-1741"></a>                         <span class="at">median_mean =</span> <span class="fu">mean</span>(median), </span>
<span id="cb154-1742"><a href="#cb154-1742"></a>                         <span class="at">ratio_mean =</span> mean_mean<span class="sc">/</span>median_mean)</span>
<span id="cb154-1743"><a href="#cb154-1743"></a></span>
<span id="cb154-1744"><a href="#cb154-1744"></a><span class="in">```</span></span>
<span id="cb154-1745"><a href="#cb154-1745"></a></span>
<span id="cb154-1746"><a href="#cb154-1746"></a><span class="fu">## 1p</span></span>
<span id="cb154-1747"><a href="#cb154-1747"></a></span>
<span id="cb154-1750"><a href="#cb154-1750"></a><span class="in">```{r}</span></span>
<span id="cb154-1751"><a href="#cb154-1751"></a>gamma_dist_list <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="at">mode =</span> <span class="st">"list"</span>, <span class="at">length =</span> <span class="fu">nrow</span>(hour_coefs_nat_df_1p))</span>
<span id="cb154-1752"><a href="#cb154-1752"></a>gamma_mean <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb154-1753"><a href="#cb154-1753"></a>gamma_median <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb154-1754"><a href="#cb154-1754"></a>gamma_ratio <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb154-1755"><a href="#cb154-1755"></a></span>
<span id="cb154-1756"><a href="#cb154-1756"></a><span class="cf">for</span>(hour_no <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(hour_coefs_nat_df_1p)) {</span>
<span id="cb154-1757"><a href="#cb154-1757"></a>  </span>
<span id="cb154-1758"><a href="#cb154-1758"></a>  gamma_dist_list[[hour_no]] <span class="ot">&lt;-</span> <span class="fu">rgamma</span>(n, </span>
<span id="cb154-1759"><a href="#cb154-1759"></a>                                       <span class="at">shape =</span> hour_coefs_nat_df_1p<span class="sc">$</span>shape[hour_no], </span>
<span id="cb154-1760"><a href="#cb154-1760"></a>                                       <span class="at">scale =</span> hour_coefs_nat_df_1p<span class="sc">$</span>scale[hour_no])</span>
<span id="cb154-1761"><a href="#cb154-1761"></a>  </span>
<span id="cb154-1762"><a href="#cb154-1762"></a>  gamma_mean[hour_no] <span class="ot">&lt;-</span> <span class="fu">mean</span>(gamma_dist_list[[hour_no]])</span>
<span id="cb154-1763"><a href="#cb154-1763"></a>  gamma_median[hour_no] <span class="ot">&lt;-</span> <span class="fu">median</span>(gamma_dist_list[[hour_no]])</span>
<span id="cb154-1764"><a href="#cb154-1764"></a>  gamma_ratio[hour_no] <span class="ot">&lt;-</span> gamma_mean[hour_no] <span class="sc">/</span> gamma_median[hour_no]</span>
<span id="cb154-1765"><a href="#cb154-1765"></a></span>
<span id="cb154-1766"><a href="#cb154-1766"></a>}</span>
<span id="cb154-1767"><a href="#cb154-1767"></a></span>
<span id="cb154-1768"><a href="#cb154-1768"></a>gamma_df_1p <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">model =</span> <span class="st">"1p"</span>, </span>
<span id="cb154-1769"><a href="#cb154-1769"></a>                          <span class="at">hour =</span> hour_coefs_nat_df_1p<span class="sc">$</span>hour, </span>
<span id="cb154-1770"><a href="#cb154-1770"></a>                          <span class="at">mean =</span> gamma_mean, </span>
<span id="cb154-1771"><a href="#cb154-1771"></a>                          <span class="at">median =</span> gamma_median, </span>
<span id="cb154-1772"><a href="#cb154-1772"></a>                          <span class="at">ratio =</span> gamma_ratio) </span>
<span id="cb154-1773"><a href="#cb154-1773"></a></span>
<span id="cb154-1774"><a href="#cb154-1774"></a>mean_sl_1p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb154-1775"><a href="#cb154-1775"></a>  <span class="fu">geom_path</span>(<span class="at">data =</span> movement_summary_buffalo, </span>
<span id="cb154-1776"><a href="#cb154-1776"></a>            <span class="fu">aes</span>(<span class="at">x =</span> hour, <span class="at">y =</span> mean_sl, <span class="at">colour =</span> <span class="fu">factor</span>(id))) <span class="sc">+</span></span>
<span id="cb154-1777"><a href="#cb154-1777"></a>  <span class="fu">geom_path</span>(<span class="at">data =</span> gamma_df_1p, </span>
<span id="cb154-1778"><a href="#cb154-1778"></a>            <span class="fu">aes</span>(<span class="at">x =</span> hour, <span class="at">y =</span> mean), </span>
<span id="cb154-1779"><a href="#cb154-1779"></a>            <span class="at">colour =</span> <span class="st">"red"</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb154-1780"><a href="#cb154-1780"></a>  <span class="fu">scale_x_continuous</span>(<span class="st">"Hour"</span>, <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">24</span>,<span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb154-1781"><a href="#cb154-1781"></a>  <span class="fu">scale_y_continuous</span>(<span class="st">"Mean step length"</span>) <span class="sc">+</span></span>
<span id="cb154-1782"><a href="#cb154-1782"></a>  <span class="fu">scale_colour_viridis_d</span>(<span class="st">"Buffalo"</span>) <span class="sc">+</span></span>
<span id="cb154-1783"><a href="#cb154-1783"></a>  <span class="fu">ggtitle</span>(<span class="st">"Observed and modelled mean step length"</span>,</span>
<span id="cb154-1784"><a href="#cb154-1784"></a>          <span class="at">subtitle =</span> <span class="st">"One pair of harmonics"</span>) <span class="sc">+</span></span>
<span id="cb154-1785"><a href="#cb154-1785"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb154-1786"><a href="#cb154-1786"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span>
<span id="cb154-1787"><a href="#cb154-1787"></a></span>
<span id="cb154-1788"><a href="#cb154-1788"></a>mean_sl_1p</span>
<span id="cb154-1789"><a href="#cb154-1789"></a></span>
<span id="cb154-1790"><a href="#cb154-1790"></a>median_sl_1p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb154-1791"><a href="#cb154-1791"></a>  <span class="fu">geom_path</span>(<span class="at">data =</span> movement_summary_buffalo, </span>
<span id="cb154-1792"><a href="#cb154-1792"></a>            <span class="fu">aes</span>(<span class="at">x =</span> hour, <span class="at">y =</span> median_sl, <span class="at">colour =</span> <span class="fu">factor</span>(id))) <span class="sc">+</span></span>
<span id="cb154-1793"><a href="#cb154-1793"></a>  <span class="fu">geom_path</span>(<span class="at">data =</span> gamma_df_1p, </span>
<span id="cb154-1794"><a href="#cb154-1794"></a>            <span class="fu">aes</span>(<span class="at">x =</span> hour, <span class="at">y =</span> median), </span>
<span id="cb154-1795"><a href="#cb154-1795"></a>            <span class="at">colour =</span> <span class="st">"red"</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb154-1796"><a href="#cb154-1796"></a>  <span class="fu">scale_x_continuous</span>(<span class="st">"Hour"</span>, <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">24</span>,<span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb154-1797"><a href="#cb154-1797"></a>  <span class="fu">scale_y_continuous</span>(<span class="st">"Median step length"</span>) <span class="sc">+</span></span>
<span id="cb154-1798"><a href="#cb154-1798"></a>  <span class="fu">scale_colour_viridis_d</span>(<span class="st">"Buffalo"</span>) <span class="sc">+</span></span>
<span id="cb154-1799"><a href="#cb154-1799"></a>  <span class="fu">ggtitle</span>(<span class="st">"Observed and modelled median step length"</span>,</span>
<span id="cb154-1800"><a href="#cb154-1800"></a>          <span class="at">subtitle =</span> <span class="st">"One pair of harmonics"</span>) <span class="sc">+</span></span>
<span id="cb154-1801"><a href="#cb154-1801"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb154-1802"><a href="#cb154-1802"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span>
<span id="cb154-1803"><a href="#cb154-1803"></a></span>
<span id="cb154-1804"><a href="#cb154-1804"></a>median_sl_1p</span>
<span id="cb154-1805"><a href="#cb154-1805"></a></span>
<span id="cb154-1806"><a href="#cb154-1806"></a><span class="co"># across the hours</span></span>
<span id="cb154-1807"><a href="#cb154-1807"></a>buffalo_data_all <span class="sc">%&gt;%</span> <span class="fu">filter</span>(y <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span>  <span class="fu">group_by</span>(id) <span class="sc">%&gt;%</span> </span>
<span id="cb154-1808"><a href="#cb154-1808"></a>  <span class="fu">summarise</span>(<span class="at">mean_sl =</span> <span class="fu">mean</span>(sl), </span>
<span id="cb154-1809"><a href="#cb154-1809"></a>            <span class="at">median_sl =</span> <span class="fu">median</span>(sl), </span>
<span id="cb154-1810"><a href="#cb154-1810"></a>            <span class="at">ratio =</span> mean_sl<span class="sc">/</span>median_sl)</span>
<span id="cb154-1811"><a href="#cb154-1811"></a></span>
<span id="cb154-1812"><a href="#cb154-1812"></a>buffalo_data_all <span class="sc">%&gt;%</span> <span class="fu">filter</span>(y <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb154-1813"><a href="#cb154-1813"></a>  <span class="fu">summarise</span>(<span class="at">mean_sl =</span> <span class="fu">mean</span>(sl), </span>
<span id="cb154-1814"><a href="#cb154-1814"></a>            <span class="at">median_sl =</span> <span class="fu">median</span>(sl), </span>
<span id="cb154-1815"><a href="#cb154-1815"></a>            <span class="at">ratio =</span> mean_sl<span class="sc">/</span>median_sl)</span>
<span id="cb154-1816"><a href="#cb154-1816"></a></span>
<span id="cb154-1817"><a href="#cb154-1817"></a>gamma_df_1p <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="at">mean_mean =</span> <span class="fu">mean</span>(mean),</span>
<span id="cb154-1818"><a href="#cb154-1818"></a>                      <span class="at">median_mean =</span> <span class="fu">mean</span>(median), </span>
<span id="cb154-1819"><a href="#cb154-1819"></a>                      <span class="at">ratio_mean =</span> mean_mean<span class="sc">/</span>median_mean)</span>
<span id="cb154-1820"><a href="#cb154-1820"></a></span>
<span id="cb154-1821"><a href="#cb154-1821"></a><span class="in">```</span></span>
<span id="cb154-1822"><a href="#cb154-1822"></a></span>
<span id="cb154-1823"><a href="#cb154-1823"></a><span class="fu">## 2p</span></span>
<span id="cb154-1824"><a href="#cb154-1824"></a></span>
<span id="cb154-1827"><a href="#cb154-1827"></a><span class="in">```{r}</span></span>
<span id="cb154-1828"><a href="#cb154-1828"></a>gamma_dist_list <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="at">mode =</span> <span class="st">"list"</span>, <span class="at">length =</span> <span class="fu">nrow</span>(hour_coefs_nat_df_2p))</span>
<span id="cb154-1829"><a href="#cb154-1829"></a>gamma_mean <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb154-1830"><a href="#cb154-1830"></a>gamma_median <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb154-1831"><a href="#cb154-1831"></a>gamma_ratio <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb154-1832"><a href="#cb154-1832"></a></span>
<span id="cb154-1833"><a href="#cb154-1833"></a><span class="cf">for</span>(hour_no <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(hour_coefs_nat_df_2p)) {</span>
<span id="cb154-1834"><a href="#cb154-1834"></a>  </span>
<span id="cb154-1835"><a href="#cb154-1835"></a>gamma_dist_list[[hour_no]] <span class="ot">&lt;-</span> <span class="fu">rgamma</span>(n, </span>
<span id="cb154-1836"><a href="#cb154-1836"></a>                                     <span class="at">shape =</span> hour_coefs_nat_df_2p<span class="sc">$</span>shape[hour_no], </span>
<span id="cb154-1837"><a href="#cb154-1837"></a>                                     <span class="at">scale =</span> hour_coefs_nat_df_2p<span class="sc">$</span>scale[hour_no])</span>
<span id="cb154-1838"><a href="#cb154-1838"></a></span>
<span id="cb154-1839"><a href="#cb154-1839"></a>gamma_mean[hour_no] <span class="ot">&lt;-</span> <span class="fu">mean</span>(gamma_dist_list[[hour_no]])</span>
<span id="cb154-1840"><a href="#cb154-1840"></a>gamma_median[hour_no] <span class="ot">&lt;-</span> <span class="fu">median</span>(gamma_dist_list[[hour_no]])</span>
<span id="cb154-1841"><a href="#cb154-1841"></a>gamma_ratio[hour_no] <span class="ot">&lt;-</span> gamma_mean[hour_no] <span class="sc">/</span> gamma_median[hour_no]</span>
<span id="cb154-1842"><a href="#cb154-1842"></a></span>
<span id="cb154-1843"><a href="#cb154-1843"></a>}</span>
<span id="cb154-1844"><a href="#cb154-1844"></a></span>
<span id="cb154-1845"><a href="#cb154-1845"></a>gamma_df_2p <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">model =</span> <span class="st">"2p"</span>, </span>
<span id="cb154-1846"><a href="#cb154-1846"></a>                          <span class="at">hour =</span> hour_coefs_nat_df_2p<span class="sc">$</span>hour, </span>
<span id="cb154-1847"><a href="#cb154-1847"></a>                          <span class="at">mean =</span> gamma_mean, </span>
<span id="cb154-1848"><a href="#cb154-1848"></a>                          <span class="at">median =</span> gamma_median, </span>
<span id="cb154-1849"><a href="#cb154-1849"></a>                          <span class="at">ratio =</span> gamma_ratio) </span>
<span id="cb154-1850"><a href="#cb154-1850"></a></span>
<span id="cb154-1851"><a href="#cb154-1851"></a>mean_sl_2p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb154-1852"><a href="#cb154-1852"></a>  <span class="fu">geom_path</span>(<span class="at">data =</span> movement_summary_buffalo, </span>
<span id="cb154-1853"><a href="#cb154-1853"></a>            <span class="fu">aes</span>(<span class="at">x =</span> hour, <span class="at">y =</span> mean_sl, <span class="at">colour =</span> <span class="fu">factor</span>(id))) <span class="sc">+</span></span>
<span id="cb154-1854"><a href="#cb154-1854"></a>  <span class="fu">geom_path</span>(<span class="at">data =</span> gamma_df_2p, </span>
<span id="cb154-1855"><a href="#cb154-1855"></a>            <span class="fu">aes</span>(<span class="at">x =</span> hour, <span class="at">y =</span> mean), </span>
<span id="cb154-1856"><a href="#cb154-1856"></a>            <span class="at">colour =</span> <span class="st">"red"</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb154-1857"><a href="#cb154-1857"></a>  <span class="fu">scale_x_continuous</span>(<span class="st">"Hour"</span>, <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">24</span>,<span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb154-1858"><a href="#cb154-1858"></a>  <span class="fu">scale_y_continuous</span>(<span class="st">"Mean step length"</span>) <span class="sc">+</span></span>
<span id="cb154-1859"><a href="#cb154-1859"></a>  <span class="fu">scale_colour_viridis_d</span>(<span class="st">"Buffalo"</span>) <span class="sc">+</span></span>
<span id="cb154-1860"><a href="#cb154-1860"></a>  <span class="fu">ggtitle</span>(<span class="st">"Observed and modelled mean step length"</span>,</span>
<span id="cb154-1861"><a href="#cb154-1861"></a>          <span class="at">subtitle =</span> <span class="st">"Two pairs of harmonics"</span>) <span class="sc">+</span></span>
<span id="cb154-1862"><a href="#cb154-1862"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb154-1863"><a href="#cb154-1863"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span>
<span id="cb154-1864"><a href="#cb154-1864"></a></span>
<span id="cb154-1865"><a href="#cb154-1865"></a>mean_sl_2p</span>
<span id="cb154-1866"><a href="#cb154-1866"></a></span>
<span id="cb154-1867"><a href="#cb154-1867"></a>median_sl_2p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb154-1868"><a href="#cb154-1868"></a>  <span class="fu">geom_path</span>(<span class="at">data =</span> movement_summary_buffalo, </span>
<span id="cb154-1869"><a href="#cb154-1869"></a>            <span class="fu">aes</span>(<span class="at">x =</span> hour, <span class="at">y =</span> median_sl, <span class="at">colour =</span> <span class="fu">factor</span>(id))) <span class="sc">+</span></span>
<span id="cb154-1870"><a href="#cb154-1870"></a>  <span class="fu">geom_path</span>(<span class="at">data =</span> gamma_df_2p, </span>
<span id="cb154-1871"><a href="#cb154-1871"></a>            <span class="fu">aes</span>(<span class="at">x =</span> hour, <span class="at">y =</span> median), </span>
<span id="cb154-1872"><a href="#cb154-1872"></a>            <span class="at">colour =</span> <span class="st">"red"</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb154-1873"><a href="#cb154-1873"></a>  <span class="fu">scale_x_continuous</span>(<span class="st">"Hour"</span>, <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">24</span>,<span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb154-1874"><a href="#cb154-1874"></a>  <span class="fu">scale_y_continuous</span>(<span class="st">"Median step length"</span>) <span class="sc">+</span></span>
<span id="cb154-1875"><a href="#cb154-1875"></a>  <span class="fu">scale_colour_viridis_d</span>(<span class="st">"Buffalo"</span>) <span class="sc">+</span></span>
<span id="cb154-1876"><a href="#cb154-1876"></a>  <span class="fu">ggtitle</span>(<span class="st">"Observed and modelled median step length"</span>,</span>
<span id="cb154-1877"><a href="#cb154-1877"></a>          <span class="at">subtitle =</span> <span class="st">"Two pairs of harmonics"</span>) <span class="sc">+</span></span>
<span id="cb154-1878"><a href="#cb154-1878"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb154-1879"><a href="#cb154-1879"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span>
<span id="cb154-1880"><a href="#cb154-1880"></a></span>
<span id="cb154-1881"><a href="#cb154-1881"></a>median_sl_2p</span>
<span id="cb154-1882"><a href="#cb154-1882"></a></span>
<span id="cb154-1883"><a href="#cb154-1883"></a><span class="co"># across the hours</span></span>
<span id="cb154-1884"><a href="#cb154-1884"></a>buffalo_data_all <span class="sc">%&gt;%</span> <span class="fu">filter</span>(y <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span>  <span class="fu">group_by</span>(id) <span class="sc">%&gt;%</span> </span>
<span id="cb154-1885"><a href="#cb154-1885"></a>  <span class="fu">summarise</span>(<span class="at">mean_sl =</span> <span class="fu">mean</span>(sl), </span>
<span id="cb154-1886"><a href="#cb154-1886"></a>            <span class="at">median_sl =</span> <span class="fu">median</span>(sl), </span>
<span id="cb154-1887"><a href="#cb154-1887"></a>            <span class="at">ratio =</span> mean_sl<span class="sc">/</span>median_sl)</span>
<span id="cb154-1888"><a href="#cb154-1888"></a></span>
<span id="cb154-1889"><a href="#cb154-1889"></a>buffalo_data_all <span class="sc">%&gt;%</span> <span class="fu">filter</span>(y <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb154-1890"><a href="#cb154-1890"></a>  <span class="fu">summarise</span>(<span class="at">mean_sl =</span> <span class="fu">mean</span>(sl), </span>
<span id="cb154-1891"><a href="#cb154-1891"></a>            <span class="at">median_sl =</span> <span class="fu">median</span>(sl), </span>
<span id="cb154-1892"><a href="#cb154-1892"></a>            <span class="at">ratio =</span> mean_sl<span class="sc">/</span>median_sl)</span>
<span id="cb154-1893"><a href="#cb154-1893"></a></span>
<span id="cb154-1894"><a href="#cb154-1894"></a>gamma_df_2p <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="at">mean_mean =</span> <span class="fu">mean</span>(mean),</span>
<span id="cb154-1895"><a href="#cb154-1895"></a>                         <span class="at">median_mean =</span> <span class="fu">mean</span>(median), </span>
<span id="cb154-1896"><a href="#cb154-1896"></a>                         <span class="at">ratio_mean =</span> mean_mean<span class="sc">/</span>median_mean)</span>
<span id="cb154-1897"><a href="#cb154-1897"></a></span>
<span id="cb154-1898"><a href="#cb154-1898"></a><span class="in">```</span></span>
<span id="cb154-1899"><a href="#cb154-1899"></a></span>
<span id="cb154-1900"><a href="#cb154-1900"></a><span class="fu">## 3p</span></span>
<span id="cb154-1901"><a href="#cb154-1901"></a></span>
<span id="cb154-1904"><a href="#cb154-1904"></a><span class="in">```{r}</span></span>
<span id="cb154-1905"><a href="#cb154-1905"></a>gamma_dist_list <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="at">mode =</span> <span class="st">"list"</span>, <span class="at">length =</span> <span class="fu">nrow</span>(hour_coefs_nat_df_3p))</span>
<span id="cb154-1906"><a href="#cb154-1906"></a>gamma_mean <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb154-1907"><a href="#cb154-1907"></a>gamma_median <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb154-1908"><a href="#cb154-1908"></a>gamma_ratio <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb154-1909"><a href="#cb154-1909"></a></span>
<span id="cb154-1910"><a href="#cb154-1910"></a><span class="cf">for</span>(hour_no <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(hour_coefs_nat_df_3p)) {</span>
<span id="cb154-1911"><a href="#cb154-1911"></a>  </span>
<span id="cb154-1912"><a href="#cb154-1912"></a>gamma_dist_list[[hour_no]] <span class="ot">&lt;-</span> <span class="fu">rgamma</span>(n, </span>
<span id="cb154-1913"><a href="#cb154-1913"></a>                                     <span class="at">shape =</span> hour_coefs_nat_df_3p<span class="sc">$</span>shape[hour_no], </span>
<span id="cb154-1914"><a href="#cb154-1914"></a>                                     <span class="at">scale =</span> hour_coefs_nat_df_3p<span class="sc">$</span>scale[hour_no])</span>
<span id="cb154-1915"><a href="#cb154-1915"></a></span>
<span id="cb154-1916"><a href="#cb154-1916"></a>gamma_mean[hour_no] <span class="ot">&lt;-</span> <span class="fu">mean</span>(gamma_dist_list[[hour_no]])</span>
<span id="cb154-1917"><a href="#cb154-1917"></a>gamma_median[hour_no] <span class="ot">&lt;-</span> <span class="fu">median</span>(gamma_dist_list[[hour_no]])</span>
<span id="cb154-1918"><a href="#cb154-1918"></a>gamma_ratio[hour_no] <span class="ot">&lt;-</span> gamma_mean[hour_no] <span class="sc">/</span> gamma_median[hour_no]</span>
<span id="cb154-1919"><a href="#cb154-1919"></a></span>
<span id="cb154-1920"><a href="#cb154-1920"></a>}</span>
<span id="cb154-1921"><a href="#cb154-1921"></a></span>
<span id="cb154-1922"><a href="#cb154-1922"></a>gamma_df_3p <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">model =</span> <span class="st">"3p"</span>, </span>
<span id="cb154-1923"><a href="#cb154-1923"></a>                          <span class="at">hour =</span> hour_coefs_nat_df_3p<span class="sc">$</span>hour, </span>
<span id="cb154-1924"><a href="#cb154-1924"></a>                          <span class="at">mean =</span> gamma_mean, </span>
<span id="cb154-1925"><a href="#cb154-1925"></a>                          <span class="at">median =</span> gamma_median, </span>
<span id="cb154-1926"><a href="#cb154-1926"></a>                          <span class="at">ratio =</span> gamma_ratio)</span>
<span id="cb154-1927"><a href="#cb154-1927"></a></span>
<span id="cb154-1928"><a href="#cb154-1928"></a>mean_sl_3p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb154-1929"><a href="#cb154-1929"></a>  <span class="fu">geom_path</span>(<span class="at">data =</span> movement_summary_buffalo, </span>
<span id="cb154-1930"><a href="#cb154-1930"></a>            <span class="fu">aes</span>(<span class="at">x =</span> hour, <span class="at">y =</span> mean_sl, <span class="at">colour =</span> <span class="fu">factor</span>(id))) <span class="sc">+</span></span>
<span id="cb154-1931"><a href="#cb154-1931"></a>  <span class="fu">geom_path</span>(<span class="at">data =</span> gamma_df_3p, </span>
<span id="cb154-1932"><a href="#cb154-1932"></a>            <span class="fu">aes</span>(<span class="at">x =</span> hour, <span class="at">y =</span> mean), </span>
<span id="cb154-1933"><a href="#cb154-1933"></a>            <span class="at">colour =</span> <span class="st">"red"</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb154-1934"><a href="#cb154-1934"></a>  <span class="fu">scale_x_continuous</span>(<span class="st">"Hour"</span>, <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">24</span>,<span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb154-1935"><a href="#cb154-1935"></a>  <span class="fu">scale_y_continuous</span>(<span class="st">"Mean step length"</span>) <span class="sc">+</span></span>
<span id="cb154-1936"><a href="#cb154-1936"></a>  <span class="fu">scale_colour_viridis_d</span>(<span class="st">"Buffalo"</span>) <span class="sc">+</span></span>
<span id="cb154-1937"><a href="#cb154-1937"></a>  <span class="fu">ggtitle</span>(<span class="st">"Observed and modelled mean step length"</span>,</span>
<span id="cb154-1938"><a href="#cb154-1938"></a>          <span class="at">subtitle =</span> <span class="st">"Three pairs of harmonics"</span>) <span class="sc">+</span></span>
<span id="cb154-1939"><a href="#cb154-1939"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb154-1940"><a href="#cb154-1940"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span>
<span id="cb154-1941"><a href="#cb154-1941"></a></span>
<span id="cb154-1942"><a href="#cb154-1942"></a>mean_sl_3p</span>
<span id="cb154-1943"><a href="#cb154-1943"></a></span>
<span id="cb154-1944"><a href="#cb154-1944"></a>median_sl_3p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb154-1945"><a href="#cb154-1945"></a>  <span class="fu">geom_path</span>(<span class="at">data =</span> movement_summary_buffalo, </span>
<span id="cb154-1946"><a href="#cb154-1946"></a>            <span class="fu">aes</span>(<span class="at">x =</span> hour, <span class="at">y =</span> median_sl, <span class="at">colour =</span> <span class="fu">factor</span>(id))) <span class="sc">+</span></span>
<span id="cb154-1947"><a href="#cb154-1947"></a>  <span class="fu">geom_path</span>(<span class="at">data =</span> gamma_df_3p, </span>
<span id="cb154-1948"><a href="#cb154-1948"></a>            <span class="fu">aes</span>(<span class="at">x =</span> hour, <span class="at">y =</span> median), </span>
<span id="cb154-1949"><a href="#cb154-1949"></a>            <span class="at">colour =</span> <span class="st">"red"</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb154-1950"><a href="#cb154-1950"></a>  <span class="fu">scale_x_continuous</span>(<span class="st">"Hour"</span>, <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">24</span>,<span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb154-1951"><a href="#cb154-1951"></a>  <span class="fu">scale_y_continuous</span>(<span class="st">"Median step length"</span>) <span class="sc">+</span></span>
<span id="cb154-1952"><a href="#cb154-1952"></a>  <span class="fu">scale_colour_viridis_d</span>(<span class="st">"Buffalo"</span>) <span class="sc">+</span></span>
<span id="cb154-1953"><a href="#cb154-1953"></a>  <span class="fu">ggtitle</span>(<span class="st">"Observed and modelled median step length"</span>,</span>
<span id="cb154-1954"><a href="#cb154-1954"></a>          <span class="at">subtitle =</span> <span class="st">"Three pairs of harmonics"</span>) <span class="sc">+</span></span>
<span id="cb154-1955"><a href="#cb154-1955"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb154-1956"><a href="#cb154-1956"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span>
<span id="cb154-1957"><a href="#cb154-1957"></a></span>
<span id="cb154-1958"><a href="#cb154-1958"></a>median_sl_3p</span>
<span id="cb154-1959"><a href="#cb154-1959"></a></span>
<span id="cb154-1960"><a href="#cb154-1960"></a><span class="co"># across the hours</span></span>
<span id="cb154-1961"><a href="#cb154-1961"></a>buffalo_data_all <span class="sc">%&gt;%</span> <span class="fu">filter</span>(y <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span>  <span class="fu">group_by</span>(id) <span class="sc">%&gt;%</span> </span>
<span id="cb154-1962"><a href="#cb154-1962"></a>  <span class="fu">summarise</span>(<span class="at">mean_sl =</span> <span class="fu">mean</span>(sl), </span>
<span id="cb154-1963"><a href="#cb154-1963"></a>            <span class="at">median_sl =</span> <span class="fu">median</span>(sl), </span>
<span id="cb154-1964"><a href="#cb154-1964"></a>            <span class="at">ratio =</span> mean_sl<span class="sc">/</span>median_sl)</span>
<span id="cb154-1965"><a href="#cb154-1965"></a></span>
<span id="cb154-1966"><a href="#cb154-1966"></a>buffalo_data_all <span class="sc">%&gt;%</span> <span class="fu">filter</span>(y <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb154-1967"><a href="#cb154-1967"></a>  <span class="fu">summarise</span>(<span class="at">mean_sl =</span> <span class="fu">mean</span>(sl), </span>
<span id="cb154-1968"><a href="#cb154-1968"></a>            <span class="at">median_sl =</span> <span class="fu">median</span>(sl), </span>
<span id="cb154-1969"><a href="#cb154-1969"></a>            <span class="at">ratio =</span> mean_sl<span class="sc">/</span>median_sl)</span>
<span id="cb154-1970"><a href="#cb154-1970"></a></span>
<span id="cb154-1971"><a href="#cb154-1971"></a>gamma_df_3p <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="at">mean_mean =</span> <span class="fu">mean</span>(mean),</span>
<span id="cb154-1972"><a href="#cb154-1972"></a>                      <span class="at">median_mean =</span> <span class="fu">mean</span>(median), </span>
<span id="cb154-1973"><a href="#cb154-1973"></a>                      <span class="at">ratio_mean =</span> mean_mean<span class="sc">/</span>median_mean)</span>
<span id="cb154-1974"><a href="#cb154-1974"></a></span>
<span id="cb154-1975"><a href="#cb154-1975"></a><span class="in">```</span></span>
<span id="cb154-1976"><a href="#cb154-1976"></a></span>
<span id="cb154-1977"><a href="#cb154-1977"></a>:::</span>
<span id="cb154-1978"><a href="#cb154-1978"></a></span>
<span id="cb154-1979"><a href="#cb154-1979"></a><span class="fu">## Creating selection surfaces</span></span>
<span id="cb154-1980"><a href="#cb154-1980"></a></span>
<span id="cb154-1981"><a href="#cb154-1981"></a>As we have both quadratic and harmonic terms in the model, we can reconstruct a 'selection surface' to visualise how the animal's respond to environmental features changes through time.</span>
<span id="cb154-1982"><a href="#cb154-1982"></a></span>
<span id="cb154-1983"><a href="#cb154-1983"></a>To illustrate, if we don't have temporal dynamics (as is the case for this model), then we have a coefficient for the linear term and a coefficient for the quadratic term. Using these, we can plot the selection curve at the scale of the environmental variable (in this case NDVI).</span>
<span id="cb154-1984"><a href="#cb154-1984"></a></span>
<span id="cb154-1985"><a href="#cb154-1985"></a>Using the natural scale coefficients from the model:</span>
<span id="cb154-1986"><a href="#cb154-1986"></a></span>
<span id="cb154-1989"><a href="#cb154-1989"></a><span class="in">```{r}</span></span>
<span id="cb154-1990"><a href="#cb154-1990"></a><span class="co"># first get a sequence of NDVI values, </span></span>
<span id="cb154-1991"><a href="#cb154-1991"></a><span class="co"># starting from the minimum observed in the data to the maximum</span></span>
<span id="cb154-1992"><a href="#cb154-1992"></a>ndvi_min <span class="ot">&lt;-</span> <span class="fu">min</span>(buffalo_data<span class="sc">$</span>ndvi_temporal, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb154-1993"><a href="#cb154-1993"></a>ndvi_max <span class="ot">&lt;-</span> <span class="fu">max</span>(buffalo_data<span class="sc">$</span>ndvi_temporal, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb154-1994"><a href="#cb154-1994"></a>ndvi_seq <span class="ot">&lt;-</span> <span class="fu">seq</span>(ndvi_min, ndvi_max, <span class="at">by =</span> <span class="fl">0.01</span>)</span>
<span id="cb154-1995"><a href="#cb154-1995"></a></span>
<span id="cb154-1996"><a href="#cb154-1996"></a><span class="co"># take the coefficients from the model and calculation the selection value </span></span>
<span id="cb154-1997"><a href="#cb154-1997"></a><span class="co"># for every NDVI value in this sequence</span></span>
<span id="cb154-1998"><a href="#cb154-1998"></a></span>
<span id="cb154-1999"><a href="#cb154-1999"></a><span class="co"># we can separate to the linear term</span></span>
<span id="cb154-2000"><a href="#cb154-2000"></a>ndvi_linear_selection <span class="ot">&lt;-</span> hour_coefs_nat_df_0p<span class="sc">$</span>ndvi[<span class="dv">1</span>] <span class="sc">*</span> ndvi_seq </span>
<span id="cb154-2001"><a href="#cb154-2001"></a><span class="fu">plot</span>(<span class="at">x =</span> ndvi_seq, <span class="at">y =</span> ndvi_linear_selection,</span>
<span id="cb154-2002"><a href="#cb154-2002"></a>     <span class="at">main =</span> <span class="st">"Selection for NDVI - linear term"</span>,</span>
<span id="cb154-2003"><a href="#cb154-2003"></a>     <span class="at">xlab =</span> <span class="st">"NDVI"</span>, <span class="at">ylab =</span> <span class="st">"Estimated selection"</span>)</span>
<span id="cb154-2004"><a href="#cb154-2004"></a><span class="fu">lines</span>(ndvi_seq, <span class="fu">rep</span>(<span class="dv">0</span>,<span class="fu">length</span>(ndvi_seq)), <span class="at">lty =</span> <span class="st">"dashed"</span>)</span>
<span id="cb154-2005"><a href="#cb154-2005"></a></span>
<span id="cb154-2006"><a href="#cb154-2006"></a><span class="co"># and the quadratic term</span></span>
<span id="cb154-2007"><a href="#cb154-2007"></a>ndvi_quadratic_selection <span class="ot">&lt;-</span> (hour_coefs_nat_df_0p<span class="sc">$</span>ndvi_2[<span class="dv">1</span>] <span class="sc">*</span> (ndvi_seq <span class="sc">^</span> <span class="dv">2</span>))</span>
<span id="cb154-2008"><a href="#cb154-2008"></a><span class="fu">plot</span>(<span class="at">x =</span> ndvi_seq, <span class="at">y =</span> ndvi_quadratic_selection,</span>
<span id="cb154-2009"><a href="#cb154-2009"></a>     <span class="at">main =</span> <span class="st">"Selection for NDVI - quadratic term"</span>,</span>
<span id="cb154-2010"><a href="#cb154-2010"></a>     <span class="at">xlab =</span> <span class="st">"NDVI"</span>, <span class="at">ylab =</span> <span class="st">"Estimated selection"</span>)</span>
<span id="cb154-2011"><a href="#cb154-2011"></a><span class="fu">lines</span>(ndvi_seq, <span class="fu">rep</span>(<span class="dv">0</span>,<span class="fu">length</span>(ndvi_seq)), <span class="at">lty =</span> <span class="st">"dashed"</span>)</span>
<span id="cb154-2012"><a href="#cb154-2012"></a></span>
<span id="cb154-2013"><a href="#cb154-2013"></a><span class="co"># and the sum of both</span></span>
<span id="cb154-2014"><a href="#cb154-2014"></a>ndvi_sum_selection <span class="ot">&lt;-</span> ndvi_linear_selection <span class="sc">+</span> ndvi_quadratic_selection</span>
<span id="cb154-2015"><a href="#cb154-2015"></a><span class="fu">plot</span>(<span class="at">x =</span> ndvi_seq, <span class="at">y =</span> ndvi_sum_selection,</span>
<span id="cb154-2016"><a href="#cb154-2016"></a>     <span class="at">main =</span> <span class="st">"Selection for NDVI - sum of linear and quadratic terms"</span>,</span>
<span id="cb154-2017"><a href="#cb154-2017"></a>     <span class="at">xlab =</span> <span class="st">"NDVI"</span>, <span class="at">ylab =</span> <span class="st">"Estimated selection"</span>)</span>
<span id="cb154-2018"><a href="#cb154-2018"></a><span class="fu">lines</span>(ndvi_seq, <span class="fu">rep</span>(<span class="dv">0</span>,<span class="fu">length</span>(ndvi_seq)), <span class="at">lty =</span> <span class="st">"dashed"</span>)</span>
<span id="cb154-2019"><a href="#cb154-2019"></a></span>
<span id="cb154-2020"><a href="#cb154-2020"></a><span class="in">```</span></span>
<span id="cb154-2021"><a href="#cb154-2021"></a></span>
<span id="cb154-2022"><a href="#cb154-2022"></a>When there are no temporal dynamics, then this quadratic curve will be the same throughout the day, but when we have temporally dynamic coefficients for both the linear term and the quadratic term, then we will have a curves that vary continuously throughout the day, which we can visualise as a selection surface.</span>
<span id="cb154-2023"><a href="#cb154-2023"></a></span>
<span id="cb154-2024"><a href="#cb154-2024"></a>Here we illustrate for the model with 2 pairs of harmonic terms.</span>
<span id="cb154-2025"><a href="#cb154-2025"></a></span>
<span id="cb154-2026"><a href="#cb154-2026"></a>For brevity we won't plot the linear and quadratic terms separately, but we can do so if needed.</span>
<span id="cb154-2027"><a href="#cb154-2027"></a></span>
<span id="cb154-2028"><a href="#cb154-2028"></a>First for **Hour 3**</span>
<span id="cb154-2029"><a href="#cb154-2029"></a></span>
<span id="cb154-2032"><a href="#cb154-2032"></a><span class="in">```{r}</span></span>
<span id="cb154-2033"><a href="#cb154-2033"></a>hour_no <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb154-2034"><a href="#cb154-2034"></a></span>
<span id="cb154-2035"><a href="#cb154-2035"></a><span class="co"># we can separate to the linear term</span></span>
<span id="cb154-2036"><a href="#cb154-2036"></a>ndvi_linear_selection <span class="ot">&lt;-</span> </span>
<span id="cb154-2037"><a href="#cb154-2037"></a>  hour_coefs_nat_df_1p<span class="sc">$</span>ndvi[<span class="fu">which</span>(hour_coefs_nat_df_1p<span class="sc">$</span>hour <span class="sc">==</span> hour_no)] <span class="sc">*</span> ndvi_seq</span>
<span id="cb154-2038"><a href="#cb154-2038"></a><span class="co"># plot(x = ndvi_seq, y = ndvi_linear_selection,</span></span>
<span id="cb154-2039"><a href="#cb154-2039"></a><span class="co">#      main = "Selection for NDVI - linear term",</span></span>
<span id="cb154-2040"><a href="#cb154-2040"></a><span class="co">#      xlab = "NDVI", ylab = "Estimated selection")</span></span>
<span id="cb154-2041"><a href="#cb154-2041"></a></span>
<span id="cb154-2042"><a href="#cb154-2042"></a><span class="co"># and the quadratic term</span></span>
<span id="cb154-2043"><a href="#cb154-2043"></a>ndvi_quadratic_selection <span class="ot">&lt;-</span> </span>
<span id="cb154-2044"><a href="#cb154-2044"></a>  (hour_coefs_nat_df_1p<span class="sc">$</span>ndvi_2[<span class="fu">which</span>(hour_coefs_nat_df_1p<span class="sc">$</span>hour <span class="sc">==</span> hour_no)] <span class="sc">*</span> (ndvi_seq <span class="sc">^</span> <span class="dv">2</span>))</span>
<span id="cb154-2045"><a href="#cb154-2045"></a><span class="co"># plot(x = ndvi_seq, y = ndvi_quadratic_selection,</span></span>
<span id="cb154-2046"><a href="#cb154-2046"></a><span class="co">#      main = "Selection for NDVI - quadratic term",</span></span>
<span id="cb154-2047"><a href="#cb154-2047"></a><span class="co">#      xlab = "NDVI", ylab = "Estimated selection")</span></span>
<span id="cb154-2048"><a href="#cb154-2048"></a></span>
<span id="cb154-2049"><a href="#cb154-2049"></a><span class="co"># and the sum of both</span></span>
<span id="cb154-2050"><a href="#cb154-2050"></a>ndvi_sum_selection <span class="ot">&lt;-</span> ndvi_linear_selection <span class="sc">+</span> ndvi_quadratic_selection</span>
<span id="cb154-2051"><a href="#cb154-2051"></a><span class="fu">plot</span>(<span class="at">x =</span> ndvi_seq, <span class="at">y =</span> ndvi_sum_selection,</span>
<span id="cb154-2052"><a href="#cb154-2052"></a>     <span class="at">main =</span> <span class="st">"Selection for NDVI - sum of linear and quadratic terms"</span>,</span>
<span id="cb154-2053"><a href="#cb154-2053"></a>     <span class="at">xlab =</span> <span class="st">"NDVI"</span>, <span class="at">ylab =</span> <span class="st">"Estimated selection"</span>)</span>
<span id="cb154-2054"><a href="#cb154-2054"></a><span class="fu">lines</span>(ndvi_seq, <span class="fu">rep</span>(<span class="dv">0</span>,<span class="fu">length</span>(ndvi_seq)), <span class="at">lty =</span> <span class="st">"dashed"</span>)</span>
<span id="cb154-2055"><a href="#cb154-2055"></a></span>
<span id="cb154-2056"><a href="#cb154-2056"></a><span class="in">```</span></span>
<span id="cb154-2057"><a href="#cb154-2057"></a></span>
<span id="cb154-2058"><a href="#cb154-2058"></a>We can see that the coefficient at hour 3 shows highest selection for NDVI values slightly above 0.2, and the coefficient is mostly negative.</span>
<span id="cb154-2059"><a href="#cb154-2059"></a></span>
<span id="cb154-2060"><a href="#cb154-2060"></a>Secondly for **Hour 12**</span>
<span id="cb154-2061"><a href="#cb154-2061"></a></span>
<span id="cb154-2064"><a href="#cb154-2064"></a><span class="in">```{r}</span></span>
<span id="cb154-2065"><a href="#cb154-2065"></a>hour_no <span class="ot">&lt;-</span> <span class="dv">12</span></span>
<span id="cb154-2066"><a href="#cb154-2066"></a></span>
<span id="cb154-2067"><a href="#cb154-2067"></a><span class="co"># we can separate to the linear term</span></span>
<span id="cb154-2068"><a href="#cb154-2068"></a>ndvi_linear_selection <span class="ot">&lt;-</span> </span>
<span id="cb154-2069"><a href="#cb154-2069"></a>  hour_coefs_nat_df_1p<span class="sc">$</span>ndvi[<span class="fu">which</span>(hour_coefs_nat_df_1p<span class="sc">$</span>hour <span class="sc">==</span> hour_no)] <span class="sc">*</span> ndvi_seq</span>
<span id="cb154-2070"><a href="#cb154-2070"></a><span class="co"># plot(x = ndvi_seq, y = ndvi_linear_selection,</span></span>
<span id="cb154-2071"><a href="#cb154-2071"></a><span class="co">#      main = "Selection for NDVI - linear term",</span></span>
<span id="cb154-2072"><a href="#cb154-2072"></a><span class="co">#      xlab = "NDVI", ylab = "Estimated selection")</span></span>
<span id="cb154-2073"><a href="#cb154-2073"></a></span>
<span id="cb154-2074"><a href="#cb154-2074"></a><span class="co"># and the quadratic term</span></span>
<span id="cb154-2075"><a href="#cb154-2075"></a>ndvi_quadratic_selection <span class="ot">&lt;-</span> </span>
<span id="cb154-2076"><a href="#cb154-2076"></a>  (hour_coefs_nat_df_1p<span class="sc">$</span>ndvi_2[<span class="fu">which</span>(hour_coefs_nat_df_1p<span class="sc">$</span>hour <span class="sc">==</span> hour_no)] <span class="sc">*</span> (ndvi_seq <span class="sc">^</span> <span class="dv">2</span>))</span>
<span id="cb154-2077"><a href="#cb154-2077"></a><span class="co"># plot(x = ndvi_seq, y = ndvi_quadratic_selection,</span></span>
<span id="cb154-2078"><a href="#cb154-2078"></a><span class="co">#      main = "Selection for NDVI - quadratic term",</span></span>
<span id="cb154-2079"><a href="#cb154-2079"></a><span class="co">#      xlab = "NDVI", ylab = "Estimated selection")</span></span>
<span id="cb154-2080"><a href="#cb154-2080"></a></span>
<span id="cb154-2081"><a href="#cb154-2081"></a><span class="co"># and the sum of both</span></span>
<span id="cb154-2082"><a href="#cb154-2082"></a>ndvi_sum_selection <span class="ot">&lt;-</span> ndvi_linear_selection <span class="sc">+</span> ndvi_quadratic_selection</span>
<span id="cb154-2083"><a href="#cb154-2083"></a><span class="fu">plot</span>(<span class="at">x =</span> ndvi_seq, <span class="at">y =</span> ndvi_sum_selection,</span>
<span id="cb154-2084"><a href="#cb154-2084"></a>     <span class="at">main =</span> <span class="st">"Selection for NDVI - sum of linear and quadratic terms"</span>,</span>
<span id="cb154-2085"><a href="#cb154-2085"></a>     <span class="at">xlab =</span> <span class="st">"NDVI"</span>, <span class="at">ylab =</span> <span class="st">"Estimated selection"</span>)</span>
<span id="cb154-2086"><a href="#cb154-2086"></a><span class="fu">lines</span>(ndvi_seq, <span class="fu">rep</span>(<span class="dv">0</span>,<span class="fu">length</span>(ndvi_seq)), <span class="at">lty =</span> <span class="st">"dashed"</span>)</span>
<span id="cb154-2087"><a href="#cb154-2087"></a></span>
<span id="cb154-2088"><a href="#cb154-2088"></a><span class="in">```</span></span>
<span id="cb154-2089"><a href="#cb154-2089"></a></span>
<span id="cb154-2090"><a href="#cb154-2090"></a>Whereas for hour 12, the coefficient shows highest selection for NDVI values slightly above 0.4, and the coefficient is positive for NDVI values above 0.</span>
<span id="cb154-2091"><a href="#cb154-2091"></a></span>
<span id="cb154-2092"><a href="#cb154-2092"></a>We can imagine viewing these plots for every hour of the day, where each hour has a different quadratic curve, but this would be a lot of plots. We can also see it as a 3D surface, where the x-axis is the hour of the day, the y-axis is the NDVI value, and the z-axis (colour) is the coefficient value.</span>
<span id="cb154-2093"><a href="#cb154-2093"></a></span>
<span id="cb154-2094"><a href="#cb154-2094"></a>We simply index over the linear and quadratic terms and calculate the coefficient values at every time point.</span>
<span id="cb154-2095"><a href="#cb154-2095"></a></span>
<span id="cb154-2096"><a href="#cb154-2096"></a><span class="fu">## NDVI selection surface</span></span>
<span id="cb154-2097"><a href="#cb154-2097"></a></span>
<span id="cb154-2098"><a href="#cb154-2098"></a>::: {.panel-tabset group="model"}</span>
<span id="cb154-2099"><a href="#cb154-2099"></a></span>
<span id="cb154-2100"><a href="#cb154-2100"></a><span class="fu">## 0p</span></span>
<span id="cb154-2101"><a href="#cb154-2101"></a></span>
<span id="cb154-2104"><a href="#cb154-2104"></a><span class="in">```{r}</span></span>
<span id="cb154-2105"><a href="#cb154-2105"></a>ndvi_min <span class="ot">&lt;-</span> <span class="fu">min</span>(buffalo_data<span class="sc">$</span>ndvi_temporal, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb154-2106"><a href="#cb154-2106"></a>ndvi_max <span class="ot">&lt;-</span> <span class="fu">max</span>(buffalo_data<span class="sc">$</span>ndvi_temporal, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb154-2107"><a href="#cb154-2107"></a>ndvi_seq <span class="ot">&lt;-</span> <span class="fu">seq</span>(ndvi_min, ndvi_max, <span class="at">by =</span> <span class="fl">0.01</span>)</span>
<span id="cb154-2108"><a href="#cb154-2108"></a></span>
<span id="cb154-2109"><a href="#cb154-2109"></a><span class="co"># Create empty data frame</span></span>
<span id="cb154-2110"><a href="#cb154-2110"></a>ndvi_fresponse_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">matrix</span>(<span class="at">ncol =</span> <span class="fu">nrow</span>(hour_coefs_nat_df_0p), </span>
<span id="cb154-2111"><a href="#cb154-2111"></a>                                       <span class="at">nrow =</span> <span class="fu">length</span>(ndvi_seq)))</span>
<span id="cb154-2112"><a href="#cb154-2112"></a></span>
<span id="cb154-2113"><a href="#cb154-2113"></a><span class="co"># loop over each time increment, calculating the selection values for each NDVI value</span></span>
<span id="cb154-2114"><a href="#cb154-2114"></a><span class="co"># and storing each time increment as a column in a dataframe that we can use for plotting</span></span>
<span id="cb154-2115"><a href="#cb154-2115"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(hour_coefs_nat_df_0p)) {</span>
<span id="cb154-2116"><a href="#cb154-2116"></a>  <span class="co"># Assign the vector as a column to the dataframe</span></span>
<span id="cb154-2117"><a href="#cb154-2117"></a>  ndvi_fresponse_df[,i] <span class="ot">&lt;-</span> (hour_coefs_nat_df_0p<span class="sc">$</span>ndvi[i] <span class="sc">*</span> ndvi_seq) <span class="sc">+</span> </span>
<span id="cb154-2118"><a href="#cb154-2118"></a>    (hour_coefs_nat_df_0p<span class="sc">$</span>ndvi_2[i] <span class="sc">*</span> (ndvi_seq <span class="sc">^</span> <span class="dv">2</span>))</span>
<span id="cb154-2119"><a href="#cb154-2119"></a>}</span>
<span id="cb154-2120"><a href="#cb154-2120"></a></span>
<span id="cb154-2121"><a href="#cb154-2121"></a>ndvi_fresponse_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(ndvi_seq, ndvi_fresponse_df)</span>
<span id="cb154-2122"><a href="#cb154-2122"></a><span class="fu">colnames</span>(ndvi_fresponse_df) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"ndvi"</span>, hour)</span>
<span id="cb154-2123"><a href="#cb154-2123"></a>ndvi_fresponse_long <span class="ot">&lt;-</span> <span class="fu">pivot_longer</span>(ndvi_fresponse_df, </span>
<span id="cb154-2124"><a href="#cb154-2124"></a>                                    <span class="at">cols =</span> <span class="sc">!</span><span class="dv">1</span>, <span class="at">names_to =</span> <span class="st">"hour"</span>)</span>
<span id="cb154-2125"><a href="#cb154-2125"></a></span>
<span id="cb154-2126"><a href="#cb154-2126"></a>ndvi_contour_max <span class="ot">&lt;-</span> <span class="fu">max</span>(ndvi_fresponse_long<span class="sc">$</span>value) <span class="co"># 0.7890195</span></span>
<span id="cb154-2127"><a href="#cb154-2127"></a>ndvi_contour_min <span class="ot">&lt;-</span> <span class="fu">min</span>(ndvi_fresponse_long<span class="sc">$</span>value) <span class="co"># -0.7945691</span></span>
<span id="cb154-2128"><a href="#cb154-2128"></a>ndvi_contour_increment <span class="ot">&lt;-</span> (ndvi_contour_max<span class="sc">-</span>ndvi_contour_min)<span class="sc">/</span><span class="dv">10</span></span>
<span id="cb154-2129"><a href="#cb154-2129"></a></span>
<span id="cb154-2130"><a href="#cb154-2130"></a>ndvi_quad_0p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> ndvi_fresponse_long, </span>
<span id="cb154-2131"><a href="#cb154-2131"></a>                       <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">as.numeric</span>(hour), <span class="at">y =</span> ndvi)) <span class="sc">+</span></span>
<span id="cb154-2132"><a href="#cb154-2132"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">colour =</span> value)) <span class="sc">+</span> </span>
<span id="cb154-2133"><a href="#cb154-2133"></a>  <span class="fu">geom_contour</span>(<span class="fu">aes</span>(<span class="at">z =</span> value), </span>
<span id="cb154-2134"><a href="#cb154-2134"></a>               <span class="at">breaks =</span> <span class="fu">seq</span>(ndvi_contour_increment, </span>
<span id="cb154-2135"><a href="#cb154-2135"></a>                            ndvi_contour_max, </span>
<span id="cb154-2136"><a href="#cb154-2136"></a>                            ndvi_contour_increment), </span>
<span id="cb154-2137"><a href="#cb154-2137"></a>               <span class="at">colour =</span> <span class="st">"black"</span>, <span class="at">linewidth =</span> <span class="fl">0.25</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb154-2138"><a href="#cb154-2138"></a>  <span class="fu">geom_contour</span>(<span class="fu">aes</span>(<span class="at">z =</span> value), </span>
<span id="cb154-2139"><a href="#cb154-2139"></a>               <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="sc">-</span>ndvi_contour_increment, </span>
<span id="cb154-2140"><a href="#cb154-2140"></a>                            ndvi_contour_min, </span>
<span id="cb154-2141"><a href="#cb154-2141"></a>                            <span class="sc">-</span>ndvi_contour_increment), </span>
<span id="cb154-2142"><a href="#cb154-2142"></a>               <span class="at">colour =</span> <span class="st">"red"</span>, <span class="at">linewidth =</span> <span class="fl">0.25</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb154-2143"><a href="#cb154-2143"></a>  <span class="fu">geom_contour</span>(<span class="fu">aes</span>(<span class="at">z =</span> value), <span class="at">breaks =</span> <span class="dv">0</span>, <span class="at">colour =</span> <span class="st">"black"</span>, <span class="at">linewidth =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb154-2144"><a href="#cb154-2144"></a>  <span class="fu">scale_x_continuous</span>(<span class="st">"Hour"</span>, <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">24</span>,<span class="dv">6</span>)) <span class="sc">+</span></span>
<span id="cb154-2145"><a href="#cb154-2145"></a>  <span class="fu">scale_y_continuous</span>(<span class="st">"NDVI value"</span>, <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>, <span class="fl">0.25</span>)) <span class="sc">+</span></span>
<span id="cb154-2146"><a href="#cb154-2146"></a>  <span class="fu">scale_colour_viridis_c</span>(<span class="st">"Selection"</span>) <span class="sc">+</span></span>
<span id="cb154-2147"><a href="#cb154-2147"></a>  <span class="fu">ggtitle</span>(<span class="st">"Normalised Difference Vegetation Index (NDVI)"</span>) <span class="sc">+</span></span>
<span id="cb154-2148"><a href="#cb154-2148"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb154-2149"><a href="#cb154-2149"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span>
<span id="cb154-2150"><a href="#cb154-2150"></a></span>
<span id="cb154-2151"><a href="#cb154-2151"></a>ndvi_quad_0p</span>
<span id="cb154-2152"><a href="#cb154-2152"></a></span>
<span id="cb154-2153"><a href="#cb154-2153"></a><span class="in">```</span></span>
<span id="cb154-2154"><a href="#cb154-2154"></a></span>
<span id="cb154-2155"><a href="#cb154-2155"></a><span class="fu">## 1p</span></span>
<span id="cb154-2156"><a href="#cb154-2156"></a></span>
<span id="cb154-2159"><a href="#cb154-2159"></a><span class="in">```{r}</span></span>
<span id="cb154-2160"><a href="#cb154-2160"></a>ndvi_min <span class="ot">&lt;-</span> <span class="fu">min</span>(buffalo_data<span class="sc">$</span>ndvi_temporal, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb154-2161"><a href="#cb154-2161"></a>ndvi_max <span class="ot">&lt;-</span> <span class="fu">max</span>(buffalo_data<span class="sc">$</span>ndvi_temporal, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb154-2162"><a href="#cb154-2162"></a>ndvi_seq <span class="ot">&lt;-</span> <span class="fu">seq</span>(ndvi_min, ndvi_max, <span class="at">by =</span> <span class="fl">0.01</span>)</span>
<span id="cb154-2163"><a href="#cb154-2163"></a></span>
<span id="cb154-2164"><a href="#cb154-2164"></a><span class="co"># Create empty data frame</span></span>
<span id="cb154-2165"><a href="#cb154-2165"></a>ndvi_fresponse_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">matrix</span>(<span class="at">ncol =</span> <span class="fu">nrow</span>(hour_coefs_nat_df_1p), </span>
<span id="cb154-2166"><a href="#cb154-2166"></a>                                       <span class="at">nrow =</span> <span class="fu">length</span>(ndvi_seq)))</span>
<span id="cb154-2167"><a href="#cb154-2167"></a></span>
<span id="cb154-2168"><a href="#cb154-2168"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(hour_coefs_nat_df_1p)) {</span>
<span id="cb154-2169"><a href="#cb154-2169"></a>  <span class="co"># Assign the vector as a column to the dataframe</span></span>
<span id="cb154-2170"><a href="#cb154-2170"></a>  ndvi_fresponse_df[,i] <span class="ot">&lt;-</span> (hour_coefs_nat_df_1p<span class="sc">$</span>ndvi[i] <span class="sc">*</span> ndvi_seq) <span class="sc">+</span> </span>
<span id="cb154-2171"><a href="#cb154-2171"></a>    (hour_coefs_nat_df_1p<span class="sc">$</span>ndvi_2[i] <span class="sc">*</span> (ndvi_seq <span class="sc">^</span> <span class="dv">2</span>))</span>
<span id="cb154-2172"><a href="#cb154-2172"></a>}</span>
<span id="cb154-2173"><a href="#cb154-2173"></a></span>
<span id="cb154-2174"><a href="#cb154-2174"></a>ndvi_fresponse_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(ndvi_seq, ndvi_fresponse_df)</span>
<span id="cb154-2175"><a href="#cb154-2175"></a><span class="fu">colnames</span>(ndvi_fresponse_df) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"ndvi"</span>, hour)</span>
<span id="cb154-2176"><a href="#cb154-2176"></a>ndvi_fresponse_long <span class="ot">&lt;-</span> <span class="fu">pivot_longer</span>(ndvi_fresponse_df, <span class="at">cols =</span> <span class="sc">!</span><span class="dv">1</span>, <span class="at">names_to =</span> <span class="st">"hour"</span>)</span>
<span id="cb154-2177"><a href="#cb154-2177"></a></span>
<span id="cb154-2178"><a href="#cb154-2178"></a>ndvi_contour_max <span class="ot">&lt;-</span> <span class="fu">max</span>(ndvi_fresponse_long<span class="sc">$</span>value) <span class="co"># 0.7890195</span></span>
<span id="cb154-2179"><a href="#cb154-2179"></a>ndvi_contour_min <span class="ot">&lt;-</span> <span class="fu">min</span>(ndvi_fresponse_long<span class="sc">$</span>value) <span class="co"># -0.7945691</span></span>
<span id="cb154-2180"><a href="#cb154-2180"></a>ndvi_contour_increment <span class="ot">&lt;-</span> (ndvi_contour_max<span class="sc">-</span>ndvi_contour_min)<span class="sc">/</span><span class="dv">10</span></span>
<span id="cb154-2181"><a href="#cb154-2181"></a></span>
<span id="cb154-2182"><a href="#cb154-2182"></a>ndvi_quad_1p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> ndvi_fresponse_long, </span>
<span id="cb154-2183"><a href="#cb154-2183"></a>                       <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">as.numeric</span>(hour), <span class="at">y =</span> ndvi)) <span class="sc">+</span></span>
<span id="cb154-2184"><a href="#cb154-2184"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">colour =</span> value)) <span class="sc">+</span> <span class="co"># colour = "white"</span></span>
<span id="cb154-2185"><a href="#cb154-2185"></a>  <span class="fu">geom_contour</span>(<span class="fu">aes</span>(<span class="at">z =</span> value), </span>
<span id="cb154-2186"><a href="#cb154-2186"></a>               <span class="at">breaks =</span> <span class="fu">seq</span>(ndvi_contour_increment, </span>
<span id="cb154-2187"><a href="#cb154-2187"></a>                            ndvi_contour_max, </span>
<span id="cb154-2188"><a href="#cb154-2188"></a>                            ndvi_contour_increment), </span>
<span id="cb154-2189"><a href="#cb154-2189"></a>               <span class="at">colour =</span> <span class="st">"black"</span>, <span class="at">linewidth =</span> <span class="fl">0.25</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb154-2190"><a href="#cb154-2190"></a>  <span class="fu">geom_contour</span>(<span class="fu">aes</span>(<span class="at">z =</span> value), </span>
<span id="cb154-2191"><a href="#cb154-2191"></a>               <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="sc">-</span>ndvi_contour_increment, </span>
<span id="cb154-2192"><a href="#cb154-2192"></a>                            ndvi_contour_min, </span>
<span id="cb154-2193"><a href="#cb154-2193"></a>                            <span class="sc">-</span>ndvi_contour_increment), </span>
<span id="cb154-2194"><a href="#cb154-2194"></a>               <span class="at">colour =</span> <span class="st">"red"</span>, <span class="at">linewidth =</span> <span class="fl">0.25</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb154-2195"><a href="#cb154-2195"></a>  <span class="fu">geom_contour</span>(<span class="fu">aes</span>(<span class="at">z =</span> value), <span class="at">breaks =</span> <span class="dv">0</span>, <span class="at">colour =</span> <span class="st">"black"</span>, <span class="at">linewidth =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb154-2196"><a href="#cb154-2196"></a>  <span class="fu">scale_x_continuous</span>(<span class="st">"Hour"</span>, <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">24</span>,<span class="dv">6</span>)) <span class="sc">+</span></span>
<span id="cb154-2197"><a href="#cb154-2197"></a>  <span class="fu">scale_y_continuous</span>(<span class="st">"NDVI value"</span>, <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>, <span class="fl">0.25</span>)) <span class="sc">+</span></span>
<span id="cb154-2198"><a href="#cb154-2198"></a>  <span class="fu">scale_colour_viridis_c</span>(<span class="st">"Selection"</span>) <span class="sc">+</span></span>
<span id="cb154-2199"><a href="#cb154-2199"></a>  <span class="co"># ggtitle("Normalised Difference Vegetation Index (NDVI)") +</span></span>
<span id="cb154-2200"><a href="#cb154-2200"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb154-2201"><a href="#cb154-2201"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span>
<span id="cb154-2202"><a href="#cb154-2202"></a></span>
<span id="cb154-2203"><a href="#cb154-2203"></a>ndvi_quad_1p</span>
<span id="cb154-2204"><a href="#cb154-2204"></a></span>
<span id="cb154-2205"><a href="#cb154-2205"></a><span class="in">```</span></span>
<span id="cb154-2206"><a href="#cb154-2206"></a></span>
<span id="cb154-2207"><a href="#cb154-2207"></a><span class="fu">## 2p</span></span>
<span id="cb154-2208"><a href="#cb154-2208"></a></span>
<span id="cb154-2211"><a href="#cb154-2211"></a><span class="in">```{r}</span></span>
<span id="cb154-2212"><a href="#cb154-2212"></a>ndvi_min <span class="ot">&lt;-</span> <span class="fu">min</span>(buffalo_data<span class="sc">$</span>ndvi_temporal, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb154-2213"><a href="#cb154-2213"></a>ndvi_max <span class="ot">&lt;-</span> <span class="fu">max</span>(buffalo_data<span class="sc">$</span>ndvi_temporal, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb154-2214"><a href="#cb154-2214"></a>ndvi_seq <span class="ot">&lt;-</span> <span class="fu">seq</span>(ndvi_min, ndvi_max, <span class="at">by =</span> <span class="fl">0.01</span>)</span>
<span id="cb154-2215"><a href="#cb154-2215"></a></span>
<span id="cb154-2216"><a href="#cb154-2216"></a><span class="co"># Create empty data frame</span></span>
<span id="cb154-2217"><a href="#cb154-2217"></a>ndvi_fresponse_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">matrix</span>(<span class="at">ncol =</span> <span class="fu">nrow</span>(hour_coefs_nat_df_2p), </span>
<span id="cb154-2218"><a href="#cb154-2218"></a>                                       <span class="at">nrow =</span> <span class="fu">length</span>(ndvi_seq)))</span>
<span id="cb154-2219"><a href="#cb154-2219"></a></span>
<span id="cb154-2220"><a href="#cb154-2220"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(hour_coefs_nat_df_2p)) {</span>
<span id="cb154-2221"><a href="#cb154-2221"></a>  <span class="co"># Assign the vector as a column to the dataframe</span></span>
<span id="cb154-2222"><a href="#cb154-2222"></a>  ndvi_fresponse_df[,i] <span class="ot">&lt;-</span> (hour_coefs_nat_df_2p<span class="sc">$</span>ndvi[i] <span class="sc">*</span> ndvi_seq) <span class="sc">+</span> </span>
<span id="cb154-2223"><a href="#cb154-2223"></a>    (hour_coefs_nat_df_2p<span class="sc">$</span>ndvi_2[i] <span class="sc">*</span> (ndvi_seq <span class="sc">^</span> <span class="dv">2</span>))</span>
<span id="cb154-2224"><a href="#cb154-2224"></a>}</span>
<span id="cb154-2225"><a href="#cb154-2225"></a></span>
<span id="cb154-2226"><a href="#cb154-2226"></a>ndvi_fresponse_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(ndvi_seq, ndvi_fresponse_df)</span>
<span id="cb154-2227"><a href="#cb154-2227"></a><span class="fu">colnames</span>(ndvi_fresponse_df) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"ndvi"</span>, hour)</span>
<span id="cb154-2228"><a href="#cb154-2228"></a>ndvi_fresponse_long <span class="ot">&lt;-</span> <span class="fu">pivot_longer</span>(ndvi_fresponse_df, <span class="at">cols =</span> <span class="sc">!</span><span class="dv">1</span>, </span>
<span id="cb154-2229"><a href="#cb154-2229"></a>                                    <span class="at">names_to =</span> <span class="st">"hour"</span>)</span>
<span id="cb154-2230"><a href="#cb154-2230"></a></span>
<span id="cb154-2231"><a href="#cb154-2231"></a>ndvi_contour_max <span class="ot">&lt;-</span> <span class="fu">max</span>(ndvi_fresponse_long<span class="sc">$</span>value) <span class="co"># 0.7890195</span></span>
<span id="cb154-2232"><a href="#cb154-2232"></a>ndvi_contour_min <span class="ot">&lt;-</span> <span class="fu">min</span>(ndvi_fresponse_long<span class="sc">$</span>value) <span class="co"># -0.7945691</span></span>
<span id="cb154-2233"><a href="#cb154-2233"></a>ndvi_contour_increment <span class="ot">&lt;-</span> (ndvi_contour_max<span class="sc">-</span>ndvi_contour_min)<span class="sc">/</span><span class="dv">10</span></span>
<span id="cb154-2234"><a href="#cb154-2234"></a></span>
<span id="cb154-2235"><a href="#cb154-2235"></a>ndvi_quad_2p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> ndvi_fresponse_long, </span>
<span id="cb154-2236"><a href="#cb154-2236"></a>                       <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">as.numeric</span>(hour), <span class="at">y =</span> ndvi)) <span class="sc">+</span></span>
<span id="cb154-2237"><a href="#cb154-2237"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">colour =</span> value)) <span class="sc">+</span> <span class="co"># colour = "white"</span></span>
<span id="cb154-2238"><a href="#cb154-2238"></a>  <span class="fu">geom_contour</span>(<span class="fu">aes</span>(<span class="at">z =</span> value), </span>
<span id="cb154-2239"><a href="#cb154-2239"></a>               <span class="at">breaks =</span> <span class="fu">seq</span>(ndvi_contour_increment, </span>
<span id="cb154-2240"><a href="#cb154-2240"></a>                            ndvi_contour_max, </span>
<span id="cb154-2241"><a href="#cb154-2241"></a>                            ndvi_contour_increment), </span>
<span id="cb154-2242"><a href="#cb154-2242"></a>               <span class="at">colour =</span> <span class="st">"black"</span>, <span class="at">linewidth =</span> <span class="fl">0.25</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb154-2243"><a href="#cb154-2243"></a>  <span class="fu">geom_contour</span>(<span class="fu">aes</span>(<span class="at">z =</span> value), </span>
<span id="cb154-2244"><a href="#cb154-2244"></a>               <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="sc">-</span>ndvi_contour_increment, </span>
<span id="cb154-2245"><a href="#cb154-2245"></a>                            ndvi_contour_min, </span>
<span id="cb154-2246"><a href="#cb154-2246"></a>                            <span class="sc">-</span>ndvi_contour_increment), </span>
<span id="cb154-2247"><a href="#cb154-2247"></a>               <span class="at">colour =</span> <span class="st">"red"</span>, <span class="at">linewidth =</span> <span class="fl">0.25</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb154-2248"><a href="#cb154-2248"></a>  <span class="fu">geom_contour</span>(<span class="fu">aes</span>(<span class="at">z =</span> value), <span class="at">breaks =</span> <span class="dv">0</span>, <span class="at">colour =</span> <span class="st">"black"</span>, <span class="at">linewidth =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb154-2249"><a href="#cb154-2249"></a>  <span class="fu">scale_x_continuous</span>(<span class="st">"Hour"</span>, <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">24</span>,<span class="dv">6</span>)) <span class="sc">+</span></span>
<span id="cb154-2250"><a href="#cb154-2250"></a>  <span class="fu">scale_y_continuous</span>(<span class="st">"NDVI value"</span>, <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>, <span class="fl">0.25</span>)) <span class="sc">+</span></span>
<span id="cb154-2251"><a href="#cb154-2251"></a>  <span class="fu">scale_colour_viridis_c</span>(<span class="st">"Selection"</span>) <span class="sc">+</span></span>
<span id="cb154-2252"><a href="#cb154-2252"></a>  <span class="co"># ggtitle("Normalised Difference Vegetation Index (NDVI)") +</span></span>
<span id="cb154-2253"><a href="#cb154-2253"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb154-2254"><a href="#cb154-2254"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"right"</span>)</span>
<span id="cb154-2255"><a href="#cb154-2255"></a></span>
<span id="cb154-2256"><a href="#cb154-2256"></a>ndvi_quad_2p</span>
<span id="cb154-2257"><a href="#cb154-2257"></a></span>
<span id="cb154-2258"><a href="#cb154-2258"></a><span class="co"># ggsave(paste0("outputs/plots/manuscript_figs_R2/ndvi_selection_surface_legend_",</span></span>
<span id="cb154-2259"><a href="#cb154-2259"></a><span class="co">#          Sys.Date(), ".png"),</span></span>
<span id="cb154-2260"><a href="#cb154-2260"></a><span class="co">#   width=170, height=90, units="mm", dpi = 1000)</span></span>
<span id="cb154-2261"><a href="#cb154-2261"></a></span>
<span id="cb154-2262"><a href="#cb154-2262"></a><span class="in">```</span></span>
<span id="cb154-2263"><a href="#cb154-2263"></a></span>
<span id="cb154-2264"><a href="#cb154-2264"></a><span class="fu">## 3p</span></span>
<span id="cb154-2265"><a href="#cb154-2265"></a></span>
<span id="cb154-2268"><a href="#cb154-2268"></a><span class="in">```{r}</span></span>
<span id="cb154-2269"><a href="#cb154-2269"></a>ndvi_min <span class="ot">&lt;-</span> <span class="fu">min</span>(buffalo_data<span class="sc">$</span>ndvi_temporal, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb154-2270"><a href="#cb154-2270"></a>ndvi_max <span class="ot">&lt;-</span> <span class="fu">max</span>(buffalo_data<span class="sc">$</span>ndvi_temporal, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb154-2271"><a href="#cb154-2271"></a>ndvi_seq <span class="ot">&lt;-</span> <span class="fu">seq</span>(ndvi_min, ndvi_max, <span class="at">by =</span> <span class="fl">0.01</span>)</span>
<span id="cb154-2272"><a href="#cb154-2272"></a></span>
<span id="cb154-2273"><a href="#cb154-2273"></a><span class="co"># Create empty data frame</span></span>
<span id="cb154-2274"><a href="#cb154-2274"></a>ndvi_fresponse_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">matrix</span>(<span class="at">ncol =</span> <span class="fu">nrow</span>(hour_coefs_nat_df_3p), </span>
<span id="cb154-2275"><a href="#cb154-2275"></a>                                       <span class="at">nrow =</span> <span class="fu">length</span>(ndvi_seq)))</span>
<span id="cb154-2276"><a href="#cb154-2276"></a></span>
<span id="cb154-2277"><a href="#cb154-2277"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(hour_coefs_nat_df_3p)) {</span>
<span id="cb154-2278"><a href="#cb154-2278"></a>  <span class="co"># Assign the vector as a column to the dataframe</span></span>
<span id="cb154-2279"><a href="#cb154-2279"></a>  ndvi_fresponse_df[,i] <span class="ot">&lt;-</span> (hour_coefs_nat_df_3p<span class="sc">$</span>ndvi[i] <span class="sc">*</span> ndvi_seq) <span class="sc">+</span> </span>
<span id="cb154-2280"><a href="#cb154-2280"></a>    (hour_coefs_nat_df_3p<span class="sc">$</span>ndvi_2[i] <span class="sc">*</span> (ndvi_seq <span class="sc">^</span> <span class="dv">2</span>))</span>
<span id="cb154-2281"><a href="#cb154-2281"></a>}</span>
<span id="cb154-2282"><a href="#cb154-2282"></a></span>
<span id="cb154-2283"><a href="#cb154-2283"></a>ndvi_fresponse_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(ndvi_seq, ndvi_fresponse_df)</span>
<span id="cb154-2284"><a href="#cb154-2284"></a><span class="fu">colnames</span>(ndvi_fresponse_df) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"ndvi"</span>, hour)</span>
<span id="cb154-2285"><a href="#cb154-2285"></a>ndvi_fresponse_long <span class="ot">&lt;-</span> <span class="fu">pivot_longer</span>(ndvi_fresponse_df, <span class="at">cols =</span> <span class="sc">!</span><span class="dv">1</span>, </span>
<span id="cb154-2286"><a href="#cb154-2286"></a>                                    <span class="at">names_to =</span> <span class="st">"hour"</span>)</span>
<span id="cb154-2287"><a href="#cb154-2287"></a></span>
<span id="cb154-2288"><a href="#cb154-2288"></a>ndvi_contour_max <span class="ot">&lt;-</span> <span class="fu">max</span>(ndvi_fresponse_long<span class="sc">$</span>value) <span class="co"># 0.7890195</span></span>
<span id="cb154-2289"><a href="#cb154-2289"></a>ndvi_contour_min <span class="ot">&lt;-</span> <span class="fu">min</span>(ndvi_fresponse_long<span class="sc">$</span>value) <span class="co"># -0.7945691</span></span>
<span id="cb154-2290"><a href="#cb154-2290"></a>ndvi_contour_increment <span class="ot">&lt;-</span> (ndvi_contour_max<span class="sc">-</span>ndvi_contour_min)<span class="sc">/</span><span class="dv">10</span></span>
<span id="cb154-2291"><a href="#cb154-2291"></a></span>
<span id="cb154-2292"><a href="#cb154-2292"></a>ndvi_quad_3p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> ndvi_fresponse_long, </span>
<span id="cb154-2293"><a href="#cb154-2293"></a>                       <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">as.numeric</span>(hour), <span class="at">y =</span> ndvi)) <span class="sc">+</span></span>
<span id="cb154-2294"><a href="#cb154-2294"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">colour =</span> value)) <span class="sc">+</span> <span class="co"># colour = "white"</span></span>
<span id="cb154-2295"><a href="#cb154-2295"></a>  <span class="fu">geom_contour</span>(<span class="fu">aes</span>(<span class="at">z =</span> value), </span>
<span id="cb154-2296"><a href="#cb154-2296"></a>               <span class="at">breaks =</span> <span class="fu">seq</span>(ndvi_contour_increment, </span>
<span id="cb154-2297"><a href="#cb154-2297"></a>                            ndvi_contour_max, </span>
<span id="cb154-2298"><a href="#cb154-2298"></a>                            ndvi_contour_increment), </span>
<span id="cb154-2299"><a href="#cb154-2299"></a>               <span class="at">colour =</span> <span class="st">"black"</span>, <span class="at">linewidth =</span> <span class="fl">0.25</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb154-2300"><a href="#cb154-2300"></a>  <span class="fu">geom_contour</span>(<span class="fu">aes</span>(<span class="at">z =</span> value), </span>
<span id="cb154-2301"><a href="#cb154-2301"></a>               <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="sc">-</span>ndvi_contour_increment, </span>
<span id="cb154-2302"><a href="#cb154-2302"></a>                            ndvi_contour_min, </span>
<span id="cb154-2303"><a href="#cb154-2303"></a>                            <span class="sc">-</span>ndvi_contour_increment), </span>
<span id="cb154-2304"><a href="#cb154-2304"></a>               <span class="at">colour =</span> <span class="st">"red"</span>, <span class="at">linewidth =</span> <span class="fl">0.25</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb154-2305"><a href="#cb154-2305"></a>  <span class="fu">geom_contour</span>(<span class="fu">aes</span>(<span class="at">z =</span> value), <span class="at">breaks =</span> <span class="dv">0</span>, <span class="at">colour =</span> <span class="st">"black"</span>, <span class="at">linewidth =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb154-2306"><a href="#cb154-2306"></a>  <span class="fu">scale_x_continuous</span>(<span class="st">"Hour"</span>, <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">24</span>,<span class="dv">6</span>)) <span class="sc">+</span></span>
<span id="cb154-2307"><a href="#cb154-2307"></a>  <span class="fu">scale_y_continuous</span>(<span class="st">"NDVI value"</span>, <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>, <span class="fl">0.25</span>)) <span class="sc">+</span></span>
<span id="cb154-2308"><a href="#cb154-2308"></a>  <span class="fu">scale_colour_viridis_c</span>(<span class="st">"Selection"</span>) <span class="sc">+</span></span>
<span id="cb154-2309"><a href="#cb154-2309"></a>  <span class="co"># ggtitle("Normalised Difference Vegetation Index (NDVI)") +</span></span>
<span id="cb154-2310"><a href="#cb154-2310"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb154-2311"><a href="#cb154-2311"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span>
<span id="cb154-2312"><a href="#cb154-2312"></a></span>
<span id="cb154-2313"><a href="#cb154-2313"></a>ndvi_quad_3p</span>
<span id="cb154-2314"><a href="#cb154-2314"></a></span>
<span id="cb154-2315"><a href="#cb154-2315"></a><span class="in">```</span></span>
<span id="cb154-2316"><a href="#cb154-2316"></a></span>
<span id="cb154-2317"><a href="#cb154-2317"></a>:::</span>
<span id="cb154-2318"><a href="#cb154-2318"></a></span>
<span id="cb154-2319"><a href="#cb154-2319"></a><span class="fu">## Canopy cover selection surface</span></span>
<span id="cb154-2320"><a href="#cb154-2320"></a></span>
<span id="cb154-2321"><a href="#cb154-2321"></a>::: {.panel-tabset group="model"}</span>
<span id="cb154-2322"><a href="#cb154-2322"></a></span>
<span id="cb154-2323"><a href="#cb154-2323"></a><span class="fu">## 0p</span></span>
<span id="cb154-2324"><a href="#cb154-2324"></a></span>
<span id="cb154-2327"><a href="#cb154-2327"></a><span class="in">```{r}</span></span>
<span id="cb154-2328"><a href="#cb154-2328"></a>canopy_min <span class="ot">&lt;-</span> <span class="fu">min</span>(buffalo_data<span class="sc">$</span>canopy_01, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb154-2329"><a href="#cb154-2329"></a>canopy_max <span class="ot">&lt;-</span> <span class="fu">max</span>(buffalo_data<span class="sc">$</span>canopy_01, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb154-2330"><a href="#cb154-2330"></a>canopy_seq <span class="ot">&lt;-</span> <span class="fu">seq</span>(canopy_min, canopy_max, <span class="at">by =</span> <span class="fl">0.01</span>)</span>
<span id="cb154-2331"><a href="#cb154-2331"></a></span>
<span id="cb154-2332"><a href="#cb154-2332"></a><span class="co"># Create empty data frame</span></span>
<span id="cb154-2333"><a href="#cb154-2333"></a>canopy_fresponse_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">matrix</span>(<span class="at">ncol =</span> <span class="fu">nrow</span>(hour_coefs_nat_df_0p), </span>
<span id="cb154-2334"><a href="#cb154-2334"></a>                                         <span class="at">nrow =</span> <span class="fu">length</span>(canopy_seq)))</span>
<span id="cb154-2335"><a href="#cb154-2335"></a></span>
<span id="cb154-2336"><a href="#cb154-2336"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(hour_coefs_nat_df_0p)) {</span>
<span id="cb154-2337"><a href="#cb154-2337"></a>  <span class="co"># Assign the vector as a column to the dataframe</span></span>
<span id="cb154-2338"><a href="#cb154-2338"></a>  canopy_fresponse_df[,i] <span class="ot">&lt;-</span> (hour_coefs_nat_df_0p<span class="sc">$</span>canopy[i] <span class="sc">*</span> canopy_seq) <span class="sc">+</span> </span>
<span id="cb154-2339"><a href="#cb154-2339"></a>    (hour_coefs_nat_df_0p<span class="sc">$</span>canopy_2[i] <span class="sc">*</span> (canopy_seq <span class="sc">^</span> <span class="dv">2</span>))</span>
<span id="cb154-2340"><a href="#cb154-2340"></a>}</span>
<span id="cb154-2341"><a href="#cb154-2341"></a></span>
<span id="cb154-2342"><a href="#cb154-2342"></a>canopy_fresponse_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(canopy_seq, canopy_fresponse_df)</span>
<span id="cb154-2343"><a href="#cb154-2343"></a><span class="fu">colnames</span>(canopy_fresponse_df) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"canopy"</span>, hour)</span>
<span id="cb154-2344"><a href="#cb154-2344"></a>canopy_fresponse_long <span class="ot">&lt;-</span> <span class="fu">pivot_longer</span>(canopy_fresponse_df, </span>
<span id="cb154-2345"><a href="#cb154-2345"></a>                                      <span class="at">cols =</span> <span class="sc">!</span><span class="dv">1</span>, </span>
<span id="cb154-2346"><a href="#cb154-2346"></a>                                      <span class="at">names_to =</span> <span class="st">"hour"</span>)</span>
<span id="cb154-2347"><a href="#cb154-2347"></a></span>
<span id="cb154-2348"><a href="#cb154-2348"></a>canopy_contour_min <span class="ot">&lt;-</span> <span class="fu">min</span>(canopy_fresponse_long<span class="sc">$</span>value) <span class="co"># 0</span></span>
<span id="cb154-2349"><a href="#cb154-2349"></a>canopy_contour_max <span class="ot">&lt;-</span> <span class="fu">max</span>(canopy_fresponse_long<span class="sc">$</span>value) <span class="co"># 2.181749</span></span>
<span id="cb154-2350"><a href="#cb154-2350"></a>canopy_contour_increment <span class="ot">&lt;-</span> (canopy_contour_max<span class="sc">-</span>canopy_contour_min)<span class="sc">/</span><span class="dv">10</span></span>
<span id="cb154-2351"><a href="#cb154-2351"></a></span>
<span id="cb154-2352"><a href="#cb154-2352"></a>canopy_quad_0p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> canopy_fresponse_long, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">as.numeric</span>(hour), </span>
<span id="cb154-2353"><a href="#cb154-2353"></a>                                                           <span class="at">y =</span> canopy)) <span class="sc">+</span></span>
<span id="cb154-2354"><a href="#cb154-2354"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">colour =</span> value)) <span class="sc">+</span></span>
<span id="cb154-2355"><a href="#cb154-2355"></a>  <span class="fu">geom_contour</span>(<span class="fu">aes</span>(<span class="at">z =</span> value), </span>
<span id="cb154-2356"><a href="#cb154-2356"></a>               <span class="at">breaks =</span> <span class="fu">seq</span>(canopy_contour_increment, canopy_contour_max, </span>
<span id="cb154-2357"><a href="#cb154-2357"></a>                            <span class="sc">-</span>canopy_contour_increment), </span>
<span id="cb154-2358"><a href="#cb154-2358"></a>               <span class="at">colour =</span> <span class="st">"black"</span>, <span class="at">linewidth =</span> <span class="fl">0.25</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb154-2359"><a href="#cb154-2359"></a>  <span class="fu">geom_contour</span>(<span class="fu">aes</span>(<span class="at">z =</span> value),</span>
<span id="cb154-2360"><a href="#cb154-2360"></a>  <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="sc">-</span>canopy_contour_increment, canopy_contour_min,</span>
<span id="cb154-2361"><a href="#cb154-2361"></a>               <span class="sc">-</span>canopy_contour_increment),</span>
<span id="cb154-2362"><a href="#cb154-2362"></a>               <span class="at">colour =</span> <span class="st">"red"</span>, <span class="at">linewidth =</span> <span class="fl">0.25</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb154-2363"><a href="#cb154-2363"></a>  <span class="fu">geom_contour</span>(<span class="fu">aes</span>(<span class="at">z =</span> value), <span class="at">breaks =</span> <span class="dv">0</span>, <span class="at">colour =</span> <span class="st">"black"</span>, <span class="at">linewidth =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb154-2364"><a href="#cb154-2364"></a>  <span class="fu">scale_x_continuous</span>(<span class="st">"Hour"</span>, <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">24</span>,<span class="dv">6</span>)) <span class="sc">+</span></span>
<span id="cb154-2365"><a href="#cb154-2365"></a>  <span class="fu">scale_y_continuous</span>(<span class="st">"Canopy cover"</span>, <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.25</span>)) <span class="sc">+</span></span>
<span id="cb154-2366"><a href="#cb154-2366"></a>  <span class="fu">scale_colour_viridis_c</span>(<span class="st">"Selection"</span>) <span class="sc">+</span></span>
<span id="cb154-2367"><a href="#cb154-2367"></a>  <span class="fu">ggtitle</span>(<span class="st">"Canopy Cover"</span>) <span class="sc">+</span></span>
<span id="cb154-2368"><a href="#cb154-2368"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb154-2369"><a href="#cb154-2369"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span>
<span id="cb154-2370"><a href="#cb154-2370"></a></span>
<span id="cb154-2371"><a href="#cb154-2371"></a>canopy_quad_0p</span>
<span id="cb154-2372"><a href="#cb154-2372"></a></span>
<span id="cb154-2373"><a href="#cb154-2373"></a><span class="in">```</span></span>
<span id="cb154-2374"><a href="#cb154-2374"></a></span>
<span id="cb154-2375"><a href="#cb154-2375"></a><span class="fu">## 1p</span></span>
<span id="cb154-2376"><a href="#cb154-2376"></a></span>
<span id="cb154-2379"><a href="#cb154-2379"></a><span class="in">```{r}</span></span>
<span id="cb154-2380"><a href="#cb154-2380"></a>canopy_min <span class="ot">&lt;-</span> <span class="fu">min</span>(buffalo_data<span class="sc">$</span>canopy_01, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb154-2381"><a href="#cb154-2381"></a>canopy_max <span class="ot">&lt;-</span> <span class="fu">max</span>(buffalo_data<span class="sc">$</span>canopy_01, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb154-2382"><a href="#cb154-2382"></a>canopy_seq <span class="ot">&lt;-</span> <span class="fu">seq</span>(canopy_min, canopy_max, <span class="at">by =</span> <span class="fl">0.01</span>)</span>
<span id="cb154-2383"><a href="#cb154-2383"></a></span>
<span id="cb154-2384"><a href="#cb154-2384"></a><span class="co"># Create empty data frame</span></span>
<span id="cb154-2385"><a href="#cb154-2385"></a>canopy_fresponse_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">matrix</span>(<span class="at">ncol =</span> <span class="fu">nrow</span>(hour_coefs_nat_df_1p), </span>
<span id="cb154-2386"><a href="#cb154-2386"></a>                                         <span class="at">nrow =</span> <span class="fu">length</span>(canopy_seq)))</span>
<span id="cb154-2387"><a href="#cb154-2387"></a></span>
<span id="cb154-2388"><a href="#cb154-2388"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(hour_coefs_nat_df_1p)) {</span>
<span id="cb154-2389"><a href="#cb154-2389"></a>  <span class="co"># Assign the vector as a column to the dataframe</span></span>
<span id="cb154-2390"><a href="#cb154-2390"></a>  canopy_fresponse_df[,i] <span class="ot">&lt;-</span> (hour_coefs_nat_df_1p<span class="sc">$</span>canopy[i] <span class="sc">*</span> canopy_seq) <span class="sc">+</span> </span>
<span id="cb154-2391"><a href="#cb154-2391"></a>    (hour_coefs_nat_df_1p<span class="sc">$</span>canopy_2[i] <span class="sc">*</span> (canopy_seq <span class="sc">^</span> <span class="dv">2</span>))</span>
<span id="cb154-2392"><a href="#cb154-2392"></a>}</span>
<span id="cb154-2393"><a href="#cb154-2393"></a></span>
<span id="cb154-2394"><a href="#cb154-2394"></a>canopy_fresponse_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(canopy_seq, canopy_fresponse_df)</span>
<span id="cb154-2395"><a href="#cb154-2395"></a><span class="fu">colnames</span>(canopy_fresponse_df) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"canopy"</span>, hour)</span>
<span id="cb154-2396"><a href="#cb154-2396"></a>canopy_fresponse_long <span class="ot">&lt;-</span> <span class="fu">pivot_longer</span>(canopy_fresponse_df, <span class="at">cols =</span> <span class="sc">!</span><span class="dv">1</span>, </span>
<span id="cb154-2397"><a href="#cb154-2397"></a>                                      <span class="at">names_to =</span> <span class="st">"hour"</span>)</span>
<span id="cb154-2398"><a href="#cb154-2398"></a></span>
<span id="cb154-2399"><a href="#cb154-2399"></a>canopy_contour_min <span class="ot">&lt;-</span> <span class="fu">min</span>(canopy_fresponse_long<span class="sc">$</span>value) <span class="co"># 0</span></span>
<span id="cb154-2400"><a href="#cb154-2400"></a>canopy_contour_max <span class="ot">&lt;-</span> <span class="fu">max</span>(canopy_fresponse_long<span class="sc">$</span>value) <span class="co"># 2.181749</span></span>
<span id="cb154-2401"><a href="#cb154-2401"></a>canopy_contour_increment <span class="ot">&lt;-</span> (canopy_contour_max<span class="sc">-</span>canopy_contour_min)<span class="sc">/</span><span class="dv">10</span></span>
<span id="cb154-2402"><a href="#cb154-2402"></a></span>
<span id="cb154-2403"><a href="#cb154-2403"></a>canopy_quad_1p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> canopy_fresponse_long, </span>
<span id="cb154-2404"><a href="#cb154-2404"></a>                         <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">as.numeric</span>(hour), <span class="at">y =</span> canopy)) <span class="sc">+</span></span>
<span id="cb154-2405"><a href="#cb154-2405"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">colour =</span> value)) <span class="sc">+</span></span>
<span id="cb154-2406"><a href="#cb154-2406"></a>  <span class="fu">geom_contour</span>(<span class="fu">aes</span>(<span class="at">z =</span> value), </span>
<span id="cb154-2407"><a href="#cb154-2407"></a>               <span class="at">breaks =</span> <span class="fu">seq</span>(canopy_contour_increment, </span>
<span id="cb154-2408"><a href="#cb154-2408"></a>                            canopy_contour_max, </span>
<span id="cb154-2409"><a href="#cb154-2409"></a>                            <span class="sc">-</span>canopy_contour_increment), </span>
<span id="cb154-2410"><a href="#cb154-2410"></a>               <span class="at">colour =</span> <span class="st">"black"</span>, <span class="at">linewidth =</span> <span class="fl">0.25</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb154-2411"><a href="#cb154-2411"></a>  <span class="fu">geom_contour</span>(<span class="fu">aes</span>(<span class="at">z =</span> value),</span>
<span id="cb154-2412"><a href="#cb154-2412"></a>               <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="sc">-</span>canopy_contour_increment, </span>
<span id="cb154-2413"><a href="#cb154-2413"></a>                            canopy_contour_min, </span>
<span id="cb154-2414"><a href="#cb154-2414"></a>                            <span class="sc">-</span>canopy_contour_increment),</span>
<span id="cb154-2415"><a href="#cb154-2415"></a>               <span class="at">colour =</span> <span class="st">"red"</span>, <span class="at">linewidth =</span> <span class="fl">0.25</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb154-2416"><a href="#cb154-2416"></a>  <span class="fu">geom_contour</span>(<span class="fu">aes</span>(<span class="at">z =</span> value), <span class="at">breaks =</span> <span class="dv">0</span>, <span class="at">colour =</span> <span class="st">"black"</span>, <span class="at">linewidth =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb154-2417"><a href="#cb154-2417"></a>  <span class="fu">scale_x_continuous</span>(<span class="st">"Hour"</span>, <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">24</span>,<span class="dv">6</span>)) <span class="sc">+</span></span>
<span id="cb154-2418"><a href="#cb154-2418"></a>  <span class="fu">scale_y_continuous</span>(<span class="st">"Canopy cover"</span>, <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.25</span>)) <span class="sc">+</span></span>
<span id="cb154-2419"><a href="#cb154-2419"></a>  <span class="fu">scale_colour_viridis_c</span>(<span class="st">"Selection"</span>) <span class="sc">+</span></span>
<span id="cb154-2420"><a href="#cb154-2420"></a>  <span class="co"># ggtitle("Canopy Cover") +</span></span>
<span id="cb154-2421"><a href="#cb154-2421"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb154-2422"><a href="#cb154-2422"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span>
<span id="cb154-2423"><a href="#cb154-2423"></a></span>
<span id="cb154-2424"><a href="#cb154-2424"></a>canopy_quad_1p</span>
<span id="cb154-2425"><a href="#cb154-2425"></a></span>
<span id="cb154-2426"><a href="#cb154-2426"></a><span class="in">```</span></span>
<span id="cb154-2427"><a href="#cb154-2427"></a></span>
<span id="cb154-2428"><a href="#cb154-2428"></a><span class="fu">## 2p</span></span>
<span id="cb154-2429"><a href="#cb154-2429"></a></span>
<span id="cb154-2432"><a href="#cb154-2432"></a><span class="in">```{r}</span></span>
<span id="cb154-2433"><a href="#cb154-2433"></a>canopy_min <span class="ot">&lt;-</span> <span class="fu">min</span>(buffalo_data<span class="sc">$</span>canopy_01, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb154-2434"><a href="#cb154-2434"></a>canopy_max <span class="ot">&lt;-</span> <span class="fu">max</span>(buffalo_data<span class="sc">$</span>canopy_01, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb154-2435"><a href="#cb154-2435"></a>canopy_seq <span class="ot">&lt;-</span> <span class="fu">seq</span>(canopy_min, canopy_max, <span class="at">by =</span> <span class="fl">0.01</span>)</span>
<span id="cb154-2436"><a href="#cb154-2436"></a></span>
<span id="cb154-2437"><a href="#cb154-2437"></a><span class="co"># Create empty data frame</span></span>
<span id="cb154-2438"><a href="#cb154-2438"></a>canopy_fresponse_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">matrix</span>(<span class="at">ncol =</span> <span class="fu">nrow</span>(hour_coefs_nat_df_2p), </span>
<span id="cb154-2439"><a href="#cb154-2439"></a>                                         <span class="at">nrow =</span> <span class="fu">length</span>(canopy_seq)))</span>
<span id="cb154-2440"><a href="#cb154-2440"></a></span>
<span id="cb154-2441"><a href="#cb154-2441"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(hour_coefs_nat_df_2p)) {</span>
<span id="cb154-2442"><a href="#cb154-2442"></a>  <span class="co"># Assign the vector as a column to the dataframe</span></span>
<span id="cb154-2443"><a href="#cb154-2443"></a>  canopy_fresponse_df[,i] <span class="ot">&lt;-</span> (hour_coefs_nat_df_2p<span class="sc">$</span>canopy[i] <span class="sc">*</span> canopy_seq) <span class="sc">+</span> </span>
<span id="cb154-2444"><a href="#cb154-2444"></a>    (hour_coefs_nat_df_2p<span class="sc">$</span>canopy_2[i] <span class="sc">*</span> (canopy_seq <span class="sc">^</span> <span class="dv">2</span>))</span>
<span id="cb154-2445"><a href="#cb154-2445"></a>}</span>
<span id="cb154-2446"><a href="#cb154-2446"></a></span>
<span id="cb154-2447"><a href="#cb154-2447"></a>canopy_fresponse_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(canopy_seq, canopy_fresponse_df)</span>
<span id="cb154-2448"><a href="#cb154-2448"></a><span class="fu">colnames</span>(canopy_fresponse_df) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"canopy"</span>, hour)</span>
<span id="cb154-2449"><a href="#cb154-2449"></a>canopy_fresponse_long <span class="ot">&lt;-</span> <span class="fu">pivot_longer</span>(canopy_fresponse_df, <span class="at">cols =</span> <span class="sc">!</span><span class="dv">1</span>, </span>
<span id="cb154-2450"><a href="#cb154-2450"></a>                                      <span class="at">names_to =</span> <span class="st">"hour"</span>)</span>
<span id="cb154-2451"><a href="#cb154-2451"></a></span>
<span id="cb154-2452"><a href="#cb154-2452"></a>canopy_contour_min <span class="ot">&lt;-</span> <span class="fu">min</span>(canopy_fresponse_long<span class="sc">$</span>value) <span class="co"># 0</span></span>
<span id="cb154-2453"><a href="#cb154-2453"></a>canopy_contour_max <span class="ot">&lt;-</span> <span class="fu">max</span>(canopy_fresponse_long<span class="sc">$</span>value) <span class="co"># 2.181749</span></span>
<span id="cb154-2454"><a href="#cb154-2454"></a>canopy_contour_increment <span class="ot">&lt;-</span> (canopy_contour_max<span class="sc">-</span>canopy_contour_min)<span class="sc">/</span><span class="dv">10</span></span>
<span id="cb154-2455"><a href="#cb154-2455"></a></span>
<span id="cb154-2456"><a href="#cb154-2456"></a>canopy_quad_2p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> canopy_fresponse_long, </span>
<span id="cb154-2457"><a href="#cb154-2457"></a>                         <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">as.numeric</span>(hour), <span class="at">y =</span> canopy)) <span class="sc">+</span></span>
<span id="cb154-2458"><a href="#cb154-2458"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">colour =</span> value)) <span class="sc">+</span></span>
<span id="cb154-2459"><a href="#cb154-2459"></a>  <span class="fu">geom_contour</span>(<span class="fu">aes</span>(<span class="at">z =</span> value), </span>
<span id="cb154-2460"><a href="#cb154-2460"></a>               <span class="at">breaks =</span> <span class="fu">seq</span>(canopy_contour_increment, </span>
<span id="cb154-2461"><a href="#cb154-2461"></a>                            canopy_contour_max, </span>
<span id="cb154-2462"><a href="#cb154-2462"></a>                            <span class="sc">-</span>canopy_contour_increment), </span>
<span id="cb154-2463"><a href="#cb154-2463"></a>               <span class="at">colour =</span> <span class="st">"black"</span>, <span class="at">linewidth =</span> <span class="fl">0.25</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb154-2464"><a href="#cb154-2464"></a>  <span class="fu">geom_contour</span>(<span class="fu">aes</span>(<span class="at">z =</span> value),</span>
<span id="cb154-2465"><a href="#cb154-2465"></a>               <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="sc">-</span>canopy_contour_increment, </span>
<span id="cb154-2466"><a href="#cb154-2466"></a>                            canopy_contour_min, </span>
<span id="cb154-2467"><a href="#cb154-2467"></a>                            <span class="sc">-</span>canopy_contour_increment),</span>
<span id="cb154-2468"><a href="#cb154-2468"></a>               <span class="at">colour =</span> <span class="st">"red"</span>, <span class="at">linewidth =</span> <span class="fl">0.25</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb154-2469"><a href="#cb154-2469"></a>  <span class="fu">geom_contour</span>(<span class="fu">aes</span>(<span class="at">z =</span> value), <span class="at">breaks =</span> <span class="dv">0</span>, <span class="at">colour =</span> <span class="st">"black"</span>, <span class="at">linewidth =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb154-2470"><a href="#cb154-2470"></a>  <span class="fu">scale_x_continuous</span>(<span class="st">"Hour"</span>, <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">24</span>,<span class="dv">6</span>)) <span class="sc">+</span></span>
<span id="cb154-2471"><a href="#cb154-2471"></a>  <span class="fu">scale_y_continuous</span>(<span class="st">"Canopy cover"</span>, <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.25</span>)) <span class="sc">+</span></span>
<span id="cb154-2472"><a href="#cb154-2472"></a>  <span class="fu">scale_colour_viridis_c</span>(<span class="st">"Selection"</span>) <span class="sc">+</span></span>
<span id="cb154-2473"><a href="#cb154-2473"></a>  <span class="co"># ggtitle("Canopy Cover") +</span></span>
<span id="cb154-2474"><a href="#cb154-2474"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb154-2475"><a href="#cb154-2475"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span>
<span id="cb154-2476"><a href="#cb154-2476"></a></span>
<span id="cb154-2477"><a href="#cb154-2477"></a>canopy_quad_2p</span>
<span id="cb154-2478"><a href="#cb154-2478"></a></span>
<span id="cb154-2479"><a href="#cb154-2479"></a><span class="in">```</span></span>
<span id="cb154-2480"><a href="#cb154-2480"></a></span>
<span id="cb154-2481"><a href="#cb154-2481"></a><span class="fu">## 3p</span></span>
<span id="cb154-2482"><a href="#cb154-2482"></a></span>
<span id="cb154-2485"><a href="#cb154-2485"></a><span class="in">```{r}</span></span>
<span id="cb154-2486"><a href="#cb154-2486"></a>canopy_min <span class="ot">&lt;-</span> <span class="fu">min</span>(buffalo_data<span class="sc">$</span>canopy_01, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb154-2487"><a href="#cb154-2487"></a>canopy_max <span class="ot">&lt;-</span> <span class="fu">max</span>(buffalo_data<span class="sc">$</span>canopy_01, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb154-2488"><a href="#cb154-2488"></a>canopy_seq <span class="ot">&lt;-</span> <span class="fu">seq</span>(canopy_min, canopy_max, <span class="at">by =</span> <span class="fl">0.01</span>)</span>
<span id="cb154-2489"><a href="#cb154-2489"></a></span>
<span id="cb154-2490"><a href="#cb154-2490"></a><span class="co"># Create empty data frame</span></span>
<span id="cb154-2491"><a href="#cb154-2491"></a>canopy_fresponse_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">matrix</span>(<span class="at">ncol =</span> <span class="fu">nrow</span>(hour_coefs_nat_df_3p), </span>
<span id="cb154-2492"><a href="#cb154-2492"></a>                                         <span class="at">nrow =</span> <span class="fu">length</span>(canopy_seq)))</span>
<span id="cb154-2493"><a href="#cb154-2493"></a></span>
<span id="cb154-2494"><a href="#cb154-2494"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(hour_coefs_nat_df_3p)) {</span>
<span id="cb154-2495"><a href="#cb154-2495"></a>  <span class="co"># Assign the vector as a column to the dataframe</span></span>
<span id="cb154-2496"><a href="#cb154-2496"></a>  canopy_fresponse_df[,i] <span class="ot">&lt;-</span> (hour_coefs_nat_df_3p<span class="sc">$</span>canopy[i] <span class="sc">*</span> canopy_seq) <span class="sc">+</span> </span>
<span id="cb154-2497"><a href="#cb154-2497"></a>    (hour_coefs_nat_df_3p<span class="sc">$</span>canopy_2[i] <span class="sc">*</span> (canopy_seq <span class="sc">^</span> <span class="dv">2</span>))</span>
<span id="cb154-2498"><a href="#cb154-2498"></a>}</span>
<span id="cb154-2499"><a href="#cb154-2499"></a></span>
<span id="cb154-2500"><a href="#cb154-2500"></a>canopy_fresponse_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(canopy_seq, canopy_fresponse_df)</span>
<span id="cb154-2501"><a href="#cb154-2501"></a><span class="fu">colnames</span>(canopy_fresponse_df) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"canopy"</span>, hour)</span>
<span id="cb154-2502"><a href="#cb154-2502"></a>canopy_fresponse_long <span class="ot">&lt;-</span> <span class="fu">pivot_longer</span>(canopy_fresponse_df, <span class="at">cols =</span> <span class="sc">!</span><span class="dv">1</span>, </span>
<span id="cb154-2503"><a href="#cb154-2503"></a>                                      <span class="at">names_to =</span> <span class="st">"hour"</span>)</span>
<span id="cb154-2504"><a href="#cb154-2504"></a></span>
<span id="cb154-2505"><a href="#cb154-2505"></a>canopy_contour_min <span class="ot">&lt;-</span> <span class="fu">min</span>(canopy_fresponse_long<span class="sc">$</span>value) <span class="co"># 0</span></span>
<span id="cb154-2506"><a href="#cb154-2506"></a>canopy_contour_max <span class="ot">&lt;-</span> <span class="fu">max</span>(canopy_fresponse_long<span class="sc">$</span>value) <span class="co"># 2.181749</span></span>
<span id="cb154-2507"><a href="#cb154-2507"></a>canopy_contour_increment <span class="ot">&lt;-</span> (canopy_contour_max<span class="sc">-</span>canopy_contour_min)<span class="sc">/</span><span class="dv">10</span></span>
<span id="cb154-2508"><a href="#cb154-2508"></a></span>
<span id="cb154-2509"><a href="#cb154-2509"></a>canopy_quad_3p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> canopy_fresponse_long, </span>
<span id="cb154-2510"><a href="#cb154-2510"></a>                         <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">as.numeric</span>(hour), <span class="at">y =</span> canopy)) <span class="sc">+</span></span>
<span id="cb154-2511"><a href="#cb154-2511"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">colour =</span> value)) <span class="sc">+</span></span>
<span id="cb154-2512"><a href="#cb154-2512"></a>  <span class="fu">geom_contour</span>(<span class="fu">aes</span>(<span class="at">z =</span> value), </span>
<span id="cb154-2513"><a href="#cb154-2513"></a>               <span class="at">breaks =</span> <span class="fu">seq</span>(canopy_contour_increment, </span>
<span id="cb154-2514"><a href="#cb154-2514"></a>                            canopy_contour_max, </span>
<span id="cb154-2515"><a href="#cb154-2515"></a>                            canopy_contour_increment), </span>
<span id="cb154-2516"><a href="#cb154-2516"></a>               <span class="at">colour =</span> <span class="st">"black"</span>, <span class="at">linewidth =</span> <span class="fl">0.25</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb154-2517"><a href="#cb154-2517"></a>  <span class="fu">geom_contour</span>(<span class="fu">aes</span>(<span class="at">z =</span> value),</span>
<span id="cb154-2518"><a href="#cb154-2518"></a>               <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="sc">-</span>canopy_contour_increment, </span>
<span id="cb154-2519"><a href="#cb154-2519"></a>                            canopy_contour_min, </span>
<span id="cb154-2520"><a href="#cb154-2520"></a>                            <span class="sc">-</span>canopy_contour_increment),</span>
<span id="cb154-2521"><a href="#cb154-2521"></a>               <span class="at">colour =</span> <span class="st">"red"</span>, <span class="at">linewidth =</span> <span class="fl">0.25</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb154-2522"><a href="#cb154-2522"></a>  <span class="fu">geom_contour</span>(<span class="fu">aes</span>(<span class="at">z =</span> value), <span class="at">breaks =</span> <span class="dv">0</span>, <span class="at">colour =</span> <span class="st">"black"</span>, <span class="at">linewidth =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb154-2523"><a href="#cb154-2523"></a>  <span class="fu">scale_x_continuous</span>(<span class="st">"Hour"</span>, <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">24</span>,<span class="dv">6</span>)) <span class="sc">+</span></span>
<span id="cb154-2524"><a href="#cb154-2524"></a>  <span class="fu">scale_y_continuous</span>(<span class="st">"Canopy cover"</span>, <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.25</span>)) <span class="sc">+</span></span>
<span id="cb154-2525"><a href="#cb154-2525"></a>  <span class="fu">scale_colour_viridis_c</span>(<span class="st">"Selection"</span>) <span class="sc">+</span></span>
<span id="cb154-2526"><a href="#cb154-2526"></a>  <span class="co"># ggtitle("Canopy Cover", </span></span>
<span id="cb154-2527"><a href="#cb154-2527"></a>  <span class="co">#         subtitle = "Three pairs of harmonics") +</span></span>
<span id="cb154-2528"><a href="#cb154-2528"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb154-2529"><a href="#cb154-2529"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span>
<span id="cb154-2530"><a href="#cb154-2530"></a></span>
<span id="cb154-2531"><a href="#cb154-2531"></a>canopy_quad_3p</span>
<span id="cb154-2532"><a href="#cb154-2532"></a></span>
<span id="cb154-2533"><a href="#cb154-2533"></a><span class="in">```</span></span>
<span id="cb154-2534"><a href="#cb154-2534"></a></span>
<span id="cb154-2535"><a href="#cb154-2535"></a>:::</span>
<span id="cb154-2536"><a href="#cb154-2536"></a></span>
<span id="cb154-2537"><a href="#cb154-2537"></a><span class="fu"># Combining the plots</span></span>
<span id="cb154-2538"><a href="#cb154-2538"></a></span>
<span id="cb154-2539"><a href="#cb154-2539"></a><span class="fu">## Movement parameters</span></span>
<span id="cb154-2540"><a href="#cb154-2540"></a></span>
<span id="cb154-2543"><a href="#cb154-2543"></a><span class="in">```{r}</span></span>
<span id="cb154-2544"><a href="#cb154-2544"></a>gamma_df <span class="ot">&lt;-</span> <span class="fu">rbind</span>(gamma_df_0p, gamma_df_1p, gamma_df_2p, gamma_df_3p)</span>
<span id="cb154-2545"><a href="#cb154-2545"></a>gamma_df <span class="ot">&lt;-</span> gamma_df <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">model_f =</span> <span class="fu">as.numeric</span>(<span class="fu">factor</span>(model)))</span>
<span id="cb154-2546"><a href="#cb154-2546"></a></span>
<span id="cb154-2547"><a href="#cb154-2547"></a>mean_sl <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb154-2548"><a href="#cb154-2548"></a>  <span class="fu">geom_path</span>(<span class="at">data =</span> movement_summary_buffalo, </span>
<span id="cb154-2549"><a href="#cb154-2549"></a>            <span class="fu">aes</span>(<span class="at">x =</span> hour, <span class="at">y =</span> mean_sl, <span class="at">group =</span> <span class="fu">factor</span>(id)), </span>
<span id="cb154-2550"><a href="#cb154-2550"></a>            <span class="at">alpha =</span> <span class="fl">0.25</span>) <span class="sc">+</span></span>
<span id="cb154-2551"><a href="#cb154-2551"></a>  <span class="fu">geom_path</span>(<span class="at">data =</span> gamma_df, <span class="fu">aes</span>(<span class="at">x =</span> hour, <span class="at">y =</span> mean, <span class="at">linetype =</span> model)) <span class="sc">+</span></span>
<span id="cb154-2552"><a href="#cb154-2552"></a>  <span class="fu">scale_x_continuous</span>(<span class="st">"Hour"</span>, <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">24</span>,<span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb154-2553"><a href="#cb154-2553"></a>  <span class="fu">scale_y_continuous</span>(<span class="st">"Mean step length"</span>) <span class="sc">+</span></span>
<span id="cb154-2554"><a href="#cb154-2554"></a>  <span class="fu">scale_linetype_manual</span>(<span class="st">"Model"</span>, <span class="at">breaks=</span><span class="fu">c</span>(<span class="st">"0p"</span>,<span class="st">"1p"</span>, <span class="st">"2p"</span>, <span class="st">"3p"</span>), </span>
<span id="cb154-2555"><a href="#cb154-2555"></a>                        <span class="at">values=</span><span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">3</span>,<span class="dv">2</span>,<span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb154-2556"><a href="#cb154-2556"></a>  <span class="fu">ggtitle</span>(<span class="st">"Observed and modelled mean step length"</span>) <span class="sc">+</span></span>
<span id="cb154-2557"><a href="#cb154-2557"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb154-2558"><a href="#cb154-2558"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span>
<span id="cb154-2559"><a href="#cb154-2559"></a></span>
<span id="cb154-2560"><a href="#cb154-2560"></a>mean_sl</span>
<span id="cb154-2561"><a href="#cb154-2561"></a></span>
<span id="cb154-2562"><a href="#cb154-2562"></a><span class="co"># ggsave(paste0("outputs/plots/manuscript_figs_R1/mean_sl_", </span></span>
<span id="cb154-2563"><a href="#cb154-2563"></a><span class="co">#          Sys.Date(), ".png"),</span></span>
<span id="cb154-2564"><a href="#cb154-2564"></a><span class="co">#   width=150, height=90, units="mm", dpi = 1000)</span></span>
<span id="cb154-2565"><a href="#cb154-2565"></a></span>
<span id="cb154-2566"><a href="#cb154-2566"></a>median_sl <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb154-2567"><a href="#cb154-2567"></a>  <span class="fu">geom_path</span>(<span class="at">data =</span> movement_summary_buffalo, </span>
<span id="cb154-2568"><a href="#cb154-2568"></a>            <span class="fu">aes</span>(<span class="at">x =</span> hour, <span class="at">y =</span> median_sl, <span class="at">group =</span> <span class="fu">factor</span>(id)), </span>
<span id="cb154-2569"><a href="#cb154-2569"></a>            <span class="at">alpha =</span> <span class="fl">0.25</span>) <span class="sc">+</span></span>
<span id="cb154-2570"><a href="#cb154-2570"></a>  <span class="fu">geom_path</span>(<span class="at">data =</span> gamma_df, <span class="fu">aes</span>(<span class="at">x =</span> hour, <span class="at">y =</span> median, <span class="at">linetype =</span> model)) <span class="sc">+</span></span>
<span id="cb154-2571"><a href="#cb154-2571"></a>  <span class="fu">scale_x_continuous</span>(<span class="st">"Hour"</span>, <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">24</span>,<span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb154-2572"><a href="#cb154-2572"></a>  <span class="fu">scale_y_continuous</span>(<span class="st">"Median step length"</span>) <span class="sc">+</span></span>
<span id="cb154-2573"><a href="#cb154-2573"></a>  <span class="fu">scale_linetype_manual</span>(<span class="st">"Model"</span>, <span class="at">breaks=</span><span class="fu">c</span>(<span class="st">"0p"</span>,<span class="st">"1p"</span>, <span class="st">"2p"</span>, <span class="st">"3p"</span>), </span>
<span id="cb154-2574"><a href="#cb154-2574"></a>                        <span class="at">values=</span><span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">3</span>,<span class="dv">2</span>,<span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb154-2575"><a href="#cb154-2575"></a>  <span class="fu">ggtitle</span>(<span class="st">"Observed and modelled median step length"</span>) <span class="sc">+</span></span>
<span id="cb154-2576"><a href="#cb154-2576"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb154-2577"><a href="#cb154-2577"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span>
<span id="cb154-2578"><a href="#cb154-2578"></a></span>
<span id="cb154-2579"><a href="#cb154-2579"></a>median_sl</span>
<span id="cb154-2580"><a href="#cb154-2580"></a></span>
<span id="cb154-2581"><a href="#cb154-2581"></a><span class="co"># ggsave(paste0("outputs/plots/manuscript_figs_R1/median_sl_", </span></span>
<span id="cb154-2582"><a href="#cb154-2582"></a><span class="co">#          Sys.Date(), ".png"),</span></span>
<span id="cb154-2583"><a href="#cb154-2583"></a><span class="co">#   width=150, height=90, units="mm", dpi = 1000)</span></span>
<span id="cb154-2584"><a href="#cb154-2584"></a></span>
<span id="cb154-2585"><a href="#cb154-2585"></a><span class="in">```</span></span>
<span id="cb154-2586"><a href="#cb154-2586"></a></span>
<span id="cb154-2587"><a href="#cb154-2587"></a><span class="fu">## Habitat selection</span></span>
<span id="cb154-2588"><a href="#cb154-2588"></a></span>
<span id="cb154-2591"><a href="#cb154-2591"></a><span class="in">```{r}</span></span>
<span id="cb154-2592"><a href="#cb154-2592"></a>harmonics_scaled_long_0p <span class="ot">&lt;-</span> harmonics_scaled_long_0p <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">model =</span> <span class="st">"0p"</span>)</span>
<span id="cb154-2593"><a href="#cb154-2593"></a>harmonics_scaled_long_1p <span class="ot">&lt;-</span> harmonics_scaled_long_1p <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">model =</span> <span class="st">"1p"</span>)</span>
<span id="cb154-2594"><a href="#cb154-2594"></a>harmonics_scaled_long_2p <span class="ot">&lt;-</span> harmonics_scaled_long_2p <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">model =</span> <span class="st">"2p"</span>)</span>
<span id="cb154-2595"><a href="#cb154-2595"></a>harmonics_scaled_long_3p <span class="ot">&lt;-</span> harmonics_scaled_long_3p <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">model =</span> <span class="st">"3p"</span>)</span>
<span id="cb154-2596"><a href="#cb154-2596"></a></span>
<span id="cb154-2597"><a href="#cb154-2597"></a>harmonics_scaled_long_Mp <span class="ot">&lt;-</span> <span class="fu">rbind</span>(harmonics_scaled_long_0p, </span>
<span id="cb154-2598"><a href="#cb154-2598"></a>                                  harmonics_scaled_long_1p, </span>
<span id="cb154-2599"><a href="#cb154-2599"></a>                                  harmonics_scaled_long_2p, </span>
<span id="cb154-2600"><a href="#cb154-2600"></a>                                  harmonics_scaled_long_3p)</span>
<span id="cb154-2601"><a href="#cb154-2601"></a></span>
<span id="cb154-2602"><a href="#cb154-2602"></a>coef_titles <span class="ot">&lt;-</span> <span class="fu">unique</span>(harmonics_scaled_long_Mp<span class="sc">$</span>coef)</span>
<span id="cb154-2603"><a href="#cb154-2603"></a></span>
<span id="cb154-2604"><a href="#cb154-2604"></a></span>
<span id="cb154-2605"><a href="#cb154-2605"></a>ndvi_harms <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb154-2606"><a href="#cb154-2606"></a>      <span class="fu">geom_path</span>(<span class="at">data =</span> harmonics_scaled_long_Mp <span class="sc">%&gt;%</span></span>
<span id="cb154-2607"><a href="#cb154-2607"></a>                <span class="fu">filter</span>(coef <span class="sc">==</span> <span class="st">"ndvi"</span>), </span>
<span id="cb154-2608"><a href="#cb154-2608"></a>                <span class="fu">aes</span>(<span class="at">x =</span> hour, <span class="at">y =</span> value, <span class="at">linetype =</span> model)) <span class="sc">+</span></span>
<span id="cb154-2609"><a href="#cb154-2609"></a>      <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">colour =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb154-2610"><a href="#cb154-2610"></a>      <span class="fu">scale_y_continuous</span>(<span class="fu">expression</span>(beta)) <span class="sc">+</span></span>
<span id="cb154-2611"><a href="#cb154-2611"></a>      <span class="fu">scale_x_continuous</span>(<span class="st">"Hour"</span>) <span class="sc">+</span></span>
<span id="cb154-2612"><a href="#cb154-2612"></a>  <span class="fu">scale_linetype_manual</span>(<span class="st">"Model"</span>, <span class="at">breaks=</span><span class="fu">c</span>(<span class="st">"0p"</span>,<span class="st">"1p"</span>, <span class="st">"2p"</span>, <span class="st">"3p"</span>), </span>
<span id="cb154-2613"><a href="#cb154-2613"></a>                        <span class="at">values=</span><span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">3</span>,<span class="dv">2</span>,<span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb154-2614"><a href="#cb154-2614"></a>      <span class="fu">ggtitle</span>(<span class="st">"NDVI"</span>) <span class="sc">+</span></span>
<span id="cb154-2615"><a href="#cb154-2615"></a>      <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb154-2616"><a href="#cb154-2616"></a>      <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span>
<span id="cb154-2617"><a href="#cb154-2617"></a></span>
<span id="cb154-2618"><a href="#cb154-2618"></a>ndvi_harms</span>
<span id="cb154-2619"><a href="#cb154-2619"></a></span>
<span id="cb154-2620"><a href="#cb154-2620"></a></span>
<span id="cb154-2621"><a href="#cb154-2621"></a></span>
<span id="cb154-2622"><a href="#cb154-2622"></a>ndvi_2_harms <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb154-2623"><a href="#cb154-2623"></a>      <span class="fu">geom_path</span>(<span class="at">data =</span> harmonics_scaled_long_Mp <span class="sc">%&gt;%</span></span>
<span id="cb154-2624"><a href="#cb154-2624"></a>                <span class="fu">filter</span>(coef <span class="sc">==</span> <span class="st">"ndvi_2"</span>), </span>
<span id="cb154-2625"><a href="#cb154-2625"></a>                <span class="fu">aes</span>(<span class="at">x =</span> hour, <span class="at">y =</span> value, <span class="at">linetype =</span> model)) <span class="sc">+</span></span>
<span id="cb154-2626"><a href="#cb154-2626"></a>      <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">colour =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb154-2627"><a href="#cb154-2627"></a>      <span class="fu">scale_y_continuous</span>(<span class="fu">expression</span>(beta)) <span class="sc">+</span></span>
<span id="cb154-2628"><a href="#cb154-2628"></a>      <span class="fu">scale_x_continuous</span>(<span class="st">"Hour"</span>) <span class="sc">+</span></span>
<span id="cb154-2629"><a href="#cb154-2629"></a>  <span class="fu">scale_linetype_manual</span>(<span class="st">"Model"</span>, <span class="at">breaks=</span><span class="fu">c</span>(<span class="st">"0p"</span>,<span class="st">"1p"</span>, <span class="st">"2p"</span>, <span class="st">"3p"</span>), </span>
<span id="cb154-2630"><a href="#cb154-2630"></a>                        <span class="at">values=</span><span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">3</span>,<span class="dv">2</span>,<span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb154-2631"><a href="#cb154-2631"></a>      <span class="fu">ggtitle</span>(<span class="fu">expression</span>(NDVI<span class="sc">^</span><span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb154-2632"><a href="#cb154-2632"></a>      <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb154-2633"><a href="#cb154-2633"></a>      <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span>
<span id="cb154-2634"><a href="#cb154-2634"></a></span>
<span id="cb154-2635"><a href="#cb154-2635"></a>ndvi_2_harms</span>
<span id="cb154-2636"><a href="#cb154-2636"></a></span>
<span id="cb154-2637"><a href="#cb154-2637"></a></span>
<span id="cb154-2638"><a href="#cb154-2638"></a></span>
<span id="cb154-2639"><a href="#cb154-2639"></a>canopy_harms <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb154-2640"><a href="#cb154-2640"></a>      <span class="fu">geom_path</span>(<span class="at">data =</span> harmonics_scaled_long_Mp <span class="sc">%&gt;%</span></span>
<span id="cb154-2641"><a href="#cb154-2641"></a>                <span class="fu">filter</span>(coef <span class="sc">==</span> <span class="st">"canopy"</span>), </span>
<span id="cb154-2642"><a href="#cb154-2642"></a>                <span class="fu">aes</span>(<span class="at">x =</span> hour, <span class="at">y =</span> value, <span class="at">linetype =</span> model)) <span class="sc">+</span></span>
<span id="cb154-2643"><a href="#cb154-2643"></a>      <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">colour =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb154-2644"><a href="#cb154-2644"></a>      <span class="fu">scale_y_continuous</span>(<span class="fu">expression</span>(beta)) <span class="sc">+</span></span>
<span id="cb154-2645"><a href="#cb154-2645"></a>      <span class="fu">scale_x_continuous</span>(<span class="st">"Hour"</span>) <span class="sc">+</span></span>
<span id="cb154-2646"><a href="#cb154-2646"></a>  <span class="fu">scale_linetype_manual</span>(<span class="st">"Model"</span>, <span class="at">breaks=</span><span class="fu">c</span>(<span class="st">"0p"</span>,<span class="st">"1p"</span>, <span class="st">"2p"</span>, <span class="st">"3p"</span>), </span>
<span id="cb154-2647"><a href="#cb154-2647"></a>                        <span class="at">values=</span><span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">3</span>,<span class="dv">2</span>,<span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb154-2648"><a href="#cb154-2648"></a>      <span class="fu">ggtitle</span>(<span class="st">"Canopy cover"</span>) <span class="sc">+</span></span>
<span id="cb154-2649"><a href="#cb154-2649"></a>      <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb154-2650"><a href="#cb154-2650"></a>      <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span>
<span id="cb154-2651"><a href="#cb154-2651"></a></span>
<span id="cb154-2652"><a href="#cb154-2652"></a>canopy_harms</span>
<span id="cb154-2653"><a href="#cb154-2653"></a></span>
<span id="cb154-2654"><a href="#cb154-2654"></a></span>
<span id="cb154-2655"><a href="#cb154-2655"></a></span>
<span id="cb154-2656"><a href="#cb154-2656"></a>canopy_2_harms <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb154-2657"><a href="#cb154-2657"></a>      <span class="fu">geom_path</span>(<span class="at">data =</span> harmonics_scaled_long_Mp <span class="sc">%&gt;%</span></span>
<span id="cb154-2658"><a href="#cb154-2658"></a>                <span class="fu">filter</span>(coef <span class="sc">==</span> <span class="st">"canopy_2"</span>), </span>
<span id="cb154-2659"><a href="#cb154-2659"></a>                <span class="fu">aes</span>(<span class="at">x =</span> hour, <span class="at">y =</span> value, <span class="at">linetype =</span> model)) <span class="sc">+</span></span>
<span id="cb154-2660"><a href="#cb154-2660"></a>      <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">colour =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb154-2661"><a href="#cb154-2661"></a>      <span class="fu">scale_y_continuous</span>(<span class="fu">expression</span>(beta)) <span class="sc">+</span></span>
<span id="cb154-2662"><a href="#cb154-2662"></a>      <span class="fu">scale_x_continuous</span>(<span class="st">"Hour"</span>) <span class="sc">+</span></span>
<span id="cb154-2663"><a href="#cb154-2663"></a>  <span class="fu">scale_linetype_manual</span>(<span class="st">"Model"</span>, <span class="at">breaks=</span><span class="fu">c</span>(<span class="st">"0p"</span>,<span class="st">"1p"</span>, <span class="st">"2p"</span>, <span class="st">"3p"</span>), </span>
<span id="cb154-2664"><a href="#cb154-2664"></a>                        <span class="at">values=</span><span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">3</span>,<span class="dv">2</span>,<span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb154-2665"><a href="#cb154-2665"></a>      <span class="fu">ggtitle</span>(<span class="fu">expression</span>(Canopy<span class="sc">~</span>cover<span class="sc">^</span><span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb154-2666"><a href="#cb154-2666"></a>      <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb154-2667"><a href="#cb154-2667"></a>      <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span>
<span id="cb154-2668"><a href="#cb154-2668"></a></span>
<span id="cb154-2669"><a href="#cb154-2669"></a>canopy_2_harms</span>
<span id="cb154-2670"><a href="#cb154-2670"></a></span>
<span id="cb154-2671"><a href="#cb154-2671"></a></span>
<span id="cb154-2672"><a href="#cb154-2672"></a></span>
<span id="cb154-2673"><a href="#cb154-2673"></a>herby_harms <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb154-2674"><a href="#cb154-2674"></a>      <span class="fu">geom_path</span>(<span class="at">data =</span> harmonics_scaled_long_Mp <span class="sc">%&gt;%</span></span>
<span id="cb154-2675"><a href="#cb154-2675"></a>                <span class="fu">filter</span>(coef <span class="sc">==</span> <span class="st">"herby"</span>), </span>
<span id="cb154-2676"><a href="#cb154-2676"></a>                <span class="fu">aes</span>(<span class="at">x =</span> hour, <span class="at">y =</span> value, <span class="at">linetype =</span> model)) <span class="sc">+</span></span>
<span id="cb154-2677"><a href="#cb154-2677"></a>      <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">colour =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb154-2678"><a href="#cb154-2678"></a>      <span class="fu">scale_y_continuous</span>(<span class="fu">expression</span>(beta), <span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.4</span>,<span class="fl">0.15</span>)) <span class="sc">+</span></span>
<span id="cb154-2679"><a href="#cb154-2679"></a>      <span class="fu">scale_x_continuous</span>(<span class="st">"Hour"</span>) <span class="sc">+</span></span>
<span id="cb154-2680"><a href="#cb154-2680"></a>  <span class="fu">scale_linetype_manual</span>(<span class="st">"Model"</span>, <span class="at">breaks=</span><span class="fu">c</span>(<span class="st">"0p"</span>,<span class="st">"1p"</span>, <span class="st">"2p"</span>, <span class="st">"3p"</span>), </span>
<span id="cb154-2681"><a href="#cb154-2681"></a>                        <span class="at">values=</span><span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">3</span>,<span class="dv">2</span>,<span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb154-2682"><a href="#cb154-2682"></a>      <span class="fu">ggtitle</span>(<span class="st">"Herbaceous vegetation"</span>) <span class="sc">+</span></span>
<span id="cb154-2683"><a href="#cb154-2683"></a>      <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb154-2684"><a href="#cb154-2684"></a>      <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span>
<span id="cb154-2685"><a href="#cb154-2685"></a></span>
<span id="cb154-2686"><a href="#cb154-2686"></a>herby_harms</span>
<span id="cb154-2687"><a href="#cb154-2687"></a></span>
<span id="cb154-2688"><a href="#cb154-2688"></a></span>
<span id="cb154-2689"><a href="#cb154-2689"></a></span>
<span id="cb154-2690"><a href="#cb154-2690"></a>slope_harms <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb154-2691"><a href="#cb154-2691"></a>      <span class="fu">geom_path</span>(<span class="at">data =</span> harmonics_scaled_long_Mp <span class="sc">%&gt;%</span></span>
<span id="cb154-2692"><a href="#cb154-2692"></a>                <span class="fu">filter</span>(coef <span class="sc">==</span> <span class="st">"slope"</span>), </span>
<span id="cb154-2693"><a href="#cb154-2693"></a>                <span class="fu">aes</span>(<span class="at">x =</span> hour, <span class="at">y =</span> value, <span class="at">linetype =</span> model)) <span class="sc">+</span></span>
<span id="cb154-2694"><a href="#cb154-2694"></a>      <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">colour =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb154-2695"><a href="#cb154-2695"></a>      <span class="fu">scale_y_continuous</span>(<span class="fu">expression</span>(beta), <span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.4</span>,<span class="fl">0.15</span>)) <span class="sc">+</span></span>
<span id="cb154-2696"><a href="#cb154-2696"></a>      <span class="fu">scale_x_continuous</span>(<span class="st">"Hour"</span>) <span class="sc">+</span></span>
<span id="cb154-2697"><a href="#cb154-2697"></a>  <span class="fu">scale_linetype_manual</span>(<span class="st">"Model"</span>, <span class="at">breaks=</span><span class="fu">c</span>(<span class="st">"0p"</span>,<span class="st">"1p"</span>, <span class="st">"2p"</span>, <span class="st">"3p"</span>),</span>
<span id="cb154-2698"><a href="#cb154-2698"></a>                        <span class="at">values=</span><span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">3</span>,<span class="dv">2</span>,<span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb154-2699"><a href="#cb154-2699"></a>      <span class="fu">ggtitle</span>(<span class="st">"Slope"</span>) <span class="sc">+</span></span>
<span id="cb154-2700"><a href="#cb154-2700"></a>      <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb154-2701"><a href="#cb154-2701"></a>      <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span>
<span id="cb154-2702"><a href="#cb154-2702"></a></span>
<span id="cb154-2703"><a href="#cb154-2703"></a>slope_harms</span>
<span id="cb154-2704"><a href="#cb154-2704"></a></span>
<span id="cb154-2705"><a href="#cb154-2705"></a><span class="fu">ggarrange</span>(herby_harms, </span>
<span id="cb154-2706"><a href="#cb154-2706"></a>          slope_harms, </span>
<span id="cb154-2707"><a href="#cb154-2707"></a>          <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"A"</span>, <span class="st">"B"</span>), </span>
<span id="cb154-2708"><a href="#cb154-2708"></a>          <span class="at">ncol =</span> <span class="dv">2</span>, <span class="at">nrow =</span> <span class="dv">1</span>,</span>
<span id="cb154-2709"><a href="#cb154-2709"></a>          <span class="at">align =</span> <span class="st">"hv"</span>,</span>
<span id="cb154-2710"><a href="#cb154-2710"></a>          <span class="at">legend =</span> <span class="st">"bottom"</span>, </span>
<span id="cb154-2711"><a href="#cb154-2711"></a>          <span class="at">common.legend =</span> <span class="cn">TRUE</span>)</span>
<span id="cb154-2712"><a href="#cb154-2712"></a></span>
<span id="cb154-2713"><a href="#cb154-2713"></a><span class="co"># ggsave(paste0("outputs/plots/manuscript_figs_R1/herby_slope_harmonic_functions_", </span></span>
<span id="cb154-2714"><a href="#cb154-2714"></a><span class="co">#          Sys.Date(), ".png"),</span></span>
<span id="cb154-2715"><a href="#cb154-2715"></a><span class="co">#   width=150, height=90, units="mm", dpi = 1000)</span></span>
<span id="cb154-2716"><a href="#cb154-2716"></a></span>
<span id="cb154-2717"><a href="#cb154-2717"></a><span class="in">```</span></span>
<span id="cb154-2718"><a href="#cb154-2718"></a></span>
<span id="cb154-2719"><a href="#cb154-2719"></a><span class="fu"># Combining selection surfaces</span></span>
<span id="cb154-2720"><a href="#cb154-2720"></a></span>
<span id="cb154-2721"><a href="#cb154-2721"></a><span class="fu">## NDVI</span></span>
<span id="cb154-2722"><a href="#cb154-2722"></a></span>
<span id="cb154-2723"><a href="#cb154-2723"></a><span class="ss">-   </span>A = 0p model</span>
<span id="cb154-2724"><a href="#cb154-2724"></a><span class="ss">-   </span>B = 1p model</span>
<span id="cb154-2725"><a href="#cb154-2725"></a><span class="ss">-   </span>C = 2p model</span>
<span id="cb154-2726"><a href="#cb154-2726"></a><span class="ss">-   </span>D = 3p model</span>
<span id="cb154-2727"><a href="#cb154-2727"></a></span>
<span id="cb154-2730"><a href="#cb154-2730"></a><span class="in">```{r}</span></span>
<span id="cb154-2731"><a href="#cb154-2731"></a><span class="fu">ggarrange</span>(ndvi_quad_0p <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb154-2732"><a href="#cb154-2732"></a>                               <span class="at">axis.title.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb154-2733"><a href="#cb154-2733"></a>                               <span class="at">axis.text.x =</span> <span class="fu">element_blank</span>()), </span>
<span id="cb154-2734"><a href="#cb154-2734"></a>          </span>
<span id="cb154-2735"><a href="#cb154-2735"></a>          ndvi_quad_1p <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_blank</span>(), </span>
<span id="cb154-2736"><a href="#cb154-2736"></a>                               <span class="at">axis.title.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb154-2737"><a href="#cb154-2737"></a>                               <span class="at">axis.text.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb154-2738"><a href="#cb154-2738"></a>                               <span class="at">axis.title.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb154-2739"><a href="#cb154-2739"></a>                               ), </span>
<span id="cb154-2740"><a href="#cb154-2740"></a>          </span>
<span id="cb154-2741"><a href="#cb154-2741"></a>          ndvi_quad_2p, </span>
<span id="cb154-2742"><a href="#cb154-2742"></a>          </span>
<span id="cb154-2743"><a href="#cb154-2743"></a>          ndvi_quad_3p <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_blank</span>(), </span>
<span id="cb154-2744"><a href="#cb154-2744"></a>                               <span class="at">axis.title.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb154-2745"><a href="#cb154-2745"></a>                               ),</span>
<span id="cb154-2746"><a href="#cb154-2746"></a>          </span>
<span id="cb154-2747"><a href="#cb154-2747"></a>          <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"A"</span>, <span class="st">"B"</span>, <span class="st">"C"</span>, <span class="st">"D"</span>),</span>
<span id="cb154-2748"><a href="#cb154-2748"></a>          <span class="at">ncol =</span> <span class="dv">2</span>, <span class="at">nrow =</span> <span class="dv">2</span>,</span>
<span id="cb154-2749"><a href="#cb154-2749"></a>          <span class="at">legend =</span> <span class="st">"none"</span>,</span>
<span id="cb154-2750"><a href="#cb154-2750"></a>          <span class="at">common.legend =</span> <span class="cn">TRUE</span>)</span>
<span id="cb154-2751"><a href="#cb154-2751"></a></span>
<span id="cb154-2752"><a href="#cb154-2752"></a><span class="co"># ggsave(paste0("outputs/plots/manuscript_figs_R1/",</span></span>
<span id="cb154-2753"><a href="#cb154-2753"></a><span class="co">#               "NDVI_2x2_CLR_TS_daily_GvM_10rs_", </span></span>
<span id="cb154-2754"><a href="#cb154-2754"></a><span class="co">#          Sys.Date(), ".png"),</span></span>
<span id="cb154-2755"><a href="#cb154-2755"></a><span class="co">#   width=150, height=120, units="mm", dpi = 1000)</span></span>
<span id="cb154-2756"><a href="#cb154-2756"></a></span>
<span id="cb154-2757"><a href="#cb154-2757"></a><span class="in">```</span></span>
<span id="cb154-2758"><a href="#cb154-2758"></a></span>
<span id="cb154-2759"><a href="#cb154-2759"></a><span class="fu">## Canopy cover</span></span>
<span id="cb154-2760"><a href="#cb154-2760"></a></span>
<span id="cb154-2761"><a href="#cb154-2761"></a><span class="ss">-   </span>A = 0p model</span>
<span id="cb154-2762"><a href="#cb154-2762"></a><span class="ss">-   </span>B = 1p model</span>
<span id="cb154-2763"><a href="#cb154-2763"></a><span class="ss">-   </span>C = 2p model</span>
<span id="cb154-2764"><a href="#cb154-2764"></a><span class="ss">-   </span>D = 3p model</span>
<span id="cb154-2765"><a href="#cb154-2765"></a></span>
<span id="cb154-2768"><a href="#cb154-2768"></a><span class="in">```{r}</span></span>
<span id="cb154-2769"><a href="#cb154-2769"></a><span class="fu">ggarrange</span>(canopy_quad_0p <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb154-2770"><a href="#cb154-2770"></a>                               <span class="at">axis.title.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb154-2771"><a href="#cb154-2771"></a>                               <span class="at">axis.text.x =</span> <span class="fu">element_blank</span>()), </span>
<span id="cb154-2772"><a href="#cb154-2772"></a>          </span>
<span id="cb154-2773"><a href="#cb154-2773"></a>          canopy_quad_1p <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_blank</span>(), </span>
<span id="cb154-2774"><a href="#cb154-2774"></a>                               <span class="at">axis.title.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb154-2775"><a href="#cb154-2775"></a>                               <span class="at">axis.text.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb154-2776"><a href="#cb154-2776"></a>                               <span class="at">axis.title.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb154-2777"><a href="#cb154-2777"></a>                               ), </span>
<span id="cb154-2778"><a href="#cb154-2778"></a>          </span>
<span id="cb154-2779"><a href="#cb154-2779"></a>          canopy_quad_2p, </span>
<span id="cb154-2780"><a href="#cb154-2780"></a>          </span>
<span id="cb154-2781"><a href="#cb154-2781"></a>          canopy_quad_3p <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_blank</span>(), </span>
<span id="cb154-2782"><a href="#cb154-2782"></a>                               <span class="at">axis.title.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb154-2783"><a href="#cb154-2783"></a>                               ),</span>
<span id="cb154-2784"><a href="#cb154-2784"></a>          </span>
<span id="cb154-2785"><a href="#cb154-2785"></a>          <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"A"</span>, <span class="st">"B"</span>, <span class="st">"C"</span>, <span class="st">"D"</span>),</span>
<span id="cb154-2786"><a href="#cb154-2786"></a>          <span class="at">ncol =</span> <span class="dv">2</span>, <span class="at">nrow =</span> <span class="dv">2</span>,</span>
<span id="cb154-2787"><a href="#cb154-2787"></a>          <span class="at">legend =</span> <span class="st">"none"</span>,</span>
<span id="cb154-2788"><a href="#cb154-2788"></a>          <span class="at">common.legend =</span> <span class="cn">TRUE</span>)</span>
<span id="cb154-2789"><a href="#cb154-2789"></a></span>
<span id="cb154-2790"><a href="#cb154-2790"></a><span class="co"># ggsave(paste0("outputs/plots/manuscript_figs_R1/",</span></span>
<span id="cb154-2791"><a href="#cb154-2791"></a><span class="co">#               "canopy_2x2_CLR_TS_daily_GvM_10rs_", </span></span>
<span id="cb154-2792"><a href="#cb154-2792"></a><span class="co">#          Sys.Date(), ".png"),</span></span>
<span id="cb154-2793"><a href="#cb154-2793"></a><span class="co">#   width=150, height=120, units="mm", dpi = 1000)</span></span>
<span id="cb154-2794"><a href="#cb154-2794"></a></span>
<span id="cb154-2795"><a href="#cb154-2795"></a><span class="in">```</span></span>
<span id="cb154-2796"><a href="#cb154-2796"></a></span>
<span id="cb154-2797"><a href="#cb154-2797"></a><span class="fu"># Adding all selection surfaces to the same plot</span></span>
<span id="cb154-2798"><a href="#cb154-2798"></a></span>
<span id="cb154-2799"><a href="#cb154-2799"></a>We combine these plots into the plot that is in the paper. On the top is the **NDVI** selection surface, and on the bottom is the **canopy cover** selection surface.</span>
<span id="cb154-2800"><a href="#cb154-2800"></a></span>
<span id="cb154-2801"><a href="#cb154-2801"></a>::: {.panel-tabset group="model"}</span>
<span id="cb154-2802"><a href="#cb154-2802"></a></span>
<span id="cb154-2803"><a href="#cb154-2803"></a><span class="fu">## 0p</span></span>
<span id="cb154-2804"><a href="#cb154-2804"></a></span>
<span id="cb154-2807"><a href="#cb154-2807"></a><span class="in">```{r}</span></span>
<span id="cb154-2808"><a href="#cb154-2808"></a>surface_plots_0p <span class="ot">&lt;-</span> <span class="fu">ggarrange</span>(ndvi_quad_0p <span class="sc">+</span> </span>
<span id="cb154-2809"><a href="#cb154-2809"></a>            <span class="fu">ggtitle</span>(<span class="st">"0p"</span>) <span class="sc">+</span></span>
<span id="cb154-2810"><a href="#cb154-2810"></a>            <span class="fu">theme</span>(<span class="at">axis.title.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb154-2811"><a href="#cb154-2811"></a>                  <span class="at">axis.text.x =</span> <span class="fu">element_blank</span>()), </span>
<span id="cb154-2812"><a href="#cb154-2812"></a>          </span>
<span id="cb154-2813"><a href="#cb154-2813"></a>          canopy_quad_0p <span class="sc">+</span>  </span>
<span id="cb154-2814"><a href="#cb154-2814"></a>            <span class="fu">scale_x_continuous</span>(<span class="st">"Hour"</span>, <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">12</span>,<span class="dv">24</span>)) <span class="sc">+</span></span>
<span id="cb154-2815"><a href="#cb154-2815"></a>            <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_blank</span>()), </span>
<span id="cb154-2816"><a href="#cb154-2816"></a>         </span>
<span id="cb154-2817"><a href="#cb154-2817"></a>          <span class="at">ncol =</span> <span class="dv">1</span>, <span class="at">nrow =</span> <span class="dv">2</span>,</span>
<span id="cb154-2818"><a href="#cb154-2818"></a>          <span class="at">align =</span> <span class="st">"v"</span>,</span>
<span id="cb154-2819"><a href="#cb154-2819"></a>          <span class="at">legend =</span> <span class="st">"none"</span>,</span>
<span id="cb154-2820"><a href="#cb154-2820"></a>          <span class="at">common.legend =</span> <span class="cn">TRUE</span>)</span>
<span id="cb154-2821"><a href="#cb154-2821"></a></span>
<span id="cb154-2822"><a href="#cb154-2822"></a>surface_plots_0p</span>
<span id="cb154-2823"><a href="#cb154-2823"></a></span>
<span id="cb154-2824"><a href="#cb154-2824"></a><span class="in">```</span></span>
<span id="cb154-2825"><a href="#cb154-2825"></a></span>
<span id="cb154-2826"><a href="#cb154-2826"></a><span class="fu">## 1p</span></span>
<span id="cb154-2827"><a href="#cb154-2827"></a></span>
<span id="cb154-2830"><a href="#cb154-2830"></a><span class="in">```{r}</span></span>
<span id="cb154-2831"><a href="#cb154-2831"></a>surface_plots_1p <span class="ot">&lt;-</span> <span class="fu">ggarrange</span>(ndvi_quad_1p <span class="sc">+</span> </span>
<span id="cb154-2832"><a href="#cb154-2832"></a>            <span class="fu">ggtitle</span>(<span class="st">"1p"</span>) <span class="sc">+</span></span>
<span id="cb154-2833"><a href="#cb154-2833"></a>            <span class="fu">theme</span>(<span class="at">axis.title.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb154-2834"><a href="#cb154-2834"></a>                  <span class="at">axis.text.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb154-2835"><a href="#cb154-2835"></a>                  <span class="at">axis.title.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb154-2836"><a href="#cb154-2836"></a>                  <span class="at">axis.text.y =</span> <span class="fu">element_blank</span>()), </span>
<span id="cb154-2837"><a href="#cb154-2837"></a>          </span>
<span id="cb154-2838"><a href="#cb154-2838"></a>          canopy_quad_1p <span class="sc">+</span> </span>
<span id="cb154-2839"><a href="#cb154-2839"></a>            <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_blank</span>(), </span>
<span id="cb154-2840"><a href="#cb154-2840"></a>                  <span class="at">axis.title.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb154-2841"><a href="#cb154-2841"></a>                  <span class="at">axis.text.y =</span> <span class="fu">element_blank</span>()),</span>
<span id="cb154-2842"><a href="#cb154-2842"></a>          </span>
<span id="cb154-2843"><a href="#cb154-2843"></a>          <span class="at">ncol =</span> <span class="dv">1</span>, <span class="at">nrow =</span> <span class="dv">2</span>,</span>
<span id="cb154-2844"><a href="#cb154-2844"></a>          <span class="at">align =</span> <span class="st">"v"</span>,</span>
<span id="cb154-2845"><a href="#cb154-2845"></a>          <span class="at">legend =</span> <span class="st">"none"</span>,</span>
<span id="cb154-2846"><a href="#cb154-2846"></a>          <span class="at">common.legend =</span> <span class="cn">TRUE</span>)</span>
<span id="cb154-2847"><a href="#cb154-2847"></a></span>
<span id="cb154-2848"><a href="#cb154-2848"></a>surface_plots_1p</span>
<span id="cb154-2849"><a href="#cb154-2849"></a></span>
<span id="cb154-2850"><a href="#cb154-2850"></a><span class="in">```</span></span>
<span id="cb154-2851"><a href="#cb154-2851"></a></span>
<span id="cb154-2852"><a href="#cb154-2852"></a><span class="fu">## 2p</span></span>
<span id="cb154-2853"><a href="#cb154-2853"></a></span>
<span id="cb154-2856"><a href="#cb154-2856"></a><span class="in">```{r}</span></span>
<span id="cb154-2857"><a href="#cb154-2857"></a>surface_plots_2p <span class="ot">&lt;-</span> <span class="fu">ggarrange</span>(ndvi_quad_2p <span class="sc">+</span> </span>
<span id="cb154-2858"><a href="#cb154-2858"></a>            <span class="fu">ggtitle</span>(<span class="st">"2p"</span>) <span class="sc">+</span></span>
<span id="cb154-2859"><a href="#cb154-2859"></a>            <span class="fu">theme</span>(<span class="at">axis.title.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb154-2860"><a href="#cb154-2860"></a>                  <span class="at">axis.text.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb154-2861"><a href="#cb154-2861"></a>                  <span class="at">axis.title.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb154-2862"><a href="#cb154-2862"></a>                  <span class="at">axis.text.y =</span> <span class="fu">element_blank</span>()),</span>
<span id="cb154-2863"><a href="#cb154-2863"></a>          </span>
<span id="cb154-2864"><a href="#cb154-2864"></a>          canopy_quad_2p <span class="sc">+</span> </span>
<span id="cb154-2865"><a href="#cb154-2865"></a>            <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_blank</span>(), </span>
<span id="cb154-2866"><a href="#cb154-2866"></a>                  <span class="at">axis.title.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb154-2867"><a href="#cb154-2867"></a>                  <span class="at">axis.text.y =</span> <span class="fu">element_blank</span>()),</span>
<span id="cb154-2868"><a href="#cb154-2868"></a>          </span>
<span id="cb154-2869"><a href="#cb154-2869"></a>          <span class="at">ncol =</span> <span class="dv">1</span>, <span class="at">nrow =</span> <span class="dv">2</span>,</span>
<span id="cb154-2870"><a href="#cb154-2870"></a>          <span class="at">align =</span> <span class="st">"v"</span>,</span>
<span id="cb154-2871"><a href="#cb154-2871"></a>          <span class="at">legend =</span> <span class="st">"none"</span>,</span>
<span id="cb154-2872"><a href="#cb154-2872"></a>          <span class="at">common.legend =</span> <span class="cn">TRUE</span>) </span>
<span id="cb154-2873"><a href="#cb154-2873"></a></span>
<span id="cb154-2874"><a href="#cb154-2874"></a>surface_plots_2p</span>
<span id="cb154-2875"><a href="#cb154-2875"></a></span>
<span id="cb154-2876"><a href="#cb154-2876"></a><span class="in">```</span></span>
<span id="cb154-2877"><a href="#cb154-2877"></a></span>
<span id="cb154-2878"><a href="#cb154-2878"></a><span class="fu">## 3p</span></span>
<span id="cb154-2879"><a href="#cb154-2879"></a></span>
<span id="cb154-2882"><a href="#cb154-2882"></a><span class="in">```{r}</span></span>
<span id="cb154-2883"><a href="#cb154-2883"></a>surface_plots_3p <span class="ot">&lt;-</span> <span class="fu">ggarrange</span>(ndvi_quad_3p <span class="sc">+</span> </span>
<span id="cb154-2884"><a href="#cb154-2884"></a>            <span class="fu">ggtitle</span>(<span class="st">"3p"</span>) <span class="sc">+</span></span>
<span id="cb154-2885"><a href="#cb154-2885"></a>              <span class="fu">theme</span>(<span class="at">axis.title.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb154-2886"><a href="#cb154-2886"></a>                    <span class="at">axis.text.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb154-2887"><a href="#cb154-2887"></a>                    <span class="at">axis.title.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb154-2888"><a href="#cb154-2888"></a>                    <span class="at">axis.text.y =</span> <span class="fu">element_blank</span>()),</span>
<span id="cb154-2889"><a href="#cb154-2889"></a>           </span>
<span id="cb154-2890"><a href="#cb154-2890"></a>           canopy_quad_3p <span class="sc">+</span> </span>
<span id="cb154-2891"><a href="#cb154-2891"></a>            <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_blank</span>(), </span>
<span id="cb154-2892"><a href="#cb154-2892"></a>                  <span class="at">axis.title.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb154-2893"><a href="#cb154-2893"></a>                  <span class="at">axis.text.y =</span> <span class="fu">element_blank</span>()),</span>
<span id="cb154-2894"><a href="#cb154-2894"></a>          </span>
<span id="cb154-2895"><a href="#cb154-2895"></a>          <span class="at">ncol =</span> <span class="dv">1</span>, <span class="at">nrow =</span> <span class="dv">2</span>,</span>
<span id="cb154-2896"><a href="#cb154-2896"></a>          <span class="at">align =</span> <span class="st">"v"</span>,</span>
<span id="cb154-2897"><a href="#cb154-2897"></a>          <span class="at">legend =</span> <span class="st">"none"</span>,</span>
<span id="cb154-2898"><a href="#cb154-2898"></a>          <span class="at">common.legend =</span> <span class="cn">TRUE</span>)</span>
<span id="cb154-2899"><a href="#cb154-2899"></a></span>
<span id="cb154-2900"><a href="#cb154-2900"></a>surface_plots_3p</span>
<span id="cb154-2901"><a href="#cb154-2901"></a></span>
<span id="cb154-2902"><a href="#cb154-2902"></a><span class="in">```</span></span>
<span id="cb154-2903"><a href="#cb154-2903"></a></span>
<span id="cb154-2904"><a href="#cb154-2904"></a>:::</span>
<span id="cb154-2905"><a href="#cb154-2905"></a></span>
<span id="cb154-2906"><a href="#cb154-2906"></a><span class="fu">## All selection surfaces</span></span>
<span id="cb154-2907"><a href="#cb154-2907"></a></span>
<span id="cb154-2910"><a href="#cb154-2910"></a><span class="in">```{r}</span></span>
<span id="cb154-2911"><a href="#cb154-2911"></a>all_selection_surfaces <span class="ot">&lt;-</span> <span class="fu">ggarrange</span>(surface_plots_0p, surface_plots_1p, surface_plots_2p, surface_plots_3p,</span>
<span id="cb154-2912"><a href="#cb154-2912"></a>          <span class="at">ncol =</span> <span class="dv">4</span>, <span class="at">nrow =</span> <span class="dv">1</span></span>
<span id="cb154-2913"><a href="#cb154-2913"></a>          <span class="co"># legend = "none",</span></span>
<span id="cb154-2914"><a href="#cb154-2914"></a>          <span class="co"># legend.grob = get_legend(ndvi_quad_2p)</span></span>
<span id="cb154-2915"><a href="#cb154-2915"></a>          )</span>
<span id="cb154-2916"><a href="#cb154-2916"></a></span>
<span id="cb154-2917"><a href="#cb154-2917"></a>all_selection_surfaces</span>
<span id="cb154-2918"><a href="#cb154-2918"></a></span>
<span id="cb154-2919"><a href="#cb154-2919"></a><span class="co"># ggsave(paste0("outputs/plots/manuscript_figs_R1/",</span></span>
<span id="cb154-2920"><a href="#cb154-2920"></a><span class="co">#               "all_quad_4x1_CLR_TS_daily_GvM_10rs_", </span></span>
<span id="cb154-2921"><a href="#cb154-2921"></a><span class="co">#          Sys.Date(), ".png"),</span></span>
<span id="cb154-2922"><a href="#cb154-2922"></a><span class="co">#   width=150, height=110, units="mm", dpi = 1000)</span></span>
<span id="cb154-2923"><a href="#cb154-2923"></a></span>
<span id="cb154-2924"><a href="#cb154-2924"></a><span class="in">```</span></span>
<span id="cb154-2925"><a href="#cb154-2925"></a></span>
<span id="cb154-2926"><a href="#cb154-2926"></a><span class="fu">## References</span></span>
<span id="cb154-2927"><a href="#cb154-2927"></a></span>
<span id="cb154-2928"><a href="#cb154-2928"></a>::: {#refs}</span>
<span id="cb154-2929"><a href="#cb154-2929"></a>:::</span>
<span id="cb154-2930"><a href="#cb154-2930"></a></span>
<span id="cb154-2931"><a href="#cb154-2931"></a><span class="fu">## Session info</span></span>
<span id="cb154-2932"><a href="#cb154-2932"></a></span>
<span id="cb154-2935"><a href="#cb154-2935"></a><span class="in">```{r}</span></span>
<span id="cb154-2936"><a href="#cb154-2936"></a><span class="fu">sessionInfo</span>()</span>
<span id="cb154-2937"><a href="#cb154-2937"></a></span>
<span id="cb154-2938"><a href="#cb154-2938"></a><span class="in">```</span></span>
</code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
      <ul class="footer-items list-unstyled">
    <li class="nav-item">
    <a class="nav-link" href="https://swforrest.github.io">
<p>Website</p>
</a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="mailto:scottwforrest@gmail.com">
      <i class="bi bi-envelope-at-fill" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/swforrest">
      <i class="bi bi-github" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/in/swforrest/">
      <i class="bi bi-linkedin" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item">
    <a class="nav-link" href="https://bsky.app/profile/scottwilliamf.bsky.social">
<p>Bluesky</p>
</a>
  </li>  
    <li class="nav-item">
    <a class="nav-link" href="https://scholar.google.com.au/citations?user=ECYMO3YAAAAJ&amp;hl=en&amp;authuser=1">
<p>Scholar</p>
</a>
  </li>  
</ul>
    </div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>




</body></html>